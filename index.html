<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>dvlproadの博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="学而时习之不亦说乎(dvlproad)">
<meta name="keywords" content="blog,IT,iOS,Flutter">
<meta property="og:type" content="website">
<meta property="og:title" content="dvlproadの博客">
<meta property="og:url" content="https://dvlproad.github.io/index.html">
<meta property="og:site_name" content="dvlproadの博客">
<meta property="og:description" content="学而时习之不亦说乎(dvlproad)">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="dvlproadの博客">
<meta name="twitter:description" content="学而时习之不亦说乎(dvlproad)">
  
    <link rel="alternate" href="/atom.xml" title="dvlproadの博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">dvlproadの博客</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">整理及总结平时过程中的知识点</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
          <a class="main-nav-link" href="/about">关于</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://dvlproad.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Architecture架构/h5_native_interacte/h5js/dvlp_h5js_h5Action_demo" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/Architecture架构/h5_native_interacte/h5js/dvlp_h5js_h5Action_demo/" class="article-date">
  <time datetime="2024-01-31T02:54:52.172Z" itemprop="datePublished">2024-01-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <!--
 * @Author: dvlproad6
 * @Date: 2022-12-27 11:59:38
 * @LastEditors: dvlproad
 * @LastEditTime: 2023-10-10 22:44:58
 * @Description: 调试h5与app交互的网页demo
-->

<!--
一、使用fileUrl参数
1、本地服务器测试
url1:  http://localhost:4000/Architecture架构/h5_native_interacte/h5js/dvlp_h5js_demo.html?参数如下eg中的值
eg1.1: fileUrl=dvlp_h5js_demo.json
eg1.2: fileUrl=http://localhost:4000/Architecture架构/h5_native_interacte/h5js/dvlp_h5js_demo.json

2、远程服务器测试
url2:  https://dvlproad.github.io/Architecture架构/h5_native_interacte/h5js/dvlp_h5js_demo.html?参数如下eg中的值
eg2.1: fileUrl=dvlp_h5js_demo.json
eg2.2: fileUrl=https://dvlproad.github.io/Architecture架构/h5_native_interacte/h5js/dvlp_h5js_demo.json
eg2.3(测试跨域): fileUrl=https://raw.githubusercontent.com/dvlproad/dvlproad.github.io/master/Architecture%E6%9E%B6%E6%9E%84/h5_native_interacte/h5js/dvlp_h5js_demo.json
eg2.4(测试跨域): 
eg2.5(测试跨域): 

二、使用各种dataJson参数
1、本地服务器测试
url1:  http://localhost:4000/Architecture架构/h5_native_interacte/h5js/dvlp_h5js_demo.html?参数如下eg中的值
eg1.1(未编码h5CallBridgeSendMessage，在浏览器中验证可以。但在app中不行，必须对每个参数编码后再赋值，以避免参数中含中文或者对象): 
h5CallBridgeActionDes=跳转到app指定页面_Name&h5CallBridgeActionName=h5CallBridgeAction_jumpAppPage&h5CallBridgeSendMessage={"pageName":"imChatPage","pageParams":{"conversationID":"126191","imUserId":"1602856363702501376","showName":"婉艺","type":1,"dialogSubjectId":"1506196208391966720"}}
eg1.2(有编码h5CallBridgeSendMessage，验证可以): 
h5CallBridgeActionDes=跳转到app指定页面_Name&h5CallBridgeActionName=h5CallBridgeAction_jumpAppPage&h5CallBridgeSendMessage=%7B%22pageName%22%3A%22imChatPage%22%2C%22pageParams%22%3A%7B%22conversationID%22%3A%22126191%22%2C%22imUserId%22%3A%221602856363702501376%22%2C%22showName%22%3A%22%E5%A9%89%E8%89%BA%22%2C%22type%22%3A1%2C%22dialogSubjectId%22%3A%221506196208391966720%22%7D%7D
/h5_native_interacte/h5js/dvlp_h5js_demo.html
-->

<!--
注入js方法66
http://localhost:4000/Architecture架构/h5_native_interacte/h5js/dvlp_h5js_demo.html?
eg:
injectedH5MethodFileUrl=dvlp_h5js_h5Action_demo.json
-->

<!-- 移动本地引入的相对css和js文件到html前面，避免使用时候出现错误 -->
<link rel="StyleSheet" href="../commoncss/common_alert.css" type="text/css">
<link rel="StyleSheet" href="css/dvlp_h5js_h5Action_demo.css" type="text/css">


<!-- [移动端调试神器vConsole使用详解](https://www.jb51.net/article/244750.htm) -->
<script src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js"></script>
<script>
  // VConsole 默认会挂载到 `window.VConsole` 上
  var vConsole = new window.VConsole();
  // 接下来即可照常使用 `console` 等方法
  console.log('Hello world');

  // 结束调试后，可移除掉
  vConsole.destroy();
</script>


<!-- [引入jquery.js 修复出现的错误：ReferenceError: $ is not defined](https://blog.csdn.net/lq_ruonan/article/details/53690960) -->
<script src="https://code.jquery.com/jquery-3.6.3.js" type="text/javascript" charset="utf-8"></script>
<!-- <script src="js/jQuery.js" type="text/javascript" charset="utf-8"></script> -->


<script src="../commonjs/common_url_util.js" type="text/javascript" charset="utf-8"></script>
<script src="../commonjs/common_read_file.js" type="text/javascript" charset="utf-8"></script>

<script src="../commonjs/element_value.js" type="text/javascript" charset="utf-8"></script>


<!DOCTYPE html>
<html lang="en">

<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <!-- [was loaded over HTTPS, but requested an insecure错误解决](https://blog.csdn.net/weixin_40918067/article/details/117839199) -->
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  <title>html demo</title>
</head>

<body>
  <div class="dialog hide">
    <div class="content">
      <div class="msg" id="msg">消息内容</div>
      <button class="close-btn" onclick="handleCloseDialog()">我知道了</button>
    </div>
  </div>
  <div id="pageTilteView" style="text-align: center; font-size: 20px;">
    app内的网页h5调用app的演示demo
    <button onclick="_h5Action_goDemoPage()" style="font-size: 12px;">查看示例</button>
    <button onclick="_h5Action_goDemoPage()" style="font-size: 12px;">查看注入的h5示例</button>
  </div>
  <div id="pageSubTilteView" style="text-align: center; font-size: 14px;">数据来源于：xxx</div>


  <div id="inputContainer">H5到app的入参
    <div class="title1">1、app内的h5调用app的-桥接方法名信息：
      <div class="title2">桥接方法名的值：</div>
      <textarea class="textarea_one_line" id="h5CallBridgeActionNameDataView">桥接方法名的值</textarea>

      <div class="title2">桥接方法名的介绍：</div>
      <textarea class="textarea_one_line" id="h5CallBridgeActionDesDataView">桥接方法名的介绍</textarea>
    </div>

    <div class="title1">2、app内的h5调用app桥接方法后，发送的参数信息：
      <div class="title2">参数值：</div>
      <div class="title_prompt">(注:如果key或value缺少引号",则一定是你入参的时候,json没有先转义)<button onclick="_h5Action_goJsonEscapePage()" style="font-size: 12px;">json转义工具</button></div>
      <textarea class="textarea_argument" id="h5CallBridgeSendMessageDataView">参数值</textarea>

      <div class="title2">参数值的介绍：</div>
      <textarea class="textarea_decription_multiline" id="h5CallBridgeDescriptionDataView">参数值的介绍</textarea>
    </div>
  </div>

  <button class="button_full_width" id="evalButtonView" onclick="_h5CallBridgeAction_eval()">执行上述的h5调用app的方法</button>

  <div class="div_spearte"></div>
  <div id="outputContainer">app给H5的回值
    <div class="title1">app内的h5调用app桥接方法后，app给H5的回值信息：
      <div class="title2">回值：<button onclick="_h5Action_showAppResultDemoValue()" style="font-size: 12px;">回值demo</button></div>
      <textarea class="textarea_argument" id="bridgeCallH5ActionDataView">回值</textarea>

      <!-- <div class="title2">回值的介绍：</div>
      <textarea class="textarea_decription_multiline" id="bridgeCallH5ActionDescriptionDataView">回值的介绍</textarea> -->
    </div>
  </div>


  <!-- <div>分享内容到指定的分享方式(微信聊天页面等)</div>
  <button
    onclick="h5Action_updateTextAreaValue_share('只是分享网页链接，没其他操作')">'硬编码的按钮：只是分享网页链接，没其他操作'</button>
  <button
    onclick="h5Action_updateTextAreaValue_share('分享链接，且链接可打开app的_原生页面')">'硬编码的按钮：分享链接，且链接可打开app的_原生页面'</button>
  <button
    onclick="h5Action_updateTextAreaValue_share('分享链接，且链接可打开app的_网页游戏')">'硬编码的按钮：分享链接，且链接可打开app的_网页游戏'</button> -->

  <div id="h5Action_updateTextAreaValue_buttons_div"></div>

</body>



<!-- 动态注入js方法 -->
<script>
  var injectedJSMethods = [
    {
      "sectionTitle": "测试的",
      "sectionDatas": [
        {
          "name": "test",
          "arg": {
            "callback": "h5CallBridgeAction_showAppToast",
            "callback_arg": {
              "message": `恭喜您分享成功3459`
            },
          },
        }
      ],
    }
  ];

  /// 初始化数据
  async function initInjectedJSData() { // 注意必须加 async ,否则函数内使用 await 会报错
    console.log("查看是否有使用url_param_injectedH5MethodFileUrl参数,若无，则将使用本html的默认数据");
    let url_param_injectedH5MethodFileUrl = getQueryString("injectedH5MethodFileUrl"); // 从浏览器的网页地址中读取 fileUrl 参数
    console.log(`========url_param_injectedH5MethodFileUrl:${url_param_injectedH5MethodFileUrl}`);

    if (url_param_injectedH5MethodFileUrl != null) {
      injectedJSMethods = await readJson(url_param_injectedH5MethodFileUrl);
    }

    _demoSectionArray = injectedJSMethods;
    _showSuccessUI(_demoSectionArray);
  }
  initInjectedJSData();


  var sectionCount = injectedJSMethods.length;
  for (let sectionIndex = 0; sectionIndex < sectionCount; sectionIndex++) {
    const sectionElement = injectedJSMethods[sectionIndex];

    var sectionDataArray = sectionElement["sectionDatas"];
    var rowCount = sectionDataArray.length;
    for (let rowIndex = 0; rowIndex < rowCount; rowIndex++) {
      const element = sectionDataArray[rowIndex];

      var h5ActionName = element["name"];
      window[h5ActionName] = (param) => {
        var funName = element["arg"]["callback"];
        var callbackArg = element["arg"]["callback_arg"];
        var sendMessage = "";
        if (callbackArg != null) {
          sendMessage = JSON.stringify(callbackArg);
        }
        try {
          eval(funName).postMessage(sendMessage);
        } catch (err) {
          // console.log(`---------------err:${err}`);
          _showAlert(err);
        }
      }
    }


  }

  window["aaa"] = (param) => {
    console.log(`✅吃啥11156775${param}`);
    _showAlert(`✅吃啥11156775${param}`);

    var tmp = arguments.callee.toString();
    var re = /function\s*(\w*)/i;
    var matches = re.exec(tmp);//方法名
    var id = matches[1];
    console.log(`✅示范方法2${id}`);
  }





  // if (typeof __on_did_change_app_lifecycle_state=="function"){
  //   console.log(`✅示范方法`);
  // } else {
  //   console.log(`❌示范方法`);
  // }


</script>



<script>
  // 初始化
  // localStorage.setItem('vConsole_switch_x', 50)
  // var vConsole = new VConsole();
  // console.log('Hello world');
  var _demoSectionArray;
  var h5CallBridgeActionDesArray = [];

  // function readJson(url) {
  //   var request = new XMLHttpRequest();
  //   request.open("get", url);/*设置请求方法与路径*/
  //   request.send(null);/*不发送数据到服务器*/
  //   request.onload = function () {/*XHR对象获取到返回信息后执行*/
  //     if (request.status == 200) {/*返回状态为200，即为数据获取成功*/
  //       var json = JSON.parse(request.responseText);
  //       for (var i = 0; i < json.length; i++) {
  //         console.log(json[i].name);
  //       }
  //       console.log(json);
  //       debugger
  //     }
  //   }
  // }

  function handleCloseDialog() {
    document.querySelector(".dialog").classList.add("hide");
    // copy(".msg")
  }
  function handleShowDialog() {
    document.querySelector(".dialog").classList.remove("hide");
  }

  // function copy(id) {
  //   var clipboard = new Clipboard(id);
  //   clipboard.on('success', function (e) {
  //     _showAlert("复制成功");
  //     //可执行其他代码操作
  //   });
  //   clipboard.on('error', function () {
  //     _showAlert("复制失败")
  //   });
  // }

  function _showAlert(msg) {
    handleShowDialog();
    let t = document.querySelector(".msg");
    t.innerHTML = msg;
  }


  function _checkDataJson() {
    var promptMessage = "已设置本html的dataJson参数，则将获取使用哪些参数构造出只有一个元素的 demoMapArray 值";
    var remoteArrayResultMessage = `${promptMessage}:获取浏览器地址指定的dataJson各参数的值来作为 demoMapArray 成功✅`;
    console.log(`${remoteArrayResultMessage}`);

    // http://localhost:4000/Architecture架构/h5_native_interacte/h5js/dvlp_h5js_demo.html?h5CallBridgeActionDes=跳转到app指定页面_Name&h5CallBridgeActionName=h5CallBridgeAction_jumpAppPage&h5CallBridgeSendMessage={"pageName":"imChatPage","pageParams":{"conversationID":"126191","imUserId":"1602856363702501376","showName":"婉艺","type":1,"dialogSubjectId":"1506196208391966720"}}
    // http://localhost:4000/Architecture架构/h5_native_interacte/h5js/dvlp_h5js_demo.html?h5CallBridgeActionDes=跳转到app指定页面_Name&h5CallBridgeActionName=h5CallBridgeAction_jumpAppPage&h5CallBridgeSendMessage=%7B%22pageName%22%3A%22imChatPage%22%2C%22pageParams%22%3A%7B%22conversationID%22%3A%22126191%22%2C%22imUserId%22%3A%221602856363702501376%22%2C%22showName%22%3A%22%E5%A9%89%E8%89%BA%22%2C%22type%22%3A1%2C%22dialogSubjectId%22%3A%221506196208391966720%22%7D%7D
    // {
    //     "h5CallBridgeActionDes": "跳转到app指定页面_Name",
    //     "h5CallBridgeActionName": "h5CallBridgeAction_jumpAppPage",
    //     "h5CallBridgeSendMessage": {
    //       "pageName": "imChatPage",
    //       "pageParams": {
    //         "conversationID": "126191",
    //         "imUserId": "1602856363702501376",
    //         "showName": "婉艺",
    //         "type": 1,
    //         "dialogSubjectId": "1506196208391966720"
    //       }
    //     }
    //   }
    // 从浏览器的网页地址中读取 h5CallBridgeSendMessage 等参数
    console.log("dataJson各参数获取后，但获取过程中内部已解码，值分别如下:")
    let param_string_h5CallBridgeActionDes = getQueryString("h5CallBridgeActionDes");
    let param_string_h5CallBridgeActionName = getQueryString("h5CallBridgeActionName");
    let param_string_h5CallBridgeSendMessage = getQueryString("h5CallBridgeSendMessage");
    let param_string_h5CallBridgeDescription = getQueryString("h5CallBridgeDescription");
    let param_string_appCallbackDemo_ValueAndDescription = getQueryString("appCallbackDemo_ValueAndDescription");
    console.log(`========param_string_h5CallBridgeActionDes:${param_string_h5CallBridgeActionDes}`);
    console.log(`========param_string_h5CallBridgeActionName:${param_string_h5CallBridgeActionName}`);
    console.log(`========param_string_h5CallBridgeSendMessage:${param_string_h5CallBridgeSendMessage}`);
    console.log(`========param_string_h5CallBridgeDescription:${param_string_h5CallBridgeDescription}`);
    console.log(`========param_string_appCallbackDemo_ValueAndDescription:${param_string_appCallbackDemo_ValueAndDescription}`);

    // console.log("dataJson各参数解码后，值分别如下:")
    // let param_decode_h5CallBridgeActionDes = decodeURIComponent(param_string_h5CallBridgeActionDes);
    // let param_decode_h5CallBridgeActionName = decodeURIComponent(param_string_h5CallBridgeActionName);
    // let param_decode_h5CallBridgeSendMessage = decodeURIComponent(param_string_h5CallBridgeSendMessage);
    // console.log(`========param_decode_h5CallBridgeActionDes:${param_decode_h5CallBridgeActionDes}`);
    // console.log(`========param_decode_h5CallBridgeActionName:${param_decode_h5CallBridgeActionName}`);
    // console.log(`========param_decode_h5CallBridgeSendMessage:${param_decode_h5CallBridgeSendMessage}`);

    // console.log("dataJson各参数解码后并转object模型，值分别如下:")
    // let param_object_h5CallBridgeSendMessage = JSON.parse(param_decode_h5CallBridgeSendMessage);
    // console.log(`========param_object_h5CallBridgeSendMessage:${param_object_h5CallBridgeSendMessage}`);

    let demoMap1 = {
      "h5CallBridgeActionDes": param_string_h5CallBridgeActionDes,
      "h5CallBridgeActionName": param_string_h5CallBridgeActionName,
      "h5CallBridgeSendMessage": param_string_h5CallBridgeSendMessage,
      "h5CallBridgeDescription": param_string_h5CallBridgeDescription,
      "appCallbackDemo_ValueAndDescription": param_string_appCallbackDemo_ValueAndDescription,
    };

    _demoSectionArray = [
      {
        "sectionTitle": "通过给此html传入dataJson各参数，所以这里只有一个元素",
        "sectionDatas": [
          demoMap1
        ],
      }
    ];

    return true;
  }

  async function _checkFileUrlUI(fileUrl) { // 注意必须加 async ,否则函数内使用 await 会报错
    // http://localhost:4000/Architecture架构/h5_native_interacte/h5js/dvlp_h5js_demo.html?fileUrl=http://localhost:4000/Architecture架构/h5_native_interacte/h5js/dvlp_h5js_demo.json
    var promptMessage = "已设置本html的json文件路径，则将获取该路径下的json值作为 _demoSectionArray 值";
    _demoSectionArray = await readJson(fileUrl);
    if (_demoSectionArray == null) { // 本html未将json文件的值赋值给 demoMapArray
      remoteArrayResultMessage = `${promptMessage}:获取浏览器地址指定的json文件${fileUrl}的值来作为 demoMapArray 失败❌，请根据以下可能原因检查`;
      let fileUrlFailureReason1 = `失败可能原因1:路径${fileUrl}写错`;
      let fileUrlFailureReasonLocal = "失败可能原因2:如果本html是本地直接打开的，则json文件的需手动拷贝到本html中(因为暂不支持读取本地的json文件)";
      let fileUrlFailureReasonRemote = "失败可能原因3:如果本html是从网络地址上打开的，则fileUrl必须和本html的所在工程一致(因为暂不支持跨域访问)";
      remoteArrayResultMessage = `${remoteArrayResultMessage}\n${fileUrlFailureReason1}\n${fileUrlFailureReasonLocal}\n${fileUrlFailureReasonRemote}`
      console.log(`${remoteArrayResultMessage}`);

      _showErrorUI(remoteArrayResultMessage);
      return false;

    } else {
      remoteArrayResultMessage = `${promptMessage}:获取浏览器地址指定的json文件${fileUrl}的值来作为 demoMapArray 成功✅`;
      console.log(`${remoteArrayResultMessage}`);
      return true;
    }
  }

  function _showErrorUI(errorMessage) {
    let htmlStr = "";
    var h5Action_warningButton_onClick = `_h5CallBridgeAction_alert("${errorMessage}");`;
    var iButtonHtmlString = `<button onClick='${h5Action_warningButton_onClick}' style="width: 95%; height: 30px;">"${errorMessage}</button>`

    htmlStr += `${iButtonHtmlString}`;
    document.querySelector("#h5Action_updateTextAreaValue_buttons_div").innerHTML = htmlStr;
  }

  // 执行 h5 弹出错误提示的 alert
  function _h5CallBridgeAction_alert(errorMessage) {
    console.log(errorMessage);
    alert(errorMessage);
  }

  function _showSuccessUI(demoSectionArray) {
    console.log(`最终要显示的数据如下:\n demoSectionArray:${demoSectionArray}\n demoSectionArrayString:${JSON.stringify(demoSectionArray)}`);

    var sectionCount = demoSectionArray.length;
    // 当整个section就只有一个可选操作元素的时候，直接使用
    if (sectionCount == 1) {
      const sectionDatas = demoSectionArray[0]["sectionDatas"];
      if (sectionDatas.length == 1) {
        const element = sectionDatas[0];
        _useDirectlyWhenOnlyOneElement(element);
        return;
      }
    }

    /// 当整个section不止一个元素的时候，罗列在界面上，供选择使用
    let htmlStr = "";
    for (let sectionIndex = 0; sectionIndex < sectionCount; sectionIndex++) {
      const sectionElement = demoSectionArray[sectionIndex];

      let sectionHtmlString = _getSectionHtmlString(sectionIndex, sectionElement["sectionDatas"]);

      // let sectionHtmlString = `<div id="pageTilteView" style="text-align: center; font-size: 20px;">演示的section</div>`
      var iSectionDivHtmlString = `
      <div id='section_id_${sectionIndex}' style="width: 95%;">
        <div style="width: 95%; background-color: ${sectionElement["sectionBG"]};">${sectionElement["sectionTitle"]}</div>
        ${sectionHtmlString}
      </div>
      `
      if (sectionIndex < sectionCount - 1) {
        iSectionDivHtmlString += `<div style="height: 20px;"></div>`;
      }
      // console.log(`iSectionDivHtmlString${sectionIndex}=${iSectionDivHtmlString}`);
      htmlStr += `${iSectionDivHtmlString}`;
    }

    document.querySelector("#h5Action_updateTextAreaValue_buttons_div").innerHTML = htmlStr;
  }

  /// 当整个section就只有一个元素的时候，直接使用
  function _useDirectlyWhenOnlyOneElement(element) {
    var h5CallBridgeActionDes = element["h5ActionDes"];
    h5CallBridgeActionDesArray.push(h5CallBridgeActionDes);

    // [JS字符串拼接的几种方式](https://blog.csdn.net/u012320487/article/details/123822785)
    sectionIndex = 0;
    rowIndex = 0;
    var h5Action_updateTextAreaValue_onClick = `_h5Action_updateText_byIndex(${sectionIndex}, ${rowIndex});`;

    // [js(JavaScript)字符串转换成变量名](https://huaweicloud.csdn.net/63a55da9b878a54545945264.html?spm=1001.2101.3001.6661.1&utm_medium=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~activity-1-102934655-blog-92951596.pc_relevant_recovery_v2&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~activity-1-102934655-blog-92951596.pc_relevant_recovery_v2&utm_relevant_index=1)
    // 利用 eval() 函数计算 JavaScript 字符串，并把它作为脚本代码来执行。如果参数是一个表达式，eval() 函数将执行表达式。如果参数是Javascript语句，eval()将执行 Javascript 语句。
    var funName = h5Action_updateTextAreaValue_onClick;

    try {
      eval(funName);
    } catch (err) {
      // console.log(`---------------err:${err}`);
      _showAlert(err);
    }

  }

  function _getSectionHtmlString(sectionIndex, demoMapArray) {
    console.log(`${sectionIndex}当前区要显示的数据如下:\n demoMapArray:${demoMapArray}\n demoMapArrayString:${JSON.stringify(demoMapArray)}`);

    let sectionHtmlString = "";
    var demoMapCount = demoMapArray.length;
    for (let rowIndex = 0; rowIndex < demoMapCount; rowIndex++) {
      const element = demoMapArray[rowIndex];
      var h5CallBridgeActionDes = element["h5ActionDes"];
      h5CallBridgeActionDesArray.push(h5CallBridgeActionDes);

      // [JS字符串拼接的几种方式](https://blog.csdn.net/u012320487/article/details/123822785)
      var h5Action_updateTextAreaValue_onClick = `_h5Action_updateText_byIndex(${sectionIndex}, ${rowIndex});`;
      var iButtonHtmlString = `<button onClick='${h5Action_updateTextAreaValue_onClick}' style="width: 95%; height: 30px;">${sectionIndex + 1}.${rowIndex + 1}.${h5CallBridgeActionDes}</button>`
      if (rowIndex > 0) {
        // htmlStr += `<>`;
      }
      console.log(`iButtonHtmlString${rowIndex}=${iButtonHtmlString} element=${JSON.stringify(element)}`);
      sectionHtmlString += `${iButtonHtmlString}`;
    }
    return sectionHtmlString;
  }



  /// 根据标题，获取其整个数据模型
  function _getElementByH5CallBridgeActionDes(h5CallBridgeActionDes) {
    // var index = h5CallBridgeActionDesArray.indexOf(h5CallBridgeActionDes);
    // var demoMap = _demoSectionArray[index];
    var targetSectionIndex = -1;
    var targetRowIndex = -1;

    console.log(`============0:查找描述是【${h5CallBridgeActionDes}】的元素`);
    for (let sectionIndex = 0; sectionIndex < _demoSectionArray.length; sectionIndex++) {
      var sectionElement = _demoSectionArray[sectionIndex];
      var elementArray = sectionElement["sectionDatas"];
      // console.log(`============1:elementArray=${JSON.stringify(elementArray)}`);
      var hasFound = false;
      for (let rowIndex = 0; rowIndex < elementArray.length; rowIndex++) {
        const element = elementArray[rowIndex];
        // console.log(`============2:element=${JSON.stringify(element)}`);
        if (element["h5CallBridgeActionDes"] == h5CallBridgeActionDes) {
          targetSectionIndex = sectionIndex;
          targetRowIndex = rowIndex;
          hasFound = true;
          console.log(`============3Found:${sectionIndex}.${rowIndex}${element["h5ActionDes"]}`);
          break;
        } else {
          console.log(`============3NOThis:${sectionIndex}.${rowIndex}${element["h5ActionDes"]}`);
        }
      }

      if (hasFound == true) {
        break;
      }

    }

    return _getElementByIndex(targetSectionIndex, targetRowIndex);
  }

  /// 根据标题，获取其整个数据模型
  function _getElementByIndex(sectionIndex, rowIndex) {
    if (sectionIndex < 0 || rowIndex < 0) {
      return null;
    }
    var demoMap = _demoSectionArray[sectionIndex]["sectionDatas"][rowIndex];

    return demoMap;
  }

  /// 更新 标题
  function _h5Action_updateText_forTitle(dataFromSource) {
    console.log(`更新UI上的副标题为:${dataFromSource}`);
    document.getElementById("pageSubTilteView").innerHTML = `（${dataFromSource}）`;
  }

  /// 更新 h5调用的app桥接方法名 和  h5调用app桥接方法后，发送的数据
  function _h5Action_updateText_byIndex(sectionIndex, rowIndex) {
    var demoMap = _getElementByIndex(sectionIndex, rowIndex);
    console.log(`-------更新UI上的各部分数据为当前所选择的值${sectionIndex}.${rowIndex}-------demoMap=${demoMap},demoMapString=${JSON.stringify(demoMap)}`);

    _h5Action_updateText_forData(demoMap);
  }

  /// 更新 h5调用的app桥接方法名 和  h5调用app桥接方法后，发送的数据
  function _h5Action_updateText_forData(element) {
    updateElementValueById("h5CallBridgeActionDesDataView", element["h5ActionDes"]);
    updateElementValueById("h5CallBridgeActionNameDataView", element["h5ActionName"]);
    updateElementValueById("h5CallBridgeSendMessageDataView", element["h5ActionArgs"]);
    updateElementValueById("h5CallBridgeDescriptionDataView", element["h5CallBridgeDescription"]);



    updateElementValueById("bridgeCallH5ActionDataView", element["appCallbackDemo_ValueAndDescription"]);
  }

  /// 获取h5调用的app桥接方法名
  function _h5Action_getSendMethod() {
    var sendMethod = document.getElementById("h5CallBridgeActionNameDataView").value;
    return sendMethod;
  }

  /// 获取h5调用app桥接方法后，发送的数据
  function _h5Action_getSendMessage() {
    var sendMessage = document.getElementById("h5CallBridgeSendMessageDataView").value;
    return sendMessage;
  }

  // 执行 h5调用app的桥接方法
  function _h5CallBridgeAction_eval() {
    // var funName = 'h5CallBridgeAction_showAppToast';
    // var sendMessage = '恭喜您分享成功';
    // h5CallBridgeAction_showAppToast.postMessage(sendMessage);

    // [js(JavaScript)字符串转换成变量名](https://huaweicloud.csdn.net/63a55da9b878a54545945264.html?spm=1001.2101.3001.6661.1&utm_medium=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~activity-1-102934655-blog-92951596.pc_relevant_recovery_v2&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~activity-1-102934655-blog-92951596.pc_relevant_recovery_v2&utm_relevant_index=1)
    // 利用 eval() 函数计算 JavaScript 字符串，并把它作为脚本代码来执行。如果参数是一个表达式，eval() 函数将执行表达式。如果参数是Javascript语句，eval()将执行 Javascript 语句。
    var funName = _h5Action_getSendMethod();
    var sendMessage = _h5Action_getSendMessage();

    try {
      eval(funName).postMessage(sendMessage);
    } catch (err) {
      // console.log(`---------------err:${err}`);
      _showAlert(err);
    }

    console.log(sendMessage.message);
  }


  /// 提供给原生调用的h5方法(用于测试原生调用的方法及传递回来的返回值)
  function bridgeCallH5Action_showCallbackJsonString(jsonString) {
    if (jsonString == null || jsonString == undefined || !jsonString) {
      _showAlert("没有回传的jsonString值");
      return;
    }

    updateElementValueById("bridgeCallH5ActionDataView", jsonString);
    // updateElementValueById("bridgeCallH5ActionDescriptionDataView", element["argument"]["value"]);
  }

  /// 显示 h5调用app后， app回传给h5的 回值 demo 示例
  function _h5Action_showAppResultDemoValue() {
    var currentH5CallBridgeActionDes = getElementValueById("h5CallBridgeActionDesDataView");

    var element = _getElementByH5CallBridgeActionDes(currentH5CallBridgeActionDes);
    if (element == null || element == undefined || !element) {
      _showAlert(`您还未提供描述是【${currentH5CallBridgeActionDes}】的json demo示例,请检查您的描述。`);
      return;
    }

    var appCallbackDemoValue = element["appCallbackDemo_ValueAndDescription"];
    if (appCallbackDemoValue == null || appCallbackDemoValue == undefined || !appCallbackDemoValue) {
      _showAlert(`您还未提供描述是【${currentH5CallBridgeActionDes}】的回值demo示例，若需要请先行补充`);
      return;
    }


    updateElementValueById("bridgeCallH5ActionDataView", appCallbackDemoValue);
  }

  /// 跳转到示例页面
  function _h5Action_goDemoPage() {
    window.location.href = '?fileUrl=dvlp_h5js_demo.json';
  }
  /// 跳转到示例页面
  function _h5Action_goDemoPage() {
    window.location.href = '?fileUrl=dvlp_h5js_h5Action_demo.json';
  }


  /// 跳转到json转义工具页面
  function _h5Action_goJsonEscapePage() {
    window.location.href = "https://zxjson.com/";
  }


</script>

</html>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://dvlproad.github.io/Architecture架构/h5_native_interacte/h5js/dvlp_h5js_h5Action_demo/" data-id="cls067ui4015wb8r48ddx9z0l" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Architecture架构/h5_native_interacte/h5_open_app/dvlp_h5_open_app_browser_url_demo" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/Architecture架构/h5_native_interacte/h5_open_app/dvlp_h5_open_app_browser_url_demo/" class="article-date">
  <time datetime="2024-01-31T02:54:30.958Z" itemprop="datePublished">2024-01-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <!--
 * @Author: dvlproad
 * @Date: 2022-12-27 11:59:38
 * @LastEditors: dvlproad
 * @LastEditTime: 2023-02-15 14:23:19
 * @Description: 调试h5与app交互的网页demo
-->
<!--
一、使用fileUrl参数
1、本地服务器测试
url1:  http://localhost:4000/Architecture架构/h5js/dvlp_h5js_demo/dvlp_h5js_demo.html?参数如下eg中的值
eg1.1: fileUrl=dvlp_h5js_demo.json
eg1.2: fileUrl=http://localhost:4000/Architecture架构/h5js/dvlp_h5js_demo/dvlp_h5js_demo.json

2、远程服务器测试
url2:  https://dvlproad.github.io/Architecture架构/h5js/dvlp_h5js_demo/dvlp_h5js_demo.html?参数如下eg中的值
eg2.1: fileUrl=dvlp_h5js_demo.json
eg2.2: fileUrl=https://dvlproad.github.io/Architecture架构/h5js/dvlp_h5js_demo/dvlp_h5js_demo.json
eg2.3(测试跨域): fileUrl=https://raw.githubusercontent.com/dvlproad/dvlproad.github.io/master/Architecture%E6%9E%B6%E6%9E%84/h5js/dvlp_h5js_demo/dvlp_h5js_demo.json
eg2.4(测试跨域): 
eg2.5(测试跨域): 

二、使用各种dataJson参数
1、本地服务器测试
url1:  http://localhost:4000/Architecture架构/h5js/dvlp_h5js_demo/dvlp_h5js_demo.html?参数如下eg中的值
eg1.1(未编码h5CallBridgeSendMessage，在浏览器中验证可以。但在app中不行，必须对每个参数编码后再赋值，以避免参数中含中文或者对象): 
h5CallBridgeActionDes=跳转到app指定页面_Name&h5CallBridgeActionName=h5CallBridgeAction_jumpAppPage&h5CallBridgeSendMessage={"pageName":"imChatPage","pageParams":{"conversationID":"126191","imUserId":"1602856363702501376","showName":"婉艺","type":1,"dialogSubjectId":"1506196208391966720"}}
eg1.2(有编码h5CallBridgeSendMessage，验证可以): 
h5CallBridgeActionDes=跳转到app指定页面_Name&h5CallBridgeActionName=h5CallBridgeAction_jumpAppPage&h5CallBridgeSendMessage=%7B%22pageName%22%3A%22imChatPage%22%2C%22pageParams%22%3A%7B%22conversationID%22%3A%22126191%22%2C%22imUserId%22%3A%221602856363702501376%22%2C%22showName%22%3A%22%E5%A9%89%E8%89%BA%22%2C%22type%22%3A1%2C%22dialogSubjectId%22%3A%221506196208391966720%22%7D%7D

-->

<!-- 移动本地引入的相对css和js文件到html前面，避免使用时候出现错误 -->
<link rel="StyleSheet" href="../commoncss/common_alert.css" type="text/css">
<link rel="StyleSheet" href="css/dvlp_h5_open_app_browser_url_demo.css" type="text/css">


<!-- [移动端调试神器vConsole使用详解](https://www.jb51.net/article/244750.htm) -->
<script src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js"></script>
<script>
  // VConsole 默认会挂载到 `window.VConsole` 上
  var vConsole = new window.VConsole();
  // 接下来即可照常使用 `console` 等方法
  console.log('Hello world');

  // 结束调试后，可移除掉
  vConsole.destroy();
</script>


<!-- [引入jquery.js 修复出现的错误：ReferenceError: $ is not defined](https://blog.csdn.net/lq_ruonan/article/details/53690960) -->
<script src="https://code.jquery.com/jquery-3.6.3.js" type="text/javascript" charset="utf-8"></script>
<!-- <script src="js/jQuery.js" type="text/javascript" charset="utf-8"></script> -->

<!-- 
<script src="../../../HTML/common_js/object_util.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../HTML/common_js/url_util.js" type="text/javascript" charset="utf-8"></script>
<script src="http://localhost:4000/HTML/common_js/object_util.js" type="text/javascript" charset="utf-8"></script>
<script src="http://localhost:4000/HTML/common_js/url_util.js" type="text/javascript" charset="utf-8"></script>
-->


<script src="../commonjs/common_object_util.js" type="text/javascript" charset="utf-8"></script>
<script src="../commonjs/common_url_util.js" type="text/javascript" charset="utf-8"></script>
<script src="../commonjs/common_url_update.js" type="text/javascript" charset="utf-8"></script>
<script src="../commonjs/common_read_file.js" type="text/javascript" charset="utf-8"></script>

<script src="../commonjs/element_value.js" type="text/javascript" charset="utf-8"></script>



<!DOCTYPE html>
<html lang="en">

<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <!-- [was loaded over HTTPS, but requested an insecure错误解决](https://blog.csdn.net/weixin_40918067/article/details/117839199) -->
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  <title>html demo</title>
</head>



<body>
  <div class="dialog hide">
    <div class="content">
      <div class="msg" id="msg">消息内容</div>
      <button class="close-btn" onclick="handleCloseDialog()">我知道了</button>
    </div>
  </div>

  <div id="pageTilteView" style="text-align: center; font-size: 20px;">
    在指定实际项目页面(非之前的测试工具页)中测试所选路由
    <button onclick="_h5Action_goDemoPage()" style="font-size: 12px;">查看示例</button>
  </div>
  <div id="pageSubTilteView" style="text-align: center; font-size: 14px;">数据来源于：xxx</div>

  <div class="div_spearte"></div>
  <div id="h5OpenAppUrlCreate_type_custom_url">自己生成
    <div class="title1" id="h5OpenAppUrlCreate_type_custom_url_headerView">1、指定浏览器要打开的测试页面的-主地址信息：
      <div class="title2" id="h5OpenAppUrlCreate_type_custom_url_name_titleView">主地址值：</div>
      <textarea class="textarea_one_line" id="custom_browserUrl_main_Value_valueView">主地址值</textarea>

      <div class="title2" id="h5OpenAppUrlCreate_type_custom_url_name_titleView">主地址介绍：</div>
      <textarea class="textarea_one_line" id="custom_browserUrl_main_Description_valueView">主地址介绍</textarea>
    </div>


    <div class="title1"> 2、指定浏览器要打开的测试页面的-app参数信息(用于从浏览器直接打开app)：(可不传，且不传的时候，页面本身也有一个内嵌的默认值供测试)
      <div class="title2" id="h5OpenAppUrlCreate_type_custom_url_name_titleView">app参数信息使用的key(用该key将其值一起携带给页面)：</div>
      <textarea class="textarea_one_line" id="custom_browserUrl_appRouteUrlUseKey_valueView">
        app参数信息使用什么key添加到url上
      </textarea>

      <div class="title2" id="h5OpenAppUrlCreate_type_custom_url_name_titleView">app参数信息的value：</div>
      <textarea class="textarea_one_appRouteUrl" id="custom_browserUrl_appRouteUrlValue_valueView">app参数信息的值</textarea>

      <div class="title2" id="h5OpenAppUrlCreate_type_custom_url_headerView">app参数信息的value的介绍(功能及内部参数说明等)：</div>
      <textarea class="textarea_one_line" id="custom_browserUrl_appRouteUrl_Description_valueView">其他参数信息的值</textarea>
    </div>

    <div class="title1">
      3、指定浏览器要打开的测试页面的-其他参数信息(网页本身可能需要使用到)：(可不传，如果所传参数在app路由里也要使用的话，需自己加上去。因为app里不会对齐自动添加，是为了避免有时候有重复添加的情况出现)
      <div class="title2" id="h5OpenAppUrlCreate_type_custom_url_name_titleView">其他参数信息的key及其value：</div>
      <textarea class="textarea_one_line" id="custom_browserUrl_otherKeyAndValues_valueView">
        {"inviteCode": 123}
      </textarea>

      <div class="title2" id="h5OpenAppUrlCreate_type_custom_url_name_titleView">其他参数信息的key介绍：</div>
      <textarea class="textarea_decription_multiline" id="custom_browserUrl_otherKeyAndValues_Description_valueView">
        inviteCode: 邀请码
      </textarea>
    </div>
  </div>

  <!-- <div class="div_spearte"></div>
  <div>
    <div id="h5OpenAppUrlCreate_type_custom_url_headerView">生成构成后：</div>

    <div id="h5OpenAppUrlCreate_type_custom_url_name_titleView">自动同步：</div>

    <div id="h5OpenAppUrlCreate_type_custom_url_name_titleView">拆解分析前：</div>
  </div>
  <div class="div_spearte"></div> -->


  <div class="div_spearte"></div>
  <div>
    <button class="button_half_width" id="h5OpenAppUrlCreate_type_directly" onclick="_h5Action_create('custom')">生成/构成
      browseUrl</button>
  </div>
  <div class="div_spearte"></div>

  <div id="h5OpenAppUrlCreate_type_custom_url">直接地址
    <div class="title1"> 最终构成
      <div class="title2" id="h5OpenAppUrlCreate_type_custom_url_name_titleView">最终浏览器地址：</div>
      <textarea class="textarea_one_browseUrl" id="directly_browserUrl_Value_valueView">最终浏览器地址</textarea>
    </div>
  </div>


  <button id="evalButtonView" onclick="_h5CallBridgeAction_eval()" style="background-color: red; color: white; width: 95%; border-width: 0; font-size: 20px;">执行按钮</button>



  <!-- <div>分享内容到指定的分享方式(微信聊天页面等)</div>
  <button
    onclick="h5Action_updateTextAreaValue_share('只是分享网页链接，没其他操作')">'硬编码的按钮：只是分享网页链接，没其他操作'</button>
  <button
    onclick="h5Action_updateTextAreaValue_share('分享链接，且链接可打开app的_原生页面')">'硬编码的按钮：分享链接，且链接可打开app的_原生页面'</button>
  <button
    onclick="h5Action_updateTextAreaValue_share('分享链接，且链接可打开app的_网页游戏')">'硬编码的按钮：分享链接，且链接可打开app的_网页游戏'</button> -->

  <div id="h5Action_updateTextAreaValue_buttons_div"></div>

</body>



<script>

  function getLocal_appRouteElement() {
    var appRouteElement = {
      "value": "yuanwangwu://openpage?pageName=webNavPage&url=https://farm-game.yuanwangwu.com/index.html&shouldHideNavBar=true&inviteCode=123",
      "description": "打开app的网页，进入农场游戏",
    };
    return appRouteElement;
  }

  function getLocalDemoMapArray() {
    // _browserUrl = "http://www.baidu.com/index.com?inviteCode=123&appRouteUrl=yuanwangwu://openpage?pageName=webNavPage&url=https://farm-game.yuanwangwu.com/index.html&shouldHideNavBar=true&inviteCode=123";
    // _browserUrl_appRouteUrlKey = "appRouteUrl";
    // analysisBrowserUrl(_browserUrl, "appRouteUrl");

    var structureElementArray = [
      {
        "sectionTitle": "在游戏页面中测试",
        "sectionDatas": [
          {
            "unique_name": "农场游戏1",
            "website": {
              "value": "https://www.baidu.com/index.html",
              "description": "农场游戏"
            },
            "argument_appRouteUrl_useKey": {
              "value": "appRouteUrl",
              "description": "app参数信息使用的key(用该key将其值一起携带给页面)",
            },
            "argument_others": {
              "value": {
                "inviteCode": 123
              },
              "description": {
                "inviteCode": "邀请码"
              }
            }
          },
          {
            "unique_name": "农场游戏_2",
            "website": {
              "value": "https://www.baidu.com/index.html",
              "description": "农场游戏"
            },
            "argument_appRouteUrl_useKey": {
              "value": "appRouteUrl",
              "description": "app参数信息使用的key(用该key将其值一起携带给页面)",
            },
            "argument_others": {
              "value": {
                "inviteCode": 123
              },
              "description": {
                "inviteCode": "邀请码"
              }
            }
          }
        ]
      }
    ];

    // return null; // 测试本地未赋值时候的界面展示
    return structureElementArray;
  }
</script>


<script>
  /// 解析浏览器地址，并更新到解析器UI
  function analysisBrowserUrl(browserUrl, browserUrl_appRouteUrlKey) {
    // 构造器
    updateElementValueById("directly_browserUrl_Value_valueView", browserUrl);

    // 解析器
    // 1、主地址信息
    _browserUrl_main = getRequestUrlMain(browserUrl);
    updateElementValueById("custom_browserUrl_main_Value_valueView", _browserUrl_main);
    updateElementValueById("custom_browserUrl_main_Description_valueView", "未标明");

    // 2、app参数信息
    _browserUrl_appRouteUrlKey = browserUrl_appRouteUrlKey;
    updateElementValueById("custom_browserUrl_appRouteUrlUseKey_valueView", _browserUrl_appRouteUrlKey);

    _browserUrl_appRouteUrlValue = getValueByQueryKey(browserUrl, browserUrl_appRouteUrlKey);
    updateElementValueById("custom_browserUrl_appRouteUrlValue_valueView", _browserUrl_appRouteUrlValue);

    updateElementValueById("custom_browserUrl_appRouteUrl_Description_valueView", "未标明");

    // 3、其他参数信息
    var browserUrl_params = getRequestUrlParams(browserUrl);
    // var keys = Object.keys(browserUrl_params); // 获取map的所有keys
    // console.log(`keys=${keys}`);
    if (typeof browserUrl_appRouteUrlKey == "undefined" || browserUrl_appRouteUrlKey == null) {
      _browserUrl_otherKeyAndValues = browserUrl_params;
    } else {
      _browserUrl_otherKeyAndValues = deleteObjectByKey(browserUrl_params, [browserUrl_appRouteUrlKey]);
    }
    updateElementValueById("custom_browserUrl_otherKeyAndValues_valueView", _browserUrl_otherKeyAndValues);

    updateElementValueById("custom_browserUrl_otherKeyAndValues_Description_valueView", "未标明");
  }

  /// 更新 h5调用的app桥接方法名 和  h5调用app桥接方法后，发送的数据
  function _h5Action_updateText_byIndex(sectionIndex, rowIndex) {
    var element = _getElementByIndex(sectionIndex, rowIndex);
    console.log(`-------当前所选择的值${sectionIndex}.${rowIndex}-------element=${element},elementString=${JSON.stringify(element)}`);

    structureRouteUrl(element);
  }


  /// 根据当前文本框内容，构造 appRouteElement 元素值
  function _getElementByCurrentText_appRouteElement() {
    var element = {
      "value": getElementValueById("custom_browserUrl_appRouteUrlValue_valueView"),
      "description": getElementValueById("custom_browserUrl_appRouteUrl_Description_valueView")
    };
    return element;
  }

  /// 根据当前文本框内容，构造 element 元素值
  function _getElementByCurrentText() {
    var element = {
      "unique_name": "打开XXXapp_聊天页面_1",
      "website": {
        "value": getElementValueById("custom_browserUrl_main_Value_valueView"),
        "description": getElementValueById("custom_browserUrl_main_Description_valueView")
      },
      "argument_appRouteUrl_useKey": {
        "value": getElementValueById("custom_browserUrl_appRouteUrlUseKey_valueView"),
        "description": getElementValueById("custom_browserUrl_appRouteUrl_Description_valueView")
      },
      "argument_others": {
        "value": getElementValueById("custom_browserUrl_otherKeyAndValues_valueView"),
        "description": getElementValueById("custom_browserUrl_otherKeyAndValues_Description_valueView")
      }
    };

    return element;
  }

  /// 根据选中的元素，构造浏览器地址，并更新到构造器UI
  function updateAppRouteUI(appRouteElement) {
    // 先把元素更新到解析器
    // 2、app参数信息
    updateElementValueById("custom_browserUrl_appRouteUrlValue_valueView", appRouteElement["value"]);
    updateElementValueById("custom_browserUrl_appRouteUrl_Description_valueView", appRouteElement["description"]);

    // 把各个元素整合并更新结果
    _updateResultUI();
  }

  /// 根据当前文本框内容，构造浏览器地址，并更新到构造器UI
  function structureRouteUrlByCurrentText() {
    var element = _getElementByCurrentText();
    structureRouteUrl(element);
  }



  /// 根据选中的元素，构造浏览器地址，并更新到构造器UI
  function structureRouteUrl(element) {
    // 先把元素更新到解析器
    // 1、主地址信息
    updateElementValueById("custom_browserUrl_main_Value_valueView", element["website"]["value"]);
    updateElementValueById("custom_browserUrl_main_Description_valueView", element["website"]["description"]);

    // 2、app参数信息
    updateElementValueById("custom_browserUrl_appRouteUrlUseKey_valueView", element["argument_appRouteUrl_useKey"]["value"]);

    // 3、其他参数信息
    updateElementValueById("custom_browserUrl_otherKeyAndValues_valueView", element["argument_others"]["value"]);
    updateElementValueById("custom_browserUrl_otherKeyAndValues_Description_valueView", element["argument_others"]["description"]);

    // 把各个元素整合并更新结果
    _updateResultUI();
  }

  /// 构造浏览器地址，并更新到构造器UI
  function _updateResultUI() {
    // 获取文本框内容
    var browserUrl_main = document.getElementById("custom_browserUrl_main_Value_valueView").value;

    var browserUrl_appRouteUrlKey = document.getElementById("custom_browserUrl_appRouteUrlUseKey_valueView").value;
    var browserUrl_appRouteUrlValue = document.getElementById("custom_browserUrl_appRouteUrlValue_valueView").value;

    var browserUrl_otherKeyAndValues_string = document.getElementById("custom_browserUrl_otherKeyAndValues_valueView").value;
    var browserUrl_otherKeyAndValues = JSON.parse(browserUrl_otherKeyAndValues_string);

    // 构造文本框值
    var browserUrl = `${browserUrl_main}`;
    // var browserUrl_params = new Object;
    if (browserUrl_appRouteUrlKey != null && browserUrl_appRouteUrlValue != null) {
      // browserUrl_params[browserUrl_appRouteUrlKey] = browserUrl_appRouteUrlValue;
      var appRouteUrlMap = new Object;
      appRouteUrlMap[browserUrl_appRouteUrlKey] = browserUrl_appRouteUrlValue;
      browserUrl = addParamsForUrl(browserUrl, appRouteUrlMap);
    }
    if (browserUrl_otherKeyAndValues != null) {
      browserUrl = addParamsForUrl(browserUrl, browserUrl_otherKeyAndValues);
    }


    // 更新构造器UI
    updateElementValueById("directly_browserUrl_Value_valueView", browserUrl);
  }


  function _getSectionHtmlString(sectionIndex, demoMapArray) {
    console.log(`${sectionIndex}当前区要显示的数据如下:\n demoMapArray:${demoMapArray}\n demoMapArrayString:${JSON.stringify(demoMapArray)}`);

    let sectionHtmlString = "";
    var demoMapCount = demoMapArray.length;
    for (let rowIndex = 0; rowIndex < demoMapCount; rowIndex++) {
      const element = demoMapArray[rowIndex];
      var unique_name = element["unique_name"];
      _h5CallBridgeActionDesArray.push();

      // [JS字符串拼接的几种方式](https://blog.csdn.net/u012320487/article/details/123822785)
      var h5Action_updateTextAreaValue_onClick = `_h5Action_updateText_byIndex(${sectionIndex}, ${rowIndex});`;
      var iButtonHtmlString = `<button onClick='${h5Action_updateTextAreaValue_onClick}' style="width: 95%; height: 30px;">${sectionIndex + 1}.${rowIndex + 1}.${unique_name}</button>`
      if (rowIndex > 0) {
        // htmlStr += `<>`;
      }
      console.log(`iButtonHtmlString${rowIndex}=${iButtonHtmlString} element=${JSON.stringify(element)}`);
      sectionHtmlString += `${iButtonHtmlString}`;
    }
    return sectionHtmlString;
  }

</script>



<script>
  var _isMyAppWebView; // 是否是我们开发的app中内嵌的webView(还是其他app里，或者pc上的)

  /// 获取当前浏览器类型
  function _getBrowserType() {
    return getQueryString("isMyAppWebView") == 1;
  }

  /// 根据当前浏览器类型更新UI页面的标题
  function _updateUITitleByCurrentBrowserType(isMyAppWebView) {
    var evelButtonText;
    if (isMyAppWebView == true) { // 是我的app中的WebView
      evelButtonText = "将上述最终地址，在app外打开，以测试从外部能否直接打开指定app的指定页面\n(外部可包括系统浏览器、微信、iPhone备忘录等)";
    } else {  // 已在外部(包括系统浏览器、微信、iPhone备忘录等)
      evelButtonText = "进入上述实际项目页，测试所选路由";
    }

    document.getElementById("evalButtonView").innerHTML = evelButtonText;
  }
</script>


<script>
  // 初始化
  // localStorage.setItem('vConsole_switch_x', 50)
  // var vConsole = new VConsole();
  // console.log('Hello world');

  var _demoSectionArray;
  var _h5CallBridgeActionDesArray = [];

  // function readJson(url) {
  //   var request = new XMLHttpRequest();
  //   request.open("get", url);/*设置请求方法与路径*/
  //   request.send(null);/*不发送数据到服务器*/
  //   request.onload = function () {/*XHR对象获取到返回信息后执行*/
  //     if (request.status == 200) {/*返回状态为200，即为数据获取成功*/
  //       var json = JSON.parse(request.responseText);
  //       for (var i = 0; i < json.length; i++) {
  //         console.log(json[i].name);
  //       }
  //       console.log(json);
  //       debugger
  //     }
  //   }
  // }

  function handleCloseDialog() {
    document.querySelector(".dialog").classList.add("hide");
    // copy(".msg")
  }
  function handleShowDialog() {
    document.querySelector(".dialog").classList.remove("hide");
  }

  // function copy(id) {
  //   var clipboard = new Clipboard(id);
  //   clipboard.on('success', function (e) {
  //     _showAlert("复制成功");
  //     //可执行其他代码操作
  //   });
  //   clipboard.on('error', function () {
  //     _showAlert("复制失败")
  //   });
  // }

  function _showAlert(msg) {
    handleShowDialog();
    let t = document.querySelector(".msg");
    t.innerHTML = msg;
  }



  async function initAppRouteData() { // 注意必须加 async ,否则函数内使用 await 会报错
    console.log("查看是否有使用appRouteUrlValue参数,若无，则将使用本html的默认数据");

    let url_param_appRouteUrl = getQueryString("appRouteUrlValue"); // 从浏览器的网页地址中读取 fileUrl 参数
    console.log(`========url_param_appRouteUrl:${url_param_appRouteUrl}`);

    if (url_param_appRouteUrl == null) {
      _h5Action_updateText_forSubTitle("appRoute 数据来源于:本html内嵌");
      var promptMessage = "未设置本html的appRouteUrlValue参数，则将使用本地默认的 appRouteElement 值";

      var appRouteElement = getLocal_appRouteElement();
      updateAppRouteUI(appRouteElement);

    } else {
      _h5Action_updateText_forSubTitle(`appRoute 数据来源于:本html浏览器网页地址中的 appRouteUrlValue=${url_param_appRouteUrl} 等参数`);
      var dataJsonSuccess = _checkAppRouteDataJson();
      if (dataJsonSuccess != true) {
        return;
      }
    }

  }


  async function initData() { // 注意必须加 async ,否则函数内使用 await 会报错
    console.log("查看是否有使用fileUrl或者h5CallBridgeActionName参数,若都无，则将使用本html的默认数据");

    let url_param_fileUrl = getQueryString("fileUrl"); // 从浏览器的网页地址中读取 fileUrl 参数
    console.log(`========url_param_fileUrl:${url_param_fileUrl}`);

    let url_param_h5CallBridgeActionName = getQueryString("h5CallBridgeActionName"); // 从浏览器的网页地址中读取 h5CallBridgeActionName 参数
    console.log(`========url_param_h5CallBridgeActionName:${url_param_h5CallBridgeActionName}`);

    let url_param_h5CallBridgeActionDes = getQueryString("h5CallBridgeActionDes"); // 从浏览器的网页地址中读取 h5CallBridgeActionDes 参数
    console.log(`========url_param_h5CallBridgeActionDes:${url_param_h5CallBridgeActionDes}【附：不能使用h5CallBridgeActionName的值，会出现当把此html放到app项目中加载本地html的时候，莫名出现h5CallBridgeActionName有值的情况，PS当前该值为${url_param_h5CallBridgeActionName}】`);

    if (url_param_fileUrl == null && url_param_h5CallBridgeActionDes == null) {
      _h5Action_updateText_forSubTitle("数据来源于:本html内嵌");
      var promptMessage = "未设置本html的json文件路径,也未设置h5CallBridge参数，则将使用本地默认的 demoMapArray 值";

      _demoSectionArray = getLocalDemoMapArray();
      if (_demoSectionArray == null) { // 本html未将json文件的值赋值给 demoMapArray
        localArrayResultMessage = `${promptMessage}:获取本地默认的 demoMapArray 失败❌\n请打开本html文件，检查demoMapArray的本地赋值是否正确`;
        console.log(`${localArrayResultMessage}`);

        _showErrorUI(localArrayResultMessage);
        return;

      } else {
        localArrayResultMessage = `${promptMessage}:获取本地默认的 demoMapArray 成功✅`;
        console.log(`${localArrayResultMessage}`);
      }


    } else {
      if (url_param_fileUrl == null) {
        _h5Action_updateText_forSubTitle(`数据来源于:本html浏览器网页地址中的 h5CallBridgeActionName=${url_param_h5CallBridgeActionName} 等参数`);
        var dataJsonSuccess = _checkDataJson();
        if (dataJsonSuccess != true) {
          return;
        }
      } else {
        _h5Action_updateText_forSubTitle("数据来源于:本html浏览器网页地址中的 fileUrl 参数");
        var fileUrlSuccess = await _checkFileUrlUI(url_param_fileUrl);
        if (fileUrlSuccess != true) {
          return;
        }
      }


    }

    // 
    _showSuccessUI(_demoSectionArray);
  }



  initAppRouteData();
  initData();

  _isMyAppWebView = _getBrowserType();
  console.log(`========_isMyAppWebView=${_isMyAppWebView}`);
  _updateUITitleByCurrentBrowserType(_isMyAppWebView);

  function _checkAppRouteDataJson() {
    var promptMessage = "已设置本html的dataJson参数，则将获取使用哪些参数构造出只有一个元素的 demoMapArray 值";
    var remoteArrayResultMessage = `${promptMessage}:获取浏览器地址指定的dataJson各参数的值来作为 demoMapArray 成功✅`;
    console.log(`${remoteArrayResultMessage}`);

    // 从浏览器的网页地址中读取 h5CallBridgeSendMessage 等参数
    console.log("dataJson各参数获取后，但获取过程中内部已解码，值分别如下:")
    let param_string_appRouteUrlDes = getQueryString("appRouteUrlDes");
    let param_string_appRouteUrlValue = getQueryString("appRouteUrlValue");
    console.log(`========param_string_appRouteUrlDes:${param_string_appRouteUrlDes}`);
    console.log(`========param_string_appRouteUrlValue:${param_string_appRouteUrlValue}`);

    var appRouteElement = {
      "value": param_string_appRouteUrlValue,
      "description": param_string_appRouteUrlDes
    };
    updateAppRouteUI(appRouteElement);

    return true;
  }

  function _checkDataJson() {
    var promptMessage = "已设置本html的dataJson参数，则将获取使用哪些参数构造出只有一个元素的 demoMapArray 值";
    var remoteArrayResultMessage = `${promptMessage}:获取浏览器地址指定的dataJson各参数的值来作为 demoMapArray 成功✅`;
    console.log(`${remoteArrayResultMessage}`);

    // http://localhost:4000/Architecture架构/h5js/dvlp_h5js_demo/dvlp_h5js_demo.html?h5CallBridgeActionDes=跳转到app指定页面_Name&h5CallBridgeActionName=h5CallBridgeAction_jumpAppPage&h5CallBridgeSendMessage={"pageName":"imChatPage","pageParams":{"conversationID":"126191","imUserId":"1602856363702501376","showName":"婉艺","type":1,"dialogSubjectId":"1506196208391966720"}}
    // http://localhost:4000/Architecture架构/h5js/dvlp_h5js_demo/dvlp_h5js_demo.html?h5CallBridgeActionDes=跳转到app指定页面_Name&h5CallBridgeActionName=h5CallBridgeAction_jumpAppPage&h5CallBridgeSendMessage=%7B%22pageName%22%3A%22imChatPage%22%2C%22pageParams%22%3A%7B%22conversationID%22%3A%22126191%22%2C%22imUserId%22%3A%221602856363702501376%22%2C%22showName%22%3A%22%E5%A9%89%E8%89%BA%22%2C%22type%22%3A1%2C%22dialogSubjectId%22%3A%221506196208391966720%22%7D%7D
    // {
    //     "h5CallBridgeActionDes": "跳转到app指定页面_Name",
    //     "h5CallBridgeActionName": "h5CallBridgeAction_jumpAppPage",
    //     "h5CallBridgeSendMessage": {
    //       "pageName": "imChatPage",
    //       "pageParams": {
    //         "conversationID": "126191",
    //         "imUserId": "1602856363702501376",
    //         "showName": "婉艺",
    //         "type": 1,
    //         "dialogSubjectId": "1506196208391966720"
    //       }
    //     }
    //   }
    // 从浏览器的网页地址中读取 h5CallBridgeSendMessage 等参数
    console.log("dataJson各参数获取后，但获取过程中内部已解码，值分别如下:")
    let param_string_h5CallBridgeActionDes = getQueryString("h5CallBridgeActionDes");
    let param_string_h5CallBridgeActionName = getQueryString("h5CallBridgeActionName");
    let param_string_h5CallBridgeSendMessage = getQueryString("h5CallBridgeSendMessage");
    console.log(`========param_string_h5CallBridgeActionDes:${param_string_h5CallBridgeActionDes}`);
    console.log(`========param_string_h5CallBridgeActionName:${param_string_h5CallBridgeActionName}`);
    console.log(`========param_string_h5CallBridgeSendMessage:${param_string_h5CallBridgeSendMessage}`);

    // console.log("dataJson各参数解码后，值分别如下:")
    // let param_decode_h5CallBridgeActionDes = decodeURIComponent(param_string_h5CallBridgeActionDes);
    // let param_decode_h5CallBridgeActionName = decodeURIComponent(param_string_h5CallBridgeActionName);
    // let param_decode_h5CallBridgeSendMessage = decodeURIComponent(param_string_h5CallBridgeSendMessage);
    // console.log(`========param_decode_h5CallBridgeActionDes:${param_decode_h5CallBridgeActionDes}`);
    // console.log(`========param_decode_h5CallBridgeActionName:${param_decode_h5CallBridgeActionName}`);
    // console.log(`========param_decode_h5CallBridgeSendMessage:${param_decode_h5CallBridgeSendMessage}`);

    // console.log("dataJson各参数解码后并转object模型，值分别如下:")
    // let param_object_h5CallBridgeSendMessage = JSON.parse(param_decode_h5CallBridgeSendMessage);
    // console.log(`========param_object_h5CallBridgeSendMessage:${param_object_h5CallBridgeSendMessage}`);

    let demoMap1 = {
      "h5CallBridgeActionDes": param_string_h5CallBridgeActionDes,
      "h5CallBridgeActionName": param_string_h5CallBridgeActionName,
      "h5CallBridgeSendMessage": param_string_h5CallBridgeSendMessage
    };

    _demoSectionArray = [
      {
        "sectionTitle": "通过给此html传入dataJson各参数，所以这里只有一个元素",
        "sectionDatas": [
          demoMap1
        ],
      }
    ];

    return true;
  }

  async function _checkFileUrlUI(fileUrl) { // 注意必须加 async ,否则函数内使用 await 会报错
    // http://localhost:4000/Architecture架构/h5js/dvlp_h5js_demo/dvlp_h5js_demo.html?fileUrl=http://localhost:4000/Architecture架构/h5js/dvlp_h5js_demo/dvlp_h5js_demo.json
    var promptMessage = "已设置本html的json文件路径，则将获取该路径下的json值作为 _demoSectionArray 值";
    _demoSectionArray = await readJson(fileUrl);
    if (_demoSectionArray == null) { // 本html未将json文件的值赋值给 demoMapArray
      remoteArrayResultMessage = `${promptMessage}:获取浏览器地址指定的json文件${fileUrl}的值来作为 demoMapArray 失败❌，请根据以下可能原因检查`;
      let fileUrlFailureReason1 = `失败可能原因1:路径${fileUrl}写错`;
      let fileUrlFailureReasonLocal = "失败可能原因2:如果本html是本地直接打开的，则json文件的需手动拷贝到本html中(因为暂不支持读取本地的json文件)";
      let fileUrlFailureReasonRemote = "失败可能原因3:如果本html是从网络地址上打开的，则fileUrl必须和本html的所在工程一致(因为暂不支持跨域访问)";
      remoteArrayResultMessage = `${remoteArrayResultMessage}\n${fileUrlFailureReason1}\n${fileUrlFailureReasonLocal}\n${fileUrlFailureReasonRemote}`
      console.log(`${remoteArrayResultMessage}`);

      _showErrorUI(remoteArrayResultMessage);
      return false;

    } else {
      remoteArrayResultMessage = `${promptMessage}:获取浏览器地址指定的json文件${fileUrl}的值来作为 demoMapArray 成功✅`;
      console.log(`${remoteArrayResultMessage}`);
      return true;
    }
  }

  function _showErrorUI(errorMessage) {
    let htmlStr = "";
    var h5Action_warningButton_onClick = `_h5CallBridgeAction_alert("${errorMessage}");`;
    var iButtonHtmlString = `<button onClick='${h5Action_warningButton_onClick}' style="width: 95%; height: 30px;">"${errorMessage}</button>`

    htmlStr += `${iButtonHtmlString}`;
    document.querySelector("#h5Action_updateTextAreaValue_buttons_div").innerHTML = htmlStr;
  }

  // 执行 h5 弹出错误提示的 alert
  function _h5CallBridgeAction_alert(errorMessage) {
    console.log(errorMessage);
    alert(errorMessage);
  }

  function _showSuccessUI(demoSectionArray) {
    console.log(`最终要显示的数据如下:\n demoSectionArray:${demoSectionArray}\n demoSectionArrayString:${JSON.stringify(demoSectionArray)}`);

    // 当整个section非空时候，直接使用第一个可选操作元素
    const firstSectionDatas = demoSectionArray[0]["sectionDatas"];
    const firstElement = firstSectionDatas[0];
    _useDirectlyWhenOnlyOneElement(firstElement);

    var sectionCount = demoSectionArray.length;
    if (sectionCount == 1 && firstSectionDatas.length == 1) {
      return;
    }

    /// 当整个section不止一个元素的时候，罗列在界面上，供选择使用
    let htmlStr = "";
    for (let sectionIndex = 0; sectionIndex < sectionCount; sectionIndex++) {
      const sectionElement = demoSectionArray[sectionIndex];

      let sectionHtmlString = _getSectionHtmlString(sectionIndex, sectionElement["sectionDatas"]);

      // let sectionHtmlString = `<div id="pageTilteView" style="text-align: center; font-size: 20px;">演示的section</div>`
      var iSectionDivHtmlString = `
      <div id='section_id_${sectionIndex}' style="width: 95%;">
        <div style="width: 95%; background-color: ${sectionElement["sectionBG"]};">${sectionElement["sectionTitle"]}</div>
        ${sectionHtmlString}
      </div>
      `
      if (sectionIndex < sectionCount - 1) {
        iSectionDivHtmlString += `<div style="height: 20px;"></div>`;
      }
      // console.log(`iSectionDivHtmlString${sectionIndex}=${iSectionDivHtmlString}`);
      htmlStr += `${iSectionDivHtmlString}`;
    }

    document.querySelector("#h5Action_updateTextAreaValue_buttons_div").innerHTML = htmlStr;
  }

  /// 当整个section就只有一个元素的时候，直接使用
  function _useDirectlyWhenOnlyOneElement(element) {
    var unique_name = element["unique_name"];
    _h5CallBridgeActionDesArray.push(unique_name);

    // [JS字符串拼接的几种方式](https://blog.csdn.net/u012320487/article/details/123822785)
    sectionIndex = 0;
    rowIndex = 0;
    var h5Action_updateTextAreaValue_onClick = `_h5Action_updateText_byIndex(${sectionIndex}, ${rowIndex});`;

    // [js(JavaScript)字符串转换成变量名](https://huaweicloud.csdn.net/63a55da9b878a54545945264.html?spm=1001.2101.3001.6661.1&utm_medium=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~activity-1-102934655-blog-92951596.pc_relevant_recovery_v2&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~activity-1-102934655-blog-92951596.pc_relevant_recovery_v2&utm_relevant_index=1)
    // 利用 eval() 函数计算 JavaScript 字符串，并把它作为脚本代码来执行。如果参数是一个表达式，eval() 函数将执行表达式。如果参数是Javascript语句，eval()将执行 Javascript 语句。
    var funName = h5Action_updateTextAreaValue_onClick;

    try {
      eval(funName);
    } catch (err) {
      // console.log(`---------------err:${err}`);
      _showAlert(err);
    }

  }



  /// 根据标题，获取其整个数据模型
  function _getElementByIndex(sectionIndex, rowIndex) {
    // var index = _h5CallBridgeActionDesArray.indexOf(h5CallBridgeActionDes);
    // var demoMap = _demoSectionArray[index];
    var demoMap = _demoSectionArray[sectionIndex]["sectionDatas"][rowIndex];

    return demoMap;
  }

  /// 更新 标题
  function _h5Action_updateText_forSubTitle(dataFromSource) {
    console.log(`更新UI上的副标题为:${dataFromSource}`);
    document.getElementById("pageSubTilteView").innerHTML = `（${dataFromSource}）`;
  }

  /// 获取h5调用的app桥接方法名
  function _h5Action_getAppRouteUrl() {
    var sendMethod = document.getElementById("h5CallBridgeActionNameDataView").value;
    return sendMethod;
  }

  /// 获取h5调用app桥接方法后，发送的数据
  function _h5Action_getSendMessage() {
    var sendMessage = document.getElementById("h5CallBridgeSendMessageDataView").value;
    return sendMessage;
  }

  // 执行 h5调用app的桥接方法
  function _h5CallBridgeAction_eval() {
    // var funName = 'h5CallBridgeAction_showAppToast';
    // var sendMessage = '恭喜您分享成功';
    // h5CallBridgeAction_showAppToast.postMessage(sendMessage);

    // [js(JavaScript)字符串转换成变量名](https://huaweicloud.csdn.net/63a55da9b878a54545945264.html?spm=1001.2101.3001.6661.1&utm_medium=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~activity-1-102934655-blog-92951596.pc_relevant_recovery_v2&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~activity-1-102934655-blog-92951596.pc_relevant_recovery_v2&utm_relevant_index=1)
    // 利用 eval() 函数计算 JavaScript 字符串，并把它作为脚本代码来执行。如果参数是一个表达式，eval() 函数将执行表达式。如果参数是Javascript语句，eval()将执行 Javascript 语句。
    var appRouteUrl = getElementValueById("directly_browserUrl_Value_valueView");
    // appRouteUrl = encodeURIComponent(appRouteUrl); // 注意: appRouteUrl 是 browserUrl 的参数，所以必须编码，否则当 appRouteUrl 中含有中文，或者对象的时候会造成无法打开网页的错误

    if (_isMyAppWebView != true) {
      window.location.href = './dvlp_h5_open_app_browser_url_demo.html';
      return;
    }


    var funName = "h5CallBridgeAction_test_openBrowser";

    var currentUrl = window.location.href;
    var currentUrlWithoutParams = `${window.location.protocol}//${window.location.host}${window.location.pathname}`;
    console.log(`---------------currentUrl=\n${currentUrl},\n currentUrlWithoutParams=\n${currentUrlWithoutParams}`);

    var browserUrl = `${currentUrlWithoutParams}?appRouteUrl=${appRouteUrl}`;
    console.log(`---------------appRouteUrl:\n${appRouteUrl}`);
    console.log(`---------------browserUrl:\n${browserUrl}`);

    var sendMessageMap = { "isMyAppWebView": 0, "url": browserUrl };
    var sendMessage = JSON.stringify(sendMessageMap);



    try {
      eval(funName).postMessage(sendMessage);
    } catch (err) {
      // console.log(`---------------err:${err}`);
      _showAlert(err);
    }

    console.log(sendMessage.message);
  }


  // h5Action_share 分享内容到指定的分享方式(微信聊天页面等)
  /*
  function h5Action_updateTextAreaValue_share(webPageType) {
    var url;
    if (webPageType == '只是分享网页链接，没其他操作') {
      url = "https://www.baidu.com";
    } else if (webPageType == '分享链接，且链接可打开app的_原生页面') {
      url = 'yuanwangwu://openpage?pageName=imChatPage&conversationID=126191&imUserId=1602856363702501376&showName=婉艺&type=1&dialogSubjectId=1506196208391966720';
    } else if (webPageType == '分享链接，且链接可打开app的_网页游戏') {
      var appOpenUrl = "yuanwangwu://openpage?pageName=farmGamePage&accountId=1475332557208702976";
      // [js 对url进行编码和解码](https://blog.csdn.net/qq_42740797/article/details/111172160)
      // appOpenUrl = encodeURIComponent(appOpenUrl); // 提示🤝：实际发现，不编码，也可打开
      url = "http://test-h5.yuanwangwu.com/pages-h5/share/share-farm?&accountId=1475332557208702976&appurl=" + appOpenUrl;
    } else {
      url = "https://www.baidu.com";
    }

    var map = {
      // "shareType": "Wechat_SESSION", // 分享方式
      "shareWebPageUrl": url,
      "shareTitle": "你的好友发来一条加急消息", // 分享标题
      "shareDescription": "急急急，快来帮我转大转盘，100%中奖！", // 分享描述
      "shareThumbnailUrl": "https://img1.baidu.com/it/u=1605341541,1182642759&fm=253&app=138&size=w931&n=0&f=JPEG&fmt=auto?sec=1673370000&t=4e694f8a257f10a7f6b52bd051288e7d",
    };
    var message = JSON.stringify(map);
    _h5Action_updateText_forData('h5CallBridgeAction_share', message);
  }
  */

  /// 提供给原生调用的h5方法(用于测试原生调用的方法及传递回来的返回值)
  function bridgeCallH5Action_showCallbackJsonString(jsonString) {
    if (jsonString == null || jsonString == undefined || !jsonString) {
      _showAlert("没有回传的jsonString值");
      return;
    }
    _showAlert(`回传的jsonString值为:${JSON.stringify(jsonString)}`);
  }

  /// 跳转到示例页面
  function _h5Action_goDemoPage() {
    window.location.href = '?fileUrl=dvlp_h5_open_app_demo.json';
  }


  function _h5Action_create(type) {
    // _showAlert(type);
    if (type == 'directly') {

    } else if (type == 'custom') {
      structureRouteUrlByCurrentText();
    }
  }

</script>

</html>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://dvlproad.github.io/Architecture架构/h5_native_interacte/h5_open_app/dvlp_h5_open_app_browser_url_demo/" data-id="cls067v9u0194b8r4bebzeaiq" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Architecture架构/h5_native_interacte/h5_open_app/dvlp_h5_open_app_app_route_url_demo" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/Architecture架构/h5_native_interacte/h5_open_app/dvlp_h5_open_app_app_route_url_demo/" class="article-date">
  <time datetime="2024-01-31T02:54:23.748Z" itemprop="datePublished">2024-01-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <!--
 * @Author: dvlproad
 * @Date: 2022-12-27 11:59:38
 * @LastEditors: dvlproad
 * @LastEditTime: 2023-03-09 18:10:30
 * @Description: 调试h5与app交互的网页demo
-->
<!--
一、使用fileUrl参数
1、本地服务器测试
url1:  http://localhost:4000/Architecture架构/h5_native_interacte/h5_open_app/dvlp_h5_open_app_app_route_url_demo.html?参数如下eg中的值
eg1.1: fileUrl=dvlp_h5_open_app_app_route_url_demo.json
eg1.2: fileUrl=http://localhost:4000/Architecture架构/h5js/dvlp_h5js_demo/dvlp_h5_open_app_app_route_url_demo.json

2、远程服务器测试
url2:  https://dvlproad.github.io/Architecture架构/h5_native_interacte/h5_open_app/dvlp_h5_open_app_app_route_url_demo.html?参数如下eg中的值
eg2.1: fileUrl=dvlp_h5_open_app_app_route_url_demo.json
eg2.2: fileUrl=https://dvlproad.github.io/Architecture架构/h5js/dvlp_h5js_demo/dvlp_h5_open_app_app_route_url_demo.json
eg2.3(测试跨域): fileUrl=https://raw.githubusercontent.com/dvlproad/dvlproad.github.io/master/Architecture%E6%9E%B6%E6%9E%84/h5js/dvlp_h5js_demo/dvlp_h5_open_app_app_route_url_demo.json
eg2.4(测试跨域): 
eg2.5(测试跨域): 

二、使用各种dataJson参数
1、本地服务器测试
url1:  http://localhost:4000/Architecture架构/h5_native_interacte/h5_open_app/dvlp_h5_open_app_app_route_url_demo.html?参数如下eg中的值
eg1.1(未编码h5CallBridgeSendMessage，在浏览器中验证可以。但在app中不行，必须对每个参数编码后再赋值，以避免参数中含中文或者对象): 
h5CallBridgeActionDes=跳转到app指定页面_Name&h5CallBridgeActionName=h5CallBridgeAction_jumpAppPage&h5CallBridgeSendMessage={"pageName":"imChatPage","pageParams":{"conversationID":"126191","imUserId":"1602856363702501376","showName":"婉艺","type":1,"dialogSubjectId":"1506196208391966720"}}
eg1.2(有编码h5CallBridgeSendMessage，验证可以): 
h5CallBridgeActionDes=跳转到app指定页面_Name&h5CallBridgeActionName=h5CallBridgeAction_jumpAppPage&h5CallBridgeSendMessage=%7B%22pageName%22%3A%22imChatPage%22%2C%22pageParams%22%3A%7B%22conversationID%22%3A%22126191%22%2C%22imUserId%22%3A%221602856363702501376%22%2C%22showName%22%3A%22%E5%A9%89%E8%89%BA%22%2C%22type%22%3A1%2C%22dialogSubjectId%22%3A%221506196208391966720%22%7D%7D

-->

<!-- 移动本地引入的相对css和js文件到html前面，避免使用时候出现错误 -->
<link rel="StyleSheet" href="../commoncss/common_alert.css" type="text/css">
<link rel="StyleSheet" href="css/dvlp_h5_open_app_app_route_url_demo.css" type="text/css">


<!-- [引入jquery.js 修复出现的错误：ReferenceError: $ is not defined](https://blog.csdn.net/lq_ruonan/article/details/53690960) -->
<script src="https://code.jquery.com/jquery-3.6.3.js" type="text/javascript" charset="utf-8"></script>
<!-- <script src="js/jQuery.js" type="text/javascript" charset="utf-8"></script> -->

<script src="../commonjs/common_object_util.js" type="text/javascript" charset="utf-8"></script>
<script src="../commonjs/common_url_util.js" type="text/javascript" charset="utf-8"></script>
<script src="../commonjs/common_url_update.js" type="text/javascript" charset="utf-8"></script>
<script src="../commonjs/common_read_file.js" type="text/javascript" charset="utf-8"></script>

<script src="../commonjs/element_value.js" type="text/javascript" charset="utf-8"></script>



<!DOCTYPE html>
<html lang="en">

<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <!-- [was loaded over HTTPS, but requested an insecure错误解决](https://blog.csdn.net/weixin_40918067/article/details/117839199) -->
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  <title>html demo</title>
</head>


<body>
  <div class="dialog hide">
    <div class="content">
      <div class="msg" id="msg">消息内容</div>
      <button class="close-btn" onclick="handleCloseDialog()">我知道了</button>
    </div>
  </div>

  <div id="pageTilteView" style="text-align: center; font-size: 20px;">
    路由生成器
    <button onclick="_h5Action_goDemoPage()" style="font-size: 12px;">查看示例</button>
  </div>
  <div id="pageSubTilteView" style="text-align: center; font-size: 14px;">数据来源于：xxx</div>

  <div class="title1">项目路由结构：
    <div class="title2">项目路由结构值：</div>
    <textarea class="textarea_one_line" id="product_routeUrl_structure_value_View">route_scheme_value://openpage?pageName=route_path_value</textarea>

    <div class="title2">项目路由结构值介绍：</div>
    <textarea class="textarea_one_line">根据你的实际情况，调整route_scheme_value和route_path_value之间的连接</textarea>
  </div>

  <div class="div_spearte"></div>
  <div id="h5OpenAppUrlCreate_type_custom_url">自己生成
    <button class="button_half_width" onclick="_h5Action_create('custom')">从demo中(底部)选择</button>
    <div class="title1">1、应用标识：
      <div class="title2" id="h5OpenAppUrlCreate_type_custom_url_name_titleView">scheme值：</div>
      <textarea class="textarea_one_line" id="custom_browserUrl_main_Value_valueView">scheme值</textarea>

      <div class="title2" id="h5OpenAppUrlCreate_type_custom_url_name_titleView">scheme介绍：</div>
      <textarea class="textarea_one_line" id="custom_browserUrl_main_Description_valueView">scheme介绍</textarea>
    </div>


    <div class="title1"> 2、应用路径
      <div class="title2" id="h5OpenAppUrlCreate_type_custom_url_name_titleView">path值：</div>
      <textarea class="textarea_one_line" id="custom_browserUrl_appRouteUrlValue_valueView">path值</textarea>

      <div class="title2" id="h5OpenAppUrlCreate_type_custom_url_headerView">path介绍：</div>
      <textarea class="textarea_one_line" id="custom_browserUrl_appRouteUrl_Description_valueView">path介绍</textarea>
    </div>

    <div class="title1">3、应用路径参数
      <div class="title2" id="h5OpenAppUrlCreate_type_custom_url_name_titleView">argument值：</div>
      <textarea class="textarea_decription_multiline" id="custom_browserUrl_otherKeyAndValues_valueView">{"inviteCode":"123"}</textarea>

      <div class="title2" id="h5OpenAppUrlCreate_type_custom_url_name_titleView">argument介绍：</div>
      <textarea class="textarea_decription_multiline" id="custom_browserUrl_otherKeyAndValues_Description_valueView">{"inviteCode":"邀请码"}</textarea>
    </div>
  </div>



  <div class="div_spearte"></div>
  <div>
    <button class="button_half_width" id="h5OpenAppUrlCreate_type_directly" onclick="_h5Action_create('custom')">生成/构成
      routeUrl</button>
  </div>
  <div class="div_spearte"></div>

  <div id="h5OpenAppUrlCreate_type_custom_url">直接地址
    <div class="title1"> 最终构成
      <div class="title2" id="h5OpenAppUrlCreate_type_custom_url_name_titleView">最终路由地址：</div>
      <textarea class="textarea_one_browseUrl" id="directly_browserUrl_Value_valueView">最终路由地址</textarea>
    </div>
  </div>


  <div id="h5OpenAppUrlCreate_type_custom_url">下一步，请从下方选择你的测试方式：
    <button id="evalButtonView2" onclick="_chooseAppRouteUrlTestType_copyToOther()" style="background-color: red; color: white; width: 95%; border-width: 0; font-size: 20px;">1、复制链接到其他地方：自己粘贴后点击测试跳转</button>

    <div class="title1">
      <button id="evalButtonView1" onclick="_chooseAppRouteUrlTestType_testToolPage()" style="background-color: red; color: white; width: 95%; border-width: 0; font-size: 20px;">2、在此工具页面直接测试：点击后将直接测试跳转</button>

      <div class="title2">跳转使用的js方法名</div>
      <textarea class="textarea_one_line" id="toolPage_h5CallBridgeAction_jumpAppPageUrl_method_valueView">h5CallBridgeAction_jumpAppPageUrl</textarea>

      <div class="title2">跳转的js方法传递url时候使用的参数名：</div>
      <textarea class="textarea_one_line" id="toolPage_h5CallBridgeAction_jumpAppPageUrl_urlArg_valueView">url</textarea>
    </div>


    <button id="evalButtonView3" onclick="_chooseAppRouteUrlTestType_goToProductPage()" style="background-color: red; color: white; width: 95%; border-width: 0; font-size: 20px;">3、将路由值传参到到项目中指定页面进行测试跳转</button>
  </div>


  <!-- <div>分享内容到指定的分享方式(微信聊天页面等)</div>
  <button
    onclick="h5Action_updateTextAreaValue_share('只是分享网页链接，没其他操作')">'硬编码的按钮：只是分享网页链接，没其他操作'</button>
  <button
    onclick="h5Action_updateTextAreaValue_share('分享链接，且链接可打开app的_原生页面')">'硬编码的按钮：分享链接，且链接可打开app的_原生页面'</button>
  <button
    onclick="h5Action_updateTextAreaValue_share('分享链接，且链接可打开app的_网页游戏')">'硬编码的按钮：分享链接，且链接可打开app的_网页游戏'</button> -->

  <div id="h5Action_updateTextAreaValue_buttons_div"></div>

</body>


<!-- [移动端调试神器vConsole使用详解](https://www.jb51.net/article/244750.htm) -->
<script src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js"></script>
<script>
  // VConsole 默认会挂载到 `window.VConsole` 上
  var vConsole = new window.VConsole();
  // 接下来即可照常使用 `console` 等方法
  console.log('Hello world');

  // 结束调试后，可移除掉
  vConsole.destroy();
</script>







<script>

  function getLocalDemoMapArray() {
    // _browserUrl = "http://www.baidu.com/index.com?inviteCode=123&appRouteUrl=yuanwangwu://openpage?pageName=webNavPage&url=https://farm-game.yuanwangwu.com/index.html&shouldHideNavBar=true&inviteCode=123";
    // _browserUrl_appRouteUrlKey = "appRouteUrl";
    // analysisBrowserUrl(_browserUrl, "appRouteUrl");

    var structureElementArray = [
      {
        "sectionTitle": "跳转到app内的指定页面_网页",
        "sectionDatas": [
          {
            "unique_name": "打开XXXapp_网页",
            "scheme": {
              "value": "yuanwangwu",
              "description": "打开XXXapp"
            },
            "path": {
              "value": "webViewPage",
              "description": "webView页面"
            },
            "argument": {
              "value": {
                "title": "百度首页",
                "ui_params": {
                  "shouldHideNavBar": "true",
                  "shouldHideBackIcon": "false",
                  "statusBarColor": "light",
                  "navigatorBackgroundColor": "0xffffffff",
                  "willPopScope": "false"
                },
                "url": "https://www.baidu.com?inviteCode=123",
                "web_params": {
                  "allowsInlineMediaPlayback": "true",
                  "mediaTypesRequiringUserAction": [
                    "audio",
                    "video"
                  ]
                }
              },
              "description": {
                "title": "标题",
                "ui_params": {
                  "shouldHideNavBar": "是否隐藏导航栏,默认false",
                  "shouldHideBackIcon": "是否隐藏返回按钮,默认false",
                  "statusBarColor": "状态栏颜色类型 light/dark",
                  "navigatorBackgroundColor": "导航栏颜色值",
                  "willPopScope": "是否关闭侧滑,默认false"
                },
                "url": "网址及其参数(邀请码等)",
                "web_params": {
                  "allowsInlineMediaPlayback": "是否允许内联播放,默认true",
                  "mediaTypesRequiringUserAction": "设置支持自动播放的类型"
                }
              }
            }
          }
        ]
      }
    ];

    // return null; // 测试本地未赋值时候的界面展示
    return structureElementArray;
  }
</script>


<script>
  /// 解析浏览器地址，并更新到解析器UI
  function analysisBrowserUrl(browserUrl, browserUrl_appRouteUrlKey) {
    // 构造器
    updateElementValueById("directly_browserUrl_Description_valueView", "未标明");
    updateElementValueById("directly_browserUrl_appRouteUrlKey_valueView", browserUrl_appRouteUrlKey);
    updateElementValueById("directly_browserUrl_Value_valueView", browserUrl);

    // 解析器
    // 1、主地址信息
    _browserUrl_main = getRequestUrlMain(browserUrl);
    updateElementValueById("custom_browserUrl_main_Value_valueView", _browserUrl_main);
    updateElementValueById("custom_browserUrl_main_Description_valueView", "未标明");

    // 2、app参数信息
    _browserUrl_appRouteUrlKey = browserUrl_appRouteUrlKey;
    updateElementValueById("custom_browserUrl_appRouteUrlUseKey_valueView", _browserUrl_appRouteUrlKey);

    _browserUrl_appRouteUrlValue = getValueByQueryKey(browserUrl, browserUrl_appRouteUrlKey);
    updateElementValueById("custom_browserUrl_appRouteUrlValue_valueView", _browserUrl_appRouteUrlValue);

    updateElementValueById("custom_browserUrl_appRouteUrl_Description_valueView", "未标明");

    // 3、其他参数信息
    var browserUrl_params = getRequestUrlParams(browserUrl);
    // var keys = Object.keys(browserUrl_params); // 获取map的所有keys
    // console.log(`keys=${keys}`);
    if (typeof browserUrl_appRouteUrlKey == "undefined" || browserUrl_appRouteUrlKey == null) {
      _browserUrl_otherKeyAndValues = browserUrl_params;
    } else {
      _browserUrl_otherKeyAndValues = deleteObjectByKey(browserUrl_params, [browserUrl_appRouteUrlKey]);
    }
    updateElementValueById("custom_browserUrl_otherKeyAndValues_valueView", JSON.stringify(_browserUrl_otherKeyAndValues));

    updateElementValueById("custom_browserUrl_otherKeyAndValues_Description_valueView", "未标明");
  }

  /// 更新 h5调用的app桥接方法名 和  h5调用app桥接方法后，发送的数据
  function _h5Action_updateText_byIndex(sectionIndex, rowIndex) {
    var element = _getElementByIndex(sectionIndex, rowIndex);
    console.log(`-------当前所选择的值${sectionIndex}.${rowIndex}-------element=${element},elementString=${JSON.stringify(element)}`);

    structureRouteUrl(element);
  }

  /// 根据当前文本框内容，构造 element 元素值
  function _getElementByCurrentText() {
    var element = {
      "unique_name": "打开XXXapp_聊天页面_1",
      "scheme": {
        "value": getElementValueById("custom_browserUrl_main_Value_valueView"),
        "description": getElementValueById("custom_browserUrl_main_Description_valueView")
      },
      "path": {
        "value": getElementValueById("custom_browserUrl_appRouteUrlValue_valueView"),
        "description": getElementValueById("custom_browserUrl_appRouteUrl_Description_valueView")
      },
      "argument": {
        "value": getElementValueById("custom_browserUrl_otherKeyAndValues_valueView"),
        "description": getElementValueById("custom_browserUrl_otherKeyAndValues_Description_valueView")
      }
    };
    return element;
  }

  /// 根据当前文本框内容，构造浏览器地址，并更新到构造器UI
  function structureRouteUrlByCurrentText() {
    var element = _getElementByCurrentText();
    structureRouteUrl(element);
  }

  /// 根据选中的元素，构造浏览器地址，并更新到构造器UI
  function structureRouteUrl(element) {
    // 先把元素更新到解析器
    // 1、主地址信息
    updateElementValueById("custom_browserUrl_main_Value_valueView", element["scheme"]["value"]);
    updateElementValueById("custom_browserUrl_main_Description_valueView", element["scheme"]["description"]);

    // 2、app参数信息
    updateElementValueById("custom_browserUrl_appRouteUrlValue_valueView", element["path"]["value"]);
    updateElementValueById("custom_browserUrl_appRouteUrl_Description_valueView", element["path"]["description"]);

    // 3、其他参数信息
    updateElementValueById("custom_browserUrl_otherKeyAndValues_valueView", element["argument"]["value"]);
    updateElementValueById("custom_browserUrl_otherKeyAndValues_Description_valueView", element["argument"]["description"]);

    // 把各个元素整合并更新结果
    _updateResultUI();
  }

  /// 构造浏览器地址，并更新到构造器UI
  function _updateResultUI() {
    // 获取文本框内容
    var route_scheme = document.getElementById("custom_browserUrl_main_Value_valueView").value;

    // var browserUrl_appRouteUrlKey = document.getElementById("custom_browserUrl_appRouteUrlUseKey_valueView").value;
    var route_path = document.getElementById("custom_browserUrl_appRouteUrlValue_valueView").value;

    var route_argument_string = document.getElementById("custom_browserUrl_otherKeyAndValues_valueView").value;
    var route_argument = JSON.parse(route_argument_string);

    // 构造文本框值
    // var routeUrl = `${route_scheme}://`;
    // routeUrl += `${route_path}`;
    debugger
    var demoSchemeAndPath = getElementValueById("product_routeUrl_structure_value_View");
    var routeUrl = demoSchemeAndPath
    routeUrl = routeUrl.replace("route_scheme_value", route_scheme);
    routeUrl = routeUrl.replace("route_path_value", route_path)

    if (route_argument != null) {
      routeUrl = addParamsForUrl(routeUrl, route_argument);
    }
    debugger

    // 更新构造器UI
    updateElementValueById("directly_browserUrl_Value_valueView", routeUrl);
  }


  function _getSectionHtmlString(sectionIndex, demoMapArray) {
    console.log(`${sectionIndex}当前区要显示的数据如下:\n demoMapArray:${demoMapArray}\n demoMapArrayString:${JSON.stringify(demoMapArray)}`);

    let sectionHtmlString = "";
    var demoMapCount = demoMapArray.length;
    for (let rowIndex = 0; rowIndex < demoMapCount; rowIndex++) {
      const element = demoMapArray[rowIndex];
      var unique_name = element["unique_name"];
      _h5CallBridgeActionDesArray.push();

      // [JS字符串拼接的几种方式](https://blog.csdn.net/u012320487/article/details/123822785)
      var h5Action_updateTextAreaValue_onClick = `_h5Action_updateText_byIndex(${sectionIndex}, ${rowIndex});`;
      var iButtonHtmlString = `<button onClick='${h5Action_updateTextAreaValue_onClick}' style="width: 95%; height: 30px;">${sectionIndex + 1}.${rowIndex + 1}.${unique_name}</button>`
      if (rowIndex > 0) {
        // htmlStr += `<>`;
      }
      console.log(`iButtonHtmlString${rowIndex}=${iButtonHtmlString} element=${JSON.stringify(element)}`);
      sectionHtmlString += `${iButtonHtmlString}`;
    }
    return sectionHtmlString;
  }

</script>




<script>
  var _isMyAppWebView; // 是否是我们开发的app中内嵌的webView(还是其他app里，或者pc上的)

  /// 获取当前浏览器类型
  function _getBrowserType() {
    return getQueryString("isMyAppWebView") == 1;
  }

  /// 根据当前浏览器类型更新UI页面的标题
  function _updateUITitleByCurrentBrowserType(isMyAppWebView) {
    var evelButtonText;
    if (isMyAppWebView == true) { // 是我的app中的WebView
      // 请先确保此测试工具页面是在外部浏览器中打开的(目前还不是)。
      evelButtonText = "将上述最终地址，在app外打开，以测试从外部能否直接打开指定app的指定页面\n(外部可包括系统浏览器、微信、iPhone备忘录等)";
    } else {  // 已在外部(包括系统浏览器、微信、iPhone备忘录等)
      evelButtonText = "2、在此工具页面直接测试：点击后将直接使用以下方法测试跳转";
    }
    evelButtonText = "2、在此工具页面直接测试：点击后将直接使用以下方法测试跳转";
    document.getElementById("evalButtonView1").innerHTML = evelButtonText;
  }
</script>


<script>
  // 初始化
  // localStorage.setItem('vConsole_switch_x', 50)
  // var vConsole = new VConsole();
  // console.log('Hello world');

  var _demoSectionArray;
  var _h5CallBridgeActionDesArray = [];

  function handleCloseDialog() {
    document.querySelector(".dialog").classList.add("hide");
    // copy(".msg")
  }
  function handleShowDialog() {
    document.querySelector(".dialog").classList.remove("hide");
  }

  // function copy(id) {
  //   var clipboard = new Clipboard(id);
  //   clipboard.on('success', function (e) {
  //     _showAlert("复制成功");
  //     //可执行其他代码操作
  //   });
  //   clipboard.on('error', function () {
  //     _showAlert("复制失败")
  //   });
  // }

  function _showAlert(msg) {
    handleShowDialog();
    let t = document.querySelector(".msg");
    t.innerHTML = msg;
  }


  async function initData() { // 注意必须加 async ,否则函数内使用 await 会报错
    console.log("查看是否有使用fileUrl或者h5CallBridgeActionName参数,若都无，则将使用本html的默认数据");

    let url_param_fileUrl = getQueryString("fileUrl"); // 从浏览器的网页地址中读取 fileUrl 参数
    console.log(`========url_param_fileUrl:${url_param_fileUrl}`);

    let url_param_h5CallBridgeActionName = getQueryString("h5CallBridgeActionName"); // 从浏览器的网页地址中读取 h5CallBridgeActionName 参数
    console.log(`========url_param_h5CallBridgeActionName:${url_param_h5CallBridgeActionName}`);

    let url_param_h5CallBridgeActionDes = getQueryString("h5CallBridgeActionDes"); // 从浏览器的网页地址中读取 h5CallBridgeActionDes 参数
    console.log(`========url_param_h5CallBridgeActionDes:${url_param_h5CallBridgeActionDes}【附：不能使用h5CallBridgeActionName的值，会出现当把此html放到app项目中加载本地html的时候，莫名出现h5CallBridgeActionName有值的情况，PS当前该值为${url_param_h5CallBridgeActionName}】`);

    if (url_param_fileUrl == null && url_param_h5CallBridgeActionDes == null) {
      _h5Action_updateText_forSubTitle("数据来源于:本html内嵌");
      var promptMessage = "未设置本html的json文件路径,也未设置h5CallBridge参数，则将使用本地默认的 demoMapArray 值";

      _demoSectionArray = getLocalDemoMapArray();
      if (_demoSectionArray == null) { // 本html未将json文件的值赋值给 demoMapArray
        localArrayResultMessage = `${promptMessage}:获取本地默认的 demoMapArray 失败❌\n请打开本html文件，检查demoMapArray的本地赋值是否正确`;
        console.log(`${localArrayResultMessage}`);

        _showErrorUI(localArrayResultMessage);
        return;

      } else {
        localArrayResultMessage = `${promptMessage}:获取本地默认的 demoMapArray 成功✅`;
        console.log(`${localArrayResultMessage}`);
      }


    } else {
      if (url_param_fileUrl == null) {
        _h5Action_updateText_forSubTitle(`数据来源于:本html浏览器网页地址中的 h5CallBridgeActionName=${url_param_h5CallBridgeActionName} 等参数`);
        var dataJsonSuccess = _checkDataJson();
        if (dataJsonSuccess != true) {
          return;
        }
      } else {
        _h5Action_updateText_forSubTitle("数据来源于:本html浏览器网页地址中的 fileUrl 参数");
        var fileUrlSuccess = await _checkFileUrlUI(url_param_fileUrl);
        if (fileUrlSuccess != true) {
          return;
        }
      }


    }

    // 
    _showSuccessUI(_demoSectionArray);
  }




  initData();

  _isMyAppWebView = _getBrowserType();
  console.log(`========_isMyAppWebView=${_isMyAppWebView}`);
  _updateUITitleByCurrentBrowserType(_isMyAppWebView);

  function _checkDataJson() {
    var promptMessage = "已设置本html的dataJson参数，则将获取使用哪些参数构造出只有一个元素的 demoMapArray 值";
    var remoteArrayResultMessage = `${promptMessage}:获取浏览器地址指定的dataJson各参数的值来作为 demoMapArray 成功✅`;
    console.log(`${remoteArrayResultMessage}`);

    // 从浏览器的网页地址中读取 h5CallBridgeSendMessage 等参数
    console.log("dataJson各参数获取后，但获取过程中内部已解码，值分别如下:")
    let param_string_h5CallBridgeActionDes = getQueryString("h5CallBridgeActionDes");
    let param_string_h5CallBridgeActionName = getQueryString("h5CallBridgeActionName");
    let param_string_h5CallBridgeSendMessage = getQueryString("h5CallBridgeSendMessage");
    console.log(`========param_string_h5CallBridgeActionDes:${param_string_h5CallBridgeActionDes}`);
    console.log(`========param_string_h5CallBridgeActionName:${param_string_h5CallBridgeActionName}`);
    console.log(`========param_string_h5CallBridgeSendMessage:${param_string_h5CallBridgeSendMessage}`);

    // console.log("dataJson各参数解码后，值分别如下:")
    // let param_decode_h5CallBridgeActionDes = decodeURIComponent(param_string_h5CallBridgeActionDes);
    // let param_decode_h5CallBridgeActionName = decodeURIComponent(param_string_h5CallBridgeActionName);
    // let param_decode_h5CallBridgeSendMessage = decodeURIComponent(param_string_h5CallBridgeSendMessage);
    // console.log(`========param_decode_h5CallBridgeActionDes:${param_decode_h5CallBridgeActionDes}`);
    // console.log(`========param_decode_h5CallBridgeActionName:${param_decode_h5CallBridgeActionName}`);
    // console.log(`========param_decode_h5CallBridgeSendMessage:${param_decode_h5CallBridgeSendMessage}`);

    // console.log("dataJson各参数解码后并转object模型，值分别如下:")
    // let param_object_h5CallBridgeSendMessage = JSON.parse(param_decode_h5CallBridgeSendMessage);
    // console.log(`========param_object_h5CallBridgeSendMessage:${param_object_h5CallBridgeSendMessage}`);

    let demoMap1 = {
      "h5CallBridgeActionDes": param_string_h5CallBridgeActionDes,
      "h5CallBridgeActionName": param_string_h5CallBridgeActionName,
      "h5CallBridgeSendMessage": param_string_h5CallBridgeSendMessage
    };

    _demoSectionArray = [
      {
        "sectionTitle": "通过给此html传入dataJson各参数，所以这里只有一个元素",
        "sectionDatas": [
          demoMap1
        ],
      }
    ];

    return true;
  }

  async function _checkFileUrlUI(fileUrl) { // 注意必须加 async ,否则函数内使用 await 会报错
    // http://localhost:4000/Architecture架构/h5js/dvlp_h5js_demo/dvlp_h5js_demo.html?fileUrl=http://localhost:4000/Architecture架构/h5js/dvlp_h5js_demo/dvlp_h5_open_app_app_route_url_demo.json
    var promptMessage = "已设置本html的json文件路径，则将获取该路径下的json值作为 _demoSectionArray 值";
    _demoSectionArray = await readJson(fileUrl);
    if (_demoSectionArray == null) { // 本html未将json文件的值赋值给 demoMapArray
      remoteArrayResultMessage = `${promptMessage}:获取浏览器地址指定的json文件${fileUrl}的值来作为 demoMapArray 失败❌，请根据以下可能原因检查`;
      let fileUrlFailureReason1 = `失败可能原因1:路径${fileUrl}写错`;
      let fileUrlFailureReasonLocal = "失败可能原因2:如果本html是本地直接打开的，则json文件的需手动拷贝到本html中(因为暂不支持读取本地的json文件)";
      let fileUrlFailureReasonRemote = "失败可能原因3:如果本html是从网络地址上打开的，则fileUrl必须和本html的所在工程一致(因为暂不支持跨域访问)";
      remoteArrayResultMessage = `${remoteArrayResultMessage}\n${fileUrlFailureReason1}\n${fileUrlFailureReasonLocal}\n${fileUrlFailureReasonRemote}`
      console.log(`${remoteArrayResultMessage}`);

      _showErrorUI(remoteArrayResultMessage);
      return false;

    } else {
      remoteArrayResultMessage = `${promptMessage}:获取浏览器地址指定的json文件${fileUrl}的值来作为 demoMapArray 成功✅`;
      console.log(`${remoteArrayResultMessage}`);
      return true;
    }
  }

  function _showErrorUI(errorMessage) {
    let htmlStr = "";
    var h5Action_warningButton_onClick = `_h5CallBridgeAction_alert("${errorMessage}");`;
    var iButtonHtmlString = `<button onClick='${h5Action_warningButton_onClick}' style="width: 95%; height: 30px;">"${errorMessage}</button>`

    htmlStr += `${iButtonHtmlString}`;
    document.querySelector("#h5Action_updateTextAreaValue_buttons_div").innerHTML = htmlStr;
  }

  // 执行 h5 弹出错误提示的 alert
  function _h5CallBridgeAction_alert(errorMessage) {
    console.log(errorMessage);
    alert(errorMessage);
  }

  function _showSuccessUI(demoSectionArray) {
    console.log(`最终要显示的数据如下:\n demoSectionArray:${demoSectionArray}\n demoSectionArrayString:${JSON.stringify(demoSectionArray)}`);

    // 当整个section非空时候，直接使用第一个可选操作元素
    const firstSectionDatas = demoSectionArray[0]["sectionDatas"];
    const firstElement = firstSectionDatas[0];
    _useDirectlyWhenOnlyOneElement(firstElement);

    var sectionCount = demoSectionArray.length;
    if (sectionCount == 1 && firstSectionDatas.length == 1) {
      return;
    }

    /// 当整个section不止一个元素的时候，罗列在界面上，供选择使用
    let htmlStr = "";
    for (let sectionIndex = 0; sectionIndex < sectionCount; sectionIndex++) {
      const sectionElement = demoSectionArray[sectionIndex];

      let sectionHtmlString = _getSectionHtmlString(sectionIndex, sectionElement["sectionDatas"]);

      // let sectionHtmlString = `<div id="pageTilteView" style="text-align: center; font-size: 20px;">演示的section</div>`
      var iSectionDivHtmlString = `
      <div id='section_id_${sectionIndex}' style="width: 95%;">
        <div style="width: 95%; background-color: ${sectionElement["sectionBG"]};">${sectionElement["sectionTitle"]}</div>
        ${sectionHtmlString}
      </div>
      `
      if (sectionIndex < sectionCount - 1) {
        iSectionDivHtmlString += `<div style="height: 20px;"></div>`;
      }
      // console.log(`iSectionDivHtmlString${sectionIndex}=${iSectionDivHtmlString}`);
      htmlStr += `${iSectionDivHtmlString}`;
    }

    document.querySelector("#h5Action_updateTextAreaValue_buttons_div").innerHTML = htmlStr;
  }

  /// 当整个section就只有一个元素的时候，直接使用
  function _useDirectlyWhenOnlyOneElement(element) {
    var unique_name = element["unique_name"];
    _h5CallBridgeActionDesArray.push(unique_name);

    // [JS字符串拼接的几种方式](https://blog.csdn.net/u012320487/article/details/123822785)
    sectionIndex = 0;
    rowIndex = 0;
    var h5Action_updateTextAreaValue_onClick = `_h5Action_updateText_byIndex(${sectionIndex}, ${rowIndex});`;

    // [js(JavaScript)字符串转换成变量名](https://huaweicloud.csdn.net/63a55da9b878a54545945264.html?spm=1001.2101.3001.6661.1&utm_medium=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~activity-1-102934655-blog-92951596.pc_relevant_recovery_v2&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~activity-1-102934655-blog-92951596.pc_relevant_recovery_v2&utm_relevant_index=1)
    // 利用 eval() 函数计算 JavaScript 字符串，并把它作为脚本代码来执行。如果参数是一个表达式，eval() 函数将执行表达式。如果参数是Javascript语句，eval()将执行 Javascript 语句。
    var funName = h5Action_updateTextAreaValue_onClick;

    try {
      eval(funName);
    } catch (err) {
      // console.log(`---------------err:${err}`);
      _showAlert(err);
    }

  }



  /// 根据标题，获取其整个数据模型
  function _getElementByIndex(sectionIndex, rowIndex) {
    // var index = _h5CallBridgeActionDesArray.indexOf(h5CallBridgeActionDes);
    // var demoMap = _demoSectionArray[index];
    var demoMap = _demoSectionArray[sectionIndex]["sectionDatas"][rowIndex];

    return demoMap;
  }

  /// 更新 标题
  function _h5Action_updateText_forSubTitle(dataFromSource) {
    console.log(`更新UI上的副标题为:${dataFromSource}`);
    document.getElementById("pageSubTilteView").innerHTML = `（${dataFromSource}）`;
  }

  /// 获取h5调用的app桥接方法名
  function _h5Action_getAppRouteUrl() {
    var sendMethod = document.getElementById("h5CallBridgeActionNameDataView").value;
    return sendMethod;
  }

  /// 获取h5调用app桥接方法后，发送的数据
  function _h5Action_getSendMessage() {
    var sendMessage = document.getElementById("h5CallBridgeSendMessageDataView").value;
    return sendMessage;
  }

  // 执行 h5调用app的桥接方法
  function _chooseAppRouteUrlTestType_copyToOther() {
    _showAlert("暂未实现 copyToOther")
  }

  function _chooseAppRouteUrlTestType_testToolPage() {
    // var funName = 'h5CallBridgeAction_showAppToast';
    // var sendMessage = '恭喜您分享成功';
    // h5CallBridgeAction_showAppToast.postMessage(sendMessage);

    // [js(JavaScript)字符串转换成变量名](https://huaweicloud.csdn.net/63a55da9b878a54545945264.html?spm=1001.2101.3001.6661.1&utm_medium=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~activity-1-102934655-blog-92951596.pc_relevant_recovery_v2&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~activity-1-102934655-blog-92951596.pc_relevant_recovery_v2&utm_relevant_index=1)
    // 利用 eval() 函数计算 JavaScript 字符串，并把它作为脚本代码来执行。如果参数是一个表达式，eval() 函数将执行表达式。如果参数是Javascript语句，eval()将执行 Javascript 语句。
    var appRouteUrl = getElementValueById("directly_browserUrl_Value_valueView");
    // appRouteUrl = encodeURIComponent(appRouteUrl); // 注意: appRouteUrl 是 browserUrl 的参数，所以必须编码，否则当 appRouteUrl 中含有中文，或者对象的时候会造成无法打开网页的错误

    if (_isMyAppWebView != true) {
      try {
        debugger
        window.location.href = appRouteUrl; // TODO:如果显示报错信息
        debugger
      } catch (err) {
        // console.log(`---------------err:${err}`);
        _showAlert(err);
        debugger
      }
      return;
    }


    var funName = getElementValueById("toolPage_h5CallBridgeAction_jumpAppPageUrl_method_valueView");
    var urlArgName = getElementValueById("toolPage_h5CallBridgeAction_jumpAppPageUrl_urlArg_valueView");

    var sendMessageMap = { "isMyAppWebView": 0 };
    sendMessageMap[urlArgName] = appRouteUrl;

    var sendMessage = JSON.stringify(sendMessageMap);
    // console.log(`哈哈哈✅${sendMessage}`);

    try {
      eval(funName).postMessage(sendMessage);
    } catch (err) {
      // console.log(`---------------err:${err}`);
      _showAlert(err);
    }

    console.log(sendMessage);
  }

  function _chooseAppRouteUrlTestType_goToProductPage() {
    var appRouteUrlValue = getElementValueById("directly_browserUrl_Value_valueView");
    var appRouteUrlDes = getElementValueById("custom_browserUrl_appRouteUrl_Description_valueView");
    var params = {
      "appRouteUrlValue": appRouteUrlValue,
      "appRouteUrlDes": appRouteUrlDes,
    };
    if (_isMyAppWebView != null && _isMyAppWebView != undefined) {
      params["isMyAppWebView"] = _isMyAppWebView == true ? 1 : 0;
    }

    var url = `./dvlp_h5_open_app_browser_url_demo.html`;
    url = addParamsForUrl(url, params);

    window.location.href = url;
  }

  /// 提供给原生调用的h5方法(用于测试原生调用的方法及传递回来的返回值)
  function bridgeCallH5Action_showCallbackJsonString(jsonString) {
    if (jsonString == null || jsonString == undefined || !jsonString) {
      _showAlert("没有回传的jsonString值");
      return;
    }
    _showAlert(`回传的jsonString值为:${JSON.stringify(jsonString)}`);
  }

  /// 跳转到示例页面
  function _h5Action_goDemoPage() {
    window.location.href = '?fileUrl=dvlp_h5_open_app_app_route_url_demo.json';
  }


  function _h5Action_create(type) {
    // _showAlert(type);
    if (type == 'directly') {

    } else if (type == 'custom') {
      structureRouteUrlByCurrentText();
    }
  }

</script>

</html>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://dvlproad.github.io/Architecture架构/h5_native_interacte/h5_open_app/dvlp_h5_open_app_app_route_url_demo/" data-id="cls067v9w0195b8r492whkvtl" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Architecture架构/h5_native_interacte/h5js/dvlp_h5js_demo" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/Architecture架构/h5_native_interacte/h5js/dvlp_h5js_demo/" class="article-date">
  <time datetime="2024-01-31T02:22:31.303Z" itemprop="datePublished">2024-01-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <!--
 * @Author: dvlproad
 * @Date: 2022-12-27 11:59:38
 * @LastEditors: dvlproad
 * @LastEditTime: 2023-10-10 22:44:29
 * @Description: 调试h5与app交互的网页demo
-->

<!--
一、使用fileUrl参数
1、本地服务器测试
url1:  http://localhost:4000/Architecture架构/h5_native_interacte/h5js/dvlp_h5js_demo.html?参数如下eg中的值
eg1.1: fileUrl=dvlp_h5js_demo.json
eg1.2: fileUrl=http://localhost:4000/Architecture架构/h5_native_interacte/h5js/dvlp_h5js_demo.json

2、远程服务器测试
url2:  https://dvlproad.github.io/Architecture架构/h5_native_interacte/h5js/dvlp_h5js_demo.html?参数如下eg中的值
eg2.1: fileUrl=dvlp_h5js_demo.json
eg2.2: fileUrl=https://dvlproad.github.io/Architecture架构/h5_native_interacte/h5js/dvlp_h5js_demo.json
eg2.3(测试跨域): fileUrl=https://raw.githubusercontent.com/dvlproad/dvlproad.github.io/master/Architecture%E6%9E%B6%E6%9E%84/h5_native_interacte/h5js/dvlp_h5js_demo.json
eg2.4(测试跨域): 
eg2.5(测试跨域): 

二、使用各种dataJson参数
1、本地服务器测试
url1:  http://localhost:4000/Architecture架构/h5_native_interacte/h5js/dvlp_h5js_demo.html?参数如下eg中的值
eg1.1(未编码h5CallBridgeSendMessage，在浏览器中验证可以。但在app中不行，必须对每个参数编码后再赋值，以避免参数中含中文或者对象): 
h5CallBridgeActionDes=跳转到app指定页面_Name&h5CallBridgeActionName=h5CallBridgeAction_jumpAppPage&h5CallBridgeSendMessage={"pageName":"imChatPage","pageParams":{"conversationID":"126191","imUserId":"1602856363702501376","showName":"婉艺","type":1,"dialogSubjectId":"1506196208391966720"}}
eg1.2(有编码h5CallBridgeSendMessage，验证可以): 
h5CallBridgeActionDes=跳转到app指定页面_Name&h5CallBridgeActionName=h5CallBridgeAction_jumpAppPage&h5CallBridgeSendMessage=%7B%22pageName%22%3A%22imChatPage%22%2C%22pageParams%22%3A%7B%22conversationID%22%3A%22126191%22%2C%22imUserId%22%3A%221602856363702501376%22%2C%22showName%22%3A%22%E5%A9%89%E8%89%BA%22%2C%22type%22%3A1%2C%22dialogSubjectId%22%3A%221506196208391966720%22%7D%7D
/h5_native_interacte/h5js/dvlp_h5js_demo.html
-->

<!--
注入js方法66
http://localhost:4000/Architecture架构/h5_native_interacte/h5js/dvlp_h5js_demo.html?
eg:
injectedH5MethodFileUrl=dvlp_h5js_h5Action_demo.json
-->

<!-- 移动本地引入的相对css和js文件到html前面，避免使用时候出现错误 -->
<link rel="StyleSheet" href="../commoncss/common_alert.css" type="text/css">
<link rel="StyleSheet" href="css/dvlp_h5js_demo.css" type="text/css">


<!-- [移动端调试神器vConsole使用详解](https://www.jb51.net/article/244750.htm) -->
<script src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js"></script>
<script>
  // VConsole 默认会挂载到 `window.VConsole` 上
  var vConsole = new window.VConsole();
  // 接下来即可照常使用 `console` 等方法
  console.log('Hello world');

  // 结束调试后，可移除掉
  vConsole.destroy();
</script>


<!-- [引入jquery.js 修复出现的错误：ReferenceError: $ is not defined](https://blog.csdn.net/lq_ruonan/article/details/53690960) -->
<script src="https://code.jquery.com/jquery-3.6.3.js" type="text/javascript" charset="utf-8"></script>
<!-- <script src="js/jQuery.js" type="text/javascript" charset="utf-8"></script> -->

<script src="../commonjs/common_url_util.js" type="text/javascript" charset="utf-8"></script>
<script src="../commonjs/common_read_file.js" type="text/javascript" charset="utf-8"></script>

<script src="../commonjs/element_value.js" type="text/javascript" charset="utf-8"></script>


<!DOCTYPE html>
<html lang="en">

<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <!-- [was loaded over HTTPS, but requested an insecure错误解决](https://blog.csdn.net/weixin_40918067/article/details/117839199) -->
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  <title>html demo</title>
</head>

<body>
  <div class="dialog hide">
    <div class="content">
      <div class="msg" id="msg">消息内容</div>
      <button class="close-btn" onclick="handleCloseDialog()">我知道了</button>
    </div>
  </div>
  <div id="pageTilteView" style="text-align: center; font-size: 20px;">
    app内的网页h5调用app的演示demo
    <button onclick="_h5Action_goDemoPage()" style="font-size: 12px;">查看示例</button>
    <button onclick="_h5Action_goDemoH5ActionPage()" style="font-size: 12px;">查看注入的h5示例</button>
  </div>
  <div id="pageSubTilteView" style="text-align: center; font-size: 14px;">数据来源于：xxx</div>


  <div id="inputContainer">H5到app的入参
    <div class="title1">1、app内的h5调用app的-桥接方法名信息：
      <div class="title2">桥接方法名的值：</div>
      <textarea class="textarea_one_line" id="h5CallBridgeActionNameDataView">桥接方法名的值</textarea>

      <div class="title2">桥接方法名的介绍：</div>
      <textarea class="textarea_one_line" id="h5CallBridgeActionDesDataView">桥接方法名的介绍</textarea>
    </div>

    <div class="title1">2、app内的h5调用app桥接方法后，发送的参数信息：
      <div class="title2">参数值：</div>
      <div class="title_prompt">(注:如果key或value缺少引号",则一定是你入参的时候,json没有先转义)<button onclick="_h5Action_goJsonEscapePage()" style="font-size: 12px;">json转义工具</button></div>
      <textarea class="textarea_argument" id="h5CallBridgeSendMessageDataView">参数值</textarea>

      <div class="title2">参数值的介绍：</div>
      <textarea class="textarea_decription_multiline" id="h5CallBridgeDescriptionDataView">参数值的介绍</textarea>
    </div>
  </div>

  <button class="button_full_width" id="evalButtonView" onclick="_h5CallBridgeAction_eval()">执行上述的h5调用app的方法</button>

  <div class="div_spearte"></div>
  <div id="outputContainer">app给H5的回值
    <div class="title1">app内的h5调用app桥接方法后，app给H5的回值信息：
      <div class="title2">回值：<button onclick="_h5Action_showAppResultDemoValue()" style="font-size: 12px;">回值demo</button></div>
      <textarea class="textarea_argument" id="bridgeCallH5ActionDataView">回值</textarea>

      <!-- <div class="title2">回值的介绍：</div>
      <textarea class="textarea_decription_multiline" id="bridgeCallH5ActionDescriptionDataView">回值的介绍</textarea> -->
    </div>
  </div>


  <!-- <div>分享内容到指定的分享方式(微信聊天页面等)</div>
  <button
    onclick="h5Action_updateTextAreaValue_share('只是分享网页链接，没其他操作')">'硬编码的按钮：只是分享网页链接，没其他操作'</button>
  <button
    onclick="h5Action_updateTextAreaValue_share('分享链接，且链接可打开app的_原生页面')">'硬编码的按钮：分享链接，且链接可打开app的_原生页面'</button>
  <button
    onclick="h5Action_updateTextAreaValue_share('分享链接，且链接可打开app的_网页游戏')">'硬编码的按钮：分享链接，且链接可打开app的_网页游戏'</button> -->

  <div id="h5Action_updateTextAreaValue_buttons_div"></div>

</body>


<!-- 动态注入js方法 -->
<script>
  var injectedJSMethods = [
    {
      "sectionTitle": "测试的",
      "sectionDatas": [
        {
          "name": "test",
          "arg": {
            "callback": "h5CallBridgeAction_showAppToast",
            "callback_arg": {
              "message": `恭喜您分享成功3459`
            },
          },
        }
      ],
    }
  ];

  /// 初始化数据
  async function initInjectedJSData() { // 注意必须加 async ,否则函数内使用 await 会报错
    console.log("查看是否有使用url_param_injectedH5MethodFileUrl参数,若无，则将使用本html的默认数据");
    let url_param_injectedH5MethodFileUrl = getQueryString("injectedH5MethodFileUrl"); // 从浏览器的网页地址中读取 fileUrl 参数
    console.log(`========url_param_injectedH5MethodFileUrl:${url_param_injectedH5MethodFileUrl}`);

    if (url_param_injectedH5MethodFileUrl != null) {
      injectedJSMethods = await readJson(url_param_injectedH5MethodFileUrl);
    }
  }
  initInjectedJSData();


  var sectionCount = injectedJSMethods.length;
  for (let sectionIndex = 0; sectionIndex < sectionCount; sectionIndex++) {
    const sectionElement = injectedJSMethods[sectionIndex];

    var sectionDataArray = sectionElement["sectionDatas"];
    var rowCount = sectionDataArray.length;
    for (let rowIndex = 0; rowIndex < rowCount; rowIndex++) {
      const element = sectionDataArray[rowIndex];

      var h5ActionName = element["name"];
      window[h5ActionName] = (param) => {
        var funName = element["arg"]["callback"];
        var callbackArg = element["arg"]["callback_arg"];
        var sendMessage = "";
        if (callbackArg != null) {
          sendMessage = JSON.stringify(callbackArg);
        }
        try {
          eval(funName).postMessage(sendMessage);
        } catch (err) {
          // console.log(`---------------err:${err}`);
          _showAlert(err);
        }
      }
    }


  }

  window["aaa"] = (param) => {
    console.log(`✅吃啥11156775${param}`);
    _showAlert(`✅吃啥11156775${param}`);

    var tmp = arguments.callee.toString();
    var re = /function\s*(\w*)/i;
    var matches = re.exec(tmp);//方法名
    var id = matches[1];
    console.log(`✅示范方法2${id}`);
  }





  // if (typeof __on_did_change_app_lifecycle_state=="function"){
  //   console.log(`✅示范方法`);
  // } else {
  //   console.log(`❌示范方法`);
  // }


</script>



<script>
  // 初始化
  // localStorage.setItem('vConsole_switch_x', 50)
  // var vConsole = new VConsole();
  // console.log('Hello world');
  var _demoSectionArray;
  var h5CallBridgeActionDesArray = [];

  // function readJson(url) {
  //   var request = new XMLHttpRequest();
  //   request.open("get", url);/*设置请求方法与路径*/
  //   request.send(null);/*不发送数据到服务器*/
  //   request.onload = function () {/*XHR对象获取到返回信息后执行*/
  //     if (request.status == 200) {/*返回状态为200，即为数据获取成功*/
  //       var json = JSON.parse(request.responseText);
  //       for (var i = 0; i < json.length; i++) {
  //         console.log(json[i].name);
  //       }
  //       console.log(json);
  //       debugger
  //     }
  //   }
  // }

  function handleCloseDialog() {
    document.querySelector(".dialog").classList.add("hide");
    // copy(".msg")
  }
  function handleShowDialog() {
    document.querySelector(".dialog").classList.remove("hide");
  }

  // function copy(id) {
  //   var clipboard = new Clipboard(id);
  //   clipboard.on('success', function (e) {
  //     _showAlert("复制成功");
  //     //可执行其他代码操作
  //   });
  //   clipboard.on('error', function () {
  //     _showAlert("复制失败")
  //   });
  // }

  function _showAlert(msg) {
    handleShowDialog();
    let t = document.querySelector(".msg");
    t.innerHTML = msg;
  }



  function getLocalDemoMapArray() {
    let localDemoMapArray = [
      {
        "sectionTitle": "只是测试方法，不再实际项目中使用",
        // "sectionBG": "#FF0000",
        "sectionDatas": [
          {
            "h5CallBridgeActionDes": "测试 h5 调用 app 方法，并将返回值回调给 h5",
            "h5CallBridgeActionName": "h5CallBridgeAction_test_h5CallAppAndCallBackToH5",
            "h5CallBridgeSendMessage": {
              "callbackMethod": "bridgeCallH5Action_showCallbackJsonString",
              "url": "https://www.baidu.com"
            }
          }
        ]
      }
    ];

    // return null; // 测试本地未赋值时候的界面展示
    return localDemoMapArray;
  }

  /// 处理协议跳转
  /// 规则说明：
  /// yuanwangwu://openpage?pageName=XXXX&orderId=XXXXX
  /// 如果是从外部h5跳转app使用 yuanwangwu://openpage?pageName=webPage&url=URLEncode(http://www.baidyu.com)
  /// 例：yuanwangwu://openpage?pageName=webPage&url=http%3A%2F%2Fwww.baidu.com
  /// 如果是跳转到内部页面 使用：yuanwangwu://openpage?pageName=XXXXXX&id=XXX
  /// 例：yuanwangwu://openpage?pageName=testPage&id=123
  /// 如果是跳转【微信小程序】 使用：yuanwangwu://openpage?pageName=mp&path=URLEncode(XXX)
  /// 例：略
  // var message = 'yuanwangwu://openpage?pageName=webPage&url=URLEncode(http://www.baidu.com)';
  async function initData() { // 注意必须加 async ,否则函数内使用 await 会报错
    console.log("查看是否有使用fileUrl或者h5CallBridgeActionName参数,若都无，则将使用本html的默认数据");
    let url_param_fileUrl = getQueryString("fileUrl"); // 从浏览器的网页地址中读取 fileUrl 参数
    console.log(`========url_param_fileUrl:${url_param_fileUrl}`);

    let url_param_h5CallBridgeActionName = getQueryString("h5CallBridgeActionName"); // 从浏览器的网页地址中读取 h5CallBridgeActionName 参数
    console.log(`========url_param_h5CallBridgeActionName:${url_param_h5CallBridgeActionName}`);

    let url_param_h5CallBridgeActionDes = getQueryString("h5CallBridgeActionDes"); // 从浏览器的网页地址中读取 h5CallBridgeActionDes 参数
    console.log(`========url_param_h5CallBridgeActionDes:${url_param_h5CallBridgeActionDes}【附：不能使用h5CallBridgeActionName的值，会出现当把此html放到app项目中加载本地html的时候，莫名出现h5CallBridgeActionName有值的情况，PS当前该值为${url_param_h5CallBridgeActionName}】`);

    if (url_param_fileUrl == null && url_param_h5CallBridgeActionDes == null) {
      _h5Action_updateText_forTitle("数据来源于:本html内嵌");
      var promptMessage = "未设置本html的json文件路径,也未设置h5CallBridge参数，则将使用本地默认的 demoMapArray 值";

      _demoSectionArray = getLocalDemoMapArray();
      if (_demoSectionArray == null) { // 本html未将json文件的值赋值给 demoMapArray
        localArrayResultMessage = `${promptMessage}:获取本地默认的 demoMapArray 失败❌\n请打开本html文件，检查demoMapArray的本地赋值是否正确`;
        console.log(`${localArrayResultMessage}`);

        _showErrorUI(localArrayResultMessage);
        return;

      } else {
        localArrayResultMessage = `${promptMessage}:获取本地默认的 demoMapArray 成功✅`;
        console.log(`${localArrayResultMessage}`);
      }


    } else {
      if (url_param_fileUrl == null) {
        _h5Action_updateText_forTitle(`数据来源于:本html浏览器网页地址中的 h5CallBridgeActionName=${url_param_h5CallBridgeActionName} 等参数`);
        var dataJsonSuccess = _checkDataJson();
        if (dataJsonSuccess != true) {
          return;
        }
      } else {
        _h5Action_updateText_forTitle("数据来源于:本html浏览器网页地址中的 fileUrl 参数");
        var fileUrlSuccess = await _checkFileUrlUI(url_param_fileUrl);
        if (fileUrlSuccess != true) {
          return;
        }
      }


    }

    // 
    _showSuccessUI(_demoSectionArray);
  }




  initData();

  function _checkDataJson() {
    var promptMessage = "已设置本html的dataJson参数，则将获取使用哪些参数构造出只有一个元素的 demoMapArray 值";
    var remoteArrayResultMessage = `${promptMessage}:获取浏览器地址指定的dataJson各参数的值来作为 demoMapArray 成功✅`;
    console.log(`${remoteArrayResultMessage}`);

    // http://localhost:4000/Architecture架构/h5_native_interacte/h5js/dvlp_h5js_demo.html?h5CallBridgeActionDes=跳转到app指定页面_Name&h5CallBridgeActionName=h5CallBridgeAction_jumpAppPage&h5CallBridgeSendMessage={"pageName":"imChatPage","pageParams":{"conversationID":"126191","imUserId":"1602856363702501376","showName":"婉艺","type":1,"dialogSubjectId":"1506196208391966720"}}
    // http://localhost:4000/Architecture架构/h5_native_interacte/h5js/dvlp_h5js_demo.html?h5CallBridgeActionDes=跳转到app指定页面_Name&h5CallBridgeActionName=h5CallBridgeAction_jumpAppPage&h5CallBridgeSendMessage=%7B%22pageName%22%3A%22imChatPage%22%2C%22pageParams%22%3A%7B%22conversationID%22%3A%22126191%22%2C%22imUserId%22%3A%221602856363702501376%22%2C%22showName%22%3A%22%E5%A9%89%E8%89%BA%22%2C%22type%22%3A1%2C%22dialogSubjectId%22%3A%221506196208391966720%22%7D%7D
    // {
    //     "h5CallBridgeActionDes": "跳转到app指定页面_Name",
    //     "h5CallBridgeActionName": "h5CallBridgeAction_jumpAppPage",
    //     "h5CallBridgeSendMessage": {
    //       "pageName": "imChatPage",
    //       "pageParams": {
    //         "conversationID": "126191",
    //         "imUserId": "1602856363702501376",
    //         "showName": "婉艺",
    //         "type": 1,
    //         "dialogSubjectId": "1506196208391966720"
    //       }
    //     }
    //   }
    // 从浏览器的网页地址中读取 h5CallBridgeSendMessage 等参数
    console.log("dataJson各参数获取后，但获取过程中内部已解码，值分别如下:")
    let param_string_h5CallBridgeActionDes = getQueryString("h5CallBridgeActionDes");
    let param_string_h5CallBridgeActionName = getQueryString("h5CallBridgeActionName");
    let param_string_h5CallBridgeSendMessage = getQueryString("h5CallBridgeSendMessage");
    let param_string_h5CallBridgeDescription = getQueryString("h5CallBridgeDescription");
    let param_string_appCallbackDemo_ValueAndDescription = getQueryString("appCallbackDemo_ValueAndDescription");
    console.log(`========param_string_h5CallBridgeActionDes:${param_string_h5CallBridgeActionDes}`);
    console.log(`========param_string_h5CallBridgeActionName:${param_string_h5CallBridgeActionName}`);
    console.log(`========param_string_h5CallBridgeSendMessage:${param_string_h5CallBridgeSendMessage}`);
    console.log(`========param_string_h5CallBridgeDescription:${param_string_h5CallBridgeDescription}`);
    console.log(`========param_string_appCallbackDemo_ValueAndDescription:${param_string_appCallbackDemo_ValueAndDescription}`);

    // console.log("dataJson各参数解码后，值分别如下:")
    // let param_decode_h5CallBridgeActionDes = decodeURIComponent(param_string_h5CallBridgeActionDes);
    // let param_decode_h5CallBridgeActionName = decodeURIComponent(param_string_h5CallBridgeActionName);
    // let param_decode_h5CallBridgeSendMessage = decodeURIComponent(param_string_h5CallBridgeSendMessage);
    // console.log(`========param_decode_h5CallBridgeActionDes:${param_decode_h5CallBridgeActionDes}`);
    // console.log(`========param_decode_h5CallBridgeActionName:${param_decode_h5CallBridgeActionName}`);
    // console.log(`========param_decode_h5CallBridgeSendMessage:${param_decode_h5CallBridgeSendMessage}`);

    // console.log("dataJson各参数解码后并转object模型，值分别如下:")
    // let param_object_h5CallBridgeSendMessage = JSON.parse(param_decode_h5CallBridgeSendMessage);
    // console.log(`========param_object_h5CallBridgeSendMessage:${param_object_h5CallBridgeSendMessage}`);

    let demoMap1 = {
      "h5CallBridgeActionDes": param_string_h5CallBridgeActionDes,
      "h5CallBridgeActionName": param_string_h5CallBridgeActionName,
      "h5CallBridgeSendMessage": param_string_h5CallBridgeSendMessage,
      "h5CallBridgeDescription": param_string_h5CallBridgeDescription,
      "appCallbackDemo_ValueAndDescription": param_string_appCallbackDemo_ValueAndDescription,
    };

    _demoSectionArray = [
      {
        "sectionTitle": "通过给此html传入dataJson各参数，所以这里只有一个元素",
        "sectionDatas": [
          demoMap1
        ],
      }
    ];

    return true;
  }

  async function _checkFileUrlUI(fileUrl) { // 注意必须加 async ,否则函数内使用 await 会报错
    // http://localhost:4000/Architecture架构/h5_native_interacte/h5js/dvlp_h5js_demo.html?fileUrl=http://localhost:4000/Architecture架构/h5_native_interacte/h5js/dvlp_h5js_demo.json
    var promptMessage = "已设置本html的json文件路径，则将获取该路径下的json值作为 _demoSectionArray 值";
    _demoSectionArray = await readJson(fileUrl);
    if (_demoSectionArray == null) { // 本html未将json文件的值赋值给 demoMapArray
      remoteArrayResultMessage = `${promptMessage}:获取浏览器地址指定的json文件${fileUrl}的值来作为 demoMapArray 失败❌，请根据以下可能原因检查`;
      let fileUrlFailureReason1 = `失败可能原因1:路径${fileUrl}写错`;
      let fileUrlFailureReasonLocal = "失败可能原因2:如果本html是本地直接打开的，则json文件的需手动拷贝到本html中(因为暂不支持读取本地的json文件)";
      let fileUrlFailureReasonRemote = "失败可能原因3:如果本html是从网络地址上打开的，则fileUrl必须和本html的所在工程一致(因为暂不支持跨域访问)";
      remoteArrayResultMessage = `${remoteArrayResultMessage}\n${fileUrlFailureReason1}\n${fileUrlFailureReasonLocal}\n${fileUrlFailureReasonRemote}`
      console.log(`${remoteArrayResultMessage}`);

      _showErrorUI(remoteArrayResultMessage);
      return false;

    } else {
      remoteArrayResultMessage = `${promptMessage}:获取浏览器地址指定的json文件${fileUrl}的值来作为 demoMapArray 成功✅`;
      console.log(`${remoteArrayResultMessage}`);
      return true;
    }
  }

  function _showErrorUI(errorMessage) {
    let htmlStr = "";
    var h5Action_warningButton_onClick = `_h5CallBridgeAction_alert("${errorMessage}");`;
    var iButtonHtmlString = `<button onClick='${h5Action_warningButton_onClick}' style="width: 95%; height: 30px;">"${errorMessage}</button>`

    htmlStr += `${iButtonHtmlString}`;
    document.querySelector("#h5Action_updateTextAreaValue_buttons_div").innerHTML = htmlStr;
  }

  // 执行 h5 弹出错误提示的 alert
  function _h5CallBridgeAction_alert(errorMessage) {
    console.log(errorMessage);
    alert(errorMessage);
  }

  function _showSuccessUI(demoSectionArray) {
    console.log(`最终要显示的数据如下:\n demoSectionArray:${demoSectionArray}\n demoSectionArrayString:${JSON.stringify(demoSectionArray)}`);

    var sectionCount = demoSectionArray.length;
    // 当整个section就只有一个可选操作元素的时候，直接使用
    if (sectionCount == 1) {
      const sectionDatas = demoSectionArray[0]["sectionDatas"];
      if (sectionDatas.length == 1) {
        const element = sectionDatas[0];
        _useDirectlyWhenOnlyOneElement(element);
        return;
      }
    }

    /// 当整个section不止一个元素的时候，罗列在界面上，供选择使用
    let htmlStr = "";
    for (let sectionIndex = 0; sectionIndex < sectionCount; sectionIndex++) {
      const sectionElement = demoSectionArray[sectionIndex];

      let sectionHtmlString = _getSectionHtmlString(sectionIndex, sectionElement["sectionDatas"]);

      // let sectionHtmlString = `<div id="pageTilteView" style="text-align: center; font-size: 20px;">演示的section</div>`
      var iSectionDivHtmlString = `
      <div id='section_id_${sectionIndex}' style="width: 95%;">
        <div style="width: 95%; background-color: ${sectionElement["sectionBG"]};">${sectionElement["sectionTitle"]}</div>
        ${sectionHtmlString}
      </div>
      `
      if (sectionIndex < sectionCount - 1) {
        iSectionDivHtmlString += `<div style="height: 20px;"></div>`;
      }
      // console.log(`iSectionDivHtmlString${sectionIndex}=${iSectionDivHtmlString}`);
      htmlStr += `${iSectionDivHtmlString}`;
    }

    document.querySelector("#h5Action_updateTextAreaValue_buttons_div").innerHTML = htmlStr;
  }

  /// 当整个section就只有一个元素的时候，直接使用
  function _useDirectlyWhenOnlyOneElement(element) {
    var h5CallBridgeActionDes = element["h5CallBridgeActionDes"];
    h5CallBridgeActionDesArray.push(h5CallBridgeActionDes);

    // [JS字符串拼接的几种方式](https://blog.csdn.net/u012320487/article/details/123822785)
    sectionIndex = 0;
    rowIndex = 0;
    var h5Action_updateTextAreaValue_onClick = `_h5Action_updateText_byIndex(${sectionIndex}, ${rowIndex});`;

    // [js(JavaScript)字符串转换成变量名](https://huaweicloud.csdn.net/63a55da9b878a54545945264.html?spm=1001.2101.3001.6661.1&utm_medium=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~activity-1-102934655-blog-92951596.pc_relevant_recovery_v2&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~activity-1-102934655-blog-92951596.pc_relevant_recovery_v2&utm_relevant_index=1)
    // 利用 eval() 函数计算 JavaScript 字符串，并把它作为脚本代码来执行。如果参数是一个表达式，eval() 函数将执行表达式。如果参数是Javascript语句，eval()将执行 Javascript 语句。
    var funName = h5Action_updateTextAreaValue_onClick;

    try {
      eval(funName);
    } catch (err) {
      // console.log(`---------------err:${err}`);
      _showAlert(err);
    }

  }

  function _getSectionHtmlString(sectionIndex, demoMapArray) {
    console.log(`${sectionIndex}当前区要显示的数据如下:\n demoMapArray:${demoMapArray}\n demoMapArrayString:${JSON.stringify(demoMapArray)}`);

    let sectionHtmlString = "";
    var demoMapCount = demoMapArray.length;
    for (let rowIndex = 0; rowIndex < demoMapCount; rowIndex++) {
      const element = demoMapArray[rowIndex];
      var h5CallBridgeActionDes = element["h5CallBridgeActionDes"];
      h5CallBridgeActionDesArray.push(h5CallBridgeActionDes);

      // [JS字符串拼接的几种方式](https://blog.csdn.net/u012320487/article/details/123822785)
      var h5Action_updateTextAreaValue_onClick = `_h5Action_updateText_byIndex(${sectionIndex}, ${rowIndex});`;
      var iButtonHtmlString = `<button onClick='${h5Action_updateTextAreaValue_onClick}' style="width: 95%; height: 30px;">${sectionIndex + 1}.${rowIndex + 1}.${h5CallBridgeActionDes}</button>`
      if (rowIndex > 0) {
        // htmlStr += `<>`;
      }
      console.log(`iButtonHtmlString${rowIndex}=${iButtonHtmlString} element=${JSON.stringify(element)}`);
      sectionHtmlString += `${iButtonHtmlString}`;
    }
    return sectionHtmlString;
  }



  /// 根据标题，获取其整个数据模型
  function _getElementByH5CallBridgeActionDes(h5CallBridgeActionDes) {
    // var index = h5CallBridgeActionDesArray.indexOf(h5CallBridgeActionDes);
    // var demoMap = _demoSectionArray[index];
    var targetSectionIndex = -1;
    var targetRowIndex = -1;

    console.log(`============0:查找描述是【${h5CallBridgeActionDes}】的元素`);
    for (let sectionIndex = 0; sectionIndex < _demoSectionArray.length; sectionIndex++) {
      var sectionElement = _demoSectionArray[sectionIndex];
      var elementArray = sectionElement["sectionDatas"];
      // console.log(`============1:elementArray=${JSON.stringify(elementArray)}`);
      var hasFound = false;
      for (let rowIndex = 0; rowIndex < elementArray.length; rowIndex++) {
        const element = elementArray[rowIndex];
        // console.log(`============2:element=${JSON.stringify(element)}`);
        if (element["h5CallBridgeActionDes"] == h5CallBridgeActionDes) {
          targetSectionIndex = sectionIndex;
          targetRowIndex = rowIndex;
          hasFound = true;
          console.log(`============3Found:${sectionIndex}.${rowIndex}${element["h5CallBridgeActionDes"]}`);
          break;
        } else {
          console.log(`============3NOThis:${sectionIndex}.${rowIndex}${element["h5CallBridgeActionDes"]}`);
        }
      }

      if (hasFound == true) {
        break;
      }

    }

    return _getElementByIndex(targetSectionIndex, targetRowIndex);
  }

  /// 根据标题，获取其整个数据模型
  function _getElementByIndex(sectionIndex, rowIndex) {
    if (sectionIndex < 0 || rowIndex < 0) {
      return null;
    }
    var demoMap = _demoSectionArray[sectionIndex]["sectionDatas"][rowIndex];

    return demoMap;
  }

  /// 更新 标题
  function _h5Action_updateText_forTitle(dataFromSource) {
    console.log(`更新UI上的副标题为:${dataFromSource}`);
    document.getElementById("pageSubTilteView").innerHTML = `（${dataFromSource}）`;
  }

  /// 更新 h5调用的app桥接方法名 和  h5调用app桥接方法后，发送的数据
  function _h5Action_updateText_byIndex(sectionIndex, rowIndex) {
    var demoMap = _getElementByIndex(sectionIndex, rowIndex);
    console.log(`-------更新UI上的各部分数据为当前所选择的值${sectionIndex}.${rowIndex}-------demoMap=${demoMap},demoMapString=${JSON.stringify(demoMap)}`);

    _h5Action_updateText_forData(demoMap);
  }

  /// 更新 h5调用的app桥接方法名 和  h5调用app桥接方法后，发送的数据
  function _h5Action_updateText_forData(element) {
    updateElementValueById("h5CallBridgeActionDesDataView", element["h5CallBridgeActionDes"]);
    updateElementValueById("h5CallBridgeActionNameDataView", element["h5CallBridgeActionName"]);
    updateElementValueById("h5CallBridgeSendMessageDataView", element["h5CallBridgeSendMessage"]);
    updateElementValueById("h5CallBridgeDescriptionDataView", element["h5CallBridgeDescription"]);

    updateElementValueById("bridgeCallH5ActionDataView", element["appCallbackDemo_ValueAndDescription"]);
  }

  /// 获取h5调用的app桥接方法名
  function _h5Action_getSendMethod() {
    var sendMethod = document.getElementById("h5CallBridgeActionNameDataView").value;
    return sendMethod;
  }

  /// 获取h5调用app桥接方法后，发送的数据
  function _h5Action_getSendMessage() {
    var sendMessage = document.getElementById("h5CallBridgeSendMessageDataView").value;
    return sendMessage;
  }

  // 执行 h5调用app的桥接方法
  function _h5CallBridgeAction_eval() {
    // var funName = 'h5CallBridgeAction_showAppToast';
    // var sendMessage = '恭喜您分享成功';
    // h5CallBridgeAction_showAppToast.postMessage(sendMessage);

    // [js(JavaScript)字符串转换成变量名](https://huaweicloud.csdn.net/63a55da9b878a54545945264.html?spm=1001.2101.3001.6661.1&utm_medium=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~activity-1-102934655-blog-92951596.pc_relevant_recovery_v2&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~activity-1-102934655-blog-92951596.pc_relevant_recovery_v2&utm_relevant_index=1)
    // 利用 eval() 函数计算 JavaScript 字符串，并把它作为脚本代码来执行。如果参数是一个表达式，eval() 函数将执行表达式。如果参数是Javascript语句，eval()将执行 Javascript 语句。
    var funName = _h5Action_getSendMethod();
    var sendMessage = _h5Action_getSendMessage();

    try {
      eval(funName).postMessage(sendMessage);
    } catch (err) {
      // console.log(`---------------err:${err}`);
      _showAlert(err);
    }

    console.log(sendMessage.message);
  }


  /// 提供给原生调用的h5方法(用于测试原生调用的方法及传递回来的返回值)
  function bridgeCallH5Action_showCallbackJsonString(jsonString) {
    if (jsonString == null || jsonString == undefined || !jsonString) {
      _showAlert("没有回传的jsonString值");
      return;
    }

    updateElementValueById("bridgeCallH5ActionDataView", jsonString);
    // updateElementValueById("bridgeCallH5ActionDescriptionDataView", element["argument"]["value"]);
  }

  /// 显示 h5调用app后， app回传给h5的 回值 demo 示例
  function _h5Action_showAppResultDemoValue() {
    var currentH5CallBridgeActionDes = getElementValueById("h5CallBridgeActionDesDataView");

    var element = _getElementByH5CallBridgeActionDes(currentH5CallBridgeActionDes);
    if (element == null || element == undefined || !element) {
      _showAlert(`您还未提供描述是【${currentH5CallBridgeActionDes}】的json demo示例,请检查您的描述。`);
      return;
    }

    var appCallbackDemoValue = element["appCallbackDemo_ValueAndDescription"];
    if (appCallbackDemoValue == null || appCallbackDemoValue == undefined || !appCallbackDemoValue) {
      _showAlert(`您还未提供描述是【${currentH5CallBridgeActionDes}】的回值demo示例，若需要请先行补充`);
      return;
    }


    updateElementValueById("bridgeCallH5ActionDataView", appCallbackDemoValue);
  }

  /// 跳转到示例页面
  function _h5Action_goDemoPage() {
    window.location.href = '?fileUrl=dvlp_h5js_demo.json';
  }
  /// 跳转到示例页面
  function _h5Action_goDemoH5ActionPage() {
    window.location.href = 'dvlp_h5js_h5Action_demo.html?injectedH5MethodFileUrl=dvlp_h5js_h5Action_demo.json';
  }


  /// 跳转到json转义工具页面
  function _h5Action_goJsonEscapePage() {
    window.location.href = "https://zxjson.com/";
  }


</script>

</html>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://dvlproad.github.io/Architecture架构/h5_native_interacte/h5js/dvlp_h5js_demo/" data-id="cls067ug3015sb8r4oshb0uae" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Architecture架构/h5_native_interacte/commonjs/common_url_update" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/Architecture架构/h5_native_interacte/commonjs/common_url_update/" class="article-date">
  <time datetime="2024-01-30T09:41:32.214Z" itemprop="datePublished">2024-01-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        /*
 * @Author: dvlproad
 * @Date: 2023-03-03 14:02:09
 * @LastEditors: dvlproad
 * @LastEditTime: 2023-03-09 15:58:58
 * @Description: 对url进行参数新增等操作的方法
 */
/// 为 oldUrl 添加 newParams 参数，返回新url
function addParamsForUrl(oldUrl, newParams) {
  if (newParams == null || newParams == {} || typeof newParams == "undefined") {
    return oldUrl;
  }

  var newParamsString = stringFromMap(newParams);

  var paramStartIndex = oldUrl.indexOf("?");
  var connectorFlag;
  if (paramStartIndex != -1) {
    connectorFlag = '&';
  } else {
    connectorFlag = '?';
  }
  return `${oldUrl}${connectorFlag}${newParamsString}`;
}

function paramsStringFromMap(newParams) {
  debugger
  const params = new URLSearchParams();

  // 遍历newParams对象的属性
  for (const key in newParams) {
    if (newParams.hasOwnProperty(key)) {
      const value = newParams[key];
      params.append(key, JSON.stringify(value));
    }
  }

  // 将URL参数添加到URL中
  const newParamsString = `${params.toString()}`;
  return newParamsString;
}

function stringFromMap(newParams) {
  return paramsStringFromMap(newParams);

  var keys = Object.keys(newParams); // 获取map的所有keys
  console.log(`keys=${keys}`);
  var count = keys.length;
  // var count = oldUrl.size;
  var newParamsString = '';
  for (var i = 0; i < count; i++) {
    var key = keys[i];
    var value = newParams[key];
    var stringValue;
    if (typeof value === 'string') {
      stringValue = value;
    } else if (typeof value === 'number') {
      stringValue = value.toString();
    } else if (typeof value === 'object') {
      // JavaScript 判断判断某个对象是Object还是一个Array
      if (value.constructor == Array) {
        // stringValue = value;
        stringValue = value.toString();
        // stringValue = JSON.stringify(value);
        // continue
      } else {
        stringValue = stringFromMap(value);
      }
    }
    stringValue = encodeURIComponent(stringValue)

    if (i > 0) {
      newParamsString += '&';
    }
    newParamsString += `${key}=${stringValue}`;
  }
  return newParamsString;
}
      
    </div>
    <footer class="article-footer">
      <a data-url="https://dvlproad.github.io/Architecture架构/h5_native_interacte/commonjs/common_url_update/" data-id="cls067uar015hb8r4qzvudfrx" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Architecture架构/h5_native_interacte/h5js/dvlp_h5js_demo" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/Architecture架构/h5_native_interacte/h5js/dvlp_h5js_demo/" class="article-date">
  <time datetime="2023-12-06T03:01:40.561Z" itemprop="datePublished">2023-12-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        [{"sectionTitle":"只是测试方法，不再实际项目中使用","sectionDatas":[{"h5CallBridgeActionDes":"测试 h5 调用 app 方法，并将返回值回调给 h5","h5CallBridgeActionName":"h5CallBridgeAction_test_h5CallAppAndCallBackToH5","h5CallBridgeSendMessage":{"callbackMethod":"bridgeCallH5Action_showCallbackJsonString","url":"https://www.baidu.com"}},{"h5CallBridgeActionDes":"测试浏览器中的链接显示，没其他操作","h5CallBridgeActionName":"h5CallBridgeAction_test_openBrowser","h5CallBridgeSendMessage":{"url":"https://www.baidu.com"}},{"h5CallBridgeActionDes":"测试浏览器中的链接显示，且链接可打开app的_原生页面","h5CallBridgeActionName":"h5CallBridgeAction_test_openBrowser","h5CallBridgeSendMessage":{"url":"yuanwangwu://openpage?pageName=webNavPage&url=https://www.baidu.com"}},{"h5CallBridgeActionDes":"测试浏览器中的链接显示，且链接可打开app的_网页游戏","h5CallBridgeActionName":"h5CallBridgeAction_test_openBrowser","h5CallBridgeSendMessage":{"url":"yuanwangwu://openpage?pageName=farmGamePage&accountId=1475332557208702976"}}]},{"sectionTitle":"H5调用app，回调给H5(app、device monitor、user信息)","sectionDatas":[{"h5CallBridgeActionDes":"获取app的公共信息，并回调给h5","h5CallBridgeActionName":"h5CallBridgeAction_getFixedAppInfo","h5CallBridgeSendMessage":{"callbackMethod":"bridgeCallH5Action_showCallbackJsonString"},"h5CallBridgeDescription":{"callbackMethod":"获取到的数值在h5上用哪个方法来接口"},"appCallbackDemo_ValueAndDescription":{"version":"1.0.0","buildNumber":"1","platform":"iOS","appType":"App类型，公司产品上可能有多个app","appFeatureType":"dev(pgyer蒲公英)、inner(TestFlight)、formal(AppStore)"}},{"h5CallBridgeActionDes":"获取埋点monitor的公共信息，并回调给h5","h5CallBridgeActionName":"h5CallBridgeAction_getFixedMonitorInfo","h5CallBridgeSendMessage":{"callbackMethod":"bridgeCallH5Action_showCallbackJsonString"},"h5CallBridgeDescription":{"callbackMethod":"获取到的数值在h5上用哪个方法来接口"},"appCallbackDemo_ValueAndDescription":{"callbackMethod":"bridgeCallH5Action_showCallbackJsonString","app_id":"com.dvlproad.Beyond","app_name":"愿望屋","app_version":"1.0.0","app_buildNumber":"1","platform":"iOS","lib":"iOS","systemName":"iOS","lib_version":"16.1","lib_method":"code","lib_source":1,"brand":"iPhone","model":"iPhone","os":"x86_64","screen_width":393,"screen_height":852,"screen_devicePixelRatio":3,"device_id":"8CA0BE41-DE55-41E3-ABBD-8F8EC98652E3","geo_coordinate_system":"bd09ll"}}]},{"sectionTitle":"H5调用app，回调给H5(实时变化的)","sectionDatas":[{"h5CallBridgeActionDes":"获取用户token(用于安全的告知h5用户信息)，并回调给h5","h5CallBridgeActionName":"h5CallBridgeAction_getCurrentUserToken_v10000","h5CallBridgeSendMessage":{"callbackMethod":"bridgeCallH5Action_showCallbackJsonString"},"h5CallBridgeDescription":{"callbackMethod":"获取到的数值在h5上用哪个方法来接口"},"appCallbackDemo_ValueAndDescription":{"userToken":"bearer clientApp8983c8e6-5e3c-48e9-a3f7-9af53a946911"}},{"h5CallBridgeActionDes":"获取键盘变化高度，并回调给h5","h5CallBridgeActionName":"h5CallBridgeAction_getCurrentKeyboardHeight","h5CallBridgeSendMessage":{"callbackMethod":"bridgeCallH5Action_showCallbackJsonString"},"h5CallBridgeDescription":{"callbackMethod":"获取到的数值在h5上用哪个方法来接口"},"appCallbackDemo_ValueAndDescription":{"keyboardHeight":123}}]},{"sectionTitle":"WebControl的方法","sectionDatas":[{"h5CallBridgeActionDes":"关闭WebView","h5CallBridgeActionName":"h5CallBridgeAction_closeAppWebView_v10000","h5CallBridgeSendMessage":{"callbackMethod":"bridgeCallH5Action_showCallbackJsonString"}},{"h5CallBridgeActionDes":"刷新网页(到新地址)","h5CallBridgeActionName":"h5CallBridgeAction_reloadAppWebView_v10000","h5CallBridgeSendMessage":{"url":"https://www.baidu.com"}}]},{"sectionTitle":"h5调用app的方法(①无入参和回参;②有入参给app,但无需回参;③需回参给h5)","sectionDatas":[{"h5CallBridgeActionDes":"显示app的toast样式","h5CallBridgeActionName":"h5CallBridgeAction_showAppToast_v10000","h5CallBridgeSendMessage":{"message":"恭喜您调用成功"}},{"h5CallBridgeActionDes":"更新状态栏颜色_light","h5CallBridgeActionName":"h5CallBridgeAction_updateAppStatusBarStyle_v10000","h5CallBridgeSendMessage":{"statusBarColor":"light"}},{"h5CallBridgeActionDes":"更新状态栏颜色_dark","h5CallBridgeActionName":"h5CallBridgeAction_updateAppStatusBarStyle_v10000","h5CallBridgeSendMessage":{"statusBarColor":"dark"}},{"h5CallBridgeActionDes":"更新键盘弹出时候是否自动调整页面大小_true","h5CallBridgeActionName":"h5CallBridgeAction_updateResizeToAvoidBottomInset_v10000","h5CallBridgeSendMessage":{"shouldResizeToAvoidBottomInset":"true"}},{"h5CallBridgeActionDes":"更新键盘弹出时候是否自动调整页面大小_false","h5CallBridgeActionName":"h5CallBridgeAction_updateResizeToAvoidBottomInset_v10000","h5CallBridgeSendMessage":{"shouldResizeToAvoidBottomInset":"false"}}]},{"sectionTitle":"检查更新","sectionDatas":[{"h5CallBridgeActionDes":"调起检查更新","h5CallBridgeActionName":"h5CallBridgeAction_checkVersion_v10000","h5CallBridgeSendMessage":{"isManualCheck":true,"callOwner":"h5game"}}]},{"sectionTitle":"风控相关","sectionDatas":[{"h5CallBridgeActionDes":"是否是模拟器","h5CallBridgeActionName":"h5CallBridgeAction_isSimulator_v10000","h5CallBridgeSendMessage":{"types":["system","shumei","tongdun"],"callbackMethod":"bridgeCallH5Action_showCallbackJsonString"},"h5CallBridgeDescription":{"types":["想要系统方法获取的值","想要数美方法获取的值","想要同盾方法获取的值"],"callbackMethod":"获取到的数值在h5上用哪个方法来接口"},"appCallbackDemo_ValueAndDescription":{"resultCode":0,"result":[{"type":"system","value":true},{"type":"shumei","value":false},{"type":"tongdun","value":false}]}},{"h5CallBridgeActionDes":"获取设备唯一deviceId/设备指纹","h5CallBridgeActionName":"h5CallBridgeAction_getDeviceId_v10000","h5CallBridgeSendMessage":{"types":["system","shumei","tongdun"],"callbackMethod":"bridgeCallH5Action_showCallbackJsonString"},"h5CallBridgeDescription":{"types":["想要系统方法获取的值","想要数美方法获取的值","想要同盾方法获取的值"],"callbackMethod":"获取到的数值在h5上用哪个方法来接口"},"appCallbackDemo_ValueAndDescription":{"isSuccess":true,"result":[{"type":"system","value":true},{"type":"shumei","value":false},{"type":"tongdun","value":false}]}}]},{"sectionTitle":"认证相关","sectionDatas":[{"h5CallBridgeActionDes":"扫脸实人认证","h5CallBridgeActionName":"h5CallBridgeAction_realPersonAuthentication_v10000","h5CallBridgeSendMessage":{"certNo":"","certName":"","type":0,"callbackMethod":"bridgeCallH5Action_showCallbackJsonString"}}]},{"sectionTitle":"h5调用app的方法-其他操作(①无入参和回参;②有入参给app,但无需回参;③需回参给h5)","sectionDatas":[{"h5CallBridgeActionDes":"声音控制(播放、暂停、停止)-一定会用于iOS的网页声音控制","h5CallBridgeActionName":"h5CallBridgeAction_audioPlayer_v10000","h5CallBridgeSendMessage":{"type":"play","url":"https://tape.xihuanwu.com/wish_dev/audio/640/1460136481476464640/2022-08/bgm.mp3"},"h5CallBridgeDescription":{"type":"play:播放、pause:暂停、stop:停止","url":"play播放的时候，才必须传，其他操作，可为空"}}]},{"sectionTitle":"跳转到app指定页面--路由方式","sectionDatas":[{"h5CallBridgeActionDes":"跳转到app指定页面_Url_原生页面","h5CallBridgeActionName":"h5CallBridgeAction_jumpAppPageUrl_v10000","h5CallBridgeSendMessage":{"url":"yuanwangwu://openpage?pageName=imChatPage&conversationID=126191&imUserId=1602856363702501376&showName=用户1&type=1&dialogSubjectId=1506196208391966720"}},{"h5CallBridgeActionDes":"跳转到app指定页面_Url_网页游戏(url无参可不编码)","h5CallBridgeActionName":"h5CallBridgeAction_jumpAppPageUrl_v10000","h5CallBridgeSendMessage":{"url":"yuanwangwu://openpage?pageName=webNavPage&url=https://farm-game.yuanwangwu.com/index.html&shouldHideNavBar=true"}},{"h5CallBridgeActionDes":"跳转到app指定页面_Url_网页游戏(url带参必须编码)","h5CallBridgeActionName":"h5CallBridgeAction_jumpAppPageUrl_v10000","h5CallBridgeSendMessage":{"url":"yuanwangwu://openpage?pageName=webNavPage&shouldHideNavBar=true&navigatorBackgroundColor=0xffffff00&statusBarColor=light&url=https%3A%2F%2Ffarm-game.yuanwangwu.com%2Findex.html%26toUserId%3D111"}},{"h5CallBridgeActionDes":"跳转到app指定页面_Name_原生页面","h5CallBridgeActionName":"h5CallBridgeAction_jumpAppPageName_v10000","h5CallBridgeSendMessage":{"pageName":"imChatPage","pageParams":{"conversationID":"126191","imUserId":"1602856363702501376","showName":"用户1","type":1,"dialogSubjectId":"1506196208391966720"}}},{"h5CallBridgeActionDes":"跳转到app指定页面_Name_网页游戏","h5CallBridgeActionName":"h5CallBridgeAction_jumpAppPageName_v10000","h5CallBridgeSendMessage":{"pageName":"webNavPage","pageParams":{"shouldHideNavBar":true,"navigatorBackgroundColor":"0xffffff00","statusBarColor":"light","url":"https://farm-game.yuanwangwu.com/index.html&toUserId=111"}}}]},{"sectionTitle":"跳转到app具体指定页面--非路由方式","sectionDatas":[{"h5CallBridgeActionDes":"登出、跳到重新登录页","h5CallBridgeActionName":"h5CallBridgeAction_logout_v10000","h5CallBridgeSendMessage":{"userId":"159054"}},{"h5CallBridgeActionDes":"回到app的第几个一级页","h5CallBridgeActionName":"h5CallBridgeAction_backToHomeIndex_v10000","h5CallBridgeSendMessage":{"homeIndex":0}}]},{"sectionTitle":"调起三方应用","sectionDatas":[{"h5CallBridgeActionDes":"调起微信小程序(执行支付等)","h5CallBridgeActionName":"h5CallBridgeAction_callWechatMP_v10000","h5CallBridgeSendMessage":{"path":"xxx","callbackMethod":"bridgeCallH5Action_showCallbackJsonString"},"h5CallBridgeDescription":{"path":"微信小程序的路径","callbackMethod":"获取到的数值在h5上用哪个方法来接口"},"appCallbackDemo_ValueAndDescription":{"isSuccess":true}}]},{"sectionTitle":"分享网页链接到微信 h5CallBridgeAction_share_WEBPAGE_v10000","sectionDatas":[{"h5CallBridgeActionDes":"只是分享网页链接，没其他操作","h5CallBridgeActionName":"h5CallBridgeAction_share_WEBPAGE_v10000","h5CallBridgeSendMessage":{"shareType":"Wechat_SESSION","shareContentSource":"https://www.baidu.com","shareTitle":"你的好友发来一条加急消息","shareDescription":"急急急，快来帮我转大转盘，100%中奖！","shareThumbnailUrl":"https://img1.baidu.com/it/u=1605341541,1182642759&fm=253&app=138&size=w931&n=0&f=JPEG&fmt=auto?sec=1673370000&t=4e694f8a257f10a7f6b52bd051288e7d"},"h5CallBridgeDescription":{"shareType":"分享到微信哪个位置 [WeChatScene.SESSION]会话、[WeChatScene.TIMELINE]朋友圈、[WeChatScene.FAVORITE]收藏","shareContentSource":"分享的内容点击后要跳转到的网页地址","shareTitle":"分享的内容的文案","shareDescription":"分享的内容的描述","shareThumbnailUrl":"分享的内容的缩略图地址"}},{"h5CallBridgeActionDes":"分享链接，且链接可打开app的_原生页面","h5CallBridgeActionName":"h5CallBridgeAction_share_WEBPAGE_v10000","h5CallBridgeSendMessage":{"shareType":"Wechat_SESSION","shareContentSource":"yuanwangwu://openpage?pageName=imChatPage&conversationID=126191&imUserId=1602856363702501376&showName=用户1&type=1&dialogSubjectId=1506196208391966720","shareTitle":"你的好友发来一条加急消息","shareDescription":"急急急，快来帮我转大转盘，100%中奖！","shareThumbnailUrl":"https://img1.baidu.com/it/u=1605341541,1182642759&fm=253&app=138&size=w931&n=0&f=JPEG&fmt=auto?sec=1673370000&t=4e694f8a257f10a7f6b52bd051288e7d"}},{"h5CallBridgeActionDes":"分享链接，且链接可打开app的_网页游戏","h5CallBridgeActionName":"h5CallBridgeAction_share_WEBPAGE_v10000","h5CallBridgeSendMessage":{"shareType":"Wechat_SESSION","shareContentSource":"http://test-h5.yuanwangwu.com/pages-h5/share/share-farm?&accountId=1475332557208702976&appurl=yuanwangwu://openpage?pageName=farmGamePage&accountId=1475332557208702976","shareTitle":"你的好友发来一条加急消息","shareDescription":"急急急，快来帮我转大转盘，100%中奖！","shareThumbnailUrl":"https://img1.baidu.com/it/u=1605341541,1182642759&fm=253&app=138&size=w931&n=0&f=JPEG&fmt=auto?sec=1673370000&t=4e694f8a257f10a7f6b52bd051288e7d"}}]},{"sectionTitle":"分享(TEXT文本、IMAGE图片地址、VIDEO视频地址、WEBPAGE网页链接)到微信","sectionDatas":[{"h5CallBridgeActionDes":"分享《TEXT 文本内容》到【WeChatScene.SESSION 微信会话页】","h5CallBridgeActionName":"h5CallBridgeAction_share_TEXT_v10000","h5CallBridgeSendMessage":{"shareType":"Wechat_SESSION","shareContentSource":"你的好友发来一条加急消息"},"h5CallBridgeDescription":{"shareType":"分享到微信哪个位置 [WeChatScene.SESSION]会话、[WeChatScene.TIMELINE]朋友圈、[WeChatScene.FAVORITE]收藏","shareContentSource":"分享的文字内容"}},{"h5CallBridgeActionDes":"分享《IMAGE 图片内容》到【WeChatScene.SESSION 微信会话页】","h5CallBridgeActionName":"h5CallBridgeAction_share_IMAGE_v10000","h5CallBridgeSendMessage":{"shareType":"Wechat_SESSION","shareContentSource":"https://gimg3.baidu.com/search/src=http%3A%2F%2Fpics1.baidu.com%2Ffeed%2Fd788d43f8794a4c20f28bbb4f2ffe1dead6e3939.jpeg%40f_auto%3Ftoken%3Dd9363fee02e26c663dba51d2dcbb2493&refer=http%3A%2F%2Fwww.baidu.com&app=2021&size=f360,240&n=0&g=0n&q=75&fmt=auto?sec=1680886800&t=533df6cde2b8a86bbc9727f3088308df","shareTitle":"你的好友发来一条加急消息","shareDescription":"急急急，快来帮我转大转盘，100%中奖！","shareThumbnailUrl":"https://img1.baidu.com/it/u=1605341541,1182642759&fm=253&app=138&size=w931&n=0&f=JPEG&fmt=auto?sec=1673370000&t=4e694f8a257f10a7f6b52bd051288e7d"}},{"h5CallBridgeActionDes":"分享《VIDEO 视频内容》到【WeChatScene.SESSION 微信会话页】","h5CallBridgeActionName":"h5CallBridgeAction_share_VIDEO_v10000","h5CallBridgeSendMessage":{"shareType":"Wechat_SESSION","shareContentSource":"https://statics.xihuanwu.com/offical/wishhouse/static1683361771686/media/bg_video.895d2a6a.mp4","shareTitle":"你的好友发来一条加急消息","shareDescription":"急急急，快来帮我转大转盘，100%中奖！","shareThumbnailUrl":"https://img1.baidu.com/it/u=1605341541,1182642759&fm=253&app=138&size=w931&n=0&f=JPEG&fmt=auto?sec=1673370000&t=4e694f8a257f10a7f6b52bd051288e7d"}}]},{"sectionTitle":"分享《小程序》到微信(WechatMP微信小程序)","sectionDatas":[{"h5CallBridgeActionDes":"分享《WechatMP 微信小程序》到【WeChatScene.SESSION 微信会话页】","h5CallBridgeActionName":"h5CallBridgeAction_share_MP_v10000","h5CallBridgeSendMessage":{"shareType":"Wechat_SESSION","userName":"gh_4aae3c4e6c6f","shareContentSource":"https://yuanwangwu.com/home","path":"pages/index","shareTitle":"你的好友发来一条加急消息","shareDescription":"急急急，快来帮我转大转盘，100%中奖！","shareThumbnailUrl":"https://img1.baidu.com/it/u=1605341541,1182642759&fm=253&app=138&size=w931&n=0&f=JPEG&fmt=auto?sec=1673370000&t=4e694f8a257f10a7f6b52bd051288e7d"},"h5CallBridgeDescription":{"shareType":"分享到微信哪个位置 [WeChatScene.SESSION]会话、[WeChatScene.TIMELINE]朋友圈、[WeChatScene.FAVORITE]收藏","shareContentType":"分享的内容的类型(TEXT文本、IMAGE图片地址、VIDEO视频地址、WEBPAGE网页链接、WechatMP微信小程序)","shareContentSource":"为微信小程序主页地址","path":"微信小程序子路径","userName":"微信小程序id","shareTitle":"分享的内容的文案","shareDescription":"分享的内容的描述","shareThumbnailUrl":"分享的内容的缩略图地址"}}]},{"sectionTitle":"权限相关","sectionDatas":[{"h5CallBridgeActionDes":"打开app设置","h5CallBridgeActionName":"h5CallBridgeAction_openAppSettings_v10000","h5CallBridgeSendMessage":{"callbackMethod":"bridgeCallH5Action_showCallbackJsonString"}},{"h5CallBridgeActionDes":"获取定位权限(只获取值，不会请求打开)","h5CallBridgeActionName":"h5CallBridgeAction_location_get_permission_v10000","h5CallBridgeSendMessage":{"types":["permission","accuracy"],"callbackMethod":"bridgeCallH5Action_showCallbackJsonString"},"h5CallBridgeDescription":{"types":["permission 是否开启定位权限","accuracy 开始时定位数据是否精确"],"callbackMethod":"获取到的数值在h5上用哪个方法来接口"},"appCallbackDemo_ValueAndDescription":{"resultCode":0,"result":[{"isPermissionAllow":"定位开关是否打开(永不 permanentlyDenied、下次询问或在我共享时、使用APP期间、始终)","isDataFullAccuracy":"开启权限时，定位是否开启高精度模式(定位开关为永不的时候，设置里无此操作)"}]}}]},{"sectionTitle":"应用基础系统能力（保存图片、视频）","sectionDatas":[{"h5CallBridgeActionDes":"保存《IMAGE图片、VIDEO视频》到【相册】","h5CallBridgeActionName":"h5CallBridgeAction_saveAssetUrls_toAlbum_v10000","h5CallBridgeSendMessage":{"albumName":"XXXapp","assetUrls":["https://img1.baidu.com/it/u=1605341541,1182642759&fm=253&app=138&size=w931&n=0&f=JPEG&fmt=auto?sec=1673370000&t=4e694f8a257f10a7f6b52bd051288e7d","https://statics.xihuanwu.com/offical/wishhouse/static1683361771686/media/bg_video.895d2a6a.mp4"]},"h5CallBridgeDescription":{"albumName":"相册名字，可为空，为空时候为默认地址","assetUrls":["图片或视频网页地址","图片或视频网页地址"]}}]},{"sectionTitle":"实际业务功能","sectionDatas":[{"h5CallBridgeActionDes":"发送IM消息_私聊_文本","h5CallBridgeDescription":["发起会话聊天，发起私聊/商家聊天 商家聊天走的是群组聊天","dialogSubjectId: 跟店铺聊天的时候，传的是shopId 跟用户聊天则是 accountId"],"h5CallBridgeActionName":"h5CallBridgeAction_sendIMText_v10000","h5CallBridgeSendMessage":{"dialogType":"user","dialogSubjectId":"228013","text":"hello, 你好"}},{"h5CallBridgeActionDes":"显示打赏弹窗及动画_给愿望单","h5CallBridgeActionName":"h5CallBridgeAction_showAppReward_v10000","h5CallBridgeSendMessage":{"rewardType":"wish","rewardParams":{"wishId":"1836962","buyerId":"108031"}}}]},{"sectionTitle":"实际业务功能--支付操作(微信支付、支付宝支付、虚拟物品打赏)","sectionDatas":[{"h5CallBridgeActionDes":"调起【微信小程序】支付","h5CallBridgeActionName":"h5CallBridgeAction_pay_v10000","h5CallBridgeSendMessage":{"payType":"wx_mp","callbackMethod":"bridgeCallH5Action_showCallbackJsonString"},"h5CallBridgeDescription":{"payType":"wx_mp微信小程序支付、zhifubao支付宝支付","callbackMethod":"获取到的数值在h5上用哪个方法来接口"},"appCallbackDemo_ValueAndDescription":{"resultCode":0,"message":"支付成功"}},{"h5CallBridgeActionDes":"调起【浏览器支付宝】支付","h5CallBridgeActionName":"h5CallBridgeAction_pay_v10000","h5CallBridgeSendMessage":{"payType":"zhifubao","callbackMethod":"bridgeCallH5Action_showCallbackJsonString"},"h5CallBridgeDescription":{"payType":"wx_mp微信小程序支付、zhifubao支付宝支付","callbackMethod":"获取到的数值在h5上用哪个方法来接口"},"appCallbackDemo_ValueAndDescription":{"resultCode":0,"message":"支付成功"}}]},{"sectionTitle":"实际业务功能--下单流程(商品详情页、确认订单页)","sectionDatas":[{"h5CallBridgeActionDes":"跳转到app的《商品详情页》","h5CallBridgeActionName":"h5CallBridgeAction_jumpAppGoodsDetailPage_v10000","h5CallBridgeSendMessage":{"goodsId":"159054","goodsSkuId":"182057","goodsSourceScene":"h5_one_yuan_purchase"},"h5CallBridgeDescription":{"goodsId":"商品id","goodsSkuId":"商品sku id","goodsSourceScene":"商品来源于哪个场景的选择(用于区分不同活动等)"}},{"h5CallBridgeActionDes":"跳转到app的《提交/确认订单页》","h5CallBridgeActionName":"h5CallBridgeAction_jumpAppOrderConfirmPage_v10000","h5CallBridgeSendMessage":{"goodsId":"159054","goodsSkuId":"182057","goodsSourceScene":"h5_one_yuan_purchase","recipientUserId":"10002"},"h5CallBridgeDescription":{"goodsId":"商品id","goodsSkuId":"商品sku id","goodsSourceScene":"商品来源于哪个场景的选择(用于区分不同活动等)","recipientUserId":"收礼人的用户id(可填自己后者TA人)"}},{"h5CallBridgeActionDes":"跳转到app指定页面_Name_原生_代付详情页(找人付/帮我付)","h5CallBridgeActionName":"h5CallBridgeAction_jumpAppPageName_v10000","h5CallBridgeSendMessage":{},"h5CallBridgeDescription":{}}]}]
      
    </div>
    <footer class="article-footer">
      <a data-url="https://dvlproad.github.io/Architecture架构/h5_native_interacte/h5js/dvlp_h5js_demo/" data-id="cls067uh3015ub8r4l3498nrl" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-iOS/3必备知识架构/4①线程/4线程-①线程" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/iOS/3必备知识架构/4①线程/4线程-①线程/" class="article-date">
  <time datetime="2023-11-07T08:07:26.094Z" itemprop="datePublished">2023-11-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="必备知识架构-线程与网络-①线程"><a href="#必备知识架构-线程与网络-①线程" class="headerlink" title="必备知识架构-线程与网络-①线程"></a>必备知识架构-线程与网络-①线程</h1><p>[toc]</p>
<h1 id="知识架构"><a href="#知识架构" class="headerlink" title="知识架构"></a>知识架构</h1><p><a href="http://lib.csdn.net/base/ios/structure" target="_blank" rel="noopener">iOS知识库</a></p>
<p><a href="http://lib.csdn.net/base/Android/structure" target="_blank" rel="noopener">Android知识库</a></p>
<p></p><p id="目录"></p><p></p>
<h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><ul>
<li><a href="#多线程介绍">一、多线程介绍</a></li>
</ul>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;1、多线程的原理</span><br><span class="line">&gt;2、多线程的优缺点</span><br><span class="line">&gt;3、多线程在iOS开发中的应用</span><br><span class="line">&gt;4、iOS中三种多线程技术(NSThread、NSOperation/NSOperationQueue、GCD)</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li><a href="#线程间的通信">二、谈谈你对线程间的通信的了解</a></li>
</ul>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;线程间通信的体现:</span><br><span class="line">&gt;1. 一个线程传递数据给另一个线程</span><br><span class="line">&gt;2. 在一个线程中执行完特定任务后，转到另一个线程继续执行任务</span><br><span class="line">&gt;</span><br><span class="line">&gt;附：其他传值方法总结</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li><a href="#线程同步">三、线程等待(线程同步)、线程依赖问题</a></li>
</ul>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;1、通常的做法/不好的做法</span><br><span class="line">&gt;2、合理的做法（使用多线程异步执行）</span><br><span class="line">&gt;1)、先说说简单的多线程同步问题(异步线程里没有再开启异步线程)</span><br><span class="line">&gt;2)、真正的线程同步问题(异步线程里再开启异步线程)</span><br><span class="line">&gt;3)、其他补充</span><br><span class="line">&gt;附1：多个请求依次执行</span><br><span class="line">&gt;附2：并发数控制</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li><a href="#线程安全">四、线程安全问题</a></li>
</ul>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;1、线程安全</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li><a href="#常见笔试/面试题">常见笔试/面试题</a></li>
</ul>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;1、在使用SQLite过程中,如果多条线程同时操作同一数据库会造成什么问题,怎么解决?</span><br><span class="line">&gt;2、串行队列与并行队列的区别</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li><p><a href="#网络数据缓存">网络数据缓存</a></p>
</li>
<li><p><a href="#END">END</a></p>
</li>
</ul>
<p></p><p id="多线程介绍"></p><p></p>
<h2 id="一、多线程介绍"><a href="#一、多线程介绍" class="headerlink" title="一、多线程介绍"></a>一、多线程介绍</h2><blockquote>
<p><a href="#目录">&lt; 返回目录</a></p>
</blockquote>
<h4 id="1、多线程的原理"><a href="#1、多线程的原理" class="headerlink" title="1、多线程的原理"></a>1、多线程的原理</h4><p>同一时间，CPU只能处理1条线程，只有1条线程在工作（执行）。多线程并发（同时）执行，其实是CPU快速地在多条线程之间调度（切换）。如果CPU调度线程的时间足够快，就造成了多线程并发执行的假象。<br>思考：如果线程非常非常多，会发生什么情况？<br>答：CPU会在N多线程之间调度，CPU会累死，消耗大量的CPU资源，每条线程被调度执行的频次会降低（线程的执行效率降低）。</p>
<h4 id="2、多线程的优缺点"><a href="#2、多线程的优缺点" class="headerlink" title="2、多线程的优缺点"></a>2、多线程的优缺点</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">多线程的优点</span><br><span class="line">能适当提高程序的执行效率</span><br><span class="line">能适当提高资源利用率（CPU、内存利用率）</span><br><span class="line"></span><br><span class="line">多线程的缺点</span><br><span class="line">开启线程需要占用一定的内存空间（默认情况下，主线程占用1M，子线程占用512KB），如果开启大量的线程，会占用大量的内存空间，降低程序的性能</span><br><span class="line">线程越多，CPU在调度线程上的开销就越大</span><br><span class="line">程序设计更加复杂：比如线程之间的通信、多线程的数据共享</span><br></pre></td></tr></table></figure>
<h4 id="3、多线程在iOS开发中的应用"><a href="#3、多线程在iOS开发中的应用" class="headerlink" title="3、多线程在iOS开发中的应用"></a>3、多线程在iOS开发中的应用</h4><p>主线程:</p>
<blockquote>
<p>一个iOS程序运行后，默认会开启1条线程，称为“主线程”或“UI线程”</p>
</blockquote>
<p>主线程的主要作用：</p>
<blockquote>
<p>显示\刷新UI界面，处理UI事件（比如点击事件、滚动事件、拖拽事件等）</p>
</blockquote>
<p>主线程的使用注意:</p>
<blockquote>
<p>别将比较耗时的操作放到主线程中。耗时操作会卡住主线程，严重影响UI的流畅度，给用户一种“卡”的坏体验。</p>
</blockquote>
<h4 id="4、iOS中三种多线程技术-NSThread、NSOperation-NSOperationQueue、GCD"><a href="#4、iOS中三种多线程技术-NSThread、NSOperation-NSOperationQueue、GCD" class="headerlink" title="4、iOS中三种多线程技术(NSThread、NSOperation/NSOperationQueue、GCD)"></a>4、iOS中三种多线程技术(NSThread、NSOperation/NSOperationQueue、GCD)</h4><h6 id="1-NSThread"><a href="#1-NSThread" class="headerlink" title="1.NSThread"></a>1.NSThread</h6><ol>
<li>使用nsthread对象建立一个线程非常方便</li>
<li>但是！要使用nsthread管理多个线程非常困难，不推荐使用</li>
<li>技巧！使用<code>[NSThread currentThread]</code>跟踪任务所在线程，适用于这三种技术</li>
</ol>
<h6 id="2-NSOperation-NSOperationQueue"><a href="#2-NSOperation-NSOperationQueue" class="headerlink" title="2.NSOperation/NSOperationQueue"></a>2.NSOperation/NSOperationQueue</h6><p><a href="https://www.jianshu.com/p/4443d668e931" target="_blank" rel="noopener">NSOperation和NSOperationQueue相关</a></p>
<ol>
<li>是使用gcd实现的一套objective-c的api</li>
<li>是面向对象的线程技术</li>
<li>提供了一些在gcd中不容易实现的特性，如：限制最大并发数量、操作之间的依赖关系</li>
</ol>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; NSOperation`是系统提供的抽象的基类，我们使用的时候需要使用继承于它的子类。系统为我们提供了两种继承于`NSOperation`的子类，分别是`NSInvocationOperation`和`NSBlockOperation。</span><br><span class="line">&gt; </span><br><span class="line">&gt; 当将操作添加到主操作队列时，所有操作会按照添加到队列中的先后顺序串行依次执行。（主队列是GCD自带的一种特殊串行队列。）</span><br><span class="line">&gt; NSOperationQueue *mainQueue = [NSOperationQueue mainQueue];</span><br><span class="line">&gt; [mainQueue addOperation:op1];</span><br><span class="line">&gt; </span><br><span class="line">&gt; 当将任务添加到自定义队列的时候，会开启子线程，操作会并发执行。</span><br><span class="line">&gt; NSOperationQueue *customQueue = [[NSOperationQueue alloc]init];</span><br><span class="line">&gt; [customQueue addOperation:op1];</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<h6 id="3-GCD-——-grand-central-dispatch"><a href="#3-GCD-——-grand-central-dispatch" class="headerlink" title="3.GCD —— grand central dispatch"></a>3.GCD —— grand central dispatch</h6><ol>
<li>是基于c语言的底层api</li>
<li>用block定义任务，使用起来非常灵活便捷</li>
<li>提供了更多的控制能力以及操作队列中所不能使用的底层函数</li>
</ol>
<h1 id="NSOperationQueue与GCD的使用原则和场景"><a href="#NSOperationQueue与GCD的使用原则和场景" class="headerlink" title="NSOperationQueue与GCD的使用原则和场景"></a>NSOperationQueue与GCD的使用原则和场景</h1><p><a href="https://www.bbsmax.com/A/1O5Eekla57/" target="_blank" rel="noopener">NSOperationQueue与GCD的使用原则和场景</a></p>
<p></p><p id="线程同步"></p><p></p>
<h2 id="三、线程等待-线程同步-、线程依赖、任务顺序问题"><a href="#三、线程等待-线程同步-、线程依赖、任务顺序问题" class="headerlink" title="三、线程等待(线程同步)、线程依赖、任务顺序问题"></a>三、线程等待(线程同步)、线程依赖、任务顺序问题</h2><blockquote>
<p><a href="#目录">&lt; 返回目录</a></p>
</blockquote>
<p><strong>多个任务中，某个线程的执行依赖其他线程的执行完毕，或者某个线程的执行需等待其他线程执行完毕。</strong></p>
<p>常见场景：<br>某个页面加载时通过网络请求获得相应的数据，再做某些操作。有时候加载的内容需要通过好几个请求的数据组合而成，比如有两个请求A和B。</p>
<blockquote>
<p><img src="/iOS/3必备知识架构/4①线程/4线程-①线程/多线程同步需求分析图.png" alt="多线程同步需求分析图"></p>
</blockquote>
<h3 id="1、通常的做法-不好的做法：把并发队列变成串行"><a href="#1、通常的做法-不好的做法：把并发队列变成串行" class="headerlink" title="1、通常的做法/不好的做法：把并发队列变成串行"></a>1、通常的做法/不好的做法：把并发队列变成串行</h3><p>常见的有：为了省事，会将B请求放在A请求成功的回调中发起，将C请求放在B请求成功的回调中发起，在C的成功回调中将数据组合起来，这样做有明显的问题：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">①、请求如果多了，需要写许多嵌套的请求</span><br><span class="line">②、请求被变成了同步的方式了，这是最大的问题，在网络差的情况下，如果有n个请求，意味着用户要等待n倍于并发请求的时间才能看到内容</span><br></pre></td></tr></table></figure>
<h3 id="2、合理的做法（使用多线程异步执行）"><a href="#2、合理的做法（使用多线程异步执行）" class="headerlink" title="2、合理的做法（使用多线程异步执行）"></a>2、合理的做法（使用多线程异步执行）</h3><h4 id="1-、先说说简单的多线程同步问题-异步线程里没有再开启异步线程"><a href="#1-、先说说简单的多线程同步问题-异步线程里没有再开启异步线程" class="headerlink" title="1)、先说说简单的多线程同步问题(异步线程里没有再开启异步线程)"></a>1)、先说说简单的多线程同步问题(异步线程里没有再开启异步线程)</h4><p>首先我们先来看简单的多线程同步问题(异步线程里没有再开启异步线程)，这种时候，我们可以使用的方法有</p>
<blockquote>
<p>①<strong>使用GCD线程组dispatch_group的dispatch_group_notify即可解决问题</strong>。其中notify的作用就是在group中的其他操作全部完成后，再操作自己的内容。<br>② 使用NSOperationQueue中operation的addDependency<br><strong>③使用dispatch_barrier_async</strong>方法。</p>
</blockquote>
<h5 id="①、使用GCD线程组dispatch-group的dispatch-group-notify即可解决问题"><a href="#①、使用GCD线程组dispatch-group的dispatch-group-notify即可解决问题" class="headerlink" title="①、使用GCD线程组dispatch_group的dispatch_group_notify即可解决问题"></a>①、使用GCD线程组dispatch_group的dispatch_group_notify即可解决问题</h5><p>使用dispatch_group方法的代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">dispatch_group_t group = dispatch_group_create();</span><br><span class="line"></span><br><span class="line">dispatch_group_async(group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123;</span><br><span class="line">    //请求1</span><br><span class="line">    NSLog(@&quot;Request_1&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">dispatch_group_async(group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123;</span><br><span class="line">    //请求2</span><br><span class="line">    NSLog(@&quot;Request_2&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">dispatch_group_notify(group, dispatch_get_main_queue(), ^&#123;</span><br><span class="line">    //界面刷新</span><br><span class="line">    NSLog(@&quot;任务均完成，刷新界面&quot;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h5 id="②使用使用NSOperationQueue中operation的addDependency，则是"><a href="#②使用使用NSOperationQueue中operation的addDependency，则是" class="headerlink" title="②使用使用NSOperationQueue中operation的addDependency，则是"></a>②使用使用NSOperationQueue中operation的addDependency，则是</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//4.设置依赖</span><br><span class="line">[operation3 addDependency:operation1];      //任务二依赖任务一</span><br><span class="line">[operation3 addDependency:operation2];      //任务三依赖任务二</span><br><span class="line"> </span><br><span class="line">//5.创建队列并加入任务</span><br><span class="line">NSOperationQueue *queue = [[NSOperationQueue alloc] init];</span><br><span class="line">[queue addOperations:@[operation3, operation2, operation1] waitUntilFinished:NO];</span><br></pre></td></tr></table></figure>
<h5 id="③dispatch-barrier-async"><a href="#③dispatch-barrier-async" class="headerlink" title="③dispatch_barrier_async"></a>③dispatch_barrier_async</h5><h4 id="2-、真正的线程同步问题-异步线程里再开启异步线程"><a href="#2-、真正的线程同步问题-异步线程里再开启异步线程" class="headerlink" title="2)、真正的线程同步问题(异步线程里再开启异步线程)"></a>2)、真正的线程同步问题(异步线程里再开启异步线程)</h4><p>对于上面的例子，当将上面三个操作改成真实的网络操作后，这个简单的做法突然变得无效了，这是为什么呢？</p>
<p>其实这个道理很简单，因为我们开启的网络请求，是一个异步线程，所谓的异步线程，就是告诉系统你不要管我是否完成了，你尽管执行其他操作，开一个线程让我到外面操作去执行就行了，对我的处理你已经完成了，也就是说线程只负责将请求发出去，就认为自己的任务算完成了。所以，当三个请求都发送出去后，不会管网络操作是否完成，就会执行notify中的内容，但由于请求结果本身需要一定的时间，所以导致了界面都刷新了，而请求结果才返回。</p>
<p>即上面的问题，总结为<strong>如果dispatch_group_async里执行的是异步代码dispatch_group_notify会直接触发而不会等待异步任务完成。</strong></p>
<p>所以，对于这种异步线程里开异步线程的线程同步问题，该怎么处理呢？</p>
<p>为了应对这种异步线程里开异步线程的线程同步问题，其实我们需要多处理的只是<strong>监控异步线程里的所有操作(包括异步线程里的异步线程)都结束后，才算这个异步线程结束</strong>。</p>
<p>这里我们的解决方法常见的有：</p>
<p>方法A：直接使用dispatch_group_enter和dispatch_group_leave，即只需要在任务开始前enter和结束后leave即可达到线程同步的效果。</p>
<p>dispatch_group_enter(group)：下面的任务由group组管理，group组的任务数+1<br>dispatch_group_leave(group)：相应的任务执行完成，group组的任务数-1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">- (void)testGroupSync_userEnterLeave &#123;</span><br><span class="line">    dispatch_group_t group = dispatch_group_create();</span><br><span class="line">    </span><br><span class="line">    dispatch_group_enter(group);</span><br><span class="line">    dispatch_group_async(group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123;</span><br><span class="line">   			//请求1</span><br><span class="line">        dispatch_async(dispatch_get_global_queue(0, 0), ^&#123;</span><br><span class="line">            sleep(5);</span><br><span class="line">            NSLog(@&quot;任务一完成&quot;);</span><br><span class="line">            dispatch_group_leave(group);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    dispatch_group_enter(group);</span><br><span class="line">    dispatch_group_async(group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123;</span><br><span class="line">        //请求2</span><br><span class="line">        dispatch_async(dispatch_get_global_queue(0, 0), ^&#123;</span><br><span class="line">            sleep(8);</span><br><span class="line">            NSLog(@&quot;任务二完成&quot;);</span><br><span class="line">            dispatch_group_leave(group);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    dispatch_group_notify(group, dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        //界面刷新</span><br><span class="line">        NSLog(@&quot;任务均完成，刷新界面&quot;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>方法B：使用信号量，控制异步线程的结束，来达到多线程同步的效果。</p>
<p>在GCD中有三个函数是semaphore的操作，分别是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">　　dispatch_semaphore_create　　　创建一个semaphore</span><br><span class="line">　　dispatch_semaphore_signal　　　发送一个信号（信号量+1）</span><br><span class="line">　　dispatch_semaphore_wait　　　　等待信号(wait执行完后，信号量-1)</span><br></pre></td></tr></table></figure>
<p>实际使用，代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">- (void)testGroupSync_semaphore_signal_wait &#123;</span><br><span class="line">    dispatch_group_t group = dispatch_group_create();</span><br><span class="line">    </span><br><span class="line">    // 创建一个控制线程同步的信号量，初始值为0(红灯)</span><br><span class="line">    dispatch_semaphore_t syncSemaphore = dispatch_semaphore_create(0);</span><br><span class="line">    dispatch_group_async(group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123;</span><br><span class="line">      	//先再任务1的线程里中再开启一个异步线程执行请求1，同时堵塞住此时的任务1所在的线程，等到已开始的异步请求1结束之后，原本阻塞住的任务1线程才会恢复畅通，才代表任务1结束了。</span><br><span class="line">        //请求1</span><br><span class="line">        dispatch_async(dispatch_get_global_queue(0, 0), ^&#123;</span><br><span class="line">            sleep(5);</span><br><span class="line">            NSLog(@&quot;任务一完成&quot;);</span><br><span class="line">            // 使信号的信号量+1，这里的信号量本来为0，+1信号量为1(绿灯)</span><br><span class="line">            dispatch_semaphore_signal(syncSemaphore);</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        // 开启信号等待，设置等待时间为永久，直到信号的信号量大于等于1（等绿灯）</span><br><span class="line">        dispatch_semaphore_wait(syncSemaphore, DISPATCH_TIME_FOREVER);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    dispatch_group_async(group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123;</span><br><span class="line">        //请求2</span><br><span class="line">        dispatch_async(dispatch_get_global_queue(0, 0), ^&#123;</span><br><span class="line">            sleep(8);</span><br><span class="line">            NSLog(@&quot;任务二完成&quot;);</span><br><span class="line">            // 使信号的信号量+1，这里的信号量本来为0，+1信号量为1(绿灯)</span><br><span class="line">            dispatch_semaphore_signal(syncSemaphore);</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        // 开启信号等待，设置等待时间为永久，直到信号的信号量大于等于1（等绿灯）</span><br><span class="line">        dispatch_semaphore_wait(syncSemaphore, DISPATCH_TIME_FOREVER);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    dispatch_group_notify(group, dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        //界面刷新</span><br><span class="line">        NSLog(@&quot;任务均完成，刷新界面&quot;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>附：实际上，这段代码是一个常用的不控制并发数，只控制线程阻塞，实现线程同步的例子。在这里它是将等待信号<code>dispatch_semaphore_wait</code>放在线程执行后。往下看，待会会介绍控制并发数的例子。</p>
<p>上面例子中，先再任务1的线程里中再开启一个异步线程执行请求1，同时堵塞住此时的任务1所在的线程，等到已开始的异步请求1结束之后，恢复畅通，才代表任务1结束了。</p>
<h4 id="3-、其他控制任务顺序的例子"><a href="#3-、其他控制任务顺序的例子" class="headerlink" title="3)、其他控制任务顺序的例子"></a>3)、其他控制任务顺序的例子</h4><h5 id="附1：多个请求依次执行"><a href="#附1：多个请求依次执行" class="headerlink" title="附1：多个请求依次执行"></a>附1：多个请求依次执行</h5><p>例子：三个任务分别为下载图片，打水印和上传图片，三个任务需异步执行但需要顺序性。</p>
<p>对于这个问题通常会通过线程依赖进行解决。</p>
<ul>
<li>1、如果是GCD的话，设置线程依赖比较繁琐，所以这里就不讨论了。</li>
<li>2、如果是NSOperation的话，我们直接通过addDependency来设置一个操作队列NSOperationQueue中的线程依赖就可以了。</li>
</ul>
<p>代码如下(此例子不讨论线程里开线程，如果需要的话，请将信号量的使用添加上去即可解决)：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> //1.任务一：下载图片</span><br><span class="line">NSBlockOperation *operation1 = [NSBlockOperation blockOperationWithBlock:^&#123;</span><br><span class="line">    [self request_A];</span><br><span class="line">&#125;];</span><br><span class="line"> </span><br><span class="line">//2.任务二：打水印</span><br><span class="line">NSBlockOperation *operation2 = [NSBlockOperation blockOperationWithBlock:^&#123;</span><br><span class="line">    [self request_B];</span><br><span class="line">&#125;];</span><br><span class="line"> </span><br><span class="line">//3.任务三：上传图片</span><br><span class="line">NSBlockOperation *operation3 = [NSBlockOperation blockOperationWithBlock:^&#123;</span><br><span class="line">    [self request_C];</span><br><span class="line">&#125;];</span><br><span class="line"> </span><br><span class="line">//4.设置依赖</span><br><span class="line">[operation2 addDependency:operation1];      //任务二依赖任务一</span><br><span class="line">[operation3 addDependency:operation2];      //任务三依赖任务二</span><br><span class="line"> </span><br><span class="line">//5.创建队列并加入任务</span><br><span class="line">NSOperationQueue *queue = [[NSOperationQueue alloc] init];</span><br><span class="line">[queue addOperations:@[operation3, operation2, operation1] waitUntilFinished:NO];</span><br></pre></td></tr></table></figure>
<h2 id="四、多线程并发数控制"><a href="#四、多线程并发数控制" class="headerlink" title="四、多线程并发数控制"></a>四、多线程并发数控制</h2><p>当我们在处理一系列线程的时候，当数量达到一定量，我们需要处理并发数控制。</p>
<ul>
<li>1、如果是GCD的话，怎么快速的控制并发呢？答案就是dispatch_semaphore。这个比较复杂，但我们这边还是谈一下</li>
<li>2、如果是NSOperation的话，我们直接使用NSOperationQueue来控制并发，这个就不谈了。</li>
</ul>
<p>GCD使用信号量dispatch_semaphore控制并发</p>
<p>说道信号量，这里顺便谈下信号量的概念：</p>
<blockquote>
<p>信号量就是一个资源计数器，它是一个整形值并且具有一个初始计数值，并且支持两个操作：信号通知和等待。当一个信号量被信号通知，其计数会被增加。当一个线程在一个信号量上等待时<code>dispatch_semaphore_wait(sema, DISPATCH_TIME_FOREVER);</code>，线程会被阻塞（如果有必要的话），直至计数器大于零，然后线程会减少这个计数。</p>
</blockquote>
<p>上面的例子中，信号量初始值为0，其先执行到dispatch_semaphore_wait，此时由于信号量为0，所以造成了阻塞，而使得线程1没能结束它的工作。而到线程1里的异步线程执行完后，给信号量发送了一个通知，使得信号量的值加上了1，此时刚才线程1里的dispatch_semaphore_wait发现信号量大于等于1了，它就不再阻塞，而是继续执行下去，从而使得了线程1这时候真正结束了它所应该处理的工作。wait执行完后，信号量又减1了。</p>
<p>也就是通过这种<strong>线程阻塞/等待</strong>的方法，我们实现了线程的同步。</p>
<p>当然信号量的用途，除了可以用来实现线程同步外，还可以用来实现<strong>控制GCD的并发数</strong>。</p>
<p>代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">- (void)testBingfa &#123;</span><br><span class="line">    // 创建队列组</span><br><span class="line">    dispatch_group_t group = dispatch_group_create();</span><br><span class="line">    // 创建信号量，并且设置值为10</span><br><span class="line">    dispatch_semaphore_t semaphore = dispatch_semaphore_create(10);</span><br><span class="line">    dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</span><br><span class="line">    for (int i = 0; i &lt; 100; i++)</span><br><span class="line">    &#123;   // 由于是异步执行的，所以每次循环Block里面的dispatch_semaphore_signal根本还没有执行就会执行dispatch_semaphore_wait，从而semaphore-1.当循环10此后，semaphore等于0，则会阻塞线程，直到执行了Block的dispatch_semaphore_signal 才会继续执行</span><br><span class="line">        dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER);</span><br><span class="line">        dispatch_group_async(group, queue, ^&#123;</span><br><span class="line">            NSLog(@&quot;%i&quot;,i);</span><br><span class="line">            sleep(2);</span><br><span class="line">            // 每次发送信号则semaphore会+1，</span><br><span class="line">            dispatch_semaphore_signal(semaphore);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>比较这段代码与上面的代码，控制并发一般都是将等待信号<code>dispatch_semaphore_wait</code>放在线程执行前。而我们常用的只控制线程阻塞，实现线程同步的，都是将等待信号<code>dispatch_semaphore_wait</code>放在线程执行后。所以，如果一个多线程，它需要同时控制线程同步和线程并发数的话，那它就需要创建两个信号量来分别控制。代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">- (void)testGroupSyncAndBingfa_semaphore_signal_wait &#123;</span><br><span class="line">    dispatch_group_t group = dispatch_group_create();</span><br><span class="line">    </span><br><span class="line">    // 创建一个控制线程并发的信号量，初始值为最大并发数2(红灯)</span><br><span class="line">    dispatch_semaphore_t bingfaSemaphore = dispatch_semaphore_create(2);</span><br><span class="line">    </span><br><span class="line">    // 创建一个控制线程同步的信号量，初始值为0(红灯)</span><br><span class="line">    dispatch_semaphore_t syncSemaphore = dispatch_semaphore_create(0);</span><br><span class="line">    </span><br><span class="line">    dispatch_group_async(group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123;</span><br><span class="line">        dispatch_semaphore_wait(bingfaSemaphore, DISPATCH_TIME_FOREVER);    //并发信号</span><br><span class="line">        </span><br><span class="line">        //请求1</span><br><span class="line">        dispatch_async(dispatch_get_global_queue(0, 0), ^&#123;</span><br><span class="line">            sleep(5);</span><br><span class="line">            NSLog(@&quot;任务一完成&quot;);</span><br><span class="line">            dispatch_semaphore_signal(syncSemaphore);                   //同步信号</span><br><span class="line">        &#125;);</span><br><span class="line">        dispatch_semaphore_wait(syncSemaphore, DISPATCH_TIME_FOREVER);  //同步信号</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    dispatch_group_async(group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123;</span><br><span class="line">        dispatch_semaphore_wait(bingfaSemaphore, DISPATCH_TIME_FOREVER);    //并发信号</span><br><span class="line">        </span><br><span class="line">        //请求2</span><br><span class="line">        dispatch_async(dispatch_get_global_queue(0, 0), ^&#123;</span><br><span class="line">            sleep(8);</span><br><span class="line">            NSLog(@&quot;任务二完成&quot;);</span><br><span class="line">            dispatch_semaphore_signal(syncSemaphore);                   //同步信号</span><br><span class="line">        &#125;);</span><br><span class="line">        dispatch_semaphore_wait(syncSemaphore, DISPATCH_TIME_FOREVER);  //同步信号</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    dispatch_group_async(group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123;</span><br><span class="line">        dispatch_semaphore_wait(bingfaSemaphore, DISPATCH_TIME_FOREVER);    //并发信号</span><br><span class="line">        </span><br><span class="line">        //请求3</span><br><span class="line">        dispatch_async(dispatch_get_global_queue(0, 0), ^&#123;</span><br><span class="line">            sleep(6);</span><br><span class="line">            NSLog(@&quot;任务三完成&quot;);</span><br><span class="line">            dispatch_semaphore_signal(syncSemaphore);                   //同步信号</span><br><span class="line">        &#125;);</span><br><span class="line">        dispatch_semaphore_wait(syncSemaphore, DISPATCH_TIME_FOREVER);  //同步信号</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    dispatch_group_notify(group, dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        //界面刷新</span><br><span class="line">        NSLog(@&quot;任务均完成，刷新界面&quot;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>通过所附加的两个例子，我们明显的看出NSOperation在处理线程依赖以及并发数的问题上，明显更高级。所以，如果有类似的问题，我们优先使用NSOperation来处理。</em></p>
<p></p><p id="常见笔试/面试题"></p><p></p>
<h2 id="常见笔试-面试题"><a href="#常见笔试-面试题" class="headerlink" title="常见笔试/面试题"></a>常见笔试/面试题</h2><p><a href="#目录">&lt; 返回目录</a></p>
<h6 id="1、在使用SQLite过程中-如果多条线程同时操作同一数据库会造成什么问题-怎么解决"><a href="#1、在使用SQLite过程中-如果多条线程同时操作同一数据库会造成什么问题-怎么解决" class="headerlink" title="1、在使用SQLite过程中,如果多条线程同时操作同一数据库会造成什么问题,怎么解决?"></a>1、在使用SQLite过程中,如果多条线程同时操作同一数据库会造成什么问题,怎么解决?</h6><blockquote>
<p>答:(1)容易造成系统崩溃<br>(2)解决方案：开启串行模式，使用一个类（单例方式）操作数据库。</p>
</blockquote>
<p></p><p id="END"></p><p></p>
<h2 id="END"><a href="#END" class="headerlink" title="END"></a>END</h2><blockquote>
<p>&lt; <a href="#目录">返回目录</a></p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://dvlproad.github.io/iOS/3必备知识架构/4①线程/4线程-①线程/" data-id="cls067v2r0177b8r4t36nykit" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Architecture架构/h5_native_interacte/h5_mini_program/dvlp_mini_program_demo_JavascriptBridge" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/Architecture架构/h5_native_interacte/h5_mini_program/dvlp_mini_program_demo_JavascriptBridge/" class="article-date">
  <time datetime="2023-10-30T09:31:08.526Z" itemprop="datePublished">2023-10-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <!DOCTYPE html>
<html>

<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <!-- [was loaded over HTTPS, but requested an insecure错误解决](https://blog.csdn.net/weixin_40918067/article/details/117839199) -->
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">

  <title>小程序测试页面</title>
  <style>
    .button {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      text-align: center;
      margin-bottom: 10px;
      padding: 10px;
      font-size: 16px;
      border: none;
      background-color: #ffcc00;
      /* color: #ffffff; 设置文字颜色为白色 */
      line-height: 1.2;
    }

    .goPageButton {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      text-align: center;
      margin-bottom: 10px;
      padding: 10px;
      font-size: 16px;
      border: none;
      background-color: #009900;
      color: #ffffff;
      /* 设置文字颜色为白色 */
      line-height: 1.2;
    }
  </style>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>


<!-- [移动端调试神器vConsole使用详解](https://www.jb51.net/article/244750.htm) -->
<script src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js"></script>
<script>
  // VConsole 默认会挂载到 `window.VConsole` 上
  var vConsole = new window.VConsole();
  // 接下来即可照常使用 `console` 等方法
  console.log('Hello world');

  // 结束调试后，可移除掉
  vConsole.destroy();
</script>

<body>
  <h1 id="pageTitle">小程序首页</h1>
  <div id="buttonContainer">
    <button id="backButton" onclick="goBack()">返回前一页</button>
    <button id="reloadButton" onclick="reload()">刷新本页(无效)</button>
    <button id="forwardButton" onclick="goForward()">进入下一页</button>
    <br>
    <button id="goBaiduButton" class="goPageButton" onclick="goBaidu()">进入baidu</button>
    <button id="goPageButton1" class="goPageButton" onclick="goPage1()">进入page1</button>
    <button id="goPageButton2" class="goPageButton" onclick="goPage2()">进入page2</button>
  </div>
  <h6 id="logId">日志
    <div id="mpCallApp_closeMiniProgram_button2"></div>

    <script>
      // 从 localStorage 中获取计数器的值，如果不存在则初始化为 1。使其在整个生命周期中保持全局变量的值，并且不会在页面跳转时失效
      var firstPageCounter = 1;
      var secondPageCounter = 1;


      // 获取 URL 中的查询参数
      const urlParams = new URLSearchParams(window.location.search);

      // 获取 "title" 参数的值
      const title = urlParams.get('title');
      var randomNum = urlParams.get('randomNum');
      console.log(`title=${title}, randomNum=${randomNum}`);

      // 将获取的标题值设置为页面标题
      if (title) {
        // if (title == 'first') {
        //   fisrtPageCounter = randomNum;
        // } else if (title == 'second') {
        //   secondPageCounter = randomNum;
        // }
        const pageTitle = `${title}_${randomNum}`
        document.getElementById('pageTitle').innerText = pageTitle;
      }
    </script>


    <script>
      // 用于设置与移动端原生应用的通信桥梁
      function setupWebViewJavascriptBridge(callback) {
        if (window.WebViewJavascriptBridge) { return callback(WebViewJavascriptBridge); }
        if (window.WVJBCallbacks) { return window.WVJBCallbacks.push(callback); }
        window.WVJBCallbacks = [callback];
        var WVJBIframe = document.createElement('iframe');
        WVJBIframe.style.display = 'none';
        WVJBIframe.src = 'https://__bridge_loaded__';
        document.documentElement.appendChild(WVJBIframe);
        setTimeout(function () { document.documentElement.removeChild(WVJBIframe) }, 0)
      }


      setupWebViewJavascriptBridge(function (bridge) {
        var uniqueId = 1
        function log(message, data) {
          var log = document.getElementById('log')
          var el = document.createElement('div')
          el.className = 'logLine'
          el.innerHTML = uniqueId++ + '. ' + message + ':<br />' + JSON.stringify(data)
          if (log.children.length) { log.insertBefore(el, log.children[0]) }
          else { log.appendChild(el) }
        }

        // 注册一个处理来自移动端的消息的处理函数。
        bridge.registerHandler('testJavascriptHandler', function (data, responseCallback) {
          log('ObjC called testJavascriptHandler with', data)
          var responseData = { 'Javascript Says': 'Right back atcha!' }
          log('JS responding with', responseData)
          responseCallback(responseData)
        })

        var mpCallAppButton1 =
          document.getElementById('mpCallApp_closeMiniProgram_button2').appendChild(document.createElement('button'))
        mpCallAppButton1.innerHTML = '关闭小程序'
        mpCallAppButton1.onclick = function (e) {
          e.preventDefault()
          var shareDict = {
            'callback': 'window.shareResult'
          }
          bridge.callHandler('mpCallApp_closeMiniProgram', shareDict, function (response) {
            log('分享JS传给app的response值如下', response)
          })
        }

        setupViews(bridge)
      })

      function upateLog(message) {
        console.log(message);
        var log = document.getElementById('logId');
        log.innerText = message;
      }


      function goBaidu() {
        window.location.href = 'https://www.baidu.com';
      }


      function reload() {
        window.location.reload();
      }

      function goBack() {
        window.history.back();
      }

      function goForward() {
        window.history.forward();
      }
      window.addEventListener('load', updateButtonStatus)

      // 根据历史记录的状态更新按钮状态
      function updateButtonStatus() {
        const backButton = document.getElementById('backButton');
        const forwardButton = document.getElementById('forwardButton');

        backButton.disabled = !window.history || !window.history.back;
        forwardButton.disabled = !window.history || !window.history.forward;
      }


      function goPage1() {
        // firstPageCounter++;
        // localStorage.setItem('firstPageCounter', firstPageCounter);// 将计数器的值存储到 localStorage 中
        fisrtPageCounter = Math.floor(Math.random() * 1000); // 生成一个 0 到 999 的随机数

        var page = './dvlp_mini_program_demo_JavascriptBridge.html?title=1first&randomNum=' + fisrtPageCounter;
        //window.open(page, '_blank'); // 在 WebView 中，使用 window.open 可能无法正常打开新窗口。
         window.location.href = page; // 使用 href 才能正确使用 window.history.back();
         upateLog(`goPage1 已执行完进入:${page}`);
      }

      function goPage2() {
        // secondPageCounter++;
        // localStorage.setItem('secondPageCounter', secondPageCounter);// 将计数器的值存储到 localStorage 中
        secondPageCounter = Math.floor(Math.random() * 1000); // 生成一个 0 到 999 的随机数

        var page = './dvlp_mini_program_demo_JavascriptBridge.html?title=second&randomNum=' + secondPageCounter;
        //window.open(page, '_blank'); // 在 WebView 中，使用 window.open 可能无法正常打开新窗口。
         window.location.href = page; // 使用 href 才能正确使用 window.history.back();
        upateLog(`goPage2 已执行完进入:${page}`);
      }

      /// 更新 标题
      function _updateTitle(dataFromSource) {
        upateLog(`更新UI上的副标题为:${dataFromSource}`);
        document.getElementById("pageSubTilteView").innerHTML = `（${dataFromSource}）`;
      }


      function setupViews(bridge) {
        // 按钮信息对象injectedJSMethods
        const buttonInfo = {
          closeMiniProgram: {
            text: '关闭小程序',
            jsMethod: 'mpCallApp_closeMiniProgram'
          },
          hideMiniProgram: {
            text: '返回APP',
            jsMethod: 'mpCallApp_hideMiniProgram'
          },
          openAppUserDetail1: {
            text: '打开App的用户详情1',
            jsMethod: 'mpCallApp_openAppUserDetail1'
          },
          openAppUserDetail2: {
            text: '打开App的用户详情2',
            jsMethod: 'mpCallApp_openAppUserDetail2'
          },
        };

        // 生成按钮内容
        const buttonContainer = document.getElementById('buttonContainer');
        Object.keys(buttonInfo).forEach(function (action) {
          const info = buttonInfo[action];
          const button = document.createElement('button');
          button.className = 'button';
          button.dataset.action = action;
          upateLog(`====赋值 ${JSON.stringify(button.dataset)} ===== ${action}`);

          var buttonText = `${info.text}`;
          if (info.jsMethod.startsWith('mpCallApp_')) {
            buttonText += `<br>`;
            buttonText += `<span style="color: red;">${info.jsMethod}</span>`; // 使用红色作为示例颜色
          }
          button.innerHTML = buttonText;

          buttonContainer.appendChild(button);
        });

        // 事件委托，处理按钮点击事件
        buttonContainer.addEventListener('click', function (event) {
          const target = event.target;
          const action = target.dataset.action;
          upateLog(`====点击了1 ${JSON.stringify(event)} ===== ${action}`);
          if (action) {
            handleButtonAction(action);
          }
        });

        // 处理按钮点击事件
        function handleButtonAction(action) {
          const info = buttonInfo[action];
          if (info) {
            if (info.jsMethod.startsWith('mpCallApp_')) {
              var sendMessage = '{"message":"来自H5的文本"}';

              var shareDict = {
                'moduleType': '505',
                'callback': 'window.scanResult'
              }
              // upateLog(`bridge=${bridge}`)
              if (bridge != undefined) {
                bridge.callHandler(info.jsMethod, shareDict, function (response) {
                  log('传给app的response值如下', response)
                })
              } else {
                _showAlert(`bridge=${bridge} 导致调用JS失败`)
              }
            }
          }
        }
      }
      // setupViews()


      function _showAlert(message) {
        upateLog(`弹窗内容：${message}`);
      }

    </script>
</h6></body>

</html>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://dvlproad.github.io/Architecture架构/h5_native_interacte/h5_mini_program/dvlp_mini_program_demo_JavascriptBridge/" data-id="cls067ud8015mb8r4lzszycp9" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Architecture架构/h5_native_interacte/h5_mini_program/dvlp_mini_program_user_page_postMessage" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/Architecture架构/h5_native_interacte/h5_mini_program/dvlp_mini_program_user_page_postMessage/" class="article-date">
  <time datetime="2023-10-19T11:12:47.806Z" itemprop="datePublished">2023-10-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <!DOCTYPE html>
<html lang="en">
  <head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
  </head>
  <body>
      <div id="buttonContainer">
        <button id="backButton" onclick="goBack()">返回前一页</button>
        <button id="reloadButton" onclick="reload()">刷新本页(无效)</button>
        <button id="forwardButton" onclick="goForward()">进入下一页</button>
      </div>
      
    <div onclick="onJump()">点击跳转test1</div>
    <div onclick="onJump2()">点击跳转test2</div>
    <div id="test"></div>
  </body>
  <script src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js"></script>
  <script>
    let vConsole = new VConsole();
    
    function reload() {
      window.location.reload();
    }
      
    function goBack() {
      window.history.back();
    }

    function goForward() {
      window.history.forward();
    }

    function onJump() {
      console.log("点击跳转test1");
      fisrtPageCounter = Math.floor(Math.random() * 1000); // 生成一个 0 到 999 的随机数

      var page = './dvlp_mini_program_demo_postMessage.html?title=1first&randomNum=' + fisrtPageCounter;
      
      // window.location.href = 'test.html?title=点击跳转test1'
      window.open("dvlp_mini_program_user_page_postMessage.html?title=点击跳转test1");
      document.getElementById('test').innerHTML='我是页面test1'
    }
    function onJump2() {
      console.log("点击跳转test2");
      window.location.href = "dvlp_mini_program_user_page_postMessage.html?title=点击跳转test2";
      document.getElementById('test').innerHTML='我是页面test2'
    }
  </script>
</html>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://dvlproad.github.io/Architecture架构/h5_native_interacte/h5_mini_program/dvlp_mini_program_user_page_postMessage/" data-id="cls067udp015nb8r4i4d7qj2i" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Architecture架构/h5_native_interacte/h5_mini_program/dvlp_mini_program_demo_postMessage" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/Architecture架构/h5_native_interacte/h5_mini_program/dvlp_mini_program_demo_postMessage/" class="article-date">
  <time datetime="2023-10-19T11:12:47.806Z" itemprop="datePublished">2023-10-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <!DOCTYPE html>
<html>

<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <!-- [was loaded over HTTPS, but requested an insecure错误解决](https://blog.csdn.net/weixin_40918067/article/details/117839199) -->
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">

  <title>小程序测试页面</title>
  <style>
    .button {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      text-align: center;
      margin-bottom: 10px;
      padding: 10px;
      font-size: 16px;
      border: none;
      background-color: #ffcc00;
      /* color: #ffffff; 设置文字颜色为白色 */
      line-height: 1.2;
    }

    .goPageButton {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      text-align: center;
      margin-bottom: 10px;
      padding: 10px;
      font-size: 16px;
      border: none;
      background-color: #009900;
      color: #ffffff;
      /* 设置文字颜色为白色 */
      line-height: 1.2;
    }
  </style>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>


<!-- [移动端调试神器vConsole使用详解](https://www.jb51.net/article/244750.htm) -->
<script src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js"></script>
<script>
  // VConsole 默认会挂载到 `window.VConsole` 上
  var vConsole = new window.VConsole();
  // 接下来即可照常使用 `console` 等方法
  console.log('Hello world');

  // 结束调试后，可移除掉
  vConsole.destroy();
</script>

<body>
  <h1 id="pageTitle">小程序首页</h1>
  <div id="buttonContainer">
    <button id="backButton" onclick="goBack()">返回前一页</button>
    <button id="reloadButton" onclick="reload()">刷新本页(无效)</button>
    <button id="forwardButton" onclick="goForward()">进入下一页</button>
    <br>
    <button id="goBaiduButton" class="goPageButton" onclick="goBaidu()">进入baidu</button>
    <button id="goPageButton1" class="goPageButton" onclick="goPage1()">进入page1</button>
    <button id="goPageButton2" class="goPageButton" onclick="goPage2()">进入page2</button>
  </div>
  <h6 id="logId">日志
    <div id="mpCallApp_closeMiniProgram_button2"></div>

    <script>
      // 从 localStorage 中获取计数器的值，如果不存在则初始化为 1。使其在整个生命周期中保持全局变量的值，并且不会在页面跳转时失效
      var firstPageCounter = 1;
      var secondPageCounter = 1;


      // 获取 URL 中的查询参数
      const urlParams = new URLSearchParams(window.location.search);

      // 获取 "title" 参数的值
      const title = urlParams.get('title');
      var randomNum = urlParams.get('randomNum');
      console.log(`title=${title}, randomNum=${randomNum}`);

      // 将获取的标题值设置为页面标题
      if (title) {
        // if (title == 'first') {
        //   fisrtPageCounter = randomNum;
        // } else if (title == 'second') {
        //   secondPageCounter = randomNum;
        // }
        const pageTitle = `${title}_${randomNum}`
        document.getElementById('pageTitle').innerText = pageTitle;
      }
    </script>


    <script>
      // setupViews()

      function upateLog(message) {
        console.log(message);
        var log = document.getElementById('logId');
        log.innerText = message;
      }


      function goBaidu() {
        window.location.href = 'https://www.baidu.com';
      }


      function reload() {
        window.location.reload();
      }

      function goBack() {
        window.history.back();
      }

      function goForward() {
        window.history.forward();
      }
      window.addEventListener('load', updateButtonStatus)

      // 根据历史记录的状态更新按钮状态
      function updateButtonStatus() {
        const backButton = document.getElementById('backButton');
        const forwardButton = document.getElementById('forwardButton');

        backButton.disabled = !window.history || !window.history.back;
        forwardButton.disabled = !window.history || !window.history.forward;
      }


      function goPage1() {
        // firstPageCounter++;
        // localStorage.setItem('firstPageCounter', firstPageCounter);// 将计数器的值存储到 localStorage 中
        fisrtPageCounter = Math.floor(Math.random() * 1000); // 生成一个 0 到 999 的随机数

        var page = './dvlp_mini_program_demo_postMessage.html?title=1first&randomNum=' + fisrtPageCounter;
        //window.open(page, '_blank'); // 在 WebView 中，使用 window.open 可能无法正常打开新窗口。
         window.location.href = page; // 使用 href 才能正确使用 window.history.back();
         upateLog(`goPage1 已执行完进入:${page}`);
      }

      function goPage2() {
        // secondPageCounter++;
        // localStorage.setItem('secondPageCounter', secondPageCounter);// 将计数器的值存储到 localStorage 中
        secondPageCounter = Math.floor(Math.random() * 1000); // 生成一个 0 到 999 的随机数

        var page = './dvlp_mini_program_demo_postMessage.html?title=second&randomNum=' + secondPageCounter;
        //window.open(page, '_blank'); // 在 WebView 中，使用 window.open 可能无法正常打开新窗口。
         window.location.href = page; // 使用 href 才能正确使用 window.history.back();
        upateLog(`goPage2 已执行完进入:${page}`);
      }

      /// 更新 标题
      function _updateTitle(dataFromSource) {
        upateLog(`更新UI上的副标题为:${dataFromSource}`);
        document.getElementById("pageSubTilteView").innerHTML = `（${dataFromSource}）`;
      }


      function setupViews() {
        // 按钮信息对象injectedJSMethods
        const buttonInfo = {
          closeMiniProgram: {
            text: '关闭小程序',
            jsMethod: 'mpCallApp_closeMiniProgram'
          },
          hideMiniProgram: {
            text: '返回APP',
            jsMethod: 'mpCallApp_hideMiniProgram'
          },
          openAppUserDetail1: {
            text: '打开App的用户详情1',
            jsMethod: 'mpCallApp_openAppUserDetail1'
          },
          openAppUserDetail2: {
            text: '打开App的用户详情2',
            jsMethod: 'mpCallApp_openAppUserDetail2'
          },
        };

        // 生成按钮内容
        const buttonContainer = document.getElementById('buttonContainer');
        Object.keys(buttonInfo).forEach(function (action) {
          const info = buttonInfo[action];
          const button = document.createElement('button');
          button.className = 'button';
          button.dataset.action = action;
          upateLog(`====赋值 ${JSON.stringify(button.dataset)} ===== ${action}`);

          var buttonText = `${info.text}`;
          if (info.jsMethod.startsWith('mpCallApp_')) {
            buttonText += `<br>`;
            buttonText += `<span style="color: red;">${info.jsMethod}</span>`; // 使用红色作为示例颜色
          }
          button.innerHTML = buttonText;

          buttonContainer.appendChild(button);
        });

        // 事件委托，处理按钮点击事件
        buttonContainer.addEventListener('click', function (event) {
          const target = event.target;
          const action = target.dataset.action;
          upateLog(`====点击了1 ${JSON.stringify(event)} ===== ${action}`);
          if (action) {
            handleButtonAction(action);
          }
        });

        // 处理按钮点击事件
        function handleButtonAction(action) {
          const info = buttonInfo[action];
          if (info) {
            if (info.jsMethod.startsWith('mpCallApp_')) {
              var sendMessage = '{"message":"来自H5的文本"}';

              var shareDict = {
                'moduleType': '505',
                'callback': 'window.scanResult'
              }

              eval(info.jsMethod).postMessage(sendMessage);

              // upateLog(`bridge=${bridge}`)
            }
          }
        }
      }
      setupViews()


      function _showAlert(message) {
        upateLog(`弹窗内容：${message}`);
      }

    </script>
</h6></body>

</html>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://dvlproad.github.io/Architecture架构/h5_native_interacte/h5_mini_program/dvlp_mini_program_demo_postMessage/" data-id="cls067uf5015qb8r430auphcg" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/46/">46</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Architecture/">Architecture</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Architecture/埋点相关/">埋点相关</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Architecture/打包/">打包</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Architecture/搜索相关/">搜索相关</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Architecture/权限相关/">权限相关</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Architecture/第一章：JS/">第一章：JS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Architecture/第一章：代码规范/">第一章：代码规范</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Architecture/第一章：依赖关系可视化/">第一章：依赖关系可视化</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Architecture/第一章：埋点/">第一章：埋点</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Architecture/第一章：基础规范/">第一章：基础规范</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Architecture/第一章：架构分层/">第一章：架构分层</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Architecture/第一章：请求/">第一章：请求</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Architecture/第三章：h5与app交互/">第三章：h5与app交互</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Architecture/第二章：体验优化/">第二章：体验优化</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Architecture/第四章：webView/">第四章：webView</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Architecture/路由及跳转/">路由及跳转</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Architecture/通用业务规范/">通用业务规范</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Architecture/风控相关/">风控相关</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Flutter/">Flutter</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Flutter/无瑕疵的混编登录页/">无瑕疵的混编登录页</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Flutter/第一章：Flutter入门/">第一章：Flutter入门</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Flutter/第七章：规范/">第七章：规范</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Flutter/第三章：原生项目与Flutter的交互/">第三章：原生项目与Flutter的交互</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Flutter/第九章：框架升级/">第九章：框架升级</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Flutter/第二章：集成Flutter到原生项目/">第二章：集成Flutter到原生项目</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Flutter/第五章：详解/">第五章：详解</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Flutter/第八章：状态管理/">第八章：状态管理</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Flutter/第六章：进阶/">第六章：进阶</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Flutter/第四章：Flutter登录页实战/">第四章：Flutter登录页实战</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Flutter/第零章：Flutter源码/">第零章：Flutter源码</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/QA/">QA</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/README/">README</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/React/">React</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/React/第一章：React入门/">第一章：React入门</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/ReactNative/">ReactNative</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/ReactNative/第一章：ReactNative入门/">第一章：ReactNative入门</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ReactNative/第一章：React入门/">第一章：React入门</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ReactNative/第五章：ReactNative详解/">第五章：ReactNative详解</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ReactNative/第八章：ReactNative实践/">第八章：ReactNative实践</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ReactNative/第六章：ReactNative进阶/">第六章：ReactNative进阶</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Script/">Script</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Script/JQuery/">JQuery</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Script/JavaScript/">JavaScript</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Script/Mac快速操作/">Mac快速操作</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Script/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Script/Ruby/">Ruby</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Script/Shell/">Shell</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Weex/">Weex</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Weex/第一章：Weex入门/">第一章：Weex入门</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/">iOS</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/Swift/">Swift</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/混编/">混编</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/移动分析/">移动分析</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/自动化/">自动化</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/证书发版/">证书发版</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/npmjs/">npmjs</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/上架相关/">上架相关</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/代码管理/">代码管理</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/安全/">安全</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/安全/Android合规安全/">Android合规安全</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/安全/第一章：项目安全/">第一章：项目安全</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/实用工具/">实用工具</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/实用工具/ChatGPT/">ChatGPT</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/实用工具/GitBook/">GitBook</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/实用工具/Hexo/">Hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/实用工具/Jenkins/">Jenkins</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/实用工具/MySQL/">MySQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/实用工具/XAMPP/">XAMPP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/实用工具/Zentao/">Zentao</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/实用工具/其他小工具/">其他小工具</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作常识/">工作常识</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术常识/">技术常识</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术选型/">技术选型</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/技术选型/第一章：APM调研/">第一章：APM调研</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术选型/第一章：产品选型的考虑因素/">第一章：产品选型的考虑因素</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术选型/第一章：加固选型/">第一章：加固选型</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/生活常识/">生活常识</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/目前痛点/">目前痛点</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/管理相关/">管理相关</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/管理相关/第一章：账号管理/">第一章：账号管理</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/编程工具/">编程工具</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/跨平台/">跨平台</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/跨平台/第一章：混编事项说明/">第一章：混编事项说明</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Architecture/">Architecture</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ChatGPT/">ChatGPT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CocoaPods/">CocoaPods</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flutter/">Flutter</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/">Git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JQuery/">JQuery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jenkins/">Jenkins</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mac快速操作/">Mac快速操作</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/QA/">QA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/README/">README</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/">React</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ReactNative/">ReactNative</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ruby/">Ruby</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Script/">Script</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shell/">Shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Swift/">Swift</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Weex/">Weex</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iOS/">iOS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/npmjs/">npmjs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/上架相关/">上架相关</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/交互/">交互</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/实用工具/">实用工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/工作常识/">工作常识</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/技术常识/">技术常识</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/抓包/">抓包</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/文档管理/">文档管理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/环境搭建/">环境搭建</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/生活常识/">生活常识</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/痛点/">痛点</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/登录页实战/">登录页实战</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/移动分析/">移动分析</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/编程工具/">编程工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/自动化/">自动化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/跨平台/">跨平台</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/阿里云/">阿里云</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/阿里云oss/">阿里云oss</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/集成/">集成</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Architecture/" style="font-size: 20px;">Architecture</a> <a href="/tags/ChatGPT/" style="font-size: 10px;">ChatGPT</a> <a href="/tags/CocoaPods/" style="font-size: 10px;">CocoaPods</a> <a href="/tags/Flutter/" style="font-size: 18.46px;">Flutter</a> <a href="/tags/Git/" style="font-size: 13.85px;">Git</a> <a href="/tags/JQuery/" style="font-size: 10px;">JQuery</a> <a href="/tags/JavaScript/" style="font-size: 10px;">JavaScript</a> <a href="/tags/Jenkins/" style="font-size: 14.62px;">Jenkins</a> <a href="/tags/Mac快速操作/" style="font-size: 10px;">Mac快速操作</a> <a href="/tags/Python/" style="font-size: 11.54px;">Python</a> <a href="/tags/QA/" style="font-size: 10px;">QA</a> <a href="/tags/README/" style="font-size: 10px;">README</a> <a href="/tags/React/" style="font-size: 10.77px;">React</a> <a href="/tags/ReactNative/" style="font-size: 16.15px;">ReactNative</a> <a href="/tags/Ruby/" style="font-size: 10px;">Ruby</a> <a href="/tags/Script/" style="font-size: 15.38px;">Script</a> <a href="/tags/Shell/" style="font-size: 11.54px;">Shell</a> <a href="/tags/Swift/" style="font-size: 12.31px;">Swift</a> <a href="/tags/Weex/" style="font-size: 10px;">Weex</a> <a href="/tags/iOS/" style="font-size: 17.69px;">iOS</a> <a href="/tags/npmjs/" style="font-size: 10.77px;">npmjs</a> <a href="/tags/上架相关/" style="font-size: 10px;">上架相关</a> <a href="/tags/交互/" style="font-size: 12.31px;">交互</a> <a href="/tags/实用工具/" style="font-size: 16.92px;">实用工具</a> <a href="/tags/工作常识/" style="font-size: 10px;">工作常识</a> <a href="/tags/技术常识/" style="font-size: 13.08px;">技术常识</a> <a href="/tags/抓包/" style="font-size: 10px;">抓包</a> <a href="/tags/文档管理/" style="font-size: 14.62px;">文档管理</a> <a href="/tags/环境搭建/" style="font-size: 10.77px;">环境搭建</a> <a href="/tags/生活常识/" style="font-size: 10px;">生活常识</a> <a href="/tags/痛点/" style="font-size: 10px;">痛点</a> <a href="/tags/登录页实战/" style="font-size: 12.31px;">登录页实战</a> <a href="/tags/移动分析/" style="font-size: 11.54px;">移动分析</a> <a href="/tags/编程工具/" style="font-size: 11.54px;">编程工具</a> <a href="/tags/自动化/" style="font-size: 11.54px;">自动化</a> <a href="/tags/跨平台/" style="font-size: 19.23px;">跨平台</a> <a href="/tags/阿里云/" style="font-size: 10px;">阿里云</a> <a href="/tags/阿里云oss/" style="font-size: 13.85px;">阿里云oss</a> <a href="/tags/集成/" style="font-size: 11.54px;">集成</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">January 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">December 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">November 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/10/">October 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/09/">September 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/08/">August 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">July 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">April 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/01/">January 2013</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/Architecture架构/h5_native_interacte/h5js/dvlp_h5js_h5Action_demo/">(no title)</a>
          </li>
        
          <li>
            <a href="/Architecture架构/h5_native_interacte/h5_open_app/dvlp_h5_open_app_browser_url_demo/">(no title)</a>
          </li>
        
          <li>
            <a href="/Architecture架构/h5_native_interacte/h5_open_app/dvlp_h5_open_app_app_route_url_demo/">(no title)</a>
          </li>
        
          <li>
            <a href="/Architecture架构/h5_native_interacte/h5js/dvlp_h5js_demo/">(no title)</a>
          </li>
        
          <li>
            <a href="/Architecture架构/h5_native_interacte/commonjs/common_url_update/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2024 dvlproad<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
    <a href="/about" class="mobile-nav-link">关于</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>