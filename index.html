<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>dvlproadの博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="学而时习之不亦说乎(dvlproad)">
<meta name="keywords" content="blog,IT,iOS,Flutter">
<meta property="og:type" content="website">
<meta property="og:title" content="dvlproadの博客">
<meta property="og:url" content="https://dvlproad.github.io/index.html">
<meta property="og:site_name" content="dvlproadの博客">
<meta property="og:description" content="学而时习之不亦说乎(dvlproad)">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="dvlproadの博客">
<meta name="twitter:description" content="学而时习之不亦说乎(dvlproad)">
  
    <link rel="alternate" href="/atom.xml" title="dvlproadの博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">dvlproadの博客</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">整理及总结平时过程中的知识点</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
          <a class="main-nav-link" href="/about">关于</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://dvlproad.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Architecture架构/架构相关/3组件化/5框架设计模式-⑦组件化" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/Architecture架构/架构相关/3组件化/5框架设计模式-⑦组件化/" class="article-date">
  <time datetime="2024-09-01T09:05:41.000Z" itemprop="datePublished">2024-09-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Architecture/">Architecture</a>►<a class="article-category-link" href="/categories/Architecture/第一章：架构相关/">第一章：架构相关</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Architecture架构/架构相关/3组件化/5框架设计模式-⑦组件化/">框架设计模式-⑦组件化</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[toc]</p>
<h2 id="一、概念了解"><a href="#一、概念了解" class="headerlink" title="一、概念了解"></a>一、概念了解</h2><h4 id="1、组件化"><a href="#1、组件化" class="headerlink" title="1、组件化"></a>1、组件化</h4><p>就是<strong>“基础库”</strong>或者<strong>“基础组件”，</strong>意思是把代码重复的部分提炼出一个个组件供给功能使用。</p>
<p>​    使用：Dialog，各种自定义的UI控件、能在项目或者不同项目重复应用的代码等等。</p>
<p>​    目的：复用，解耦。</p>
<p>​    依赖：组件之间低依赖，比较独立。</p>
<p>​    架构定位：纵向分层（位于架构底层，被其他层所依赖）。</p>
<h4 id="2、模块化"><a href="#2、模块化" class="headerlink" title="2、模块化"></a>2、模块化</h4><p>就是<strong>“业务框架”</strong>或者<strong>“业务模块”</strong>，也可以理解为“框架”，意思是把功能进行划分，将同一类型的代码整合在一起，所以模块的功能相对复杂，但都同属于一个业务。</p>
<p>​    使用：按照项目功能需求划分成不同类型的业务框架（例如：注册、登录、外卖、直播…..）</p>
<p>​    目的：隔离/封装 （高内聚）。</p>
<p>​    依赖：模块之间有依赖的关系，可通过路由器进行模块之间的耦合问题。</p>
<p>​    架构定位：横向分块（位于架构业务框架层）。</p>
<h4 id="3、总结"><a href="#3、总结" class="headerlink" title="3、总结"></a>3、总结</h4><p>​      其实组件相当于<strong>库</strong>，把一些能在<strong>项目里或者不同类型项目中</strong>可复用的代码进行工具性的封装。</p>
<p>​      而模块相应于<strong>业务逻辑模块</strong>，把<strong>同一类型项目里</strong>的功能逻辑进行进行需求性的封装。</p>
<h2 id="二、组件化的必要性-产生背景"><a href="#二、组件化的必要性-产生背景" class="headerlink" title="二、组件化的必要性/产生背景"></a>二、组件化的必要性/产生背景</h2><p>1、产生背景：</p>
<p>所有模块代码都编写在一个项目中，在项目越来越大后，<strong>测试/使用某个模块或功能，需要编译运行整个项目，麻烦</strong>。</p>
<p>2、组件化思路：</p>
<p>将每个模块作为一个组件，加一个<strong>中间层</strong>来协调各个模块间的调用，<strong>所有的模块间的调用都会经过中间层中转。</strong>（<strong>只让其他模块对中间层产生耦合关系，中间层不对其他模块发生耦合</strong>。）</p>
<p>3、组件化好处：</p>
<p>业务划分更佳清晰，新人接手更佳容易，可以按组件分配开发任务。</p>
<p>项目可维护性更强，提高开发效率。</p>
<p>更好排查问题，某个组件出现问题，直接对组件进行处理。</p>
<p>开发测试过程中，可以只编译自己那部分代码，不需要编译整个项目代码。</p>
<p>方便集成，项目需要哪个模块直接通过<code>CocoaPods</code>集成即可。</p>
<h2 id="三、组件化设计思路1：有管理中心"><a href="#三、组件化设计思路1：有管理中心" class="headerlink" title="三、组件化设计思路1：有管理中心"></a>三、组件化设计思路1：有管理中心</h2><p>完整的项目：<a href="https://github.com/dvlproad/033-Data-Notification-iOS" target="_blank" rel="noopener">https://github.com/dvlproad/033-Data-Notification-iOS</a></p>
<h3 id="1、核心思想"><a href="#1、核心思想" class="headerlink" title="1、核心思想"></a>1、核心思想</h3><p>启动时候注册关系表，执行时候遍历关系表</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 核心思想1：注册，以统一管理，后续调用时候，从注册表中查询并执行对应的操作</span></span><br><span class="line"><span class="keyword">void</span> <span class="keyword">register</span>(url, handle) &#123;</span><br><span class="line">  model.url = url;</span><br><span class="line">  model.handle = handle;</span><br><span class="line">  models.add(model); <span class="comment">// 问题1:用什么管理所有数据</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 核心思想2：执行，遍历在注册表中的所有操作，找到对应的操作后进行执行</span></span><br><span class="line"><span class="keyword">void</span> exec(url) &#123;</span><br><span class="line">  <span class="keyword">for</span> (var model <span class="keyword">in</span> models) &#123;</span><br><span class="line">    <span class="keyword">if</span> (model.url == url) &#123;</span><br><span class="line">      model.handle();</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2、实现方案"><a href="#2、实现方案" class="headerlink" title="2、实现方案"></a>2、实现方案</h3><h4 id="2-1、方案1：Url-block-路由器"><a href="#2-1、方案1：Url-block-路由器" class="headerlink" title="2.1、方案1：Url+block   路由器"></a>2.1、方案1：Url+block   路由器</h4><p>缺点：入参，取参不明显。</p>
<h4 id="2-2、方法2：protocal-class"><a href="#2-2、方法2：protocal-class" class="headerlink" title="2.2、方法2：protocal - class"></a>2.2、方法2：protocal - class</h4><p>将要执行的方法统一放到类中，通过protocal或者类。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据 protocal 查找 class</span></span><br><span class="line"><span class="comment">// 方法1（可一对多）：为 protocal 添加监听者数组属性（通过runtime，形成类似于 protocal.listeners ），</span></span><br><span class="line"><span class="built_in">NSHashTable</span> *protocalListeners = objc_getAssociatedObject(protocol, CJ_BROADCAST_PROTOCOL_LISTENER); <span class="comment">// 找到之前绑定到这个protocal上的监听者列表。</span></span><br><span class="line">objc_setAssociatedObject(protocol, CJ_BROADCAST_PROTOCOL_LISTENER, protocalListeners, OBJC_ASSOCIATION_RETAIN_NONATOMIC);</span><br><span class="line"></span><br><span class="line">注册的时候 [protocalListeners addObject:listener];</span><br><span class="line">  </span><br><span class="line"><span class="comment">// 方法2（只能一对一）：以 protocal 为 key , 通过 protocal 存取 module 模块(模块自身遵循协议)</span></span><br><span class="line"><span class="comment">// 创建一个NSMapTable实例，其中键是强引用，值是弱引用</span></span><br><span class="line"><span class="built_in">NSMapTable</span>&lt;<span class="built_in">NSString</span> *, <span class="built_in">NSObject</span> *&gt; *weakRefHashTable = [<span class="built_in">NSMapTable</span> strongToStrongObjectsMapTable];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 向哈希表中添加一个键值对</span></span><br><span class="line"><span class="built_in">NSString</span> *key = <span class="string">@"someKey"</span>;</span><br><span class="line"><span class="built_in">NSObject</span> *value = [[<span class="built_in">NSObject</span> alloc] init];</span><br><span class="line">[weakRefHashTable setObject:value forKey:key];</span><br></pre></td></tr></table></figure>
<p>模块协议拆分为多个子协议，用户</p>
<p>网络处理协议、数据管理协议（单独）、用户界面更新协议</p>
<p>改进思想</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1、发起请求(LoginViewController)</span></span><br><span class="line"><span class="keyword">id</span>&lt;OrderModulePublic&gt; moduler = [[CJMoudleManager shared] modulerForProtocal:@protocal(OrderModulePublic)];</span><br><span class="line"><span class="built_in">UIViewController</span> *vc = [moduler orderViewControllerWithPageType:xxx];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、实现请求(TSOrderModuleImpl)</span></span><br><span class="line">[CJProtocolCenter addModule:<span class="keyword">self</span> forProtocol:<span class="class"><span class="keyword">@protocol</span>(<span class="title">OrderModulePublic</span>)];</span></span><br><span class="line"><span class="meta">#pragma mark - OrderModulePublic</span></span><br><span class="line">- (<span class="built_in">UIViewController</span> *)orderViewControllerWithPageType:(<span class="keyword">int</span>)pageType</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述代码还可以演变成实现通知的一种形式（当注入的类中，有多个类都遵循了(实际上不应该出现)模块协议时候）</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1、发起请求(LoginViewController)</span></span><br><span class="line"><span class="built_in">NSMutableSet</span>&lt;<span class="keyword">id</span>&lt;CJUserServiceProtocolForModule&gt;&gt; listener = [[CJMoudleManager shared] listenersForProtocal:@protocal(CJUserServiceProtocolForModule)];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">id</span>&lt;CJUserServiceProtocolForModule&gt; listener <span class="keyword">in</span> listeners) &#123;</span><br><span class="line">  [listener userNameUpadte:userName];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、实现请求(OrderHomeViewController)</span></span><br><span class="line">[CJProtocolCenter addModule:<span class="keyword">self</span> forProtocol:<span class="class"><span class="keyword">@protocol</span>(<span class="title">CJUserServiceProtocolForModule</span>)];</span></span><br><span class="line"><span class="meta">#pragma mark - CJUserServiceProtocolForModule</span></span><br><span class="line">- (<span class="keyword">void</span>)userNameUpadte:(<span class="built_in">NSString</span> *)userName</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下列图片来源于 《<a href="../../架构相关/1架构模式/架构模式-①概览/架构分层.graffle">架构分层.graffle</a>》 中的【三、模块间设计】</p>
<p>跳转的使用示例：</p>
<blockquote>
<p><img src="/Architecture架构/架构相关/3组件化/5框架设计模式-⑦组件化/modular_CJProtocalManager 跳转.png" alt="modular_CJProtocalManager 跳转"></p>
</blockquote>
<p>通知的实现示例：</p>
<blockquote>
<p><img src="/Architecture架构/架构相关/3组件化/5框架设计模式-⑦组件化/modular_CJProtocalManager 通知.png" alt="modular_CJProtocalManager 通知"></p>
</blockquote>
<p>跳转 + 数据变化后内部通知的实现示例：</p>
<blockquote>
<p><img src="/Architecture架构/架构相关/3组件化/5框架设计模式-⑦组件化/modular_CJProtocalManager 跳转 + 数据变化后内部通知.png" alt="modular_CJProtocalManager 跳转 + 数据变化后内部通知"></p>
</blockquote>
<h2 id="四、组件化设计思路2：无管理中心"><a href="#四、组件化设计思路2：无管理中心" class="headerlink" title="四、组件化设计思路2：无管理中心"></a>四、组件化设计思路2：无管理中心</h2><p>项目示例：<a href="https://github.com/dvlproad/CJStandardProject/blob/fb796e4f5c3d30c3942e7fe088bba6cc406b6c01/CJStandardProjectDemo/Pods/CJDemoModuleMainMediator/CJDemoModuleMainMediator/CTMediator%2BCJDemoModuleMain.m" target="_blank" rel="noopener">CJStandardProject 中 CTMediator+CJDemoModuleMain.h </a></p>
<h3 id="1、核心思想-1"><a href="#1、核心思想-1" class="headerlink" title="1、核心思想"></a>1、核心思想</h3><p><strong>核心思想：直接执行，让系统通过反射来找到要响应事件的类和方法</strong></p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> exec(target, action, params) &#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2、实现方案-1"><a href="#2、实现方案-1" class="headerlink" title="2、实现方案"></a>2、实现方案</h3><h4 id="2-1、方案1：CTMediator-target-action-param"><a href="#2-1、方案1：CTMediator-target-action-param" class="headerlink" title="2.1、方案1：CTMediator target+action+param"></a>2.1、方案1：CTMediator target+action+param</h4><p>实现示例：</p>
<p><img src="/Architecture架构/架构相关/3组件化/5框架设计模式-⑦组件化/modular_CTMediator target+action+param.png" alt="modular_CTMediator target+action+param"></p>
<h4 id="2-2、方案2：XXXService-Implemention"><a href="#2-2、方案2：XXXService-Implemention" class="headerlink" title="2.2、方案2：XXXService+Implemention"></a>2.2、方案2：XXXService+Implemention</h4><p><img src="/Architecture架构/架构相关/3组件化/5框架设计模式-⑦组件化/modular_XXXService+Implemention.png" alt="modular_XXXService+Implemention"></p>
<h2 id="五、组件化实施过程的思考"><a href="#五、组件化实施过程的思考" class="headerlink" title="五、组件化实施过程的思考"></a>五、组件化实施过程的思考</h2><h3 id="1、架构分层"><a href="#1、架构分层" class="headerlink" title="1、架构分层"></a>1、架构分层</h3><p>整个APP架构上从上到下分为<strong>三层</strong>，独立于APP的通用层，通用业务层，业务层。</p>
<p><img src="/Architecture架构/架构相关/3组件化/5框架设计模式-⑦组件化/架构分层1.png" alt="架构分层1" style="zoom: 33%;"></p>
<h4 id="1-1、独立于APP的通用层"><a href="#1-1、独立于APP的通用层" class="headerlink" title="1.1、独立于APP的通用层"></a>1.1、独立于APP的通用层</h4><p>此层常为：一些Cocoapods公有库或者自己编写的独立于APP的库。</p>
<p>举例：MJExtension、CJNetwork、分享、CJOverlayKit(Toast、HUD、ActionSheet)、CJShareList</p>
<h4 id="1-2、每个APP自己的通用层"><a href="#1-2、每个APP自己的通用层" class="headerlink" title="1.2、每个APP自己的通用层"></a>1.2、每个APP自己的通用层</h4><p>此层常为：前面的独立于APP的通用层的二次封装。若公司内部引用了第三方库，按照依赖倒置的原则，建议封装一层之后放到Basic Specs供业务方使用。好处：跟外部环境有效隔离，第三方库发生问题，公司内部可控。</p>
<p>如：CQNetwork、CQOverlayKit、CQShareKit、网络库CQNetwork、数据库(FMDB/WCDB)、缓存库等</p>
<p>依赖倒置原则告诉我们要面向接口编程；通过抽象（接口或抽象类）使各个类或模块实现彼此独立，互不影响，实现模块间的松耦合。</p>
<h4 id="1-3、业务模块"><a href="#1-3、业务模块" class="headerlink" title="1.3、业务模块"></a>1.3、业务模块</h4><p>业务层的模块应该按照模块化的设计思想，尽量做到高度的“高内聚，低耦合”。</p>
<p>因模块高度独立，且高频使用，若公司内部有多个App同时需要依赖，建议单独创建私有库Specs。</p>
<h2 id="iOS端APP架构设计心得"><a href="#iOS端APP架构设计心得" class="headerlink" title="iOS端APP架构设计心得"></a>iOS端APP架构设计心得</h2><ul>
<li><p><a href="https://www.cnblogs.com/dins/p/ios-zu-jian-hua-fang-an.html" target="_blank" rel="noopener">iOS 组件化方案</a></p>
</li>
<li><p><a href="https://www.jianshu.com/p/67a6004f6930" target="_blank" rel="noopener">组件化架构漫谈</a></p>
</li>
<li><p><a href="https://tech.youzan.com/you-zan-ioszu-jian-hua-jia-gou-she-ji-shi-jian/" target="_blank" rel="noopener">有赞移动 iOS 组件化（模块化）架构设计实践</a></p>
</li>
<li><p><a href="https://www.jianshu.com/p/0ea6b72ea1a3" target="_blank" rel="noopener">iOS端APP架构设计心得</a></p>
</li>
<li><a href="https://mobile.51cto.com/hot-600305.htm" target="_blank" rel="noopener">对于App架构和组件化的思考</a></li>
</ul>
<h2 id="END"><a href="#END" class="headerlink" title="END"></a>END</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://dvlproad.github.io/Architecture架构/架构相关/3组件化/5框架设计模式-⑦组件化/" data-id="cm2nooc6e0144ovr4c378hdbz" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Architecture/">Architecture</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Architecture架构/监控相关/日志系统" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/Architecture架构/监控相关/日志系统/" class="article-date">
  <time datetime="2024-08-28T09:08:41.000Z" itemprop="datePublished">2024-08-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Architecture/">Architecture</a>►<a class="article-category-link" href="/categories/Architecture/第九章：监控相关/">第九章：监控相关</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Architecture架构/监控相关/日志系统/">日志系统</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[toc]</p>
<h2 id="前言：主要事项"><a href="#前言：主要事项" class="headerlink" title="前言：主要事项"></a>前言：主要事项</h2><p>1、异常数据的发现及补充、日志分类优化<br>2、日志数据的文件保存、滚动存储<br>3、日志文件上传<br>4、日志回捞</p>
<h2 id="一、日志收集"><a href="#一、日志收集" class="headerlink" title="一、日志收集"></a>一、日志收集</h2><h3 id="1、日志分类"><a href="#1、日志分类" class="headerlink" title="1、日志分类"></a>1、日志分类</h3><h4 id="1-1、日志目标"><a href="#1-1、日志目标" class="headerlink" title="1.1、日志目标"></a>1.1、日志目标</h4><table>
<thead>
<tr>
<th>序号</th>
<th>目标(Target)</th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>app</td>
<td></td>
<td></td>
</tr>
<tr>
<td>2</td>
<td>sdk</td>
<td>三方库</td>
<td></td>
</tr>
<tr>
<td>3</td>
<td>h5</td>
<td>网页</td>
</tr>
</tbody>
</table>
<p><a name="日志类型"></a></p>
<h4 id="1-2、日志类型"><a href="#1-2、日志类型" class="headerlink" title="1.2、日志类型"></a>1.2、日志类型</h4><table>
<thead>
<tr>
<th>序号</th>
<th>类型</th>
<th>描述</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>api_app</td>
<td>app中的网络请求</td>
<td></td>
</tr>
<tr>
<td>2</td>
<td>api_app_cache</td>
<td>app中的网络请求的网络缓存请求</td>
<td></td>
</tr>
<tr>
<td>3</td>
<td>api_buriedPoint</td>
<td>埋点的网络请求</td>
<td></td>
</tr>
<tr>
<td>4</td>
<td>sdk_other</td>
<td>sdk的各种事件(初始化等)</td>
<td></td>
</tr>
<tr>
<td>5</td>
<td>sdk_api</td>
<td>sdk中的网络请求</td>
<td></td>
</tr>
<tr>
<td>6</td>
<td>dart</td>
<td>语法</td>
<td></td>
</tr>
<tr>
<td>7</td>
<td>widget</td>
<td>视图(布局像素越界等)</td>
<td></td>
</tr>
<tr>
<td>8</td>
<td>click_other</td>
<td>点击、</td>
<td></td>
</tr>
<tr>
<td>9</td>
<td>click_share</td>
<td>分享</td>
<td></td>
</tr>
<tr>
<td>10</td>
<td>native_route</td>
<td>路由/跳转</td>
<td></td>
</tr>
<tr>
<td>11</td>
<td>h5_route</td>
<td>与网页跳转有关</td>
<td></td>
</tr>
<tr>
<td>12</td>
<td>h5_js</td>
<td>js交互</td>
<td></td>
</tr>
<tr>
<td>13</td>
<td>monitor_network</td>
<td>监控：网络类型变化</td>
<td></td>
</tr>
<tr>
<td>14</td>
<td>monitor_lifecycle</td>
<td>监控：生命周期变化</td>
<td></td>
</tr>
<tr>
<td>15</td>
<td>buriedPoint_other</td>
<td>埋点数据生成等</td>
<td></td>
</tr>
<tr>
<td>16</td>
<td>im</td>
<td>IM</td>
<td></td>
</tr>
<tr>
<td>17</td>
<td>heartbeat</td>
<td>心跳</td>
<td></td>
</tr>
<tr>
<td>18</td>
<td>other</td>
<td>其他</td>
</tr>
</tbody>
</table>
<h3 id="2、日志等级"><a href="#2、日志等级" class="headerlink" title="2、日志等级"></a>2、日志等级</h3><table>
<thead>
<tr>
<th>序号</th>
<th>目标(Level)</th>
<th>描述</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Normal</td>
<td>正常信息(目前用于请求开始)</td>
<td></td>
</tr>
<tr>
<td>2</td>
<td>Success</td>
<td>成功信息(目前用于请求结束：成功)</td>
<td></td>
</tr>
<tr>
<td>3</td>
<td>Warning</td>
<td>警告信息(目前用于请求结束：报错)</td>
<td></td>
</tr>
<tr>
<td>4</td>
<td>Error</td>
<td>错误日志(目前用于请求结束：失败)</td>
<td></td>
</tr>
<tr>
<td>5</td>
<td>Dangerous</td>
<td>危险(处理白屏等)</td>
<td>一般会<strong>进行额外的埋点</strong></td>
</tr>
</tbody>
</table>
<p><a name="日志整合归类"></a></p>
<h3 id="3、日志整合归类"><a href="#3、日志整合归类" class="headerlink" title="3、日志整合归类"></a>3、日志整合归类</h3><table>
<thead>
<tr>
<th>序号</th>
<th>列表</th>
<th>标志</th>
<th>包含</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>全部</td>
<td>all</td>
<td>所有</td>
</tr>
<tr>
<td>2</td>
<td>警告</td>
<td>warning</td>
<td>所有的警告</td>
</tr>
<tr>
<td>3</td>
<td>错误</td>
<td>error</td>
<td>所有的错误</td>
</tr>
<tr>
<td>4</td>
<td>接口</td>
<td>api</td>
<td>api_app、api_cache(不包括sdk_api、api_buriedPoint)</td>
</tr>
<tr>
<td>5</td>
<td>点击</td>
<td>click</td>
<td>click_share、click_other、h5_js</td>
</tr>
<tr>
<td>6</td>
<td>路由</td>
<td>route</td>
<td>navite_route、h5_route</td>
</tr>
<tr>
<td>7</td>
<td>网页</td>
<td>H5</td>
<td>h5_route、h5_js</td>
</tr>
<tr>
<td>8</td>
<td>sdk</td>
<td>sdk</td>
<td>sdk_api、sdk_other</td>
</tr>
<tr>
<td>9</td>
<td>code</td>
<td>code</td>
<td>dart、widget</td>
</tr>
<tr>
<td>10</td>
<td>埋点</td>
<td>buriedPoint</td>
<td>api_buriedPoint、buriedPoint_other</td>
</tr>
<tr>
<td>11</td>
<td>监控</td>
<td>monitor</td>
<td>monitor_lifecycle、monitor_network</td>
</tr>
<tr>
<td>12</td>
<td>其他</td>
<td>other</td>
<td>other</td>
</tr>
<tr>
<td>13</td>
<td>api结果</td>
<td>api_result</td>
<td>type=api_app &amp; level != Normal</td>
</tr>
<tr>
<td>14</td>
<td>im</td>
<td>im</td>
<td>本地缓存消息、历史消息、收到的消息等</td>
</tr>
<tr>
<td>15</td>
<td>心跳</td>
<td>heartbeat</td>
</tr>
</tbody>
</table>
<p><img src="/Architecture架构/监控相关/日志系统/devtool_log_home_page.gif" alt="devtool_log_home_page" style="zoom:50%;"></p>
<h3 id="4、日志的补充收集及其策略"><a href="#4、日志的补充收集及其策略" class="headerlink" title="4、日志的补充收集及其策略"></a>4、日志的补充收集及其策略</h3><p>要收集的数据已在上述《<a href="#日志类型">1.2、日志类型</a>》中说明。</p>
<h4 id="4-1、页面跳转"><a href="#4-1、页面跳转" class="headerlink" title="4.1、页面跳转"></a>4.1、页面跳转</h4><p>详见上述 《<a href="#日志整合归类">3、日志整合归类</a>》中的”路由”</p>
<h4 id="4-2、截断的收集"><a href="#4-2、截断的收集" class="headerlink" title="4.2、截断的收集"></a>4.2、截断的收集</h4><table>
<thead>
<tr>
<th>序号</th>
<th>关键字</th>
<th>场景</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>break</td>
<td>for 、 swtich</td>
</tr>
<tr>
<td>2</td>
<td>return</td>
</tr>
</tbody>
</table>
<h4 id="4-3、用户关键行为"><a href="#4-3、用户关键行为" class="headerlink" title="4.3、用户关键行为"></a>4.3、用户关键行为</h4><table>
<thead>
<tr>
<th>序号</th>
<th>行为</th>
<th>用途的场景说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>用户的资源选择</td>
<td>判断选择的本地资源是否上传到错误的存储桶</td>
</tr>
</tbody>
</table>
<h2 id="二、日志数据的文件保存、滚动存储"><a href="#二、日志数据的文件保存、滚动存储" class="headerlink" title="二、日志数据的文件保存、滚动存储"></a>二、日志数据的文件保存、滚动存储</h2><h3 id="1、数据的文件保存"><a href="#1、数据的文件保存" class="headerlink" title="1、数据的文件保存"></a>1、数据的文件保存</h3><p>写入xlog文件中。</p>
<h3 id="2、数据的文件滚动存储"><a href="#2、数据的文件滚动存储" class="headerlink" title="2、数据的文件滚动存储"></a>2、数据的文件滚动存储</h3><h4 id="2-1、日志的过期清理"><a href="#2-1、日志的过期清理" class="headerlink" title="2.1、日志的过期清理"></a>2.1、日志的过期清理</h4><p>1、本地日志文件结构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-- Document</span><br><span class="line">	-- log</span><br><span class="line">		-- 2020-10-01</span><br><span class="line">			-- xlog_2020-10-01_1.xlog</span><br><span class="line">			-- xlog_2020-10-01_2.xlog</span><br><span class="line">		-- 2020-10-18</span><br><span class="line">			-- xlog_2020-10-18_1.xlog</span><br></pre></td></tr></table></figure>
<p>2、日志保留清理的配置信息(摘自/同 下文的日志接口中的《日志文件配置信息》)</p>
<blockquote>
<table>
<thead>
<tr>
<th>序号</th>
<th>说明</th>
<th>字段</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>接口回值1</td>
<td>最多保留几个天的日志目录</td>
<td>maxDayDirCount</td>
<td>7</td>
</tr>
<tr>
<td>接口回值2</td>
<td>最多每天保留几个文件</td>
<td>maxDayFileCount</td>
<td>10</td>
</tr>
<tr>
<td>接口回值3</td>
<td>每个日志文件超过多少后创建新文件</td>
<td>perFileMaxMB</td>
<td>5</td>
</tr>
</tbody>
</table>
</blockquote>
<p>3、清理方案</p>
<p><strong>清理时机：在切换前后台的时候，</strong></p>
<ul>
<li>日志配置信息的更新</li>
<li>根据最新的日志配置信息，延迟10s后(避免影响启动)，进行清理判断及清理<ul>
<li>遍历总日志目录 Document/log 下的所有日志文件夹</li>
<li>如果天日志文件夹<strong>个数</strong>超过保留个数（避免是用保留时间，导致保留时间内只有一个日志，也被删掉），则按顺序删除早期日志<ul>
<li>遍历天日志目录 Document/log/yyyy-MM-dd 下的所有日志文件夹</li>
<li>如果天日志文件夹<strong>个数</strong>超过保留个数（避免是用保留时间，导致保留时间内只有一个日志，也被删掉），则按顺序删除早期日志</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="2-2、日志文件的滚动写入"><a href="#2-2、日志文件的滚动写入" class="headerlink" title="2.2、日志文件的滚动写入"></a>2.2、日志文件的滚动写入</h4><p>要增加的日志记录，如果添加后会超过日志文件的大小，则使用新文件写入。</p>
<p><strong>细节点</strong>：<br>1、日志文件的大小判断，不要每次都去读取文件，而是记录住大小变化<br>2、日志不要有一条写一条，而是使用写入缓冲区+定时器，5s尝试写入一次</p>
<h3 id="3、数据的加密、解密"><a href="#3、数据的加密、解密" class="headerlink" title="3、数据的加密、解密"></a>3、数据的加密、解密</h3><p>1、加密：</p>
<p>写入日志字符串时候，对编码后的字节数据，额外增加一个三位随机值。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="markdown">/// 使用 GZip 压缩算法将字符串进行压缩，并返回压缩后的字节数据（List&lt;int&gt; 类型）。</span></span></span><br><span class="line"><span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt; _gzipCompressString(<span class="built_in">String</span> inputString) &#123;</span><br><span class="line">  <span class="keyword">final</span> codec = GZipCodec();</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 将输入字符串 inputString 编码为 UTF-8 格式的字节数据</span></span><br><span class="line">  <span class="keyword">final</span> encoded = utf8.encode(inputString);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 对编码后的字节数据进行压缩，并返回压缩后的字节数据。</span></span><br><span class="line">  <span class="keyword">final</span> compressedData = codec.encode(encoded);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> compressedData;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="markdown">/// 加密日志字符串</span></span></span><br><span class="line"><span class="built_in">String</span> _encryptLogString(<span class="built_in">String</span> logString) &#123;</span><br><span class="line">  <span class="keyword">final</span> compressedData = _gzipCompressString(logString); <span class="comment">// 压缩字符串，并返回压缩后的字节数据（List&lt;int&gt; 类型）</span></span><br><span class="line">  <span class="keyword">final</span> randomNumber = Random().nextInt(<span class="number">800</span>) + <span class="number">100</span>;</span><br><span class="line">  <span class="keyword">final</span> confound = compressedData.toString().substring(<span class="number">0</span>, compressedData.toString().length - <span class="number">1</span>) + <span class="string">", <span class="subst">$randomNumber</span>]"</span>; <span class="comment">// 在压缩后的字符串尾部加上一个随机字符串</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> confound;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2、解密：</p>
<p>使用python脚本对log文件进行解密</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> gzip</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取.clog文件并解析数据</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_clog_file</span><span class="params">(input_file)</span>:</span></span><br><span class="line">    parsed_data = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> open(input_file, <span class="string">'r'</span>) <span class="keyword">as</span> clog_file:</span><br><span class="line">        current_data = <span class="string">""</span></span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> clog_file:</span><br><span class="line">            <span class="keyword">if</span> current_data:</span><br><span class="line">                parsed_data.append(current_data)</span><br><span class="line">            binary_data = line[:<span class="number">-6</span>] + <span class="string">']'</span> <span class="comment"># 去除加密时候额外添加的三位随机数</span></span><br><span class="line">            byte_data = bytes(eval(binary_data))</span><br><span class="line">            decompressed_data = gzip.decompress(byte_data)</span><br><span class="line">            <span class="comment"># current_data = byte_data.decode('utf-8')</span></span><br><span class="line">            print(decompressed_data)</span><br><span class="line">            current_data = decompressed_data.decode(<span class="string">'utf-8'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 添加最后一个数据条目</span></span><br><span class="line">        <span class="keyword">if</span> current_data:</span><br><span class="line">            parsed_data.append(current_data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> parsed_data</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将解析后的数据写入与输入文件同名的.log文件</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_to_log_file</span><span class="params">(parsed_data, input_file)</span>:</span></span><br><span class="line">    base_name = os.path.splitext(input_file)[<span class="number">0</span>]</span><br><span class="line">    output_file = base_name + <span class="string">".log"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> open(output_file, <span class="string">'w'</span>) <span class="keyword">as</span> log_file:</span><br><span class="line">        <span class="keyword">for</span> data <span class="keyword">in</span> parsed_data:</span><br><span class="line">            log_file.write(data + <span class="string">"\n"</span>)</span><br><span class="line">            log_file.write(<span class="string">"\n"</span>)</span><br><span class="line">            log_file.write(<span class="string">"================================================================================================="</span> + <span class="string">"\n"</span>)</span><br><span class="line">            log_file.write(<span class="string">"\n"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="keyword">if</span> len(sys.argv) != <span class="number">2</span>:</span><br><span class="line">        print(<span class="string">"Usage: python script.py &lt;clogFileName&gt;"</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    input_clog_file = sys.argv[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 解析.clog文件</span></span><br><span class="line">    parsed_data = parse_clog_file(input_clog_file)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将解析后的数据写入与输入文件同名的.log文件</span></span><br><span class="line">    write_to_log_file(parsed_data, input_clog_file)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">f"Log data parsed from <span class="subst">&#123;input_clog_file&#125;</span> and written to <span class="subst">&#123;input_clog_file&#125;</span>.log."</span>)</span><br></pre></td></tr></table></figure>
<h2 id="三、日志文件上传"><a href="#三、日志文件上传" class="headerlink" title="三、日志文件上传"></a>三、日志文件上传</h2><h3 id="1、日志文件命名及目录规范"><a href="#1、日志文件命名及目录规范" class="headerlink" title="1、日志文件命名及目录规范"></a>1、日志文件命名及目录规范</h3><p>以用户<code>1000001</code>在<code>2020-01</code>时候上传<code>声音文件 beautiful_scenery.aac</code>为例，其路径完整示例如下：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">https://media.xxx.com/app1_test1/audio/1/1000001/2020-01/beautiful_scenery.aac</span></span><br></pre></td></tr></table></figure>
<p>要上传的存储桶：</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>说明</th>
<th>参数</th>
<th>约定值示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>存储桶region<br>regionGetFunction</td>
<td>网络环境</td>
<td>ap-shanghai</td>
</tr>
<tr>
<td>2</td>
<td>存储桶bucket<br>bucketGetFunction</td>
<td>网络环境</td>
<td>xxx-pro-image-1302324914</td>
</tr>
<tr>
<td>3</td>
<td>上传成功后，桶的映射路径值<br>cosFileUrlPrefixGetFunction</td>
<td></td>
<td>1、图片桶：<a href="https://images.xxx.com/" target="_blank" rel="noopener">https://images.xxx.com/</a><br>2、媒体桶：<a href="https://media.xxx.com/" target="_blank" rel="noopener">https://media.xxx.com/</a><br>3、日志桶：<a href="https://static.xxx.com/" target="_blank" rel="noopener">https://static.xxx.com/</a></td>
</tr>
<tr>
<td>4</td>
<td>要上传到桶的哪个相对路径下<br>cosFileRelativePathGetFunction<br>上传成功后完整路径=以上桶值+此相对路径<br></td>
<td>见下文</td>
<td>见下文<br>eg：app1_test1/audio/1/1000001/2020-01/beautiful_scenery.aac</td>
</tr>
</tbody>
</table>
<p>《要上传到桶的哪个相对路径下 <strong>cosFileRelativePathGetFunction</strong> 》的文件路径分批说明：</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>层次说明</th>
<th>层次值算法</th>
<th>层次值描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1.1</td>
<td>存储桶里相对路径的前缀</td>
<td>app标志_环境标志<br>eg：app1_pro、app1_test1、app1_dev1</td>
<td>文件区分</td>
</tr>
<tr>
<td>1.2</td>
<td>是否在存储桶里进行进一步路径区分(可选)</td>
<td>根据场景决定是否对桶进行进一步分类。<br>if ( mediaType == xxx ) {<br>     if(mediaScene == yyy) {<br>     <br>     }<br>}</td>
<td>如<br>1、都是图片，但自拍图片要求独立出来<br>2、都是多媒体，但音视频要区分开</td>
</tr>
<tr>
<td>2.1</td>
<td>用户1级</td>
<td>int.parse(uid) % 1000; // 取余数</td>
<td>用户名取余，有效减少同层上文件夹个数</td>
</tr>
<tr>
<td>2.2</td>
<td>用户2级</td>
<td>uid</td>
<td>用户名</td>
</tr>
<tr>
<td>3</td>
<td>年月</td>
<td>DateTime.now().toString().substring(0, 7);</td>
<td>年-月</td>
</tr>
<tr>
<td>4</td>
<td>文件名</td>
<td>${fileOriginName}_<br>${DateTime.now().microsecondsSinceEpoch}<br>.$fileExtensionType</td>
<td>文件名</td>
</tr>
</tbody>
</table>
<p>附1：MediaType 媒体类型</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>UploadMediaType 媒体类型</th>
<th>描述</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>unkonw</td>
<td>未知（默认值）</td>
<td></td>
</tr>
<tr>
<td>2</td>
<td>image</td>
<td>图片</td>
<td></td>
</tr>
<tr>
<td>3</td>
<td>audio</td>
<td>音频</td>
<td></td>
</tr>
<tr>
<td>4</td>
<td>video</td>
<td>视频</td>
<td></td>
</tr>
<tr>
<td>5</td>
<td>xlog</td>
<td>日志文件</td>
</tr>
</tbody>
</table>
<p>附2：MediaScene场景 说明</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>UploadMediaScene场景</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>unkonw</td>
<td>未知（默认值）</td>
</tr>
<tr>
<td>2</td>
<td>selfie</td>
<td>自拍（安全等级较多）</td>
</tr>
<tr>
<td>3</td>
<td>im</td>
<td>会话聊天</td>
</tr>
<tr>
<td>4</td>
<td>live</td>
<td>直播</td>
</tr>
</tbody>
</table>
<h2 id="四、日志接口"><a href="#四、日志接口" class="headerlink" title="四、日志接口"></a>四、日志接口</h2><h3 id="1、日志记录接口（区别于回捞接口，需要在回捞前就有日志信息）"><a href="#1、日志记录接口（区别于回捞接口，需要在回捞前就有日志信息）" class="headerlink" title="1、日志记录接口（区别于回捞接口，需要在回捞前就有日志信息）"></a>1、日志记录接口（区别于回捞接口，需要在回捞前就有日志信息）</h3><p>1、是否记录日志的开关及其配置信息</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>说明</th>
<th>字段</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>网页配置1</td>
<td>是否开启日志记录</td>
<td>isLogOn</td>
<td>1:开启、其他:关</td>
</tr>
<tr>
<td>网页配置2</td>
<td>要开启日志的用户(灰度上线)<br>(当且仅当开启上述日志记录时有效)<br>📢：未配置但开关为开时为全记录</td>
<td>logUserids</td>
<td>[“101”, “102”]</td>
</tr>
<tr>
<td>网页配置3</td>
<td>要开启日志的设备(灰度上线)<br>(当且仅当开启上述日志记录时有效)<br>📢：未配置但开关为开时为全记录</td>
<td>logDeviceIds</td>
<td>[“udid001”, “udid002”]</td>
</tr>
<tr>
<td>接口回值1</td>
<td>是否进行日志记录(灰度上线)</td>
<td>needLog</td>
<td>1:记录、其他:不记录</td>
</tr>
</tbody>
</table>
<p>2、不需要记录什么日志信息</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>说明</th>
<th>字段</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>接口回值1</td>
<td>不需要记录的日志类型</td>
<td>ignoreLogLevel</td>
<td>[“Normal”, “Success”]</td>
</tr>
<tr>
<td>接口回值2</td>
<td>不需要记录的日志等级</td>
<td>ignoreLogType</td>
<td>[“api_buriedPoint”, “buriedPoint_other”]</td>
</tr>
</tbody>
</table>
<p>3、日志文件配置信息</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>说明</th>
<th>字段</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>接口回值1</td>
<td>最多保留几个天的日志目录</td>
<td>maxDayDirCount</td>
<td>7</td>
</tr>
<tr>
<td>接口回值2</td>
<td>最多每天保留几个文件</td>
<td>maxDayFileCount</td>
<td>10</td>
</tr>
<tr>
<td>接口回值3</td>
<td>每个日志文件超过多少后创建新文件</td>
<td>perFileMaxMB</td>
<td>5</td>
</tr>
</tbody>
</table>
<p>4、日志文件问题回滚</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>说明</th>
<th>字段</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>网页配置1</td>
<td>强制删除什么时间前的日志</td>
<td>removeLogBeforeDate</td>
<td>2020-12-31</td>
</tr>
<tr>
<td>网页配置2</td>
<td>强制删除哪个用户的日志</td>
<td>removeUserids</td>
<td>[“101”, “102”]</td>
</tr>
<tr>
<td>网页配置2</td>
<td>强制删除哪个设备的日志</td>
<td>logDeviceIds</td>
<td>[“udid001”, “udid002”]</td>
</tr>
<tr>
<td>接口回值1</td>
<td>强制删除什么时间前的日志(不删除时空)</td>
<td>removeLogBeforeDate</td>
<td>2020-12-31 或 空值</td>
</tr>
</tbody>
</table>
<p>接口名定义：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function getLoggerConfig(userid, deviceId)</span><br></pre></td></tr></table></figure>
<p>接口结果的json示例如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"logConfig"</span>: &#123;</span><br><span class="line">		<span class="attr">"needLog"</span>: <span class="number">1</span>,</span><br><span class="line">		<span class="attr">"ignoreLogLevel"</span>: [<span class="string">"Normal"</span>, <span class="string">"Success"</span>],</span><br><span class="line">		<span class="attr">"ignoreLogType"</span>: [<span class="string">"api_buriedPoint"</span>, <span class="string">"buriedPoint_other"</span>],</span><br><span class="line">		<span class="attr">"maxDayDirCount"</span>: <span class="number">7</span>,</span><br><span class="line">		<span class="attr">"maxDayFileCount"</span>: <span class="number">10</span>,</span><br><span class="line">		<span class="attr">"perFileMaxMB"</span>: <span class="number">5</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"logRevert"</span>: &#123;</span><br><span class="line">		<span class="attr">"removeLogBeforeDate"</span>: <span class="string">"2020-12-31"</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2、日志回捞及问题回滚接口"><a href="#2、日志回捞及问题回滚接口" class="headerlink" title="2、日志回捞及问题回滚接口"></a>2、日志回捞及问题回滚接口</h3><p>1、日志回捞</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>说明</th>
<th>字段</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>网页配置1</td>
<td>要回捞日志的用户</td>
<td>salvageUserids</td>
<td>[“101”, “102”]</td>
</tr>
<tr>
<td>网页配置2</td>
<td>要回捞日志的设备</td>
<td>salvageDeviceIds</td>
<td>[“udid001”, “udid002”]</td>
</tr>
<tr>
<td>网页配置3</td>
<td>日志回捞的开始时间</td>
<td>salvageStartDate</td>
<td>2020-01-01</td>
</tr>
<tr>
<td>网页配置4</td>
<td>日志回捞的结束时间</td>
<td>salvageEndDate</td>
<td>2020-01-07</td>
</tr>
<tr>
<td>接口回值1</td>
<td>此用户此设备日志回捞的开始时间</td>
<td>salvageStartDate</td>
<td>2020-01-01</td>
</tr>
<tr>
<td>接口回值1</td>
<td>此用户此设备日志回捞的结束时间</td>
<td>salvageEndDate</td>
<td>2020-01-07</td>
</tr>
</tbody>
</table>
<p>2、日志文件问题回滚</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>说明</th>
<th>字段</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>网页配置1</td>
<td>强制删除什么时间前的日志</td>
<td>removeLogBeforeDate</td>
<td>2020-12-31</td>
</tr>
<tr>
<td>网页配置2</td>
<td>强制删除哪个用户的日志</td>
<td>removeUserids</td>
<td>[“101”, “102”]</td>
</tr>
<tr>
<td>网页配置2</td>
<td>强制删除哪个设备的日志</td>
<td>logDeviceIds</td>
<td>[“udid001”, “udid002”]</td>
</tr>
<tr>
<td>接口回值1</td>
<td>强制删除什么时间前的日志(不删除时空)</td>
<td>removeLogBeforeDate</td>
<td>2020-12-31 或 空值</td>
</tr>
</tbody>
</table>
<p>接口名定义：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function getLoggerSalvageAndRevert(salvageUserids, salvageDeviceIds)</span><br></pre></td></tr></table></figure>
<p>接口结果的json示例如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"salvageId"</span>: <span class="string">"1001"</span>, </span><br><span class="line">	<span class="attr">"salvageStartDate"</span>: <span class="string">"2020-01-01"</span>,</span><br><span class="line">  <span class="attr">"salvageEndDate"</span>: <span class="string">"2020-01-07"</span>,</span><br><span class="line">	<span class="attr">"removeLogBeforeDate"</span>: <span class="string">"2020-12-31"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3、日志文件上传到cos后同步给后台"><a href="#3、日志文件上传到cos后同步给后台" class="headerlink" title="3、日志文件上传到cos后同步给后台"></a>3、日志文件上传到cos后同步给后台</h3><p>用途：日志文件上传到cos后同步给后台，后台数据库记录每个用户，每个设备都捞到了什么数据。</p>
<p>接口名定义：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function addLoggerFile(userid, deviceId)</span><br></pre></td></tr></table></figure>
<p>接口结果的json示例如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="四、日志回捞"><a href="#四、日志回捞" class="headerlink" title="四、日志回捞"></a>四、日志回捞</h2><p>1、后台通过接口返回要回捞的信息。</p>
<p>2、前端用户在下次使用，收到后台信息时候，进行本地日志的上传。在腾云存储桶能收到对应日志，即代表成功。</p>
<h2 id="五、方案实施"><a href="#五、方案实施" class="headerlink" title="五、方案实施"></a>五、方案实施</h2><p>灰度方案：请参照 <a href="灰度系统">灰度系统 </a> 。（附：日志记录开关里目前已有灰度策略。）</p>
<p>目的：避免功能异常，出现集体性问题。</p>
<h2 id="End"><a href="#End" class="headerlink" title="End"></a>End</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://dvlproad.github.io/Architecture架构/监控相关/日志系统/" data-id="cm2noo92p008zovr49szf1n4d" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Architecture/">Architecture</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-总目录" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/总目录/" class="article-date">
  <time datetime="2024-08-08T02:39:52.000Z" itemprop="datePublished">2024-08-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/总目录/">总目录</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[toc]</p>
<h2 id="Architecture架构"><a href="#Architecture架构" class="headerlink" title="Architecture架构"></a>Architecture架构</h2><ul>
<li>第一章：架构相关<ul>
<li><a href="Architecture架构/架构相关/1架构模式/架构模式-①概览">第1.1节：架构模式-①概览</a><br>项目目录结构规范、架构分层、页面与服务类设计、依赖关系可视化</li>
<li><a href="Architecture架构/架构相关/1架构模式/架构模式-④MVC与MVVM">第1.2节：架构模式-④MVC与MVVM</a></li>
<li><a href="Architecture架构/架构相关/1架构细节/你真的会用RAC吗">第1.3节：架构细节-①你真的会用RAC吗</a></li>
<li><a href="Architecture架构/架构相关/2设计模式/设计模式-①概览">第2.1节：设计模式-①概览</a></li>
<li><a href="Architecture架构/架构相关/2设计模式/设计模式-②单例模式">第2.2节：设计模式-②单例模式</a></li>
<li><a href="Architecture架构/架构相关/2设计模式/设计模式-③观察者模式(Notification&amp;KVO">第2.3节：设计模式-③观察者模式(Notification&amp;KVO)</a>)</li>
<li><a href="Architecture架构/架构相关/2设计模式/设计模式-④适配器、策略、责任链模式">第2.4节：设计模式-④适配器、策略、责任链模式(Adapter、Strategy、Chain of Responsibility)</a></li>
<li><a href="Architecture架构/架构相关/2设计模式/设计模式-⑤多代理模式">第2.4节：设计模式-⑤多代理模式</a></li>
<li><a href="Architecture架构/架构相关/3组件化/5框架设计模式-⑦组件化">第3节：组件化</a></li>
<li><a href="Architecture架构/架构相关/4瘦身/瘦身-①UIViewController">第4.1节：瘦身-①UIViewController</a></li>
<li><a href="Architecture架构/架构相关/4瘦身/瘦身-②AppDelegate瘦身">第4.2节：瘦身-②AppDelegate瘦身</a></li>
<li><a href="Architecture架构/架构相关/9架构实操/新项目实施步骤">第9.1节：新项目实施步骤</a></li>
<li><a href="Architecture架构/架构相关/9架构实操/项目目录结构规范实践">第9.2节：项目目录结构规范实践</a></li>
<li><a href="Architecture架构/架构相关/9架构实操/依赖关系可视化">第9.3节：依赖关系可视化</a></li>
</ul>
</li>
<li>第二章：框架相关<ul>
<li><a href="Architecture架构/框架相关/框架的重要性">第1节：框架的重要性</a></li>
<li><a href="Architecture架构/框架相关/UI框架.xmind">第2节：UI框架</a></li>
<li><a href="Architecture架构/框架相关/foundation框架">第3节：foundation</a></li>
<li><a href="Architecture架构/框架相关/网络相关/网络框架">第4.1节：网络框架</a></li>
<li><a href="Architecture架构/框架相关/图片相关/图片框架">第5.1节：图片框架</a></li>
<li><a href="Architecture架构/框架相关/WebView相关/WebView优化">第6.1节：WebView</a></li>
<li><a href="Architecture架构/框架相关/WebView相关/h5_native_interacte/h5js">第6.2节：H5与原生交互：h5js</a></li>
<li><a href="Architecture架构/框架相关/WebView相关/h5_native_interacte/h5_open_app">第6.3节：H5与原生交互：h5 open app</a></li>
</ul>
</li>
<li>第三章：基础规范<ul>
<li><a href="Architecture架构/架构相关/1架构模式/架构模式-①概览">第1.1节：项目目录结构规范</a></li>
<li><a href="Architecture架构/基础规范/分支规范">第1.2节：分支规范</a></li>
<li><a href="Architecture架构/基础规范/请求规范">第2.1节：请求规范</a></li>
<li><a href="Architecture架构/基础规范/请求规范_JS">第2.2节：请求规范_JS</a></li>
<li><a href="Architecture架构/基础规范/路由及跳转/路由规范(含点击属性规范">第3.1节：路由规范(含点击属性规范)</a>)</li>
<li><a href="Architecture架构/基础规范/分页规范">第4.1节：分页规范</a></li>
<li><a href="Architecture架构/基础规范/埋点规范">第5节：埋点规范</a></li>
</ul>
</li>
<li>第四章：基础框架设计及接口文档<ul>
<li><a href="Architecture架构/基础框架设计及接口文档/网络库接口文档">第1节：网络库接口文档</a></li>
<li><a href="Architecture架构/基础框架设计及接口文档/版本检查">第2节：版本检查</a></li>
</ul>
</li>
<li>第五章：基础数据基类<ul>
<li><a href="Architecture架构/基础数据基类/基础数据整合方案">第1节：基础数据整合方案</a></li>
<li><a href="Architecture架构/基础数据基类/基础数据基类-①用户">第2.1节：基础数据基类-①用户</a></li>
<li><a href="Architecture架构/基础数据基类/基础数据基类-②商品">第2.2节：基础数据基类-②商品</a></li>
<li><a href="Architecture架构/基础数据基类/基础数据基类-③标签">第2.3节：基础数据基类-③标签</a></li>
<li><a href="Architecture架构/基础数据基类/业务数据基类-消息">第3.1节：业务数据基类-消息</a></li>
<li><a href="Architecture架构/基础数据基类/业务数据基类-卡片">第3.2节：业务数据基类-卡片</a></li>
</ul>
</li>
<li>第六章：通用业务规范<ul>
<li><a href="Architecture架构/通用业务规范/发布业务规范">第1节：发布业务规范</a></li>
<li><a href="Architecture架构/通用业务规范/分享业务规范">第2节：分享业务规范</a></li>
</ul>
</li>
<li>第七章：技术选型<ul>
<li><a href="Architecture架构/技术选型/技术选型流程">第1节：技术选型流程</a></li>
<li><a href="Architecture架构/技术选型/UI组件选择历程">第2节：UI组件选择历程</a></li>
<li><a href="Architecture架构/技术选型/切为H5的标准">第3节：切为H5的标准</a></li>
<li><a href="Architecture架构/技术选型/FlutterGetX框架选择历程">第4节：FlutterGetX框架选择历程</a></li>
<li><a href="Architecture架构/技术选型/加固选型-1调研">第5.1节：加固选型-1调研</a></li>
<li><a href="Architecture架构/技术选型/APM选型-1调研">第6.1节：APM选型-1调研</a></li>
<li><a href="Architecture架构/技术选型/APM选型-2备选筛选">第6.2节：APM选型-2备选筛选</a></li>
</ul>
</li>
<li>第八章：页面加载相关<ul>
<li><a href="Architecture架构/页面加载相关/页面加载体验优化">第1节：页面加载体验优化</a></li>
<li><a href="Architecture架构/框架相关/网络相关/弱网优化空间探索">第1.1节：弱网优化空间探索</a></li>
<li><a href="Architecture架构/框架相关/网络相关/弱网测试">第1.2节：弱网测试</a></li>
</ul>
</li>
<li>第九章：监控相关<ul>
<li><a href="Architecture架构/监控相关/日志系统">第1节：日志系统</a></li>
<li><a href="Architecture架构/监控相关/灰度系统">第2节：灰度系统</a></li>
<li><a href="Architecture架构/监控相关/性能监控/异常与崩溃">第3.1节：性能系统：异常与崩溃</a></li>
<li><a href="Architecture架构/监控相关/问题排查/app内存问题">第4.1节：问题排查：app内存问题</a></li>
<li><a href="Architecture架构/监控相关/问题排查/app发热问题">第4.2节：问题排查：app发热问题</a></li>
</ul>
</li>
<li>第十章：其他体验优化<ul>
<li><a href="Architecture架构/架构相关/4瘦身/瘦身-③app安装包">第1.1节：瘦身-③app安装包</a></li>
</ul>
</li>
</ul>
<h2 id="安全与破解"><a href="#安全与破解" class="headerlink" title="安全与破解"></a>安全与破解</h2><ul>
<li>第一章：项目安全<ul>
<li><a href="安全/网络加密">第1节：网络接口数据安全的【攻与防大全】</a></li>
<li><a href="安全/开发工具的安全性保障">第2.1节：开发工具的安全性保障</a></li>
<li><a href="安全/app打包保证">第2.2节：app打包保证</a></li>
<li><a href="安全/风控相关">第3节：风控相关</a></li>
</ul>
</li>
<li>第二章：iOS<ul>
<li><a href="安全/iOS加固">第1节：iOS加固</a></li>
<li><a href="安全/iOS逆向">第2节：iOS逆向</a></li>
<li><a href="安全/iOS的重签名">第3节：iOS的重签名</a></li>
</ul>
</li>
<li>第三章：Android<ul>
<li><a href="安全/Android合规安全">第1节：Android合规安全</a></li>
<li><a href="安全/Android加固">第2节：Android加固</a></li>
<li><a href="安全/Android反编译">第3节：Android反编译</a></li>
</ul>
</li>
</ul>
<h2 id="管理相关"><a href="#管理相关" class="headerlink" title="管理相关"></a>管理相关</h2><ul>
<li><a href="管理相关/账号管理">第一章：账号管理</a><ul>
<li><a href="管理相关/苹果设备注册管理">第1.1节：苹果设备注册管理</a></li>
</ul>
</li>
<li><a href="管理相关/常见痛点">第二章：常见痛点</a></li>
</ul>
<h2 id="混编"><a href="#混编" class="headerlink" title="混编"></a>混编</h2><ul>
<li><a href="混编/混编事项说明">第一章：混编事项说明</a></li>
</ul>
<h2 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h2><ul>
<li><a href="数据结构/9数据结构-①nil、isEqual、Hash">第一章：nil、isEqual、Hash</a></li>
<li><a href="数据结构/9数据结构-②堆栈">第二章：堆栈</a></li>
<li><a href="数据结构/9数据结构-②二叉树">第三章：二叉树</a></li>
<li><a href="数据结构/9数据结构-②链表">第四章：链表</a></li>
<li><a href="数据结构/9数据结构-③环">第五章：环</a></li>
</ul>
<h2 id="算法与数学"><a href="#算法与数学" class="headerlink" title="算法与数学"></a>算法与数学</h2><ul>
<li>算法<ul>
<li><a href="算法与数学/9算法">第一章：算法</a></li>
</ul>
</li>
<li>数学<ul>
<li><a href="算法与数学/数学-三维">第一章：三维</a></li>
<li><a href="算法与数学/数学-三角函数">第二章：三角函数</a></li>
</ul>
</li>
</ul>
<h2 id="iOS部分"><a href="#iOS部分" class="headerlink" title="iOS部分"></a>iOS部分</h2><ul>
<li><a href="./iOS/README">前言</a></li>
<li><a href="iOS/开发规范/开发规范">第一章：开发规范</a></li>
<li><a href="iOS/Swift/README">第二章：Swift</a><ul>
<li><a href="iOS/Swift/1入门/Swift基础知识">第1节：Swift基础知识</a></li>
</ul>
</li>
<li><a href="iOS/性能相关/README">第四章：性能相关</a><ul>
<li><a href="iOS/性能相关/性能优化-①TableView优化">第1.1节：性能优化-①TableView优化</a></li>
<li><a href="iOS/性能相关/性能优化-②其他">第1.2节：性能优化-②其他</a></li>
<li><a href="iOS/性能相关/性能监控-①卡顿监控">第2节：性能监控-①卡顿监控</a></li>
<li><a href="iOS/性能相关/6编译优化hmap">第3节：编译优化hmap</a></li>
<li><a href="iOS/性能相关/启动优化">第4节：启动优化</a></li>
</ul>
</li>
<li><a href="iOS/第三方库/README">第X章：第三方库</a><ul>
<li><a href="iOS/第三方库/图片库SDWebImage/SDWebImage①缓存-①NSCache">第1.1节：图片库SDWebImage①缓存-①NSCache</a></li>
<li><a href="iOS/第三方库/图片库SDWebImage/SDWebImage①缓存-②缓存原理">第1.2节：图片库SDWebImage①缓存-②缓存原理</a></li>
<li><a href="iOS/第三方库/图片库SDWebImage/SDWebImage①缓存-③缓存不更新问题">第1.3节：图片库SDWebImage①缓存-③缓存不更新问题</a></li>
<li><a href="iOS/第三方库/图片库SDWebImage/SDWebImage②请求-①简介">第2.1节：图片库SDWebImage②请求-①简介</a></li>
<li><a href="iOS/第三方库/图片库SDWebImage/SDWebImage②请求-②避免重复请求问题">第2.2节：图片库SDWebImage②请求-②避免重复请求问题</a></li>
<li><a href="iOS/第三方库/图片库SDWebImage/SDWebImage③解码">第3节：图片库SDWebImage③解码</a></li>
<li><a href="iOS/第三方库/图片库SDWebImage/SDWebImage④其他">第4节：图片库SDWebImage④其他</a></li>
<li><a href="iOS/第三方库/数据库FMDB/数据库-①FMDB">第5.1节：数据库FMDB</a></li>
<li><a href="iOS/第三方库/数据库FMDB/数据库">第5.2节：数据库</a></li>
<li><a href="iOS/第三方库/网络库AFNetworking/第三方网络库AFNetworking">第6节：网络库AFNetworking</a></li>
</ul>
</li>
<li>进阶<ul>
<li><a href="iOS/进阶/iOS进阶_多Target">第1节：iOS进阶_多Target</a></li>
<li><a href="iOS/进阶/iOS进阶_多Configuration">第2节：iOS进阶_多Configuration</a></li>
<li><a href="iOS/进阶/APNS+TCP推送流程">第3节：APNS+TCP推送流程</a></li>
<li><a href="iOS/进阶/iOS进阶_推送模拟">第4节：iOS进阶_推送模拟</a></li>
<li><a href="iOS/进阶/企业版灰度流程">第5节：企业版灰度流程</a></li>
</ul>
</li>
<li>功能性技术<ul>
<li><a href="iOS/功能性技术/iOS功能-通用链接">第1节：iOS功能-通用链接</a></li>
<li><a href="iOS/功能性技术/iOS功能-Transform">第2节：iOS功能-Transform</a></li>
</ul>
</li>
<li>证书发版<ul>
<li><a href="iOS/证书发版/邓白氏编码申请">第1节：邓白氏编码申请</a></li>
</ul>
</li>
<li><a href="iOS/移动分析/README">第四章：移动分析</a></li>
<li><a href="iOS/自动化/README">第五章：自动化</a><ul>
<li><a href="iOS/自动化/iOS 安装包0-完整自动化流程">第1节：iOS 安装包0-完整自动化流程</a></li>
<li><a href="iOS/自动化/iOS 安装包1-编译&amp;打包">第2节：iOS 安装包1-编译&amp;打包</a></li>
<li><a href="iOS/自动化/iOS 安装包2-上传">第3节：iOS 安装包2-上传</a></li>
<li><a href="iOS/自动化/iOS 自动化测试">第4节：iOS 自动化测试</a></li>
<li><a href="iOS/自动化/iOS 单元测试">第5节：iOS 单元测试</a></li>
</ul>
</li>
</ul>
<h2 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h2><ul>
<li>第一章：入门<ul>
<li><a href="Android/1入门/Android开发环境搭建与运行">第1节：Android开发环境搭建与运行</a></li>
<li><a href="Android/1入门/JDK相关">第2节：JDK相关</a></li>
<li><a href="Android/1入门/Android_devices">第3节：Android_devices</a></li>
</ul>
</li>
</ul>
<h2 id="Flutter部分"><a href="#Flutter部分" class="headerlink" title="Flutter部分"></a>Flutter部分</h2><ul>
<li><a href="./Flutter/README">前言</a></li>
<li><a href="Flutter/1入门/README">第一章：入门</a><ul>
<li><a href="Flutter/1入门/Flutter开发环境搭建与运行">第1节：Flutter开发环境搭建与运行</a></li>
<li><a href="Flutter/1入门/Flutter的Hello World">第2节：Flutter的Hello World</a></li>
<li><a href="Flutter/1入门/Flutter的最基础知识">第3节：Flutter的最基础知识</a></li>
<li><a href="Flutter/1入门/Dart语言必备基础知识">第4节：Dart语言必备基础知识</a></li>
</ul>
</li>
<li><a href="Flutter/2集成/README">第二章：原生项目集成Flutter</a><ul>
<li><a href="Flutter/2集成/iOS项目集成Flutter">第1节：iOS项目集成Flutter</a></li>
<li><a href="Flutter/2集成/Android项目集成Flutter">第2节：Android项目集成Flutter</a></li>
</ul>
</li>
<li><a href="Flutter/3交互/README">第三章：原生项目与Flutter交互</a><ul>
<li><a href="Flutter/3交互/用于测试交互的Flutter项目">第1节：用于测试交互的Flutter项目</a></li>
<li><a href="Flutter/3交互/交互时iOS端的代码编写">第2节：交互时iOS端的代码编写</a></li>
<li><a href="Flutter/3交互/交互时Android端的代码编写">第3节：交互时Android端的代码编写</a></li>
</ul>
</li>
<li><a href="Flutter/4登录页实战/README">第四章：Flutter登录页实战</a><ul>
<li><a href="Flutter/4登录页实战/登录页在Flutter工程中的代码">第1节：登录页在Flutter工程中的代码</a></li>
<li><a href="Flutter/4登录页实战/登录页在iOS工程中的代码">第2节：登录页在iOS工程中的代码</a></li>
<li><a href="Flutter/4登录页实战/登录页在Android工程中的代码">第3节：登录页在Android工程中的代码</a></li>
</ul>
</li>
<li><a href="Flutter/5详解/README">第五章：Flutter详解</a><ul>
<li><a href="Flutter/5详解/详解Button">第1节：详解Button</a></li>
<li><a href="Flutter/5详解/详解TextField">第2节：详解TextField</a></li>
<li><a href="Flutter/5详解/详解Platform Channel">第3节：详解Platform Channel</a></li>
</ul>
</li>
<li><a href="Flutter/6进阶/README">第六章：Flutter进阶</a><ul>
<li><a href="Flutter/6进阶/iOS项目集成Flutter高级">第1节：iOS项目集成Flutter高级</a></li>
<li><a href="Flutter/6进阶/Flutter控件的封装">第2节：Flutter控件Widget的封装</a></li>
<li><a href="Flutter/6进阶/Package的使用、开发与发布">第3节：Package的使用、开发与发布</a></li>
<li><a href="Flutter/6进阶/Flutter的设计模式">第4节：Flutter的设计模式</a></li>
</ul>
</li>
<li><a href="Flutter/7规范/README">第七章：Flutter规范</a><ul>
<li><a href="Flutter/7规范/Flutter开发规范">第1节：Flutter开发规范</a></li>
</ul>
</li>
<li><a href="Flutter/8状态管理/README">第八章：Flutter状态管理</a><ul>
<li><a href="Flutter/8状态管理/状态管理1Provider">第1节：状态管理1Provider</a></li>
<li><a href="Flutter/8状态管理/状态管理-框架对比">第2节：状态管理-框架对比</a></li>
</ul>
</li>
<li><a href="Flutter/9框架升级/README">第九章：Flutter框架升级</a><ul>
<li><a href="Flutter/9框架升级/基础框架">第1节：基础框架</a></li>
<li><a href="Flutter/9框架升级/基础框架的接入">第2节：基础框架的接入</a></li>
<li><a href="Flutter/9框架升级/组件的使用">第3节：组件的使用</a></li>
</ul>
</li>
</ul>
<h2 id="React-Native-部分"><a href="#React-Native-部分" class="headerlink" title="React Native 部分"></a>React Native 部分</h2><ul>
<li><a href="./ReactNative/ReactNative README">前言</a></li>
<li><a href="ReactNative/1入门/README">第一章：入门</a><ul>
<li><a href="ReactNative/1入门/ReactNative开发环境搭建与运行">第1节：ReactNative开发环境搭建与运行</a></li>
<li><a href="ReactNative/1入门/ReactNative的Hello World">第2节：ReactNative的Hello World</a></li>
<li><a href="ReactNative/1入门/ReactNative的最基础知识">第3节：ReactNative的最基础知识</a></li>
<li><a href="ReactNative/1入门/ReactNative必备的语言基础知识">第4节：ReactNative必备的语言基础知识</a></li>
<li><a href="ReactNative/1入门/ReactNative的常用库">第5节：ReactNative的常用库</a></li>
</ul>
</li>
<li><a href="ReactNative/5详解/README">第五章：ReactNative详解</a><ul>
<li><a href="ReactNative/5详解/ReactNative详解布局">第1节：详解布局</a></li>
<li><a href="ReactNative/5详解/ReactNative详解Button">第2节：详解Button</a></li>
</ul>
</li>
<li><a href="ReactNative/6进阶/README">第六章：ReactNative进阶</a><ul>
<li><a href="ReactNative/6进阶/ReactNative使用技巧">第1节：ReactNative使用技巧</a></li>
<li><a href="ReactNative/6进阶/ReactNative的继承重写等">第2节：ReactNative的继承重写等</a></li>
<li><a href="ReactNative/6进阶/ReactNative组件的封装">第3节：ReactNative组件Component的封装</a></li>
</ul>
</li>
<li><a href="ReactNative/8实践/README">第八章：ReactNative实践</a><ul>
<li><a href="ReactNative/8实践/ReactNative的Demo实践">第1节：ReactNative的Demo实践</a></li>
</ul>
</li>
</ul>
<h2 id="React-部分"><a href="#React-部分" class="headerlink" title="React 部分"></a>React 部分</h2><ul>
<li><a href="./React/React README">前言</a></li>
<li><a href="React/1入门/README">第一章：入门</a><ul>
<li><a href="ReactNative/1入门/ReactNative开发环境搭建与运行">第1节：React开发环境搭建与运行</a></li>
<li><a href="React/1入门/ReactNative的Hello World">第2节：React的Hello World</a></li>
<li><a href="React/1入门/ReactNative的最基础知识">第3节：React的最基础知识</a></li>
<li><a href="React/1入门/ReactNative必备的语言基础知识">第4节：React必备的语言基础知识</a></li>
<li><a href="ReactNative/1入门/ReactNative的常用库">第5节：ReactNative的常用库</a></li>
<li><a href="React/1入门/React与ReactNative的区别">React与ReactNative的区别</a></li>
</ul>
</li>
</ul>
<h2 id="H5-APP"><a href="#H5-APP" class="headerlink" title="H5-APP"></a>H5-APP</h2><ul>
<li><a href="H5-APP/1入门/README">第一章：入门</a><ul>
<li><a href="H5-APP/1入门/H5-APP开发环境搭建与运行">第1节：H5-APP开发环境搭建与运行</a></li>
<li><a href="H5-APP/1入门/H5-APP开发小技巧">第2节：H5-APP开发小技巧</a></li>
</ul>
</li>
</ul>
<h2 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h2><ul>
<li><a href="HTML/1入门/README">第一章：入门</a><ul>
<li><a href="HTML/1入门/web必备基础1-学习路线">第1节：web必备基础1-学习路线</a></li>
<li><a href="HTML/1入门/web必备基础2-实践基础">第2节：web必备基础2-实践基础</a></li>
<li><a href="HTML/1入门/web必备基础3-代码复用">第3节：web必备基础3-代码复用</a></li>
</ul>
</li>
<li><a href="HTML/2扩展/README">第二章：扩展</a><ul>
<li><a href="HTML/2扩展/web扩展1">第1节：web扩展1</a></li>
</ul>
</li>
</ul>
<h2 id="Weex"><a href="#Weex" class="headerlink" title="Weex"></a>Weex</h2><ul>
<li><a href="Weex/1入门/README">第一章：入门</a><ul>
<li><a href="Weex/1入门/Weex开发环境搭建与运行">第1节：Weex开发环境搭建与运行</a></li>
</ul>
</li>
</ul>
<h2 id="上架相关"><a href="#上架相关" class="headerlink" title="上架相关"></a>上架相关</h2><ul>
<li><a href="上架相关/上架-发版频率">第一章：上架-发版频率</a></li>
<li><a href="上架相关/上架-提审前自检">第二章：上架-提审前自检</a></li>
<li><a href="上架相关/上架-账号主体变更">第三章：上架-账号主体变更</a></li>
<li><a href="上架相关/上架-app链接">第四章：上架-app链接</a></li>
</ul>
<h2 id="Script"><a href="#Script" class="headerlink" title="Script"></a>Script</h2><ul>
<li><a href="Script/Script README">前言</a></li>
<li>Shell<ul>
<li><a href="./Script/Shell/Shell入门">Shell</a></li>
</ul>
</li>
<li>Ruby<ul>
<li><a href="Script/Ruby/Ruby入门">Ruby</a></li>
</ul>
</li>
<li>JavaScript<ul>
<li><a href="Script/JavaScript/JavaScript入门">JavaScript</a></li>
</ul>
</li>
<li>Python<ul>
<li><a href="Script/Python/Python入门">Python</a></li>
</ul>
</li>
</ul>
<h2 id="阿里云"><a href="#阿里云" class="headerlink" title="阿里云"></a>阿里云</h2><ul>
<li>第一章：阿里云<ul>
<li><a href="实用工具/阿里云oss/阿里云">第1节：阿里云</a></li>
</ul>
</li>
<li>第二章：阿里云oss<ul>
<li><a href="实用工具/阿里云oss/阿里云oss1上传">第1节：阿里云oss1上传</a></li>
</ul>
</li>
<li>第三章：阿里云服务器ECS<ul>
<li><a href="实用工具/阿里云服务器ECS/阿里云服务器ECS的购买与远程连接">第1节：阿里云服务器ECS的购买与远程连接</a></li>
<li><a href="实用工具/阿里云服务器ECS/阿里云服务器ECS的使用">第2节：阿里云服务器ECS的使用</a></li>
<li><a href="实用工具/阿里云服务器ECS/阿里云服务器ECS域名绑定">第3节：阿里云服务器ECS域名绑定</a></li>
<li><a href="实用工具/阿里云服务器ECS/阿里云服务器ECS的数据备份">第4节：阿里云服务器ECS的数据备份</a></li>
</ul>
</li>
</ul>
<h2 id="腾讯云"><a href="#腾讯云" class="headerlink" title="腾讯云"></a>腾讯云</h2><ul>
<li>第二章：腾讯云cos<ul>
<li><a href="实用工具/腾讯云/腾讯云cos1上传">第1节：腾讯云cos1上传</a></li>
</ul>
</li>
</ul>
<h2 id="实用工具部分"><a href="#实用工具部分" class="headerlink" title="实用工具部分"></a>实用工具部分</h2><ul>
<li><a href="实用工具/Terminal/README">Terminal</a><ul>
<li><a href="实用工具/Terminal/1终端常用命令">第1节：终端常用命令</a></li>
<li><a href="实用工具/Terminal/终端命令安装">第2节：终端命令安装</a></li>
<li><a href="实用工具/Terminal/终端命令使用">第3节：终端命令使用</a></li>
</ul>
</li>
<li><a href="实用工具/Hexo/README">Hexo</a><ul>
<li><a href="实用工具/Hexo/1Hexo的使用">第1节：1Hexo的使用</a></li>
<li><a href="实用工具/Hexo/2Hexo的进阶">第2节：2Hexo的进阶</a></li>
</ul>
</li>
<li><a href="实用工具/GitBook/README">GitBook</a><ul>
<li><a href="实用工具/GitBook/1GitBook的使用">第1节：GitBook的使用</a></li>
</ul>
</li>
<li><a href="实用工具/XAMPP/XAMPP问题整理">XAMPP</a></li>
<li>yapi<ul>
<li><a href="实用工具/yapi/yapi的安装">第1节：yapi的安装</a></li>
<li><a href="实用工具/yapi/yapi的项目运行">第2节：yapi的项目运行</a></li>
<li><a href="实用工具/yapi/yapi在云服务器ECS上的使用-阿里云">第3节：yapi在云服务器ECS上的使用-阿里云</a></li>
<li><a href="实用工具/yapi/yapi的使用之入门篇">第4节：yapi的使用之入门篇</a></li>
<li><a href="实用工具/yapi/yapi的使用之设置篇">第5节：yapi的使用之设置篇</a></li>
<li>第6节：Mock<ul>
<li><a href="实用工具/yapi/Mock基础知识">第6.1节：Mock基础知识</a></li>
<li><a href="实用工具/yapi/yapi的使用之Mock篇">第6.2节：yapi的使用之Mock篇</a></li>
<li><a href="实用工具/yapi/yapi的使用之Mock篇2-类型修改">第6.3节：yapi的使用之Mock篇2-类型修改</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="实用工具/iconFont">iconFont</a></li>
<li><a href="实用工具/MySQL/MySQL问题整理">MySQL</a></li>
<li><a href="实用工具/Zentao/Zentao问题整理">Zentao</a></li>
<li>明道<ul>
<li><a href="实用工具/明道/明道任务划分">第1节：明道任务划分</a></li>
</ul>
</li>
<li><a href="实用工具/Jenkins/Jenkins使用问题常见">Jenkins</a><ul>
<li><a href="实用工具/Jenkins/Jenkins的安装与启动">第1节：Jenkins的安装与启动</a></li>
<li><a href="实用工具/Jenkins/Jenkins基本操作">第2节：Jenkins基本操作</a></li>
<li><a href="实用工具/Jenkins/Jenkins使用技巧常用">第3节：Jenkins使用技巧常用</a></li>
<li><a href="实用工具/Jenkins/Jenkins使用问题常见">第4节：Jenkins使用问题常见</a></li>
<li><a href="实用工具/Jenkins/Jenkins常用插件介绍">第5节：Jenkins常用插件介绍</a></li>
<li><a href="实用工具/Jenkins/Jenkins上显示二维码图片">第6节：Jenkins上显示二维码图片</a></li>
<li><a href="实用工具/Jenkins/Jenkins参数化构建">第7节：Jenkins参数化构建</a></li>
</ul>
</li>
<li>qrencode<ul>
<li><a href="实用工具/qrencode/qrencode">第1节：qrencode</a></li>
</ul>
</li>
<li>Xcode Extensions<ul>
<li><a href="实用工具/Xcode Extensions/Swifttify for Xcode">Swifttify for Xcode</a></li>
</ul>
</li>
<li><a href="实用工具/Charles">Charles</a></li>
<li>AI<ul>
<li><a href="实用工具/ChatGPT">ChatGPT</a></li>
</ul>
</li>
<li><a href="实用工具/Nginx">Nginx</a></li>
<li><a href="实用工具/其他小工具/其他小工具">其他小工具</a><br>截图、录屏、音频转换</li>
</ul>
<h2 id="代码管理"><a href="#代码管理" class="headerlink" title="代码管理"></a>代码管理</h2><ul>
<li>Git<ul>
<li><a href="代码管理/Git/Git Permission">第1节：Git Permission</a></li>
<li><a href="代码管理/Git/Git Log">第1节：Git Log</a></li>
<li><a href="代码管理/Git/Git Feature">第1节：Git Feature</a></li>
<li><a href="代码管理/Git/Git Rebase">第1节：Git Rebase</a></li>
<li><a href="代码管理/Git/Git Search">第1节：Git Search</a></li>
<li><a href="代码管理/Git/Git2">第1节：Git2</a></li>
<li><a href="代码管理/Git/Git代码同步">第1节：Git代码同步</a></li>
<li><a href="代码管理/Git/Git获取信息">第1节：Git获取信息</a></li>
<li><a href="代码管理/Git/Git使用">第1节：Git使用</a></li>
<li><a href="代码管理/Git/Git项目管理">第1节：Git项目管理</a></li>
<li><a href="代码管理/Git/Git Push方式">第1节：Git Push方式</a></li>
<li><a href="代码管理/Git/Git Push失败问题">第1节：Git Push失败问题</a></li>
<li><a href="代码管理/Git/Git随笔">第1节：Git随笔</a></li>
<li><a href="代码管理/Git/Git Commit规范">第1节：Git Commit规范</a></li>
</ul>
</li>
<li><a href="代码管理/SVN">SVN</a></li>
<li>库管理<ul>
<li><a href="代码管理/库管理/CocoaPods">CocoaPods</a></li>
<li><a href="代码管理/库管理/homebrew">homebrew</a></li>
<li>npmjs<ul>
<li><a href="代码管理/库管理/npmjs的命令">第1节：npmjs的命令</a></li>
<li><a href="代码管理/库管理/npmjs的调试">第2节：npmjs的调试</a></li>
<li><a href="代码管理/库管理/npmjs的发布">第3节：npmjs的发布</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="电脑使用"><a href="#电脑使用" class="headerlink" title="电脑使用"></a>电脑使用</h2><ul>
<li><a href="电脑使用/新电脑初始配置">第1节：新电脑初始配置</a></li>
<li><a href="电脑使用/旧电脑数据清理">第2节：旧电脑数据清理</a></li>
<li><a href="电脑使用/电脑使用过程中的问题">第3节：电脑使用过程中的问题</a></li>
<li><a href="电脑使用/Mac中个各种文件夹">第4节：Mac中个各种文件夹</a></li>
<li>第5节：远程控制<ul>
<li><a href="电脑使用/远程桌面连接">第5.1节：远程桌面连接</a></li>
<li><a href="电脑使用/远程共享文件夹">第5.2节：远程共享文件夹</a></li>
</ul>
</li>
<li><a href="电脑使用/环境变量设置">第6节：环境变量设置</a></li>
</ul>
<h2 id="常识类"><a href="#常识类" class="headerlink" title="常识类"></a>常识类</h2><ul>
<li>技术常识<ul>
<li><a href="常识类/技术常识/好用的网站">第1节：好用的网站</a></li>
<li>第2节：科学上网<ul>
<li><a href="常识类/技术常识/科学上网_ClashX">第1节：科学上网_ClashX</a></li>
<li><a href="常识类/技术常识/科学上网_SMS">第2节：科学上网_SMS</a></li>
<li><a href="常识类/技术常识/科学上网_AppleID">第3节：科学上网_AppleID</a></li>
<li><a href="常识类/技术常识/科学上网_ModHeader">第4节：科学上网_ModHeader</a></li>
</ul>
</li>
<li><a href="常识类/技术常识/图片相关常识">第3节：图片相关常识</a></li>
</ul>
</li>
<li>Office常识<ul>
<li><a href="常识类/Office常识/PPT常识">第1节：PPT常识</a></li>
</ul>
</li>
<li>生活常识<ul>
<li><a href="常识类/生活常识/楼房常识">第1节：楼房常识</a></li>
</ul>
</li>
</ul>
<h2 id="编程工具部分"><a href="#编程工具部分" class="headerlink" title="编程工具部分"></a>编程工具部分</h2><ul>
<li><a href="编程工具/WebStorm">WebStorm</a></li>
<li><a href="编程工具/VSCode">VSCode</a></li>
<li><a href="编程工具/UI2Code">UI2Code</a></li>
<li><a href="编程工具/OnlineCoding在线编码">OnlineCoding在线编码</a></li>
</ul>
<p><a href="http://lib.csdn.net/base/ios/structure" target="_blank" rel="noopener">iOS知识库</a></p>
<p><a href="http://lib.csdn.net/base/Android/structure" target="_blank" rel="noopener">Android知识库</a></p>
<p>随笔</p>
<p>专利申请</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://dvlproad.github.io/总目录/" data-id="cm2noo7460009ovr470lbzqrg" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-安全/网络加密" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/安全/网络加密/" class="article-date">
  <time datetime="2024-06-07T02:39:52.000Z" itemprop="datePublished">2024-06-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/安全与破解/">安全与破解</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/安全/网络加密/">网络接口数据安全的【攻与防大全】</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[toc]</p>
<h2 id="一、对数据加密的概述"><a href="#一、对数据加密的概述" class="headerlink" title="一、对数据加密的概述"></a>一、对数据加密的概述</h2><h3 id="1、安全的数据传输是什么样的"><a href="#1、安全的数据传输是什么样的" class="headerlink" title="1、安全的数据传输是什么样的"></a>1、安全的数据传输是什么样的</h3><p>数据传输：都是使用密文（客户端提供加密的参数，服务端提供加密的结果）。</p>
<p>【客户端提供加密的参数】：需要在客户端加密后，上传到服务端，并在服务端对其进行解密，以确认传过来的参数。</p>
<p>【服务端提供加密的结果】：需要在服务端加密后，返回给客户端，并在客户端对其进行解密，以确认传过来的结果。</p>
<p><img src="/安全/网络加密/数据安全传输(AES).jpg" alt="数据安全传输(AES)" style="zoom:50%;"></p>
<p>若要了解加密方式可查看下文【<a href="#附1：加密的方式有哪些">附1：加密的方式有哪些</a>】</p>
<h3 id="2、一端的AESKey怎么【安全的】传给另一端-为什么要对AES的密钥进行RSA公钥加密后传输？？"><a href="#2、一端的AESKey怎么【安全的】传给另一端-为什么要对AES的密钥进行RSA公钥加密后传输？？" class="headerlink" title="2、一端的AESKey怎么【安全的】传给另一端 / 为什么要对AES的密钥进行RSA公钥加密后传输？？"></a>2、一端的AESKey怎么【安全的】传给另一端 / 为什么要对AES的密钥进行RSA公钥加密后传输？？</h3><p>答：为了安全，一端的AESKey必须先加密，然后才能传给另一端，这样才能防止用户从请求中抓取到AESKey。同时另一端需要对传过来的数据进行解密得到AESKey原值，后续两端才能都通过AESkey原值进行两边数据的对称加解密。即<strong>数据加密采用AES，而把AES的加密秘钥用RSA加密。</strong>（附：<strong>为什么AESKey不是使用md5方式加密？答：因为另一端要解密来使用原值。</strong>）。</p>
<p><strong>问题：为什么要对AES的密钥进行RSA公钥加密后传输？</strong></p>
<p>AES是对称加密算法，加密和解密的密钥都是同一个，为了防止被别人恶意获取到该密钥，然后对我们的业务请求参数进行解密，我们需要将AES密钥进行非对称加密后再进行传输。</p>
<h4 id="2-1、密钥来源于客户端（类似Https）"><a href="#2-1、密钥来源于客户端（类似Https）" class="headerlink" title="2.1、密钥来源于客户端（类似Https）"></a>2.1、密钥来源于客户端（类似Https）</h4><p><img src="/安全/网络加密/数据安全传输(Https_AES+RSA).jpg" alt="数据安全传输(AES+RSA)" style="zoom:50%;"></p>
<p>上图和Https原理有点相像。</p>
<h5 id="2-1-1、客户端密钥保存的安全问题"><a href="#2-1-1、客户端密钥保存的安全问题" class="headerlink" title="2.1.1、客户端密钥保存的安全问题"></a>2.1.1、客户端密钥保存的安全问题</h5><p>如果密钥是来源于客户端，那如何在客户端安全的保存密钥？请查看下文中的【<a href="#附2：如何在客户端安全的保存密钥AESKey">附2：如何在客户端安全的保存密钥AESKey</a>】</p>
<h4 id="2-2、密钥来源于服务端（为了密钥能够像版本那样进行控制）"><a href="#2-2、密钥来源于服务端（为了密钥能够像版本那样进行控制）" class="headerlink" title="2.2、密钥来源于服务端（为了密钥能够像版本那样进行控制）"></a>2.2、密钥来源于服务端（为了密钥能够像版本那样进行控制）</h4><p>实际过程中，可能你的AESKey为了能够像版本那样进行控制，可能你的AESKey是由服务端分发的，则其过程可能如下：</p>
<p><img src="/安全/网络加密/数据安全传输_AES+RSA.jpg" alt="数据安全传输(AES+RSA)"></p>
<p>空 ==&gt;  getServicePublicKey ==&gt;  servicePublicKey</p>
<p>clientPublicKey(使用ServicePublicKey加密)  ==&gt;   sendClientPublicKey  ==&gt;  使用servicePrivateKey解密得到clientPublicKey</p>
<p>空 ==&gt;   getServiceAESKey ==&gt;   aesKey(使用clientPublicKey加密)</p>
<p>参考文章：</p>
<ul>
<li><a href="https://juejin.cn/post/7078952957739286542" target="_blank" rel="noopener">前端RSA+AES混合加密</a></li>
<li><a href="https://juejin.cn/post/7146386827522342948" target="_blank" rel="noopener">客户端与服务端数据加密传输方案</a></li>
</ul>
<p>最终网络数据传输，可能就只剩下类似下面一样，只有一个参数和</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">只剩一个参数：</span><br><span class="line">encryptedParametersString: xxxx</span><br><span class="line"></span><br><span class="line">只剩一个返回：</span><br><span class="line">encryptedResultString: yyyy</span><br></pre></td></tr></table></figure>
<h2 id="二、被破解后，篡改参数值，进行请求攻击，怎么办？（二次加密：签名）"><a href="#二、被破解后，篡改参数值，进行请求攻击，怎么办？（二次加密：签名）" class="headerlink" title="二、被破解后，篡改参数值，进行请求攻击，怎么办？（二次加密：签名）"></a>二、被破解后，篡改参数值，进行请求攻击，怎么办？（二次加密：签名）</h2><p>如果上面的加密过程被破解了，用户就能自己还原原始参数和原始返回值了。这时候如果他篡改参数值进行请求攻击怎么办？</p>
<h3 id="1、请求参数值被篡改的场景"><a href="#1、请求参数值被篡改的场景" class="headerlink" title="1、请求参数值被篡改的场景"></a>1、请求参数值被篡改的场景</h3><p>购物车多商品结算时候，本需共100美元的商品。在生成订单的时候，携带了所要支付的各个商品的id，以及总费用。结果总费用被篡改成以0.01美元的价格生成了订单Id。而后服务端却没有校验这些商品是不是0.01美元，从而导致平台损失。</p>
<p>以购物车结算为例，传统的传给服务器的参数一般是如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">goods: [</span><br><span class="line">  &#123;</span><br><span class="line">    id: xxx</span><br><span class="line">    title: </span><br><span class="line">    price: </span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    id: yyy</span><br><span class="line">    title: </span><br><span class="line">    price: </span><br><span class="line">  &#125;</span><br><span class="line">],</span><br><span class="line">totoalPrice: 100</span><br></pre></td></tr></table></figure>
<p>当用户破解了我们之前的加密算法后，其就能还原原始参数结果，并篡改参数值，然后再利用破解所得的加密算法得到一个新的加密参数如下：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">篡改前所传参数：</span><br><span class="line">encryptedParametersString: xxxx1</span><br><span class="line"></span><br><span class="line">篡改后所传参数：</span><br><span class="line">encryptedParametersString: xxxx2</span><br></pre></td></tr></table></figure>
<p>之后，如果服务器接收和处理的就是被修改过的值了。</p>
<p>那这种情况下怎么办法呢？答：再加一层加密算法，即签名。</p>
<h3 id="2、请求参数值被篡改的解决-防篡改方案"><a href="#2、请求参数值被篡改的解决-防篡改方案" class="headerlink" title="2、请求参数值被篡改的解决/防篡改方案"></a>2、请求参数值被篡改的解决/防篡改方案</h3><p>为了防篡改，通常有以下三个步骤：</p>
<p>1、我们通过上述原始参数计算得出一个签名值。然后将签名值添加一起传给服务端。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">篡改前所传参数：</span><br><span class="line">encryptedParametersString: xxxx1</span><br><span class="line">signatureValue: xxxx1的签名值</span><br><span class="line">signatureMethod: xxx1的签名方式（如果客户端有md5、sha256等多种加密方式）</span><br><span class="line"></span><br><span class="line">篡改后所传参数：</span><br><span class="line">encryptedParametersString: xxxx2</span><br><span class="line">signatureValue: xxxx1的签名值（用户不知道此签名值的计算方法）</span><br><span class="line">signatureMethod: xxx1的签名方式（如果客户端有md5、sha256等多种加密方式）</span><br></pre></td></tr></table></figure>
<p>由于用户不知道签名值的计算方法，所以即使其篡改了原原始参数中的部分参数值并生成加密参数，其也仍需要再破解出这个签名值的计算方法，如果其不修改签名值，而是把签名值直接上传到服务端，则服务端会进行以下操作。</p>
<p>2、然后服务端接收到所传的参数（含签名值）后，也按照和客户端一样的方式对除签名值外的其他参数再计算一遍签名值。</p>
<p>3、如果所得的签名值和客户端传过来的签名值不一样，则是参数被篡改了，服务端放弃该请求。（注：<strong>为了保证正常情况下计算出的客户端和服务端的签名一样，我们会对请求参数进行字典排序后再签名。</strong>）</p>
<p>所以，防篡改的解决办法是客户端加签，服务端验签。</p>
<h4 id="2-1、加签的方法"><a href="#2-1、加签的方法" class="headerlink" title="2.1、加签的方法"></a>2.1、加签的方法</h4><p>对上述的 <code>encryptedParametersString: xxxx1</code> 进行md5、sha256或其他加密算法。</p>
<h5 id="2-1-1、签名算法的防猜测"><a href="#2-1-1、签名算法的防猜测" class="headerlink" title="2.1.1、签名算法的防猜测"></a>2.1.1、签名算法的防猜测</h5><p>如果签名的加密算法被猜到是用md5进行的签名。则用户可以也跟着对<code>encryptedParametersString: xxxx1</code> 进行md5加密即可得到签名会被服务端认证通过的请求了。那是不是md5不能用呢？如果用怎么用？答：md5加盐，进一步增加破解的难度。</p>
<p>为什么加盐？<br>避免用户直接使用参数值进行md5加密，发现签名值就是由参数值md5加密而来。所以为了让MD5码更加安全 ，我们现在都采用加盐，盐要越长越乱。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">加盐前：</span><br><span class="line">digest = hash(input)</span><br><span class="line"></span><br><span class="line">加盐后：用户拿参数值直接md5发现和签名值匹配不上，则一般就不会发现是用md5加密了。</span><br><span class="line">digest = hash(salt + input)</span><br></pre></td></tr></table></figure>
<p>这样加盐后，当用户再拿参数值直接进行md5后，发现和签名值匹配不上，则一般就不会想到算法是用md5加密了。</p>
<p><strong>这个salt可以看作是一个额外的“认证码”，可以是固定的值，也可以是动态的值，如每个用户自己的userid。</strong></p>
<p>更多MD5及其加盐可查看下文中的【<a href="#附3：签名 --&gt; md5(加盐">附3：签名 –&gt; md5(加盐)</a>)】</p>
<h5 id="2-1-2、签名算法关注的内容"><a href="#2-1-2、签名算法关注的内容" class="headerlink" title="2.1.2、签名算法关注的内容"></a>2.1.2、签名算法关注的内容</h5><p>除了请求参数外，签名算法还关注请求的接口和方法，即其一般是对含参数在内、外加其他值（如URL、Method)一起进行签名。</p>
<p>参考文章：</p>
<ul>
<li><a href="https://cloud.tencent.com/developer/article/1557750" target="_blank" rel="noopener">如何设计一个API签名</a></li>
<li><a href="https://help.aliyun.com/zh/api-gateway/traditional-api-gateway/user-guide/use-digest-authentication-to-call-an-api" target="_blank" rel="noopener">使用摘要签名认证方式调用API</a></li>
</ul>
<h2 id="三、不破解，但进行二次请求-API重放攻击-Replay-Attacks-怎么办？"><a href="#三、不破解，但进行二次请求-API重放攻击-Replay-Attacks-怎么办？" class="headerlink" title="三、不破解，但进行二次请求/API重放攻击(Replay Attacks)怎么办？"></a>三、不破解，但进行二次请求/API重放攻击(Replay Attacks)怎么办？</h2><p>加密后，破解难度增加了，但是如果用户不破解，而是通过API重放攻击你的服务器呢，怎么办？</p>
<h3 id="1、重放攻击-Replay-Attacks-概述及危害介绍"><a href="#1、重放攻击-Replay-Attacks-概述及危害介绍" class="headerlink" title="1、重放攻击(Replay Attacks)概述及危害介绍"></a>1、重放攻击(Replay Attacks)概述及危害介绍</h3><p>API重放攻击(Replay Attacks)又称为重播攻击、回放攻击。它的原理就是把之前窃听到的数据原封不动的重新发送给接收方。</p>
<h4 id="1-1、即使有幂等性情况下，重放请求的危害"><a href="#1-1、即使有幂等性情况下，重放请求的危害" class="headerlink" title="1.1、即使有幂等性情况下，重放请求的危害"></a>1.1、即使有幂等性情况下，重放请求的危害</h4><p>追问：服务端不是应该有做幂等性了吗，为什么还需要处理防重放问题？</p>
<p>答：虽然如果一个系统操作是幂等的，即使攻击者重放了一个请求，系统也不会因为重复执行而产生不同的结果或状态。在一定程度上可以减少重放攻击的潜在损害（例如，一个幂等的HTTP GET请求，无论请求多少次，服务器都会返回相同的结果，而不会对服务器的状态产生影响）。但是即使请求本身是幂等的，也需要<strong>防止恶意用户发送大量重放请求来耗尽系统资源</strong>，从而实现拒绝服务攻击（DoS）。</p>
<p>若要了解幂等性知识，可查看</p>
<ul>
<li><a href="https://developer.aliyun.com/article/812075" target="_blank" rel="noopener">接口的幂等性设计和防重保证，详细分析幂等性的几种实现方法</a></li>
<li><a href="https://blog.csdn.net/XinTeng2012/article/details/121093535" target="_blank" rel="noopener">幂等性问题的思考和总结，防重、幂等，常用解决方案，解决方式</a></li>
</ul>
<h4 id="1-2、没有幂等性情况下，重放请求的危害"><a href="#1-2、没有幂等性情况下，重放请求的危害" class="headerlink" title="1.2、没有幂等性情况下，重放请求的危害"></a>1.2、没有幂等性情况下，重放请求的危害</h4><p>如果服务端没有幂等性，则假设有一个在线投票系统，用于选举或表决，每个用户只能投票一次。那么攻击者可能会尝试重放投票请求，进行<strong>重复投票</strong>，以增加他们支持的候选人或选项的票数。</p>
<h3 id="2、重放攻击-Replay-Attacks-的解决方案"><a href="#2、重放攻击-Replay-Attacks-的解决方案" class="headerlink" title="2、重放攻击(Replay Attacks)的解决方案"></a>2、重放攻击(Replay Attacks)的解决方案</h3><p><strong>防止重放攻击必须要保证请求仅一次有效</strong>。需要通过在请求体中携带当前请求的唯一标识，并且进行签名防止被篡改。所以，防止重放攻击需要建立在添加签名且防止签名被篡改的基础之上。</p>
<h4 id="2-1、措施一：添加请求的时效性参数-Timestamp"><a href="#2-1、措施一：添加请求的时效性参数-Timestamp" class="headerlink" title="2.1、措施一：添加请求的时效性参数 Timestamp"></a>2.1、措施一：添加请求的时效性参数 Timestamp</h4><p>即某个请求，其请求时间戳<strong>Timestamp</strong>，和服务端的当前时间在规定时间内（如1分钟内）则为合法请求，反之，则视为无效请求。</p>
<p><strong>服务端时间戳的获取时机</strong>和服务端的RSA公钥一致，你可理解为网络库的初始化阶段（虽然这是真正初始化之后的请求的”二次初始化”）。</p>
<p><img src="/安全/网络加密/数据安全传输_防重放_1加timestamp.png" alt="数据安全传输_防重放_1加timestamp" style="zoom:50%;"></p>
<p>客户端与服务端的时间戳差值 diff = 服务器返回的时间戳 - 客户端请求结束的时间戳</p>
<p>校准服务端后的客户端的时间戳 = 当前客户端时间戳 + 客户端与服务端的时间戳差值 diff</p>
<h4 id="2-2、措施二：添加一个唯一的随机数Nonce"><a href="#2-2、措施二：添加一个唯一的随机数Nonce" class="headerlink" title="2.2、措施二：添加一个唯一的随机数Nonce"></a>2.2、措施二：添加一个唯一的随机数Nonce</h4><h5 id="2-2-1、Nonce的核心思路："><a href="#2-2-1、Nonce的核心思路：" class="headerlink" title="2.2.1、Nonce的核心思路："></a>2.2.1、Nonce的核心思路：</h5><p>调用者每次调用时：</p>
<p>​        A：调用者生成并带上一个随机数<strong>Nonce</strong>（可以考虑用用户id+当前时间戳+接口url）</p>
<p>​        B：服务端该随机数是否已出现，有则拒绝，无则存储该随机数并放过请求。</p>
<p>则请求参数变为如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">未加 timestamp 和 nonce 前：</span><br><span class="line">encryptedParametersString: xxxx1</span><br><span class="line">signatureValue: xxxx1的签名值</span><br><span class="line">signatureMethod: xxx1的签名方式（如果客户端有md5、sha256等多种加密方式）</span><br><span class="line"></span><br><span class="line">加了 timestamp 和 nonce 后：</span><br><span class="line">encryptedParametersString: xxxx1</span><br><span class="line">signatureValue: xxxx1的签名值,📢：要把timestamp和nonce也包括进去，避免它们被篡改</span><br><span class="line">signatureMethod: xxx1的签名方式（如果客户端有md5、sha256等多种加密方式）</span><br><span class="line">nonce: xxx1的nonce</span><br><span class="line">timestamp: xxx1的timestamp</span><br></pre></td></tr></table></figure>
<p>这里注意：计算xxxx1的<strong>签名值要把timestamp和nonce也包括进去，避免它们被篡改。</strong></p>
<h5 id="2-2、Nonce的优化思路："><a href="#2-2、Nonce的优化思路：" class="headerlink" title="2.2、Nonce的优化思路："></a>2.2、Nonce的优化思路：</h5><p>这里服务端要保证Nonce唯一，就得存储已经用过的Nonce，但长期保持会带来两个问题</p>
<p>​        （1）存储成本增加，日积月累，这里要存储的Nonce会越来越多，需要的存储空间就越大</p>
<p>​        （2）碰撞概率增加，正常服务被拒绝概率增大；这里随着生成Nonce值越来越多，碰撞的概率一定越来越大，若通过增加Nonce值的长度，有增加存储成本。</p>
<p>​         那么，另一个可行的办法，就是调用者每次请求时带上当前请求时间点Timestamp，然后由服务端限制请求的时效性。   </p>
<p>​         如此，上面提到的Nonce值存储成本可能比较大的问题，在结合Timestamp后，可大大降低存储成本，如Timestamp=1min，则仅需存储1min内的请求Nonce值即可，大大减少存储的量级。</p>
<p>至此，客户端发送的参数为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">encryptedParametersString: xxxx1</span><br><span class="line">signatureValue: xxxx1的签名值,📢：要把timestamp和nonce也包括进去，避免它们被篡改</span><br><span class="line">signatureMethod: xxx1的签名方式（如果客户端有md5、sha256等多种加密方式）</span><br><span class="line">nonce: xxx1的nonce</span><br><span class="line">timestamp: xxx1的timestamp</span><br></pre></td></tr></table></figure>
<h3 id="3、扩展：客户端自己如何防止接口重复请求？"><a href="#3、扩展：客户端自己如何防止接口重复请求？" class="headerlink" title="3、扩展：客户端自己如何防止接口重复请求？"></a>3、扩展：客户端自己如何防止接口重复请求？</h3><p>1、界面添加 loading</p>
<p>2、进行节流（最后执行）和防抖（立即执行）中的防抖。</p>
<p>3、请求队列：类似SDWebImage加载相同地址的图片。</p>
<p>如果重复请求的话，客户端的优化：</p>
<p>1、缓存</p>
<p>其他可参考：<a href="https://juejin.cn/post/7377208894551261193" target="_blank" rel="noopener">功能问题：如何防止接口重复请求？</a></p>
<hr>
<p>## </p>
<p><a name="附1：加密的方式有哪些"></a></p>
<h2 id="附1：加密的方式有哪些"><a href="#附1：加密的方式有哪些" class="headerlink" title="附1：加密的方式有哪些"></a>附1：加密的方式有哪些</h2><table>
<thead>
<tr>
<th></th>
<th>对称加密</th>
<th>非对称加密</th>
</tr>
</thead>
<tbody>
<tr>
<td>概念</td>
<td>加密密钥和解密密钥相同</td>
<td>加密密钥和解密密钥不相同</td>
</tr>
<tr>
<td>算法</td>
<td>DES、AES、RC2、RC4、RC5 等</td>
<td>RSA、ECC 等</td>
</tr>
<tr>
<td>缺点</td>
<td>速度快，安全性低。使用<code>同一个密钥</code>，如果一方密钥泄露，数据就不安全了</td>
<td>非对称加密的安全性更高，但加密速度较慢。</td>
</tr>
</tbody>
</table>
<p>注意：非对称加密的安全性更高，但加密速度较慢。一般我们在项目中采用的是 <strong>”结合对称和非对称加密，数据加密采用AES，而把AES的加密秘钥用RSA加密，这样兼顾速度及安全性“</strong>。<a href="https://juejin.cn/post/7002058547395559438" target="_blank" rel="noopener">https://juejin.cn/post/7002058547395559438</a></p>
<h3 id="1-1、对称加密"><a href="#1-1、对称加密" class="headerlink" title="1.1、对称加密"></a>1.1、对称加密</h3><p><img src="/安全/网络加密/加密方式_对称.png" alt="加密方式_对称" style="zoom: 33%;"></p>
<p>1、李雷想要给韩梅梅发送消息，他们约定使用对称加密的方式把消息进行加密</p>
<p>2、李雷用密钥把消息加密然后发送给韩梅梅</p>
<p>3、韩梅梅用同一个密钥解密，然后看到李雷发送给自己的消息</p>
<h3 id="1-2、非对称加密"><a href="#1-2、非对称加密" class="headerlink" title="1.2、非对称加密"></a>1.2、非对称加密</h3><p><img src="/安全/网络加密/加密方式_非对称.png" alt="加密方式_非对称" style="zoom: 33%;"></p>
<p>1、李雷想要给韩梅梅发送消息，他们约定使用非对称加密的方式把消息进行加密</p>
<p>2、李雷首先要得到韩梅梅的公钥</p>
<p>2、李雷用韩梅梅的公钥把消息加密然后发送给韩梅梅</p>
<p>3、韩梅梅用自己的私钥解密，然后看到李雷发送给自己的消息</p>
<p>韩梅梅给李雷发送消息同理。</p>
<p><a name="附2：如何在客户端安全的保存密钥AESKey"></a></p>
<h2 id="附2：如何在客户端安全的保存密钥AESKey"><a href="#附2：如何在客户端安全的保存密钥AESKey" class="headerlink" title="附2：如何在客户端安全的保存密钥AESKey"></a>附2：如何在客户端安全的保存密钥AESKey</h2><p>如果密钥是来源于客户端，那如何在客户端安全的保存密钥？</p>
<h3 id="1、密钥在代码上-内部"><a href="#1、密钥在代码上-内部" class="headerlink" title="1、密钥在代码上(内部)"></a>1、密钥在代码上(内部)</h3><h4 id="1-1、存放密码的常见的代码"><a href="#1-1、存放密码的常见的代码" class="headerlink" title="1.1、存放密码的常见的代码"></a>1.1、存放密码的常见的代码</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#define kSecret <span class="meta-string">"abcd1234"</span></span></span><br><span class="line"></span><br><span class="line"> <span class="comment">// 或者</span></span><br><span class="line"> <span class="keyword">const</span> <span class="keyword">char</span>* kSecret = <span class="string">"abcd1234"</span>;</span><br></pre></td></tr></table></figure>
<p>这是非常危险的，因为常量会被直接编译到可执行文件的data段，只要对生成的可执行文件使用<code>strings</code>、<code>otool</code>等命令就可以dump出原始字符串。</p>
<h4 id="1-2、对密码加密"><a href="#1-2、对密码加密" class="headerlink" title="1.2、对密码加密"></a>1.2、对密码加密</h4><p>仍然存</p>
<p>1、类的代码层面</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 方法1：密码在可执行文件的data段，且是明文</span></span><br><span class="line"><span class="meta">#define kSecret <span class="meta-string">"abcd1234"</span></span></span><br><span class="line"><span class="keyword">void</span> getSecret &#123;</span><br><span class="line">	<span class="keyword">return</span> kSecret</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法2：密码在可执行文件的data段，虽是明文，但取到的值要再经过一层你自己知道的方法解密</span></span><br><span class="line"><span class="meta">#define kSecret <span class="meta-string">"\x7e\x77\x64\x3c\xa7\xd4\x6d\x46\x29\x8b\xe3\x23\x9f\x1a\x5c\xdb"</span>;  // 使用aes加密后的</span></span><br><span class="line"><span class="meta">#define kAESKey	<span class="meta-string">"abcdefgh12345678"</span>;</span></span><br><span class="line"><span class="keyword">char</span>* getSecret() &#123;</span><br><span class="line">	<span class="keyword">return</span> decryptSecretByAESKey(kSecret, kAESKey);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 方法2的优化：内部代码使用额外包在宏(kAppSecret)上，由于宏没有明确的入口，使得静态分析相比直接调用函数形式的getSecret更加不容易被破解。</span></span><br><span class="line"><span class="meta">#define kAppSecret                                          \</span></span><br><span class="line">(&#123;                                                          \</span><br><span class="line">    <span class="keyword">char</span>* buf = decryptSecretByAESKey(kSecret, kAESKey);		\</span><br><span class="line">    [<span class="built_in">NSString</span> stringWithUTF8String:buf];					    			\</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>附：带返回值的宏的写法 见<strong><a href="https://tanqisen.github.io/blog/2014/06/06/how-to-prevent-app-crack/" target="_blank" rel="noopener">宏定义的两个技巧：</a></strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#define SOME_MACRO \ </span><br><span class="line">(&#123;                 \</span><br><span class="line">	expression;      \</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>最后一个表达式的值就是宏的返回值，使用时更像函数的返回值。</p>
<p>2、类本身（可包含类中的函数名）</p>
<p>因为objc代码的动态性，编译器会在binary中留下类名、函数名等信息，这些信息是可以被<code>class-dump-z</code>等工具提取的，友好的命名让程序猿更方便，但同时也方便了破解者。对安全相关的重要模块类，可以故意混淆类名，让人不容易轻易联想到该的真实目的。</p>
<p>PS、更多混淆知识可看我写的另一篇文章：<a href="https://www.jianshu.com/p/ccfe5623483d" target="_blank" rel="noopener">iOS APP安全加固方案(一、代码混淆CodeObfuscation)</a></p>
<h3 id="2、密钥保存在外部"><a href="#2、密钥保存在外部" class="headerlink" title="2、密钥保存在外部"></a>2、密钥保存在外部</h3><h4 id="2-1、密钥保存在Keychain"><a href="#2-1、密钥保存在Keychain" class="headerlink" title="2.1、密钥保存在Keychain"></a>2.1、密钥保存在Keychain</h4><p>密钥保存在Keychain并不安全，iOS越狱后可以导出Keychain的内容。应该尽量避免存放重要信息(如：token、用户名、密码等)在Keychain中，即使要存放，也一定要加密后存放。参考：<a href="http://blog.csdn.net/yiyaaixuexi/article/details/18404343" target="_blank" rel="noopener">iOS安全攻防（九）：使用Keychain-Dumper导出keychain数据</a></p>
<h4 id="2-2、密钥保存在文件"><a href="#2-2、密钥保存在文件" class="headerlink" title="2.2、密钥保存在文件"></a>2.2、密钥保存在文件</h4><p>保存在app bundle、plist等配置文件更不安全，但可以使用隐写术等方式迷惑hackers。</p>
<h5 id="2-2-1、隐写术"><a href="#2-2-1、隐写术" class="headerlink" title="2.2.1、隐写术"></a>2.2.1、隐写术</h5><ul>
<li><a href="https://blog.csdn.net/wpgdream/article/details/126497352" target="_blank" rel="noopener">隐写术，图片中隐藏的秘密！</a></li>
</ul>
<p>隐写术的载体：相比视频、音乐等文件，通常选择使用图片这种占用空间小的文件，但<strong>因为Xcode打包时会对png图片做特殊处理，如果将密码携带在png中，可能会在使用的时候无法复原。所以若非确定的隐写方法，则建议用bmp图片。</strong></p>
<p>本节点【如何防止客户端被破解/密钥的保护】部分内容摘自/参考：<a href="https://tanqisen.github.io/blog/2014/06/06/how-to-prevent-app-crack/" target="_blank" rel="noopener">如何防止客户端被破解</a></p>
<p><strong>LSB算法</strong>：LSB全称为 Least Significant Bit（最低有效位），是一种常被用做图片隐写的算法。为了避免我们对图片进行的处理可能会在压缩的过程中被破坏，建议在无压缩的bmp图片上实现。（png图片是无损压缩，jpg图片是有损压缩。）</p>
<blockquote>
<p><img src="/安全/网络加密/steganography_lbs.png" alt="steganography_lbs">图片来源于：《<a href="./网络加密/网络加密.graffle">网络加密.graffle</a>》中的【隐写术】</p>
</blockquote>
<p>bmp的隐写，相比lsb隐写，bmp简单的多，并且达到了无损隐写。</p>
<p>bmp了解：<a href="https://maidang.cool/2022/14839.html" target="_blank" rel="noopener">BMP位图隐写</a></p>
<p><a href="https://www.onctf.com/posts/30da720a.html" target="_blank" rel="noopener">ctf杂项中图片隐写拿到一张图片常见的解题方法</a></p>
<p><a name="附3：签名 --> md5(加盐)"></a></p>
<h2 id="附3：签名-–-gt-md5-加盐"><a href="#附3：签名-–-gt-md5-加盐" class="headerlink" title="附3：签名 –&gt; md5(加盐)"></a>附3：签名 –&gt; md5(加盐)</h2><p>md5是哈希函数。SHA-256或SHA-3也是哈希函数，相比md5更安全。</p>
<p>Mac：在终端上实现将abcd1234进行MD5（Message Digest algorithm 5 ,信息摘要算法）加密。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo -n 'abcd1234' | md5</span><br><span class="line"></span><br><span class="line">得到结果：e19d5cd5af0378da05f63f891c7467af</span><br></pre></td></tr></table></figure>
<p>使用MD5就是将一串字符串通过某特定的算法来将其变成另一种形式，这样子就在外观上起到了加密的效果，但是由于背后的算法(<strong>md5是一种常见的hash算法</strong>)是固定的，所以每一个字符串都有固定的MD5格式。（反过来，一个hash值是否只能是一个值才可能？答：不是）</p>
<p>因为<strong>每一个字符串就只有一种特定的MD5格式</strong>，所以md5的破解（从c=hash(m)逆向得到原始明文m）容易想到的方式有：</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>优缺点</th>
<th>推荐程度</th>
</tr>
</thead>
<tbody>
<tr>
<td>暴力破解法</td>
<td>时间成本太高</td>
<td>⭐️</td>
</tr>
<tr>
<td>字典法</td>
<td>提前构建一个“明文-&gt;密文”对应关系的一个大型数据库，破解时通过密文直接反查明文。但存储一个这样的数据库，空间成本是惊人的</td>
<td>⭐️⭐️⭐️</td>
</tr>
<tr>
<td>构建彩虹表</td>
<td>在字典法的基础上改进，以时间换空间。是现在破解哈希常用的办法。<br>彩虹表：彩虹表记录了几乎所有字符串的MD5对照表。</td>
<td>⭐️⭐️⭐️⭐️⭐️</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong><a href="https://www.cmd5.com/" target="_blank" rel="noopener">md5在线解密网站</a></strong></p>
<p><img src="/安全/网络加密/md5在线解密.png" alt="md5在线解密" style="zoom:50%;"></p>
</blockquote>
<p>因为已经有了类似彩虹表的破解方法，所以如果不<strong>‘加盐’</strong>，则当用户知道是 e19d5cd5af0378da05f63f891c7467af 时候，就很容易知道原值是 ‘abcd1234’了。</p>
<p>所以Md5加密方式的进化之路小结：</p>
<table>
<thead>
<tr>
<th></th>
<th>密码存储的种方式</th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>直接存储密码明文m</td>
<td>明文存储，无安全性可言。</td>
<td></td>
</tr>
<tr>
<td>2</td>
<td>存储密码明文的哈希值hash(m)</td>
<td>虽然是入侵者得到的是hash值，但由于<strong>彩虹表</strong>的存在，也很容易批量还原出密码明文来。</td>
<td></td>
</tr>
<tr>
<td>3</td>
<td>存储密码明文的加盐哈希 hash(m+salt)。<br><strong>这里的salt可以是用户名，手机号等</strong>，但必须保证每个用户的salt都不一样才是安全的。</td>
<td>相对前两种安全</td>
</tr>
</tbody>
</table>
<h2 id="网路本身的安全"><a href="#网路本身的安全" class="headerlink" title="网路本身的安全"></a>网路本身的安全</h2><p><strong>HTTPS是应用层的安全协议。TCP是传输层的协议，但是它不安全，因为它是明文传输的，所以SSL的诞生就是给TCP加了一层保险，使HTTPS和TCP之间使用加密传输。而TLS只是SSL的升级版，他们的作用是一样的。</strong></p>
<p>以下内容摘自<a href="https://www.sohu.com/a/251746171_216613" target="_blank" rel="noopener">HTTPS、SSL/TLS、TCP之间错综复杂的情感纠葛 </a></p>
<blockquote>
<p>SSL(Secure Sockets Layer) 安全套接层：为网络通信提供安全及数据完整性的一种安全协议。</p>
<p>TLS(Transport Layer Security）安全传输层协议：用于在两个通信应用程序之间提供保密性和数据完整性。该协议由两层组成： TLS 记录协议（TLS Record）和 TLS 握手协议（TLS Handshake），是更新、更安全的SSL版本。</p>
</blockquote>
<p>SSL/TLS协议的基本思路是采用公钥加密法，也就是说，客户端先向服务器端索要公钥，然后用公钥加密信息，服务器收到密文后，用自己的私钥解密。<strong>==&gt; 类似 RSA</strong></p>
<p>但是，这里有两个问题。</p>
<p>（1）如何保证公钥不被篡改？</p>
<p>解决方法：将公钥放在数字证书中。只要证书是可信的，公钥就是可信的。</p>
<p>（2）公钥加密计算量太大，如何减少耗用的时间？</p>
<p>解决方法：每一次对话（session），客户端和服务器端都生成一个”对话密钥”（session key），用它来加密信息。由于”对话密钥”是对称加密，所以运算速度非常快，而服务器公钥只用于加密”对话密钥”本身，这样就减少了加密运算的消耗时间。 <strong>==&gt; 类似 AES</strong></p>
<p>HTTPS（超文本传输安全协议）是建立在HTTP（超文本传输协议）之上，通过SSL/TLS（安全套接字层/传输层安全协议）进行加密的安全协议。在HTTPS的握手过程中，SSL/TLS握手会先于HTTP握手发生。以下是HTTPS连接建立的基本步骤：</p>
<ol>
<li><strong>TCP握手</strong>：客户端首先通过TCP（传输控制协议）与服务器建立一个普通的连接。这个过程包括三次握手，确保双方都准备好进行数据传输。</li>
<li><strong>SSL/TLS握手</strong>：一旦TCP连接建立，SSL/TLS握手就开始了。这个过程包括：<ul>
<li>客户端发送一个“hello”消息给服务器，请求建立一个安全的连接。</li>
<li>服务器响应自己的“hello”消息，并发送其证书（包含公钥）给客户端。</li>
<li><strong>客户端验证服务器的证书</strong>，如果证书有效，客户端会生成一个随机数（用于会话加密），并使用服务器的公钥加密这个随机数，然后发送给服务器。（<a href="https://juejin.cn/post/6844903564960088071" target="_blank" rel="noopener">使用 AFNetworking 时怎么进行证书认证：AFSSLPinningModeNone(Default)：客户端自己不会对服务端证书进行自主校验，而是直接默认信任</a>)</li>
<li>服务器使用自己的私钥解密这个随机数，然后使用这个随机数来加密接下来的通信。</li>
</ul>
</li>
<li><strong>应用层协议</strong>：一旦SSL/TLS握手完成，客户端和服务器就可以使用这个安全的连接来传输加密的数据。这时，HTTP请求和响应就会在SSL/TLS层之上进行传输。</li>
</ol>
<p>因此，HTTPS的连接建立过程中，是先进行TCP握手，然后进行SSL/TLS握手，最后才开始HTTP通信。</p>
<h2 id="其他参考文章"><a href="#其他参考文章" class="headerlink" title="其他参考文章"></a>其他参考文章</h2><ul>
<li><p><a href="https://www.cnblogs.com/xingxia/p/api_security.html" target="_blank" rel="noopener">API接口之安全篇(含https原理图解)</a></p>
</li>
<li><p><a href="https://blog.csdn.net/HO1_K/article/details/109285565" target="_blank" rel="noopener">Java API加密 从sign签名验证到RSA、AES数据加密的实际应用</a></p>
</li>
<li><p><a href="https://cloud.tencent.com/developer/article/1557750" target="_blank" rel="noopener">如何设计一个API签名</a></p>
</li>
</ul>
<h2 id="End"><a href="#End" class="headerlink" title="End"></a>End</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://dvlproad.github.io/安全/网络加密/" data-id="cm2noo7jy003aovr4d0o9otux" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/安全/">安全</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Architecture架构/监控相关/灰度系统" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/Architecture架构/监控相关/灰度系统/" class="article-date">
  <time datetime="2024-05-31T09:07:41.000Z" itemprop="datePublished">2024-05-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Architecture/">Architecture</a>►<a class="article-category-link" href="/categories/Architecture/第九章：监控相关/">第九章：监控相关</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Architecture架构/监控相关/灰度系统/">灰度系统</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[toc]</p>
<p><strong>目的：避免功能异常，出现集体性问题。</strong></p>
<h2 id="一、灰度接口"><a href="#一、灰度接口" class="headerlink" title="一、灰度接口"></a>一、灰度接口</h2><h3 id="1、灰度开关接口"><a href="#1、灰度开关接口" class="headerlink" title="1、灰度开关接口"></a>1、灰度开关接口</h3><p>1、是否进行功能的灰度使用的开关</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>说明</th>
<th>字段</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>网页配置1</td>
<td>是否开启功能</td>
<td>isOpen</td>
<td>1:开启、其他:关</td>
</tr>
<tr>
<td>网页配置2</td>
<td>要开启功能的用户(灰度上线)<br>(当且仅当开启上述功能时有效)</td>
<td>openUserids</td>
<td>[“101”, “102”]</td>
</tr>
<tr>
<td>网页配置3</td>
<td>要开启功能的设备(灰度上线)<br>(当且仅当开启上述功能时有效)<br>未配置但开关为开时为全记录</td>
<td>openDeviceIds</td>
<td>[“udid001”, “udid002”]</td>
</tr>
<tr>
<td>接口回值1</td>
<td>是否进行功能的使用(灰度上线)</td>
<td>needOpen</td>
<td>1:使用、其他:不使用</td>
</tr>
</tbody>
</table>
<p>接口名定义：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function getGrayscaleSwitchConfig(userid, deviceId)</span><br></pre></td></tr></table></figure>
<p>接口结果的json示例如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"logFuture"</span>: &#123;</span><br><span class="line">		<span class="attr">"needOpen"</span>: <span class="number">1</span>,</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"cacheOptimize"</span>: &#123;</span><br><span class="line">		<span class="attr">"needOpen"</span>: <span class="number">1</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="End"><a href="#End" class="headerlink" title="End"></a>End</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://dvlproad.github.io/Architecture架构/监控相关/灰度系统/" data-id="cm2noo92i008tovr4ujjkk8n2" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Architecture/">Architecture</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Architecture架构/基础规范/请求规范_JS" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/Architecture架构/基础规范/请求规范_JS/" class="article-date">
  <time datetime="2024-04-29T09:05:41.000Z" itemprop="datePublished">2024-04-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Architecture/">Architecture</a>►<a class="article-category-link" href="/categories/Architecture/第三章：基础规范/">第三章：基础规范</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Architecture架构/基础规范/请求规范_JS/">请求规范</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[toc]</p>
<h2 id="一、JS请求结果结构规范-JSResponseModel"><a href="#一、JS请求结果结构规范-JSResponseModel" class="headerlink" title="一、JS请求结果结构规范(JSResponseModel)"></a>一、JS请求结果结构规范(<code>JSResponseModel</code>)</h2><p>json举例</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"resultCode"</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">"message"</span>: <span class="string">"成功"</span>,</span><br><span class="line">  <span class="attr">"result"</span>: map 或 array</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>点击跳转到附文查看：<a href="#JSResponseModel代码示例">JSResponseModel 代码示例</a></p>
<h2 id="二、JS调用规范"><a href="#二、JS调用规范" class="headerlink" title="二、JS调用规范"></a>二、JS调用规范</h2><h3 id="1、规范标准"><a href="#1、规范标准" class="headerlink" title="1、规范标准"></a>1、规范标准</h3><p>1、js需要回传值时候，回传值方法统一由h5的<code>callbackMethod</code>告知app(而非app写死)</p>
<p>2、js需要回传值时候，一定要有回传值，且回传值结果必须如《本文》中的【一、JS请求结果结构】所示</p>
<h3 id="2、JS调用示例"><a href="#2、JS调用示例" class="headerlink" title="2、JS调用示例"></a>2、JS调用示例</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="markdown">/// 调起微信小程序去支付</span></span></span><br><span class="line"> <span class="keyword">static</span> JavascriptChannel pay(</span><br><span class="line">   BuildContext context, &#123;</span><br><span class="line">   required WebViewController? <span class="built_in">Function</span>() webViewControllerGetBlock,</span><br><span class="line"> &#125;) &#123;</span><br><span class="line">   <span class="keyword">return</span> BJJavascriptChannel(</span><br><span class="line">     name: <span class="string">'h5CallBridgeAction_pay'</span>,</span><br><span class="line">     onMessageReceived: (JavaScriptMessage message) <span class="keyword">async</span> &#123;</span><br><span class="line">       <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="keyword">dynamic</span>&gt;? map = json.decode(message.message.toString());</span><br><span class="line">       <span class="keyword">if</span> (map == <span class="keyword">null</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="keyword">dynamic</span>&gt; jsCallbackMap = JSResponseModel.initMap();</span><br><span class="line">       <span class="keyword">if</span> (map[<span class="string">'payType'</span>] == <span class="keyword">null</span> || map[<span class="string">'payType'</span>].isEmpty) &#123;</span><br><span class="line">         jsCallbackMap = JSResponseModel.errorMap(message: <span class="string">'缺少 payType 参数'</span>);</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         MiniProgramPayBean payParams = MiniProgramPayBean.fromJson(map);</span><br><span class="line">         <span class="built_in">bool</span> isSuccess = <span class="keyword">false</span>;</span><br><span class="line">         <span class="keyword">if</span> (map[<span class="string">'payType'</span>] == <span class="string">'wx_mp'</span>) &#123;</span><br><span class="line">           isSuccess = <span class="keyword">await</span> WXMPPay.jumpWechatMP2Pay(payParams);</span><br><span class="line">         &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           isSuccess = <span class="keyword">await</span> WXMPPay.jumpWechatMP2Pay(payParams);</span><br><span class="line">         &#125;</span><br><span class="line">         jsCallbackMap = JSResponseModel.successMap(isSuccess: isSuccess);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="built_in">String</span>? jsMethodName = map[<span class="string">"callbackMethod"</span>];</span><br><span class="line">       <span class="keyword">if</span> (jsMethodName == <span class="keyword">null</span>) &#123;</span><br><span class="line">         WebViewController? webViewController = webViewControllerGetBlock();</span><br><span class="line">         WebViewWays.runJavaScriptMap(</span><br><span class="line">           jsMethodName!,</span><br><span class="line">           params: jsCallbackMap,</span><br><span class="line">           controller: webViewController,</span><br><span class="line">         );</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;,</span><br><span class="line">   );</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h2 id="三、测试JS的JS接口"><a href="#三、测试JS的JS接口" class="headerlink" title="三、测试JS的JS接口"></a>三、测试JS的JS接口</h2><table>
<thead>
<tr>
<th>描述</th>
<th>JS方法</th>
<th>其他</th>
</tr>
</thead>
<tbody>
<tr>
<td>测试 h5 调用 app 方法，并将返回值回调给 h5</td>
<td>h5CallBridgeAction_test_h5CallAppAndCallBackToH5</td>
<td></td>
</tr>
<tr>
<td>测试浏览器中的链接显示，且链接可打开app的_原生页面</td>
<td>h5CallBridgeAction_test_openBrowser</td>
<td></td>
</tr>
<tr>
<td>原生调用h5提供的显示回传值的方法</td>
<td>bridgeCallH5Action_showCallbackJsonString</td>
</tr>
</tbody>
</table>
<h2 id="四、公共的JS接口"><a href="#四、公共的JS接口" class="headerlink" title="四、公共的JS接口"></a>四、公共的JS接口</h2><h3 id="1、app设备相关"><a href="#1、app设备相关" class="headerlink" title="1、app设备相关"></a>1、app设备相关</h3><table>
<thead>
<tr>
<th>描述</th>
<th>JS方法</th>
<th>其他</th>
</tr>
</thead>
<tbody>
<tr>
<td><del>获取app的公共信息，并将返回值回调给 h5</del></td>
<td><del>h5CallBridgeAction_getFixedAppInfo</del></td>
<td>改用user-agent</td>
</tr>
<tr>
<td>获取埋点monitor的公共信息，并将返回值回调给 h5</td>
<td>h5CallBridgeAction_getFixedMonitorInfo</td>
<td></td>
</tr>
<tr>
<td>更新状态栏颜色</td>
<td>h5CallBridgeAction_updateAppStatusBarStyle</td>
<td></td>
</tr>
<tr>
<td>是否是模拟器</td>
<td>h5CallBridgeAction_isSimulator</td>
</tr>
</tbody>
</table>
<h3 id="2、用户相关"><a href="#2、用户相关" class="headerlink" title="2、用户相关"></a>2、用户相关</h3><table>
<thead>
<tr>
<th>描述</th>
<th>JS方法</th>
<th>其他</th>
</tr>
</thead>
<tbody>
<tr>
<td>获取用户token(用于安全的告知h5用户信息)，并将返回值回调给 h5</td>
<td>h5CallBridgeAction_getCurrentUserToken</td>
<td></td>
</tr>
<tr>
<td>退出登录</td>
<td>h5CallBridgeAction_logout</td>
</tr>
</tbody>
</table>
<h3 id="3、基础提示相关"><a href="#3、基础提示相关" class="headerlink" title="3、基础提示相关"></a>3、基础提示相关</h3><table>
<thead>
<tr>
<th>描述</th>
<th>JS方法</th>
<th>其他</th>
</tr>
</thead>
<tbody>
<tr>
<td>显示app的toast样式</td>
<td>h5CallBridgeAction_showAppToast</td>
</tr>
</tbody>
</table>
<h3 id="4、路由相关"><a href="#4、路由相关" class="headerlink" title="4、路由相关"></a>4、路由相关</h3><table>
<thead>
<tr>
<th>描述</th>
<th>JS方法</th>
<th>其他</th>
</tr>
</thead>
<tbody>
<tr>
<td>跳转到app指定页面_Url</td>
<td>h5CallBridgeAction_jumpAppPageUrl</td>
<td></td>
</tr>
<tr>
<td>跳转到app指定页面_Name</td>
<td>h5CallBridgeAction_jumpAppPageName</td>
</tr>
</tbody>
</table>
<h3 id="5、分享相关"><a href="#5、分享相关" class="headerlink" title="5、分享相关"></a>5、分享相关</h3><table>
<thead>
<tr>
<th>描述</th>
<th>JS方法</th>
<th>其他</th>
</tr>
</thead>
<tbody>
<tr>
<td>分享内容到指定的分享方式(微信聊天页面等)</td>
<td>h5CallBridgeAction_share</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="6、网页相关"><a href="#6、网页相关" class="headerlink" title="6、网页相关"></a>6、网页相关</h3><table>
<thead>
<tr>
<th>描述</th>
<th>JS方法</th>
<th>其他</th>
</tr>
</thead>
<tbody>
<tr>
<td>刷新网页(到新地址)</td>
<td>h5CallBridgeAction_reloadAppWebView</td>
<td></td>
</tr>
<tr>
<td>关闭webview</td>
<td>h5CallBridgeAction_closeWebView</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="五、业务相关的JS接口"><a href="#五、业务相关的JS接口" class="headerlink" title="五、业务相关的JS接口"></a>五、业务相关的JS接口</h2><table>
<thead>
<tr>
<th>入参</th>
<th>JS方法</th>
<th>其他</th>
</tr>
</thead>
<tbody>
<tr>
<td>发送IM的各种信息</td>
<td>h5CallBridgeAction_sendIMText</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="六、JS安全"><a href="#六、JS安全" class="headerlink" title="六、JS安全"></a>六、JS安全</h2><p><a name="JSResponseModel代码示例"></a></p>
<h2 id="附1：JSResponseModel代码示例"><a href="#附1：JSResponseModel代码示例" class="headerlink" title="附1：JSResponseModel代码示例"></a>附1：<code>JSResponseModel</code>代码示例</h2><p>class JSResponseModel 示例：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// h5CallBridge_responseModel.dart</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JSResponseModel</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">int</span> resultCode;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span>? message;</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">dynamic</span> result;</span><br><span class="line"></span><br><span class="line">  JSResponseModel(&#123;</span><br><span class="line">    <span class="keyword">this</span>.resultCode = <span class="number">0</span>,</span><br><span class="line">    <span class="keyword">this</span>.message,</span><br><span class="line">    <span class="keyword">this</span>.result,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// js默认的map（默认是成功）</span></span><br><span class="line">  <span class="keyword">static</span> <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="keyword">dynamic</span>&gt; initMap(&#123;</span><br><span class="line">    <span class="built_in">String</span>? message,</span><br><span class="line">  &#125;) &#123;</span><br><span class="line">    <span class="keyword">return</span> JSResponseModel(</span><br><span class="line">      resultCode: <span class="number">0</span>,</span><br><span class="line">    ).toMap();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// js失败时候的map</span></span><br><span class="line">  <span class="keyword">static</span> <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="keyword">dynamic</span>&gt; errorMap(&#123;</span><br><span class="line">    <span class="built_in">String</span>? message,</span><br><span class="line">  &#125;) &#123;</span><br><span class="line">    <span class="keyword">return</span> JSResponseModel(resultCode: <span class="number">1</span>, message: message).toMap();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// js成功时候的map</span></span><br><span class="line">  <span class="keyword">static</span> <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="keyword">dynamic</span>&gt; successMap(&#123;</span><br><span class="line">    required <span class="built_in">bool</span> isSuccess,</span><br><span class="line">    <span class="keyword">dynamic</span> result,</span><br><span class="line">  &#125;) &#123;</span><br><span class="line">    <span class="keyword">return</span> JSResponseModel(</span><br><span class="line">      resultCode: isSuccess ? <span class="number">1</span> : <span class="number">0</span>,</span><br><span class="line">      result: result,</span><br><span class="line">    ).toMap();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Model 转 map 以回传结果给h5</span></span><br><span class="line">  <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="keyword">dynamic</span>&gt; toMap() &#123;</span><br><span class="line">    <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="keyword">dynamic</span>&gt; responseMap = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    responseMap.addAll(&#123;<span class="string">"resultCode"</span>: resultCode&#125;);</span><br><span class="line">    <span class="keyword">if</span> (message != <span class="keyword">null</span>) &#123;</span><br><span class="line">      responseMap.addAll(&#123;<span class="string">"message"</span>: message&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (result != <span class="keyword">null</span>) &#123;</span><br><span class="line">      responseMap.addAll(&#123;<span class="string">"result"</span>: result&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> responseMap;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">bool</span> <span class="keyword">get</span> isSuccess =&gt; resultCode == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="End"><a href="#End" class="headerlink" title="End"></a>End</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://dvlproad.github.io/Architecture架构/基础规范/请求规范_JS/" data-id="cm2noo90v007eovr4skphiedo" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Architecture/">Architecture</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/请求/">请求</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Architecture架构/基础规范/请求规范" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/Architecture架构/基础规范/请求规范/" class="article-date">
  <time datetime="2024-04-29T09:05:41.000Z" itemprop="datePublished">2024-04-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Architecture/">Architecture</a>►<a class="article-category-link" href="/categories/Architecture/第三章：基础规范/">第三章：基础规范</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Architecture架构/基础规范/请求规范/">请求规范</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[toc]</p>
<h2 id="一、各种示例"><a href="#一、各种示例" class="headerlink" title="一、各种示例"></a>一、各种示例</h2><h3 id="1、request的HEADER公共入参-固定-可变的-示例"><a href="#1、request的HEADER公共入参-固定-可变的-示例" class="headerlink" title="1、request的HEADER公共入参(固定+可变的)示例"></a>1、request的HEADER公共入参(固定+可变的)示例</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- HEADER(REQUEST):</span><br><span class="line">&#123;</span><br><span class="line"> <span class="attr">"version"</span>:<span class="string">"1.16.30"</span>,</span><br><span class="line"> <span class="attr">"buildNumber"</span>:<span class="string">"16301610"</span>,</span><br><span class="line"> <span class="attr">"platform"</span>:<span class="string">"iOS"</span>,</span><br><span class="line"> <span class="attr">"appType"</span>:<span class="string">"monkey"</span>,</span><br><span class="line"> <span class="attr">"appFeatureType"</span>:<span class="string">"dev"</span>,</span><br><span class="line"> <span class="attr">"packageChannel"</span>:<span class="string">"general"</span>,</span><br><span class="line"> <span class="attr">"trace_id"</span>:<span class="string">"1683158692451101/2023-05-04 08:04:52/_sy_]onw^w^"</span>,</span><br><span class="line"> <span class="attr">"Authorization"</span>:<span class="string">"bearer clientApp247deea3-da67-47bc-94f7-04b83ca0fb07"</span>,</span><br><span class="line"> <span class="attr">"content-type"</span>:<span class="string">"application/json"</span>,</span><br><span class="line"> <span class="attr">"content-length"</span>:<span class="string">"28"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>参数详情介绍见下文《公共入参介绍》。</p>
<h3 id="2、request的BODY公共入参-固定-可变的-示例"><a href="#2、request的BODY公共入参-固定-可变的-示例" class="headerlink" title="2、request的BODY公共入参(固定+可变的)示例"></a>2、request的BODY公共入参(固定+可变的)示例</h3><p>示例可详见 <a href="埋点相关/埋点规范_结构">《埋点规范》–【埋点入参】–固定的公共入参</a> 。附：其实改部分也可考虑放在HEADER中</p>
<h3 id="3、response的返回结构示例"><a href="#3、response的返回结构示例" class="headerlink" title="3、response的返回结构示例"></a>3、response的返回结构示例</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"status"</span>: <span class="number">200</span>,</span><br><span class="line">  <span class="attr">"message"</span>: <span class="string">"请求成功，但是业务处理失败"</span>,</span><br><span class="line">  <span class="attr">"errorCode"</span>: <span class="number">1001</span>,</span><br><span class="line">  <span class="attr">"errorMessage"</span>: <span class="string">"参数name不能为空"</span>,</span><br><span class="line">  <span class="attr">"data"</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">"timestamp"</span>: <span class="string">"2023-05-04T09:00:00Z"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="二、设置request的HEADER公共入参-固定不变7个-可变N个"><a href="#二、设置request的HEADER公共入参-固定不变7个-可变N个" class="headerlink" title="二、设置request的HEADER公共入参(固定不变7个+可变N个)"></a>二、设置request的HEADER公共入参(固定不变7个+可变N个)</h2><p>网络库初始化所需的header参数</p>
<table>
<thead>
<tr>
<th>header形参</th>
<th>header形参名</th>
<th>描述</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>必填 Map</td>
<td>headerCommonFixParams</td>
<td>header 中公共但【不变】的参数</td>
<td>如上</td>
</tr>
<tr>
<td>可选 block</td>
<td>headerCommonChangeParamsGetBlock</td>
<td>header 中公共但【会变】的参数</td>
<td>{ ‘trace_id’: TraceUtil.traceId() }</td>
</tr>
<tr>
<td>可空 String</td>
<td>headerAuthorization</td>
<td>header 中公共但会变的参数</td>
</tr>
</tbody>
</table>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1、初始化网络库的时候定义</span></span><br><span class="line">required <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="keyword">dynamic</span>&gt; headerCommonFixParams, <span class="comment">// header 中公共但不变的参数</span></span><br><span class="line"><span class="built_in">String</span>? headerAuthorization, <span class="comment">// header 中公共但【基本不会变】的参数--Authorization</span></span><br><span class="line">  <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="keyword">dynamic</span>&gt; <span class="built_in">Function</span>()? headerCommonChangeParamsGetBlock, <span class="comment">// header 中公共但会变的参数</span></span><br><span class="line"><span class="comment">// 示例:</span></span><br><span class="line">headerCommonChangeParamsGetBlock: () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="string">'trace_id'</span>: TraceUtil.traceId(),</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line"><span class="comment">// 1.2、初始化网络库的时候使用 headerCommonFixParams</span></span><br><span class="line"><span class="comment">// headers 的所有参数处理</span></span><br><span class="line"><span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="keyword">dynamic</span>&gt; headers = &#123;&#125;;</span><br><span class="line"><span class="comment">// ① header 中公共但【固定不变】的参数</span></span><br><span class="line">  headers.addAll(headerCommonFixParams);</span><br><span class="line"><span class="comment">// ② header 中公共但【基本不会变】的参数--Authorization--策略：因为这只是一次性取值，后面的没法自动变化，需要调用update接口</span></span><br><span class="line">  <span class="keyword">if</span> (headerAuthorization != <span class="keyword">null</span> &amp;&amp; headerAuthorization.isNotEmpty) &#123;</span><br><span class="line">    headers.addAll(&#123;<span class="string">'Authorization'</span>: headerAuthorization&#125;);</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// 将 header 参数设置到网络单例中</span></span><br><span class="line">dio!.options = dio!.options.copyWith(</span><br><span class="line">    baseUrl: baseUrl,</span><br><span class="line">    connectTimeout: connectTimeout,</span><br><span class="line">    receiveTimeout: receiveTimeout,</span><br><span class="line">    contentType: contentType,</span><br><span class="line">    headers: headers,</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、具体发起网络请求里进行: headers 的所有参数处理</span></span><br><span class="line"><span class="keyword">if</span> (options.headers != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (optionsHeaderCommonChangeParamsGetBlock != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="keyword">dynamic</span>&gt; customHeaders =</span><br><span class="line">            optionsHeaderCommonChangeParamsGetBlock();</span><br><span class="line">        options.headers!.addAll(customHeaders);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="1、【固定的】公共请求参数-headerCommonFixParams-7个"><a href="#1、【固定的】公共请求参数-headerCommonFixParams-7个" class="headerlink" title="1、【固定的】公共请求参数 headerCommonFixParams(7个)"></a>1、【固定的】公共请求参数 headerCommonFixParams(7个)</h3><p>获取方法形如：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">headerCommonFixParams: <span class="keyword">await</span> CommonParamsHelper.commonHeaderParams(</span><br><span class="line">    appFeatureType: appFeatureType,</span><br><span class="line">    channel: channelName,</span><br><span class="line">  );</span><br></pre></td></tr></table></figure>
<p>参数介绍如下：</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>类型</th>
<th>字段</th>
<th>值示例</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>平台系统</td>
<td>platform</td>
<td>iOS/Android</td>
<td></td>
</tr>
<tr>
<td>2</td>
<td>app的唯一标识</td>
<td>appType</td>
<td></td>
<td>区分出同一公司的多个app</td>
</tr>
<tr>
<td>3</td>
<td>版本号（1.月.日）</td>
<td>version</td>
<td>1.04.30</td>
<td></td>
</tr>
<tr>
<td>4</td>
<td>版本编译号（月日时分）<br>安卓隔年需加+12</td>
<td>buildNumber</td>
<td>04301610</td>
<td></td>
</tr>
<tr>
<td>5</td>
<td>功能类型</td>
<td>appFeatureType</td>
<td>dev、inner、formal</td>
<td>区分出内测、正式功能</td>
</tr>
<tr>
<td>6</td>
<td>渠道</td>
<td>packageChannel</td>
<td>appstore</td>
<td></td>
</tr>
<tr>
<td>7</td>
<td>唯一设备码</td>
<td>deviceId</td>
<td></td>
<td>未登录时的关闭检查更新</td>
</tr>
</tbody>
</table>
<h4 id="1-1、平台-iOS-Android"><a href="#1-1、平台-iOS-Android" class="headerlink" title="1.1、平台(iOS/Android)"></a>1.1、平台(iOS/Android)</h4><h4 id="1-2、app类型-同一公司多个app-App的唯一标识"><a href="#1-2、app类型-同一公司多个app-App的唯一标识" class="headerlink" title="1.2、app类型(同一公司多个app)/App的唯一标识"></a>1.2、app类型(同一公司多个app)/App的唯一标识</h4><h4 id="1-3、版本号（1-月-日）"><a href="#1-3、版本号（1-月-日）" class="headerlink" title="1.3、版本号（1.月.日）"></a>1.3、版本号（1.月.日）</h4><h4 id="1-4、版本编译号（月日时分）"><a href="#1-4、版本编译号（月日时分）" class="headerlink" title="1.4、版本编译号（月日时分）"></a>1.4、版本编译号（月日时分）</h4><h4 id="1-5、功能类型-蒲公英dev、内测inner、正式formal"><a href="#1-5、功能类型-蒲公英dev、内测inner、正式formal" class="headerlink" title="1.5、功能类型(蒲公英dev、内测inner、正式formal)"></a>1.5、功能类型(蒲公英dev、内测inner、正式formal)</h4><h4 id="1-6、渠道"><a href="#1-6、渠道" class="headerlink" title="1.6、渠道"></a>1.6、渠道</h4><table>
<thead>
<tr>
<th>平台</th>
<th>应用商店</th>
<th>渠道名</th>
</tr>
</thead>
<tbody>
<tr>
<td>iOS</td>
<td>App Store</td>
<td>general</td>
</tr>
<tr>
<td>Android</td>
<td>华为应用市场</td>
<td>huawei</td>
</tr>
<tr>
<td>Android</td>
<td>小米应用商店</td>
<td>Xiaomi</td>
</tr>
<tr>
<td>Android</td>
<td>Vivo应用商店</td>
<td>vivo</td>
</tr>
<tr>
<td>Android</td>
<td>ColorOS应用商店</td>
<td>oppo</td>
</tr>
<tr>
<td>Android</td>
<td>应用宝</td>
<td>yingyongbao</td>
</tr>
<tr>
<td>Android</td>
<td>360手机助手</td>
<td>360</td>
</tr>
<tr>
<td>Android</td>
<td>百度手机助手</td>
<td>baidu</td>
</tr>
<tr>
<td>Android</td>
<td>酷安应用市场</td>
<td>kuan</td>
</tr>
<tr>
<td>Android</td>
<td>阿里应用市场</td>
<td>alibaba</td>
</tr>
<tr>
<td>Android</td>
<td>官网包</td>
<td>general</td>
</tr>
</tbody>
</table>
<h4 id="1-7、DeviceId-唯一设备码"><a href="#1-7、DeviceId-唯一设备码" class="headerlink" title="1.7、DeviceId 唯一设备码"></a>1.7、DeviceId 唯一设备码</h4><p>Android 端主要取 Android ID </p>
<p>iOS 端先尝试获取 IDFA，如果获取不到，则取 IDFV</p>
<h3 id="2、【变化的】公共请求参数-headerCommonChangeParamsGetBlock"><a href="#2、【变化的】公共请求参数-headerCommonChangeParamsGetBlock" class="headerlink" title="2、【变化的】公共请求参数 headerCommonChangeParamsGetBlock"></a>2、【变化的】公共请求参数 headerCommonChangeParamsGetBlock</h3><p>获取方法形如：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">headerCommonChangeParamsGetBlock: () &#123;</span><br><span class="line">     <span class="keyword">return</span> &#123;</span><br><span class="line">       <span class="string">'trace_id'</span>: TraceUtil.traceId(),</span><br><span class="line">       <span class="string">'Authorization'</span>: headerAuthorization,</span><br><span class="line">     &#125;;</span><br><span class="line">   &#125;,</span><br></pre></td></tr></table></figure>
<p>参数介绍如下：</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>类型</th>
<th>字段</th>
<th>值示例</th>
<th>其他</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>用户token</td>
<td>Authorization</td>
<td>bearer clientApp247deea3-da67-47bc-94f7-04b83ca0fb07</td>
<td></td>
</tr>
<tr>
<td>2</td>
<td>跟踪id</td>
<td>trace_id</td>
<td>1683158692451101/2023-05-04 08:04:52/_sy_]onw^w^</td>
</tr>
</tbody>
</table>
<h4 id="2-1、用户-Authorization"><a href="#2-1、用户-Authorization" class="headerlink" title="2.1、用户 Authorization"></a>2.1、用户 Authorization</h4><p>该值为登录时候，后台接口返回。且需要在用户状态变更的时候同步更新。</p>
<h4 id="2-2、跟踪-trace-id"><a href="#2-2、跟踪-trace-id" class="headerlink" title="2.2、跟踪 trace_id"></a>2.2、跟踪 trace_id</h4><p>组成部分：时间戳/时间字符串/10位随机字符串</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'dart:math'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/foundation.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TraceUtil</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="built_in">String</span> traceId() &#123;</span><br><span class="line">    <span class="built_in">String</span> timeStamp = <span class="built_in">DateTime</span>.now().microsecondsSinceEpoch.toString();</span><br><span class="line">    <span class="built_in">String</span> timeString = <span class="built_in">DateTime</span>.now().toString().substring(<span class="number">0</span>, <span class="number">19</span>);</span><br><span class="line">    <span class="built_in">String</span> randomString = TraceUtil.generateRandomString(<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">String</span> traceId = <span class="string">"<span class="subst">$timeStamp</span>/<span class="subst">$timeString</span>/_<span class="subst">$randomString<span class="string">";</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">    return traceId;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">  &#125;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string"></span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">  // Declare a fucntion for reusable purpose</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">  static String generateRandomString(int len) &#123;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">    final _random = Random();</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">    final result = String.fromCharCodes(</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">        List.generate(len, (index) =&gt; _random.nextInt(33) + 89));</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">    return result;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">  &#125;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">&#125;</span></span></span></span><br></pre></td></tr></table></figure>
<h2 id="三、设置request的BODY公共入参-当不放header时候"><a href="#三、设置request的BODY公共入参-当不放header时候" class="headerlink" title="三、设置request的BODY公共入参(当不放header时候)"></a>三、设置request的BODY公共入参(当不放header时候)</h2><p>详见 <a href="./埋点规范">《埋点规范》–【埋点入参】–固定的公共入参</a> 其实可考虑放在HEADER中</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1、初始化网络库的时候定义</span></span><br><span class="line">  required <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="keyword">dynamic</span>&gt; bodyCommonFixParams, <span class="comment">// body 中公共但不变的参数</span></span><br><span class="line">  <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="keyword">dynamic</span>&gt; <span class="built_in">Function</span>()? bodyCommonChangeParamsGetBlock, <span class="comment">// body 中公共但会变的参数（一般可考虑放在header中）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、具体发起网络请求里进行: body 的所有参数处理</span></span><br><span class="line"><span class="comment">// ① body 中公共但不变的参数</span></span><br><span class="line"><span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="keyword">dynamic</span>&gt; allParams = <span class="built_in">Map</span>.from(_bodyCommonFixParams);</span><br><span class="line"><span class="comment">// ② body 中公共但会变的参数</span></span><br><span class="line">  <span class="keyword">if</span> (_bodyCommonChangeParamsGetBlock != <span class="keyword">null</span>) &#123;</span><br><span class="line">    allParams.addAll(_bodyCommonChangeParamsGetBlock!());</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// ③ body 中自定义的其他参数</span></span><br><span class="line">  <span class="keyword">if</span> (customParams != <span class="keyword">null</span> &amp;&amp; customParams.isNotEmpty) &#123;</span><br><span class="line">    allParams.addAll(customParams);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h2 id="四、response返回结构介绍"><a href="#四、response返回结构介绍" class="headerlink" title="四、response返回结构介绍"></a>四、response返回结构介绍</h2><p>为了准确判断业务是否成功，通常需要同时判断status和errorCode两个字段。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"status"</span>: <span class="number">200</span>,</span><br><span class="line">  <span class="attr">"message"</span>: <span class="string">"请求成功，但是业务处理失败"</span>,</span><br><span class="line">  <span class="attr">"errorCode"</span>: <span class="number">1001</span>,</span><br><span class="line">  <span class="attr">"errorMessage"</span>: <span class="string">"参数name不能为空"</span>,</span><br><span class="line">  <span class="attr">"data"</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">"timestamp"</span>: <span class="string">"2023-05-04T09:00:00Z"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>状态码（status code）：表示请求的处理结果，常见的状态码包括200（请求成功）、400（请求参数错误）、401（未授权）、403（禁止访问）、404（请求的资源不存在）等。</li>
<li>消息（message）：对请求处理结果的简要描述，可以用于前端展示错误信息或者提示。</li>
<li>数据（data）：请求处理成功后返回的数据，例如json格式的数据、图片、文件等。</li>
<li>时间戳（timestamp）：表示服务器处理请求的时间，可以用于前端调试和日志记录。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">if (response.status &gt;= 200 &amp;&amp; response.status &lt; 300) &#123;</span><br><span class="line">  // 请求成功，继续处理业务逻辑</span><br><span class="line">  if (response.errorCode) &#123;</span><br><span class="line">    // 业务逻辑处理失败，根据errorCode和errorMessage进行相应的处理</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    // 业务逻辑处理成功，根据data字段获取返回的数据</span><br><span class="line">  &#125;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">  // 请求失败，根据错误码和错误信息进行相应的处理</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="附1：不建议把status和errorCode用同一个字段表示"><a href="#附1：不建议把status和errorCode用同一个字段表示" class="headerlink" title="附1：不建议把status和errorCode用同一个字段表示"></a>附1：不建议把status和errorCode用同一个字段表示</h3><blockquote>
<p>将状态码（status code）和业务错误码（error code）合并成一个字段可能会带来一些问题，建议不要采用这种方法。</p>
<p>首先，将状态码和业务错误码合并在一个字段中会导致客户端处理逻辑复杂化。客户端需要在处理请求结果时先判断状态码，然后再解析业务错误码，这会增加客户端代码的复杂度，降低代码的可维护性。</p>
<p>其次，将状态码和业务错误码合并在一个字段中还会带来一些歧义。状态码是HTTP协议定义的标准字段，具有固定的含义，例如200表示请求成功，400表示请求参数错误，500表示服务器内部错误等。而业务错误码是根据具体业务定义的，具有一定的灵活性。将这两种含义合并在一起会导致状态码的含义变得模糊，不利于代码的可读性和维护性。</p>
<p>因此，建议在response结构中分别使用状态码和业务错误码两个字段来表示请求的处理结果。这样可以使客户端处理逻辑更加清晰，并且可以使状态码和业务错误码的含义保持清晰和统一。</p>
</blockquote>
<h2 id="五、埋点的入参"><a href="#五、埋点的入参" class="headerlink" title="五、埋点的入参"></a>五、埋点的入参</h2><p>详见<a href="./埋点规范">埋点规范</a></p>
<h2 id="五、请求接口的整理规范"><a href="#五、请求接口的整理规范" class="headerlink" title="五、请求接口的整理规范"></a>五、请求接口的整理规范</h2><p>背景：为了能够将请求接口的用途和页面关联起来。</p>
<p>目的：①便于省去后端频繁询问该页面该位置调用的是什么接口（虽然已有日志，但是仍有部分后端人员懒到不愿去自己排查）。</p>
<p>②完成前端依赖服务关系的梳理，并一直到后台各级服务-数据层。</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>参数</th>
<th>必填</th>
<th>描述与其目的 purpose</th>
<th>策略</th>
</tr>
</thead>
<tbody>
<tr>
<td>1.1</td>
<td>caller_page</td>
<td>必填</td>
<td>接口调用者(页面、管理器等)<br>①多页面调用接口：告知后台，以对业务进行逻辑区分处理<br>②日志使用：方便查看与统计每个页面调用的接口</td>
<td>可全局记录获当前页面<br>eg: goods_detail_page</td>
</tr>
<tr>
<td>1.2</td>
<td>caller_view</td>
<td>可空</td>
<td>接口调用者(视图)<br>同上(有时候一个page下有多个tab)</td>
<td>必须请求单独设置<br>eg: sku_choose_window</td>
</tr>
<tr>
<td>2</td>
<td>caller_times</td>
<td>必填</td>
<td>调用场景<br>①页面打开：open_page<br>②页面输入：input<br>②页面点击：click</td>
<td>open_page\</td>
<td>input\</td>
<td>click</td>
</tr>
<tr>
<td>3</td>
<td>purpose</td>
<td>必填</td>
<td>接口用途中文<br>①日志使用：便于快速/直接筛选出问题根源接口</td>
<td>eg: 商品搜索</td>
</tr>
<tr>
<td>4</td>
<td>byApper</td>
<td>必填</td>
<td>前台具体开发者的id</td>
<td>eg：byQian</td>
</tr>
<tr>
<td>5</td>
<td>byApier</td>
<td>必填</td>
<td>后端具体开发者的id</td>
<td>eg：byApier2</td>
</tr>
</tbody>
</table>
<p>方案：</p>
<p>将 purpose 添加到 body 的参数中</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_params.addPurpose(caller_page: <span class="string">"商城页"</span>, caller_time:open_page|click, purpose: <span class="string">"商品搜索"</span>).byQian.byApier2;</span><br></pre></td></tr></table></figure>
<p>请求接口的整理产出效果示例如下：</p>
<blockquote>
<p><img src="/Architecture架构/基础规范/请求规范/请求接口整理.png" alt="请求接口整理"></p>
<p>该图来源于脑图： <a href="./请求规范/请求接口的整理规范.xmind">请求接口的整理规范.xmind</a></p>
</blockquote>
<p>附：多处页面调用的公共接口提取出，描述在页面中调用的公共接口的部分添加颜色或者其他标记来标识使用的是哪个部分的公共接口。</p>
<h2 id="六、网络库的加强"><a href="#六、网络库的加强" class="headerlink" title="六、网络库的加强"></a>六、网络库的加强</h2><h3 id="1、网络日志加强"><a href="#1、网络日志加强" class="headerlink" title="1、网络日志加强"></a>1、网络日志加强</h3><p>目的：查看日志的时候能清晰的知道接口的中文含义，以及调用其的页面或者其他类或实例。</p>
<p>方法：每个接口请求时候添加对应页面。</p>
<h3 id="2、网络时长统计"><a href="#2、网络时长统计" class="headerlink" title="2、网络时长统计"></a>2、网络时长统计</h3><p>目的：统计加载每个页面的过程中，所消耗的网络时长。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">NetworkUtil.requestApi1(caller:aPage, belongLoadPage:<span class="keyword">true</span>)</span><br><span class="line">  </span><br><span class="line">requestUrl(caller, belongLoadPage) &#123;</span><br><span class="line">  <span class="keyword">if</span> (belongLoadPage != <span class="keyword">true</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  PageRequestManager.</span><br><span class="line">  map[caller][<span class="string">"apiStartCount"</span>] = map[caller][<span class="string">"apiStartCount"</span>] + <span class="number">1</span></span><br><span class="line">  dio.request(&#123;</span><br><span class="line">    url: url,</span><br><span class="line">    completeCallback: () &#123;</span><br><span class="line">      <span class="built_in">int</span> callerApiStartCount = map[caller][<span class="string">"apiStartCount"</span>];</span><br><span class="line">      <span class="built_in">int</span> callerApiEndCount = map[caller][<span class="string">"apiEndCount"</span>];</span><br><span class="line">      callerApiEndCount++;</span><br><span class="line">      map[caller][<span class="string">"apiEndCount"</span>] = callerApiEndCount;</span><br><span class="line">      <span class="keyword">if</span> (callerApiEndCount == callerApiStartCount) &#123;</span><br><span class="line">        _pageLoadingEnd();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"> 	); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="End"><a href="#End" class="headerlink" title="End"></a>End</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://dvlproad.github.io/Architecture架构/基础规范/请求规范/" data-id="cm2noo90w007hovr4e9n8cozk" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Architecture/">Architecture</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/请求/">请求</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Architecture架构/高质量妙用/妙用注解" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/Architecture架构/高质量妙用/妙用注解/" class="article-date">
  <time datetime="2024-04-20T09:05:42.000Z" itemprop="datePublished">2024-04-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Architecture/">Architecture</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Architecture架构/高质量妙用/妙用注解/">妙用注解</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[toc]</p>
<h1 id="妙用注解"><a href="#妙用注解" class="headerlink" title="妙用注解"></a>妙用注解</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><h2 id="一、-为什么要使用注解开发"><a href="#一、-为什么要使用注解开发" class="headerlink" title="一、 为什么要使用注解开发"></a>一、 为什么要使用注解开发</h2><p>在日常开发过程中，我们经常会面临以下挑战：大量重复的模板代码、臃肿的代码降低可读性，以及JSON序列化和反序列化问题。为应对这些问题，各种编程语言都有自己的解决方案。在Dart语言中，采用了注解这一高效手段来解决这些问题。</p>
<p>注解就像是一把神奇的钥匙，为我们解锁了许多高效开发的大门。以下是使用注解的一些原因：</p>
<ol>
<li>自动生成代码：注解就像会魔法的小精灵，能够在编译时自动生成代码，减轻了我们手动编写重复代码的负担，让开发变得更加轻松。</li>
<li>简化代码：注解可以减少重复代码，提高代码质量。</li>
<li>提高可读性：注解可以将元数据与实际代码分离，使代码更易于理解。</li>
<li>扩展功能：通过注解和注解处理器，我们可以在编译时执行一些额外操作，例如代码检查、代码优化等</li>
</ol>
<h2 id="二、什么是注解？"><a href="#二、什么是注解？" class="headerlink" title="二、什么是注解？"></a>二、什么是注解？</h2><p><strong>注解（Annotation）是一种编程语言特性，它不属于特定的架构或框架，而是可以在多种编程语言和开发框架中使用的一种工具。注解提供了一种方式，允许开发者在代码中添加元数据，这些元数据可以由编译器、运行时环境或其他工具在不同阶段使用。</strong></p>
<p>在Dart语言中，注解是一种特殊的语法，用于在编译时或运行时向代码添加额外的元数据。注解以<code>@</code>符号开头，后跟一个编译时常量表达式。这种元数据可以用于指导工具（如静态分析器、编译器和构建器）执行特定操作，例如代码生成、静态检查和优化。注解不会影响程序的执行过程，但可以在编译时或运行时被工具和库访问，以实现各种目的。</p>
<h2 id="三、注解实践：使用注解为每个页面类添加页面描述信息，埋点中经常需要"><a href="#三、注解实践：使用注解为每个页面类添加页面描述信息，埋点中经常需要" class="headerlink" title="三、注解实践：使用注解为每个页面类添加页面描述信息，埋点中经常需要"></a>三、注解实践：使用注解为每个页面类添加页面描述信息，埋点中经常需要</h2><h3 id="1、iOS：使用宏定义实现注解"><a href="#1、iOS：使用宏定义实现注解" class="headerlink" title="1、iOS：使用宏定义实现注解"></a>1、iOS：使用<code>宏定义</code>实现注解</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">// 定义宏，用于创建页面信息注解</span><br><span class="line">#define CreatePageInfoAnnotation(pageClass, pageKey, pageDes) \</span><br><span class="line">@interface pageClass (PageInfo) \</span><br><span class="line">@property (nonatomic, readonly) NSString *pageKey; \</span><br><span class="line">@property (nonatomic, readonly) NSString *pageDescription; \</span><br><span class="line">@end \</span><br><span class="line">@implementation pageClass (PageInfo) \</span><br><span class="line">- (NSString *)pageKey &#123; \</span><br><span class="line">    return pageKey; \</span><br><span class="line">&#125; \</span><br><span class="line">- (NSString *)pageDescription &#123; \</span><br><span class="line">    return pageDes; \</span><br><span class="line">&#125; \</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// LoginViewController.m</span><br><span class="line">@PageInfoAnnotation(LoginViewController, @&quot;login_page&quot;, @&quot;登录页面&quot;)	// 调用宏，为类添加注解</span><br><span class="line">@implementation LoginViewController</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<h3 id="2、Flutter：使用source-gen库生成文件实现注解"><a href="#2、Flutter：使用source-gen库生成文件实现注解" class="headerlink" title="2、Flutter：使用source_gen库生成文件实现注解"></a>2、Flutter：使用<code>source_gen库</code>生成文件实现注解</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// page_info_generator.dart</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:source_gen/source_gen.dart'</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestGenerator</span> <span class="keyword">extends</span> <span class="title">GeneratorForAnnotation</span>&lt;<span class="title">CJPageInfoMetadata</span>&gt; </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">String</span>? generateForAnnotatedElement(<span class="built_in">Element</span> element, ConstantReader annotation, BuildStep buildStep) &#123;</span><br><span class="line">    <span class="built_in">String</span> className = element.name;</span><br><span class="line">    <span class="built_in">String</span>? pageKey = annotation.read(<span class="string">"pageKey"</span>);</span><br><span class="line">    <span class="built_in">String</span>? pageDesc = annotation.read(<span class="string">"pageDesc"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"""</span></span><br><span class="line"><span class="string">      extension <span class="subst">$&#123;className&#125;</span>APTExtension on <span class="subst">$&#123;className&#125;</span> &#123;</span></span><br><span class="line"><span class="string">      	String? apt_pageKey() &#123;</span></span><br><span class="line"><span class="string">      		return <span class="subst">$&#123;pageKey&#125;</span>;</span></span><br><span class="line"><span class="string">      	&#125;</span></span><br><span class="line"><span class="string">      	String? apt_pageDesc() &#123;</span></span><br><span class="line"><span class="string">      		return <span class="subst">$&#123;pageDesc&#125;</span>;</span></span><br><span class="line"><span class="string">      	&#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      """</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TestModel.dart</span></span><br><span class="line"><span class="meta">@CJPageInfoMetadata</span>(<span class="string">"我是页面描述"</span>, <span class="string">'home_page'</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestModel</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 属性</span></span><br><span class="line">  <span class="built_in">int</span> age;</span><br><span class="line">  <span class="built_in">int</span> bookNum;</span><br><span class="line">	</span><br><span class="line">  <span class="comment">// 方法</span></span><br><span class="line">  <span class="keyword">void</span> fun1() &#123;&#125;</span><br><span class="line">  <span class="keyword">void</span> fun2(<span class="built_in">int</span> a) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果就会生成一堆dart文件。</p>
<h2 id="四、进入页面前的登录判断"><a href="#四、进入页面前的登录判断" class="headerlink" title="四、进入页面前的登录判断"></a>四、进入页面前的登录判断</h2><p>其他参考文章：<a href="https://blog.csdn.net/qq_25303213/article/details/126891328" target="_blank" rel="noopener">自定义iOS注解</a></p>
<h3 id="1、最差做法"><a href="#1、最差做法" class="headerlink" title="1、最差做法"></a>1、最差做法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// HomeViewController.m</span><br><span class="line">- (void)goMineHomePage &#123;</span><br><span class="line">  // 进入个人主页前，需要先判断是否登录</span><br><span class="line">	if (!UserManager.isLogin) &#123;</span><br><span class="line">    LoginViewController *viewController = [[MineHomeViewController alloc] init];</span><br><span class="line">		[self.navigationController pushViewController:viewController animated:YES];</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	MineHomeViewController *viewController = [[MineHomeViewController alloc] init];</span><br><span class="line">	[self.navigationController pushViewController:viewController animated:YES];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2、统一到路由中优化：在路由中拦截-拦截器-可选"><a href="#2、统一到路由中优化：在路由中拦截-拦截器-可选" class="headerlink" title="2、统一到路由中优化：在路由中拦截+拦截器(可选)"></a>2、统一到路由中优化：在路由中拦截+拦截器(可选)</h3><p>所有跳转使用 RouterManger，在RouterManager中限制未登录允许的页面。</p>
<h4 id="2-1、常规路由"><a href="#2-1、常规路由" class="headerlink" title="2.1、常规路由"></a>2.1、常规路由</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// HomeViewController.m</span><br><span class="line">- (void)goMineHomePage &#123;</span><br><span class="line">  [RouterManger push:RouterNames.mine_home_page argument:nil];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// RouterManger.m</span><br><span class="line">- (void)push:(String *)pageName argument:(NSDictionary *)argument &#123;</span><br><span class="line">	if (!UserManager.isLogin) &#123;	// 进入个人主页前，需要先判断是否登录</span><br><span class="line">    if ([RouterNames.mine_home_page].contains(pageName)) &#123;</span><br><span class="line">      LoginViewController *viewController = [[MineHomeViewController alloc] init];</span><br><span class="line">			[topVC pushViewController:viewController animated:YES];</span><br><span class="line">      return;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  getVCHandle = [HandleManager.handleMap objectForKey:pageName];</span><br><span class="line">  UIViewController *viewController = getVCHandle(argument:argument);</span><br><span class="line">  [topVC pushViewController:viewController animated:YES];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-2、优化路由，引进拦截器：对路由中的跳转进行改进，使用拦截器"><a href="#2-2、优化路由，引进拦截器：对路由中的跳转进行改进，使用拦截器" class="headerlink" title="2.2、优化路由，引进拦截器：对路由中的跳转进行改进，使用拦截器"></a>2.2、优化路由，引进拦截器：对路由中的跳转进行改进，使用拦截器</h4><p>改进后的代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">// HomeViewController.m</span><br><span class="line">- (void)goMineHomePage &#123;</span><br><span class="line">  [RouterManger push:RouterNames.mine_home_page argument:nil];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// RouterManger.m 优化为拦截器</span><br><span class="line">- (void)push:(String *)pageName argument:(NSDictionary *)argument &#123;</span><br><span class="line">  for (var interceptor in interceptors) &#123;</span><br><span class="line">  	bool canPush = [interceptor canPushPageName:pageName arguments: arguments];</span><br><span class="line">    if (!canPush) return;</span><br><span class="line">  &#125;</span><br><span class="line">    </span><br><span class="line">  getVCHandle = [HandleManager.handleMap objectForKey:pageName];</span><br><span class="line">  UIViewController *viewController = getVCHandle(argument:argument);</span><br><span class="line">  [topVC pushViewController:viewController animated:YES];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// LoginInterceptor.m</span><br><span class="line">- (BOOL)canPushPageName:(NSString *)pageName arguments:(NSDictionary *)arguments &#123;</span><br><span class="line">  if (!UserManager.isLogin) &#123;	// 进入个人主页前，需要先判断是否登录</span><br><span class="line">    if ([RouterNames.mine_home_page].contains(pageName)) &#123;</span><br><span class="line">      LoginViewController *viewController = [[MineHomeViewController alloc] init];</span><br><span class="line">			[topVC pushViewController:viewController animated:YES];</span><br><span class="line">      return NO;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  return YES;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3、在调用原始方法之前插入额外的执行逻辑（不推荐，不使用）"><a href="#3、在调用原始方法之前插入额外的执行逻辑（不推荐，不使用）" class="headerlink" title="3、在调用原始方法之前插入额外的执行逻辑（不推荐，不使用）"></a>3、在调用原始方法之前插入额外的执行逻辑（不推荐，不使用）</h3><p><a href="../../iOS/3必备知识架构/1语言/1语言-消息转发.md">《在调用原始方法之前插入额外的执行逻辑》</a></p>
<h2 id="三、常见的注解示例"><a href="#三、常见的注解示例" class="headerlink" title="三、常见的注解示例"></a>三、常见的注解示例</h2><p>以下内容摘自：<a href="https://juejin.cn/post/7217637205590114364" target="_blank" rel="noopener">Flutter 注解开发</a></p>
<ol>
<li><p><code>@override</code>：这个注解表示一个方法覆盖了父类的方法。它可以帮助我们检查是否正确地实现了方法覆盖，如果没有正确实现，编译器会给出警告。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="type">String</span> makeSound() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"makeSound"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  void makeSound() &#123;</span><br><span class="line">    print(<span class="symbol">'makeSoun</span>d');</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>@JsonSerializable()</code>：这个注解就是我们项目中使用到的<code>json_annotation</code>库的<code>@JsonSerializable()</code>注解。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JsonSerializable</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConversationListEntity</span> </span>&#123;</span><br><span class="line">  <span class="built_in">String</span>? nextSeq;</span><br><span class="line">  late <span class="built_in">List</span>&lt;ConversationListResList&gt; resList;</span><br><span class="line"></span><br><span class="line">  ConversationListEntity();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">factory</span> ConversationListEntity.fromJson(<span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="keyword">dynamic</span>&gt; json) =&gt; $ConversationListEntityFromJson(json);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="keyword">dynamic</span>&gt; toJson() =&gt; $ConversationListEntityToJson(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">String</span> toString() &#123;</span><br><span class="line">    <span class="keyword">return</span> jsonEncode(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>我们项目中的<code>@RootView(jumpId: &quot;1005&quot;)</code>：用来为订单详情页面生成路由代码。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RootView</span>(jumpId: <span class="string">"1005"</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OrderDetail</span> <span class="keyword">extends</span> <span class="title">BaseWidget</span> </span>&#123;</span><br><span class="line">  OrderDetail(&#123;Key? key&#125;) : <span class="keyword">super</span>();</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  OrderDetailState createState() =&gt; OrderDetailState();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="附1、iOS注解原理介绍"><a href="#附1、iOS注解原理介绍" class="headerlink" title="附1、iOS注解原理介绍"></a>附1、iOS注解原理介绍</h2><p>1、在oc中实现注解一样的东西肯定是通过宏来实现的。</p>
<p>2、在oc中实现注解主要有4个方向：代码中注解，类注解，属性注解，方法注解。</p>
<p>其中代码中注解的形式应该是最常见的。你说没见过？libextobjc中那一套@weakify和@strongify你们总用得很爽吧。拆开看看这就是做代码中注解的标准形式了。而类注解，考虑了很久暂时还是误解状态，因此也没法讲了。因此实现属性注解和方法注解是关键。</p>
<p>3、既然是宏实现的，因此注解宏展开后应该是实际能够在对应的段落实际有效的语法才对。另外为了和面向对象的oc类型进行关联，因此在oc中可以随便乱写的c代码当然很难办了。因此我们可以做的宏很快就限定下来了，在属性中宏展开新的属性，在方法中宏展开新的方法。</p>
<p><a href="https://lrdcq.com/me/read.php/79.htm" target="_blank" rel="noopener">在oc中实现注解一样的东西</a></p>
<p>实现</p>
<p>首先实现一下方法注解。由于我们知道我们需要展开方法，因此我们很快就能写出这样的宏：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// __COUNTER__ 这个宏每次使用都会自动+1</span></span><br><span class="line"><span class="comment">// ## 是宏的直接串接</span></span><br><span class="line"><span class="meta">#define path(x) \</span></span><br><span class="line">- (<span class="keyword">id</span>)__klmurl_path_<span class="meta">##__COUNTER__() &#123; \</span></span><br><span class="line">    <span class="keyword">return</span> x ;\</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">所以结果是 __klmurl_path_1</span><br></pre></td></tr></table></figure>
<p>@是哪儿来的，毕竟宏里面本来是不允许有这样的符号的。原来强项在展开的内容前加了无用的带@的表达式：参考 @weakify 其也只是宏定义weakify</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#define weakify(...) \</span></span><br><span class="line">    rac_keywordify \</span><br><span class="line">    metamacro_foreach_cxt(rac_weakify_,, __<span class="keyword">weak</span>, __VA_ARGS__)</span><br><span class="line"></span><br><span class="line"><span class="meta">#define rac_keywordify autoreleasepool &#123;&#125;</span></span><br><span class="line"><span class="meta">#define rac_keywordify try &#123;&#125; @catch (...) &#123;&#125;</span></span><br></pre></td></tr></table></figure>
<p>这样才能很自然的串一个@。</p>
<p>优化考虑有什么带@的而且没有什么卵用的标示呢。@compatibility_alias</p>
<p>这一段展开后的代码是：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// __COUNTER__ 这个宏每次使用都会自动+1</span></span><br><span class="line"><span class="comment">// ## 是宏的直接串接</span></span><br><span class="line"><span class="meta">#define path(x) \</span></span><br><span class="line">compatibility_alias _KLMURL_0 KLMURL;</span><br><span class="line">- (<span class="keyword">id</span>)__klmurl_path_<span class="meta">##__COUNTER__() &#123; \</span></span><br><span class="line">    <span class="keyword">return</span> x ;\</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">所以结果是 __klmurl_path_1</span><br></pre></td></tr></table></figure>
<h2 id="附1、Flutter-注解"><a href="#附1、Flutter-注解" class="headerlink" title="附1、Flutter 注解"></a>附1、Flutter 注解</h2><p>参考文章：<a href="https://juejin.cn/post/6844903878392053774" target="_blank" rel="noopener">Flutter 注解处理及代码生成</a></p>
<h3 id="1、注解的调用和执行结果"><a href="#1、注解的调用和执行结果" class="headerlink" title="1、注解的调用和执行结果"></a>1、注解的调用和执行结果</h3><p><strong>对 TestModel 类进行注解</strong></p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CJPageInfoMetadata</span>(<span class="string">"我是页面描述"</span>, <span class="string">'home_page'</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestModel</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 属性</span></span><br><span class="line">  <span class="built_in">int</span> age;</span><br><span class="line">  <span class="built_in">int</span> bookNum;</span><br><span class="line">	</span><br><span class="line">  <span class="comment">// 方法</span></span><br><span class="line">  <span class="keyword">void</span> fun1() &#123;&#125;</span><br><span class="line">  <span class="keyword">void</span> fun2(<span class="built_in">int</span> a) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>以要生成如下 TestModel.g.dart 文件为例</strong></p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GENERATED CODE - DO NOT MODIFY BY HAND</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// **************************************************************************</span></span><br><span class="line"><span class="comment">// CJPageInfoMetadata</span></span><br><span class="line"><span class="comment">// **************************************************************************</span></span><br><span class="line"></span><br><span class="line">extension TestModelAPTExtension on TestModel &#123;</span><br><span class="line">  <span class="built_in">String</span>? apt_pageKey() &#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="string">"home_page"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">String</span>? apt_pageDesc() &#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="string">"我是页面描述"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2、注解内部的实现"><a href="#2、注解内部的实现" class="headerlink" title="2、注解内部的实现"></a>2、注解内部的实现</h3><h4 id="2-1、注解及生成器"><a href="#2-1、注解及生成器" class="headerlink" title="2.1、注解及生成器"></a>2.1、注解及生成器</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注解</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CJPageInfoMetadata</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> pageDesc;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> pageKey;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> CJPageInfoMetadata(<span class="keyword">this</span>.pageDesc, <span class="keyword">this</span>.pageKey);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成器</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:source_gen/source_gen.dart'</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestGenerator</span> <span class="keyword">extends</span> <span class="title">GeneratorForAnnotation</span>&lt;<span class="title">CJPageInfoMetadata</span>&gt; </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">String</span>? generateForAnnotatedElement(<span class="built_in">Element</span> element, ConstantReader annotation, BuildStep buildStep) &#123;</span><br><span class="line">    <span class="built_in">String</span> className = element.name;</span><br><span class="line">    <span class="built_in">String</span>? pageKey = annotation.read(<span class="string">"pageKey"</span>);</span><br><span class="line">    <span class="built_in">String</span>? pageDesc = annotation.read(<span class="string">"pageDesc"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"""</span></span><br><span class="line"><span class="string">      extension <span class="subst">$&#123;className&#125;</span>APTExtension on <span class="subst">$&#123;className&#125;</span> &#123;</span></span><br><span class="line"><span class="string">      	String? apt_pageKey() &#123;</span></span><br><span class="line"><span class="string">      		return <span class="subst">$&#123;pageKey&#125;</span>;</span></span><br><span class="line"><span class="string">      	&#125;</span></span><br><span class="line"><span class="string">      	String? apt_pageDesc() &#123;</span></span><br><span class="line"><span class="string">      		return <span class="subst">$&#123;pageDesc&#125;</span>;</span></span><br><span class="line"><span class="string">      	&#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      """</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-2、使用注解生成代码的运行结果"><a href="#2-2、使用注解生成代码的运行结果" class="headerlink" title="2.2、使用注解生成代码的运行结果"></a>2.2、使用注解生成代码的运行结果</h4><p>命令执行成功后将会生成一个新的文件：TestModel.g.dart 其内容：</p>
<p>最后生成的文件为</p>
<h4 id="2-2、生成器中-Element-element-ConstantReader-annotation-BuildStep-buildStep-各值"><a href="#2-2、生成器中-Element-element-ConstantReader-annotation-BuildStep-buildStep-各值" class="headerlink" title="2.2、生成器中 Element element, ConstantReader annotation, BuildStep buildStep 各值"></a>2.2、生成器中 <code>Element element</code>, <code>ConstantReader annotation</code>, <code>BuildStep buildStep</code> 各值</h4><h5 id="2-2-1、Element-element：要注解的对象"><a href="#2-2-1、Element-element：要注解的对象" class="headerlink" title="2.2.1、Element element：要注解的对象"></a>2.2.1、<code>Element element</code>：要注解的对象</h5><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">element.toString: <span class="class"><span class="keyword">class</span> <span class="title">TestModel</span></span></span><br><span class="line"><span class="class"><span class="title">element</span>.<span class="title">name</span>: <span class="title">TestModel</span>																// 要注解的对象的【名】：<span class="title">TestModel</span></span></span><br><span class="line"><span class="class"><span class="title">element</span>.<span class="title">metadata</span>: [@<span class="title">CJPageInfoMetadata</span>("我是页面描述", '<span class="title">home_page</span>')]</span></span><br><span class="line"><span class="class"><span class="title">element</span>.<span class="title">kind</span>: <span class="title">CLASS</span>	// 元素类型有 <span class="title">CLASS</span>、<span class="title">FIELD</span>、<span class="title">FUNCTION</span> 等，</span></span><br><span class="line"><span class="class"><span class="title">element</span>.<span class="title">displayName</span>: <span class="title">TestModel</span></span></span><br><span class="line"><span class="class"><span class="title">element</span>.<span class="title">fields</span>: [<span class="title">int</span> <span class="title">age</span>, <span class="title">int</span> <span class="title">bookNum</span>]								// 要注解的对象的【属性】：[<span class="title">int</span> <span class="title">age</span>, <span class="title">int</span> <span class="title">bookNum</span>]</span></span><br><span class="line"><span class="class"><span class="title">element</span>.<span class="title">methods</span>: [<span class="title">fun1</span>() → <span class="title">void</span>, <span class="title">fun2</span>(<span class="title">int</span> <span class="title">a</span>) → <span class="title">void</span>]	// 要注解的对象的【方法名】：[<span class="title">fun1</span>() → <span class="title">void</span>, ...]</span></span><br><span class="line"><span class="class"><span class="title">element</span>.<span class="title">documentationComment</span>: <span class="title">null</span></span></span><br><span class="line"><span class="class"><span class="title">element</span>.<span class="title">enclosingElement</span>: <span class="title">flutter_annotation</span>|<span class="title">lib</span>/<span class="title">demo_class</span>.<span class="title">dart</span></span></span><br><span class="line"><span class="class"><span class="title">element</span>.<span class="title">hasAlwaysThrows</span>: <span class="title">false</span></span></span><br><span class="line"><span class="class"><span class="title">element</span>.<span class="title">hasDeprecated</span>: <span class="title">false</span></span></span><br><span class="line"><span class="class"><span class="title">element</span>.<span class="title">hasFactory</span>: <span class="title">false</span></span></span><br><span class="line"><span class="class"><span class="title">element</span>.<span class="title">hasIsTest</span>: <span class="title">false</span></span></span><br><span class="line"><span class="class"><span class="title">element</span>.<span class="title">hasLiteral</span>: <span class="title">false</span></span></span><br><span class="line"><span class="class"><span class="title">element</span>.<span class="title">hasOverride</span>: <span class="title">false</span></span></span><br><span class="line"><span class="class"><span class="title">element</span>.<span class="title">hasProtected</span>: <span class="title">false</span></span></span><br><span class="line"><span class="class"><span class="title">element</span>.<span class="title">hasRequired</span>: <span class="title">false</span></span></span><br><span class="line"><span class="class"><span class="title">element</span>.<span class="title">isPrivate</span>: <span class="title">false</span></span></span><br><span class="line"><span class="class"><span class="title">element</span>.<span class="title">isPublic</span>: <span class="title">true</span></span></span><br><span class="line"><span class="class"><span class="title">element</span>.<span class="title">isSynthetic</span>: <span class="title">false</span></span></span><br><span class="line"><span class="class"><span class="title">element</span>.<span class="title">nameLength</span>: 9</span></span><br><span class="line"><span class="class"><span class="title">element</span>.<span class="title">runtimeType</span>: <span class="title">ClassElementImpl</span></span></span><br><span class="line"><span class="class">...</span></span><br></pre></td></tr></table></figure>
<h5 id="2-2-2、ConstantReader-annotation：对注解对象添加的注解信息"><a href="#2-2-2、ConstantReader-annotation：对注解对象添加的注解信息" class="headerlink" title="2.2.2、ConstantReader annotation：对注解对象添加的注解信息"></a>2.2.2、<code>ConstantReader annotation</code>：对注解对象添加的注解信息</h5><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">annotation.runtimeType: _DartObjectConstant</span><br><span class="line">annotation.read(<span class="string">"pageDesc"</span>): <span class="string">'我是页面描述'</span></span><br><span class="line">annotation.read(<span class="string">"pageKey"</span>): <span class="string">'home_page'</span></span><br><span class="line">annotation.objectValue: CJPageInfoMetadata (pageDesc = <span class="built_in">String</span> (<span class="string">'我是页面描述'</span>); pageKey = <span class="built_in">String</span> (<span class="string">'home_page'</span>))</span><br></pre></td></tr></table></figure>
<h5 id="2-2-3、BuildStep-buildStep-：提供的是该次构建的输入输出信息"><a href="#2-2-3、BuildStep-buildStep-：提供的是该次构建的输入输出信息" class="headerlink" title="2.2.3、BuildStep buildStep ：提供的是该次构建的输入输出信息:"></a>2.2.3、<code>BuildStep buildStep</code> ：提供的是该次构建的输入输出信息:</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">buildStep.runtimeType: BuildStepImpl</span><br><span class="line">buildStep.inputId.path: lib/demo_class.dart</span><br><span class="line">buildStep.inputId.extension: .dart</span><br><span class="line">buildStep.inputId.package: flutter_annotation</span><br><span class="line">buildStep.inputId.uri: package:flutter_annotation/demo_class.dart</span><br><span class="line">buildStep.inputId.pathSegments: [lib, demo_class.dart]</span><br><span class="line">buildStep.expectedOutputs.path: lib/demo_class.g.dart</span><br><span class="line">buildStep.expectedOutputs.extension: .dart</span><br><span class="line">buildStep.expectedOutputs.package: flutter_annotation</span><br></pre></td></tr></table></figure>
<h3 id="3、使用注解生成代码前的准备"><a href="#3、使用注解生成代码前的准备" class="headerlink" title="3、使用注解生成代码前的准备"></a>3、使用注解生成代码前的准备</h3><p>注解的生成器 Generator 的执行需要 Builder 来触发</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1、使用Generator 创建一个Builder</span></span><br><span class="line">Builder testBuilder(BuilderOptions options) =&gt; LibraryBuilder(TestGenerator());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、创建 build.yaml 文件，将我们要执行的 builder 配置进去</span></span><br><span class="line">builders:</span><br><span class="line">  testBuilder:</span><br><span class="line">    <span class="keyword">import</span>: <span class="string">"package:flutter_annotation/test.dart"</span></span><br><span class="line">    builder_factories: [<span class="string">"testBuilder"</span>]</span><br><span class="line">    build_extensions: &#123;<span class="string">".dart"</span>: [<span class="string">".g.part"</span>]&#125;</span><br><span class="line">    auto_apply: root_package</span><br><span class="line">    build_to: source</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3、运行 Builder，命令执行成功后将会生成一个新的文件：TestModel.g.dart 其内容：</span></span><br><span class="line">flutter packages pub run build_runner build</span><br></pre></td></tr></table></figure>
<p>Flutter注解的Builder的原理很像使用shell或者python脚本遍历文件的方式。</p>
<p>已知@Description是注解，其作用为提取 @Description 的方法描述到一个文件。</p>
<p>请说说@Description注解的内部实现（使用shell或者python脚本遍历文件的方式，不在本次讨论中）</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// my_class.dart</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Description</span>(<span class="string">'This method does something important.'</span>) <span class="comment">// 注解</span></span><br><span class="line">  <span class="keyword">void</span> myImportantMethod() &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'Doing something important.'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// description_generator.dart</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:source_gen/source_gen.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:code_builder/code_builder.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:annotations/annotations.dart'</span>; <span class="comment">// 引入上面创建的注解库</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DescriptionGenerator</span> <span class="keyword">extends</span> <span class="title">GeneratorForAnnotation</span>&lt;<span class="title">Description</span>&gt; </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">String</span>? generateForAnnotatedElement(<span class="built_in">Element</span> element, ConstantReader annotation, BuildStep buildStep) &#123; &#123;</span><br><span class="line">    <span class="comment">// 检查注解是否应用在方法上</span></span><br><span class="line">    <span class="keyword">if</span> (element.isMethod) &#123;</span><br><span class="line">      <span class="keyword">final</span> description = annotation.read(<span class="string">'value'</span>).stringValue;</span><br><span class="line">      <span class="keyword">final</span> method = element.asMethod();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 创建一个方法调用的描述文本</span></span><br><span class="line">      <span class="keyword">final</span> code = Block.of([</span><br><span class="line">        Directive.code(<span class="string">"print('Method <span class="subst">$&#123;method.name&#125;</span> description: <span class="subst">$description<span class="string">');")</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">      ]);</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string"></span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">      // 返回生成的代码</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">      return code.toString();</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">    &#125;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string"></span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">    // 如果注解没有应用在方法上，返回空字符串</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">    return '</span><span class="string">';</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">  &#125;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">&#125;</span></span></span></span><br></pre></td></tr></table></figure>
<h2 id="其他参考文章"><a href="#其他参考文章" class="headerlink" title="其他参考文章"></a>其他参考文章</h2><p><a href="https://pub.dev/packages/mustache_template" target="_blank" rel="noopener">https://pub.dev/packages/mustache_template</a></p>
<blockquote>
<p><code>mustache_template</code> 是一个用于Flutter的Dart模板库，它支持<code>dart2js</code>和<code>dart2native</code>。</p>
</blockquote>
<ul>
<li><a href="https://www.cnblogs.com/cherf/articles/16320710.html" target="_blank" rel="noopener">Mustache模板引擎的语法及使用</a></li>
</ul>
<h2 id="End"><a href="#End" class="headerlink" title="End"></a>End</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://dvlproad.github.io/Architecture架构/高质量妙用/妙用注解/" data-id="cm2noo943009kovr4qlh20zds" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Architecture/">Architecture</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Architecture架构/高质量妙用/妙用依赖注入" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/Architecture架构/高质量妙用/妙用依赖注入/" class="article-date">
  <time datetime="2024-04-20T09:05:41.000Z" itemprop="datePublished">2024-04-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Architecture/">Architecture</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Architecture架构/高质量妙用/妙用依赖注入/">妙用依赖注入</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[toc]</p>
<h1 id="妙用依赖注入"><a href="#妙用依赖注入" class="headerlink" title="妙用依赖注入"></a>妙用依赖注入</h1><p>常见的依赖注入模式有构造器注入、属性注入和方法注入。</p>
<p><a href="https://developer.aliyun.com/article/1260903" target="_blank" rel="noopener">Flutter依赖注入</a></p>
<h2 id="End"><a href="#End" class="headerlink" title="End"></a>End</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://dvlproad.github.io/Architecture架构/高质量妙用/妙用依赖注入/" data-id="cm2noo949009oovr4bbe79jzj" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Architecture/">Architecture</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-算法与数学/9算法" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/算法与数学/9算法/" class="article-date">
  <time datetime="2024-04-09T02:24:11.353Z" itemprop="datePublished">2024-04-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="必备知识架构-算法"><a href="#必备知识架构-算法" class="headerlink" title="必备知识架构-算法"></a>必备知识架构-算法</h1><p>[toc]</p>
<blockquote>
<p>稳定与不稳定：如果a原本在b的前面并且a=b，排序之后a仍然在b的前面那就是稳定排序，如果排序之后a可能会出现在b的后面则是不稳定排序。所以冒泡排序是稳定的。选择排序可能不稳定。</p>
<p>空间复杂度：是指算法在计算机内执行时所需的存储空间与n的规模之间的关系。</p>
<p>时间复杂度：排序的的总操作次数，与n的规模之间的关系。</p>
</blockquote>
<p>以下是我们在面试中要问的主要问题：</p>
<p>1.数据结构：<br>a、 链表<br>b、 堆叠<br>c、 排队<br>d、 二叉树<br>e、 哈希表</p>
<p>2.算法：<br>a、 排序（像快速排序和归并排序），二分搜索法，贪婪算法。<br>b、 二叉树（比如遍历、构造、操作…）</p>
<p><a href="https://www.cnblogs.com/ZachRobin/p/7094852.html" target="_blank" rel="noopener">iOS 开发中常用的排序（冒泡、选择、快速、插入、希尔、归并、基数）算法</a></p>
<table>
<thead>
<tr>
<th>排序算法</th>
<th>平均时间复杂度</th>
<th>其他时间复杂度</th>
<th>平均空间复杂度</th>
<th>是否是稳定性的</th>
</tr>
</thead>
<tbody>
<tr>
<td>冒泡排序</td>
<td>O(n^2)</td>
<td>最好：O(n)，已是有序的<br> 最坏：O(n^2)，是逆序的</td>
<td>O(1)</td>
<td>稳定</td>
</tr>
<tr>
<td>选择排序</td>
<td>O(n^2)</td>
<td>——</td>
<td>O(1)</td>
<td>不稳定</td>
</tr>
<tr>
<td>快速排序</td>
<td>O(nlogn)</td>
<td>最好：O(nlogn)，每次划分都非常平衡时<br>最坏：O(n^2)，每次划分非常不均匀时</td>
<td>O(nlogn)</td>
<td>不稳定<br>不稳定发生在交换的时刻；</td>
</tr>
<tr>
<td>归并排序</td>
<td>O(nlogn)</td>
<td>——</td>
<td>O(n)</td>
<td>稳定</td>
</tr>
</tbody>
</table>
<p>因为冒泡和选择排序都是原地排序算法，不需要额外的存储空间。所以其空间复杂度都是O(1)。</p>
<p>归并排序需要额外的空间来存储合并过程中的临时数组，其空间复杂度O(n)。</p>
<p><a href="https://www.hello-algo.com/chapter_sorting/quick_sort/#1153" target="_blank" rel="noopener">11.5.3  快速排序为什么快</a></p>
<p><a href="https://github.com/MisterBooo/Play-With-Sort-OC" target="_blank" rel="noopener">在Object-C中学习数据结构与算法之排序算法</a></p>
<p>二分搜索法，是一种【在有序数组中】查找某一特定元素的搜索算法。</p>
<p><a href="https://www.jianshu.com/p/2ba53d050637" target="_blank" rel="noopener">iOS查找算法之二分查找</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/76164082" target="_blank" rel="noopener">漫画：五分钟学会贪心算法</a></p>
<p>有一个背包，最多能承载150斤的重量，现在有7个物品，<br>重量分别为[35, 30, 60, 50, 40, 10, 25]，<br>价值分别为[10, 40, 30, 50, 35, 40, 30]，<br>应该如何选择才能使得我们的背包背走最多价值的物品？</p>
<p>局部最优解</p>
<p>1、每次都尽量选择当前【价值最高】的物品<br>重量分别为[35, 30🚗,     60, 50🚗,     40🚗,   10🚗,    25]，  130<br>价值分别为[10, 40②✅, 30, 50①✅, 35④✅, 40③✅, 30]， 165</p>
<p>2、每次都尽量选择当前【重量最小】的物品<br>重量分别为[35④, 30③, 60, 50, 40⑤, 10①,  25②]，    140<br>价值分别为[10✅,40✅, 30, 50, 35✅, 40✅, 30✅]，    155</p>
<p>3、每次都尽量选择当前【价值密度最高】的物品<br>重量分别为[35🚗,    30🚗,   60,   50🚗,  40,    10🚗,   25🚗]， 150<br>价值分别为[10✅,    40✅,   30,   50✅,  35,    40✅,   30✅]， 170<br>价值密度  [0.285⑤, 1.333②, 0.5, 1.0④,  0.875, 4.0①,  1.2③]</p>
<p>想象一下下列场景：</p>
<ol>
<li>从通讯录中寻找某个联系人</li>
<li>从一大堆文件中寻找某个文件</li>
<li>到了影厅之后，寻找电影票上指定的座位</li>
</ol>
<p>如果以上情况中，联系人、文件、影厅座位这些“数据”没有按照需要的顺序组织，如何找到想要的特定“数据”呢？会非常麻烦！所以说，对于需要搜索的数据，往往应该先排个序！</p>
<p><a href="https://zhuanlan.zhihu.com/p/31810006" target="_blank" rel="noopener">排序比较 &amp; 对比归并排序与快速排序</a></p>
<p><img src="/算法与数学/9算法/image-20240902163103782.png" alt="image-20240902163103782" style="zoom: 33%;"></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 交换数组中的两个元素</span></span><br><span class="line"><span class="keyword">void</span> swap(<span class="built_in">NSMutableArray</span> *array, <span class="built_in">NSInteger</span> i, <span class="built_in">NSInteger</span> j) &#123;</span><br><span class="line">    <span class="built_in">NSNumber</span> *temp = array[i];</span><br><span class="line">    array[i] = array[j];</span><br><span class="line">    array[j] = temp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>算法图解</p>
<p>《<a href="https://github.com/dvlproad/034-Data-AlgorithmCollect-iOS" target="_blank" rel="noopener">034-Data-AlgorithmCollect-iOS</a>》</p>
<p><img src="/算法与数学/9算法/Data-AlgorithmCollect-1.png" alt="Data-AlgorithmCollect-1"></p>
<h2 id="一、冒泡排序"><a href="#一、冒泡排序" class="headerlink" title="一、冒泡排序"></a>一、冒泡排序</h2><p>实现一个冒泡排序或者快速排序</p>
<p>从小到大排序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">假设45132，按从小到大排序</span><br><span class="line">i = 0 的时候，j的相邻两个位置都要比较排一下位置：</span><br><span class="line">         j = 0 的时候：arr_M = 45132(a[0]和a[1]比得到的结果)</span><br><span class="line">         j = 1 的时候：arr_M = 41532(a[1]和a[2]比得到的结果)</span><br><span class="line">         j = 2 的时候：arr_M = 41352(a[2]和a[3]比得到的结果)</span><br><span class="line">         j = 3 的时候：arr_M = 41325(a[3]和a[4]比得到的结果)</span><br><span class="line">i=0已经将第一个最大的值放到最后了。</span><br><span class="line"></span><br><span class="line">i = 1 的时候，j的相邻两个位置都要比较排一下位置：</span><br><span class="line">         j = 0 的时候：arr_M = 14325</span><br><span class="line">         j = 1 的时候：arr_M = 13425</span><br><span class="line">         j = 2 的时候：arr_M = 13245</span><br><span class="line">i=1已经将第二个最大的值放到最后了。</span><br></pre></td></tr></table></figure>
<p><a href="#冒泡排序代码实现">冒泡排序代码实现</a></p>
<h2 id="二、选择排序"><a href="#二、选择排序" class="headerlink" title="二、选择排序"></a>二、选择排序</h2><p><strong>从数组的第a[i+1]个元素开始到第n个元素，寻找最小的元素(的位置)</strong>。（具体过程为:先设最小位置为i=0，从该位置往后逐一比较，若遇到比之小的则记下该最小值的位置，结束后交换）；</p>
<p>先为a[0]取到最小值，再为a[1]取到最小值，再继续…..</p>
<p>从小到大排序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">假设45132，按从小到大排序</span><br><span class="line">i = 0 的时候，j的相邻两个位置都要比较排一下位置：</span><br><span class="line">     j = i+1=1 的时候：arr_M = 45132(此时a[0]的4和a[1]的5比较：得到的结果)</span><br><span class="line">         j = 2 的时候：arr_M = 15432(此时a[0]的4和a[2]的1比较：得到的结果)</span><br><span class="line">         j = 3 的时候：arr_M = 15432(此时a[0]的1和a[3]的3比较：得到的结果)</span><br><span class="line">         j = 4 的时候：arr_M = 15432(此时a[0]的1和a[4]的2比较：得到的结果)</span><br><span class="line">i=0已经将第一个最小的值放到第一位了。</span><br><span class="line"></span><br><span class="line">i = 1 的时候，j的相邻两个位置都要比较排一下位置：</span><br><span class="line">         j = 2 的时候：arr_M = 14532(a[1]和a[2]比得到的结果)</span><br><span class="line">         j = 3 的时候：arr_M = 13542(a[1]和a[3]比得到的结果)</span><br><span class="line">         j = 4 的时候：arr_M = 12543(a[1]和a[4]比得到的结果)</span><br><span class="line">i=1已经将第二个最小的值放到最第二位了。</span><br></pre></td></tr></table></figure>
<p><a href="#选择排序代码实现">选择排序代码实现</a></p>
<h2 id="三、快速排序"><a href="#三、快速排序" class="headerlink" title="三、快速排序"></a>三、快速排序</h2><p><a href="https://www.sohu.com/a/246785807_684445" target="_blank" rel="noopener">漫画：什么是快速排序？（完整版） </a></p>
<p>快速排序（Quicksort）是对冒泡排序的一种改进。</p>
<blockquote>
<p>同冒泡排序一样，快速排序也属于<strong>交换排序</strong>，通过元素之间的比较和交换位置来达到排序的目的。</p>
<p>不同的是，冒泡排序在每一轮只把一个元素冒泡到数列的一端，而快速排序<strong>在每一轮挑选一个基准元素，并让其他比它大的元素移动到数列一边，比它小的元素移动到数列的另一边，从而把数列拆解成了两个部分</strong>。这种思路就叫做<strong>分治法</strong>。</p>
</blockquote>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 快速排序函数 quickSort(array, 0, [array count] - 1);</span></span><br><span class="line"><span class="keyword">void</span> quickSort(<span class="built_in">NSMutableArray</span> *array, <span class="built_in">NSInteger</span> left, <span class="built_in">NSInteger</span> right) &#123;</span><br><span class="line">    <span class="keyword">if</span> (left &lt; right) &#123;</span><br><span class="line">        <span class="built_in">NSInteger</span> pivotIndex = partition(array, left, right);</span><br><span class="line">        quickSort(array, left, pivotIndex - <span class="number">1</span>);</span><br><span class="line">        quickSort(array, pivotIndex + <span class="number">1</span>, right);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="#快速排序代码实现">快速排序代码实现</a></p>
<h3 id="1、排序原理："><a href="#1、排序原理：" class="headerlink" title="1、排序原理："></a>1、排序原理：</h3><p>设要排序的数组是A[0]……A[N-1]，首先任意选取一个数据（通常选用数组的第一个数）作为关键数据，</p>
<p><a href="https://baike.baidu.com/pic/快速排序算法/369842/0/b7003af33a87e950707fdf2110385343fbf2b416?fr=lemma&amp;ct=single" target="_blank" rel="noopener"><img src="https://bkimg.cdn.bcebos.com/pic/b7003af33a87e950707fdf2110385343fbf2b416?x-bce-process=image/resize,m_lfit,w_220,h_220,limit_1" alt="快排图"></a>快排图</p>
<p>然后将所有比它小的数都放到它左边，所有比它大的数都放到它右边，这个过程称为一趟快速排序。</p>
<h3 id="2、排序流程"><a href="#2、排序流程" class="headerlink" title="2、排序流程"></a>2、排序流程</h3><p>快速排序算法通过多次比较和交换来实现排序，其排序流程如下：</p>
<p>(1)首先设定一个分界值，通过该分界值将数组分成左右两部分。 </p>
<p>(2)将大于或等于分界值的数据集中到数组右边，小于分界值的数据集中到数组的左边。此时，左边部分中各元素都小于或等于分界值，而右边部分中各元素都大于或等于分界值。</p>
<p>(3)然后，左边和右边的数据可以独立排序。对于左侧的数组数据，又可以取一个分界值，将该部分数据分成左右两部分，同样在左边放置较小值，右边放置较大值。右侧的数组数据也可以做类似处理。</p>
<p>(4)重复上述过程，可以看出，这是一个递归定义。通过递归将左侧部分排好序后，再递归排好右侧部分的顺序。当左、右两个部分各数据排序完成后，整个数组的排序也就完成了。</p>
<h2 id="四、归并排序"><a href="#四、归并排序" class="headerlink" title="四、归并排序"></a>四、归并排序</h2><p><a href="https://www.hello-algo.com/chapter_sorting/merge_sort/" target="_blank" rel="noopener"><strong>Hello 算法</strong> 11.6  归并排序</a></p>
<p><a href="https://www.cnblogs.com/chengxiao/p/6194356.html" target="_blank" rel="noopener">图解排序算法(四)之归并排序</a></p>
<p>1、<strong>划分阶段</strong>：通过递归不断地将数组从中点处分开（以把序列分成元素尽可能相等的两半），将长数组的排序问题转换为短数组的排序问题。当子数组长度为 1 时终止划分，开始合并。</p>
<p><img src="/算法与数学/9算法/1024555-20161218163120151-452283750.png" alt="归并排序" style="zoom:33%;"></p>
<p>归并排序思路简单，速度仅次于快速排序，为稳定排序算法，一般用于对总体无序，但是各子项相对有序的数列。</p>
<p>2、<strong>合并阶段</strong>：持续地将左右两个较短的有序数组合并为一个较长的有序数组，直至结束。</p>
<blockquote>
<p>归并排序的合并过程如下：</p>
<ol>
<li><strong>初始化</strong>：创建两个指针，分别指向两个已排序数组的起始位置。</li>
<li><strong>比较元素</strong>：比较两个指针所指向的元素。</li>
<li><strong>选择较小元素</strong>：<strong>将较小的元素放入临时数组，并移动该元素所在数组的指针。</strong></li>
<li><strong>重复比较</strong>：重复步骤2和3，直到其中一个数组的所有元素都被比较过。</li>
<li><strong>复制剩余元素</strong>：如果一个数组的所有元素都已经被比较并复制到临时数组中，将另一个数组中剩余的元素直接复制到临时数组的末尾。</li>
<li><strong>返回临时数组</strong>：临时数组现在是一个合并后的有序数组。</li>
</ol>
</blockquote>
<p>示例：要将[4,5,7,8]和[1,2,3,6]两个已经有序的子序列，合并为最终序列[1,2,3,4,5,6,7,8]，来看下实现步骤。</p>
<p><img src="https://images2018.cnblogs.com/blog/1122709/201807/1122709-20180711175409829-1250175071.png" alt="img" style="zoom: 33%;"></p>
<h2 id="附：深度优先遍历-DFS-和广度优先遍历-BFS"><a href="#附：深度优先遍历-DFS-和广度优先遍历-BFS" class="headerlink" title="附：深度优先遍历(DFS)和广度优先遍历(BFS)"></a>附：深度优先遍历(DFS)和广度优先遍历(BFS)</h2><p>深度优先遍历(Depth First Search, 简称 DFS) </p>
<p><img src="/算法与数学/9算法/algorithm_DFS_1.png" alt="img"></p>
<p>广度优先遍历（Breath First Search, 简称 BFS） 也叫层序遍历，指的是从图的一个未遍历的节点出发，先遍历这个节点的相邻节点，再依次遍历每个相邻节点的相邻节点。</p>
<p>BFS 一般是解决最短路径问题。</p>
<p><img src="/算法与数学/9算法/algorithm_BFS_1.gif" alt="img"></p>
<h1 id="iOS算法篇-leetcode题目记录"><a href="#iOS算法篇-leetcode题目记录" class="headerlink" title="iOS算法篇-leetcode题目记录"></a>iOS算法篇-leetcode题目记录</h1><ul>
<li><a href="https://www.jianshu.com/p/8bca07d00b3e" target="_blank" rel="noopener">iOS算法篇-leetcode题目记录</a></li>
</ul>
<h2 id="附：排序算法代码"><a href="#附：排序算法代码" class="headerlink" title="附：排序算法代码"></a>附：排序算法代码</h2><p><a name="冒泡排序代码实现"></a></p>
<h3 id="1、冒泡排序代码实现"><a href="#1、冒泡排序代码实现" class="headerlink" title="1、冒泡排序代码实现"></a>1、冒泡排序代码实现</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">- (void)methodMaopao &#123;</span><br><span class="line">  int array[5] = &#123;4, 5, 1, 3, 2&#125;;</span><br><span class="line">    </span><br><span class="line">  for (int i = 0; i &lt; 5-1; i++) &#123; //需要比较几遍</span><br><span class="line">      for(int j = 0; j &lt; 5-1-i; j++) &#123; //每一遍都从0开始到倒数第-i个</span><br><span class="line">          if (array[j] &gt; array [j + 1])&#123;</span><br><span class="line">              int temp = array[j];</span><br><span class="line">              array[j] = array[j + 1];</span><br><span class="line">              array[j + 1] = temp;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  for(int i = 0; i &lt; 5; i++) &#123;</span><br><span class="line">      printf(&quot;%d\n&quot;,array[i]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a name="选择排序代码实现"></a></p>
<h3 id="2、选择排序代码实现"><a href="#2、选择排序代码实现" class="headerlink" title="2、选择排序代码实现"></a>2、选择排序代码实现</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sort</span><span class="params">(items: Array&lt;Int&gt;)</span></span> -&gt; <span class="type">Array</span>&lt;<span class="type">Int</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">var</span> list = items</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span>..&lt;list.<span class="built_in">count</span> &#123;</span><br><span class="line">    		<span class="comment">//记录当前最小的数，比较i+1后更大的数进行记录</span></span><br><span class="line">        <span class="keyword">var</span> minIndex = i</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> i+<span class="number">1</span>..&lt;list.<span class="built_in">count</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> list[j] &lt; list[minIndex] &#123;</span><br><span class="line">                minIndex = j</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 交换</span></span><br><span class="line">        <span class="keyword">let</span> temp = list[minIndex]</span><br><span class="line">        list[minIndex] = list[i]</span><br><span class="line">        list[i] = temp</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> list</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a name="快速排序代码实现"></a></p>
<h3 id="3、快速排序代码实现"><a href="#3、快速排序代码实现" class="headerlink" title="3、快速排序代码实现"></a>3、快速排序代码实现</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//单趟 快速排序挖坑法</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">PartSort2</span><span class="params">(<span class="keyword">int</span>* a, <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (left &gt;= right) <span class="keyword">return</span> left;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">int</span> begin = left;</span><br><span class="line">	<span class="keyword">int</span> end = right;</span><br><span class="line">	<span class="keyword">int</span> key = a[left]; <span class="comment">//保存要排序的值</span></span><br><span class="line">	<span class="keyword">while</span> (begin &lt; end) <span class="comment">//当左右指针相遇时结束</span></span><br><span class="line">	&#123;</span><br><span class="line">    <span class="comment">// begin是坑，从后往前找比key小的值填到坑里</span></span><br><span class="line">		<span class="keyword">while</span> (begin &lt; end &amp;&amp; a[end] &gt;= key) &#123;</span><br><span class="line">			end--;</span><br><span class="line">		&#125;</span><br><span class="line">		a[begin] = a[end];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 此时end位置是坑，从前往后比key大的值填到坑中</span></span><br><span class="line">		<span class="keyword">while</span> (begin &lt; end &amp;&amp; a[begin] &lt;= key) &#123;</span><br><span class="line">			begin++;</span><br><span class="line">		&#125;</span><br><span class="line">		a[end] = a[begin];</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="comment">//begin和end相遇的地方是key对应的位置</span></span><br><span class="line">	a[end] = key;</span><br><span class="line">	<span class="keyword">return</span> end; <span class="comment">//返回排好位置的元素的下标</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="END"><a href="#END" class="headerlink" title="END"></a>END</h2><blockquote>
<p>&lt; <a href="#目录">返回目录</a></p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://dvlproad.github.io/算法与数学/9算法/" data-id="cm2noo7l3004fovr4uaaqnoc7" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/45/">45</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Architecture/">Architecture</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Architecture/第一章：架构相关/">第一章：架构相关</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Architecture/第七章：技术选型/">第七章：技术选型</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Architecture/第三章：基础规范/">第三章：基础规范</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Architecture/第九章：监控相关/">第九章：监控相关</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Architecture/第二章：框架相关/">第二章：框架相关</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Architecture/第八章：页面加载相关/">第八章：页面加载相关</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Architecture/第六章：通用业务规范/">第六章：通用业务规范</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Architecture/第四章：基础框架设计及接口文档/">第四章：基础框架设计及接口文档</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Flutter/">Flutter</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Flutter/无瑕疵的混编登录页/">无瑕疵的混编登录页</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Flutter/第一章：Flutter入门/">第一章：Flutter入门</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Flutter/第七章：规范/">第七章：规范</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Flutter/第三章：原生项目与Flutter的交互/">第三章：原生项目与Flutter的交互</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Flutter/第九章：框架升级/">第九章：框架升级</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Flutter/第二章：集成Flutter到原生项目/">第二章：集成Flutter到原生项目</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Flutter/第五章：详解/">第五章：详解</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Flutter/第八章：状态管理/">第八章：状态管理</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Flutter/第六章：进阶/">第六章：进阶</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Flutter/第四章：Flutter登录页实战/">第四章：Flutter登录页实战</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Flutter/第零章：Flutter源码/">第零章：Flutter源码</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/QA/">QA</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/README/">README</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/React/">React</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/React/第一章：React入门/">第一章：React入门</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/ReactNative/">ReactNative</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/ReactNative/第一章：ReactNative入门/">第一章：ReactNative入门</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ReactNative/第一章：React入门/">第一章：React入门</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ReactNative/第五章：ReactNative详解/">第五章：ReactNative详解</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ReactNative/第八章：ReactNative实践/">第八章：ReactNative实践</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ReactNative/第六章：ReactNative进阶/">第六章：ReactNative进阶</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Script/">Script</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Script/JQuery/">JQuery</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Script/JavaScript/">JavaScript</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Script/Mac快速操作/">Mac快速操作</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Script/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Script/Ruby/">Ruby</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Script/Shell/">Shell</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Weex/">Weex</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Weex/第一章：Weex入门/">第一章：Weex入门</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/">iOS</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/Swift/">Swift</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/混编/">混编</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/移动分析/">移动分析</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/自动化/">自动化</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/证书发版/">证书发版</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/npmjs/">npmjs</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/上架相关/">上架相关</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/代码管理/">代码管理</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/安全与破解/">安全与破解</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/实用工具/">实用工具</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/实用工具/ChatGPT/">ChatGPT</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/实用工具/GitBook/">GitBook</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/实用工具/Hexo/">Hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/实用工具/Jenkins/">Jenkins</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/实用工具/MySQL/">MySQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/实用工具/XAMPP/">XAMPP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/实用工具/Zentao/">Zentao</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/实用工具/其他小工具/">其他小工具</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作常识/">工作常识</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术常识/">技术常识</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/生活常识/">生活常识</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/电脑使用/">电脑使用</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/管理相关/">管理相关</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/管理相关/第一章：账号管理/">第一章：账号管理</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/编程工具/">编程工具</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/跨平台/">跨平台</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/跨平台/第一章：混编事项说明/">第一章：混编事项说明</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Architecture/">Architecture</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ChatGPT/">ChatGPT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CocoaPods/">CocoaPods</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flutter/">Flutter</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/">Git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JQuery/">JQuery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jenkins/">Jenkins</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mac快速操作/">Mac快速操作</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/QA/">QA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/README/">README</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/">React</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ReactNative/">ReactNative</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ruby/">Ruby</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Script/">Script</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shell/">Shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Swift/">Swift</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Weex/">Weex</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/h5与app交互/">h5与app交互</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iOS/">iOS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/npmjs/">npmjs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/上架相关/">上架相关</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/交互/">交互</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/埋点/">埋点</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/基类/">基类</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/安全/">安全</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/实用工具/">实用工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/工作常识/">工作常识</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/打包/">打包</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/技术常识/">技术常识</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/抓包/">抓包</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/搜索相关/">搜索相关</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/文档管理/">文档管理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/权限相关/">权限相关</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/架构模式/">架构模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/环境搭建/">环境搭建</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/生活常识/">生活常识</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/电脑使用/">电脑使用</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/瘦身/">瘦身</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/登录页实战/">登录页实战</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/破解/">破解</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/移动分析/">移动分析</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/管理相关/">管理相关</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/编程工具/">编程工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/自动化/">自动化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/请求/">请求</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/跨平台/">跨平台</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/路由及跳转/">路由及跳转</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/阿里云/">阿里云</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/阿里云oss/">阿里云oss</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/集成/">集成</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Architecture/" style="font-size: 20px;">Architecture</a> <a href="/tags/ChatGPT/" style="font-size: 10.83px;">ChatGPT</a> <a href="/tags/CocoaPods/" style="font-size: 10px;">CocoaPods</a> <a href="/tags/Flutter/" style="font-size: 18.33px;">Flutter</a> <a href="/tags/Git/" style="font-size: 13.33px;">Git</a> <a href="/tags/JQuery/" style="font-size: 10px;">JQuery</a> <a href="/tags/JavaScript/" style="font-size: 10px;">JavaScript</a> <a href="/tags/Jenkins/" style="font-size: 14.17px;">Jenkins</a> <a href="/tags/Mac快速操作/" style="font-size: 10px;">Mac快速操作</a> <a href="/tags/Python/" style="font-size: 11.67px;">Python</a> <a href="/tags/QA/" style="font-size: 10px;">QA</a> <a href="/tags/README/" style="font-size: 10px;">README</a> <a href="/tags/React/" style="font-size: 10.83px;">React</a> <a href="/tags/ReactNative/" style="font-size: 15.83px;">ReactNative</a> <a href="/tags/Ruby/" style="font-size: 10px;">Ruby</a> <a href="/tags/Script/" style="font-size: 15px;">Script</a> <a href="/tags/Shell/" style="font-size: 11.67px;">Shell</a> <a href="/tags/Swift/" style="font-size: 12.5px;">Swift</a> <a href="/tags/Weex/" style="font-size: 10px;">Weex</a> <a href="/tags/h5与app交互/" style="font-size: 12.5px;">h5与app交互</a> <a href="/tags/iOS/" style="font-size: 17.5px;">iOS</a> <a href="/tags/npmjs/" style="font-size: 10.83px;">npmjs</a> <a href="/tags/上架相关/" style="font-size: 10px;">上架相关</a> <a href="/tags/交互/" style="font-size: 12.5px;">交互</a> <a href="/tags/埋点/" style="font-size: 10.83px;">埋点</a> <a href="/tags/基类/" style="font-size: 10.83px;">基类</a> <a href="/tags/安全/" style="font-size: 14.17px;">安全</a> <a href="/tags/实用工具/" style="font-size: 16.67px;">实用工具</a> <a href="/tags/工作常识/" style="font-size: 10px;">工作常识</a> <a href="/tags/打包/" style="font-size: 10px;">打包</a> <a href="/tags/技术常识/" style="font-size: 13.33px;">技术常识</a> <a href="/tags/抓包/" style="font-size: 10px;">抓包</a> <a href="/tags/搜索相关/" style="font-size: 10px;">搜索相关</a> <a href="/tags/文档管理/" style="font-size: 14.17px;">文档管理</a> <a href="/tags/权限相关/" style="font-size: 10px;">权限相关</a> <a href="/tags/架构模式/" style="font-size: 11.67px;">架构模式</a> <a href="/tags/环境搭建/" style="font-size: 10.83px;">环境搭建</a> <a href="/tags/生活常识/" style="font-size: 10px;">生活常识</a> <a href="/tags/电脑使用/" style="font-size: 10px;">电脑使用</a> <a href="/tags/瘦身/" style="font-size: 11.67px;">瘦身</a> <a href="/tags/登录页实战/" style="font-size: 12.5px;">登录页实战</a> <a href="/tags/破解/" style="font-size: 11.67px;">破解</a> <a href="/tags/移动分析/" style="font-size: 11.67px;">移动分析</a> <a href="/tags/管理相关/" style="font-size: 11.67px;">管理相关</a> <a href="/tags/编程工具/" style="font-size: 12.5px;">编程工具</a> <a href="/tags/自动化/" style="font-size: 11.67px;">自动化</a> <a href="/tags/请求/" style="font-size: 10.83px;">请求</a> <a href="/tags/跨平台/" style="font-size: 19.17px;">跨平台</a> <a href="/tags/路由及跳转/" style="font-size: 11.67px;">路由及跳转</a> <a href="/tags/阿里云/" style="font-size: 10px;">阿里云</a> <a href="/tags/阿里云oss/" style="font-size: 13.33px;">阿里云oss</a> <a href="/tags/集成/" style="font-size: 11.67px;">集成</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/09/">September 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/08/">August 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/06/">June 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/05/">May 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">April 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">November 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/10/">October 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/09/">September 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">July 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">April 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/01/">January 2013</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/Architecture架构/架构相关/3组件化/5框架设计模式-⑦组件化/">框架设计模式-⑦组件化</a>
          </li>
        
          <li>
            <a href="/Architecture架构/监控相关/日志系统/">日志系统</a>
          </li>
        
          <li>
            <a href="/总目录/">总目录</a>
          </li>
        
          <li>
            <a href="/安全/网络加密/">网络接口数据安全的【攻与防大全】</a>
          </li>
        
          <li>
            <a href="/Architecture架构/监控相关/灰度系统/">灰度系统</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2024 dvlproad<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
    <a href="/about" class="mobile-nav-link">关于</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>